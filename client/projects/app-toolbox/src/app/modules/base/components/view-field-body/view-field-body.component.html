<div class="loc-container" gvOpenCloseContainer [isOpen$]="showBody$">
  <div gvOpenCloseChild>

    <div [ngClass]="{'gv-fh': (addMode$|async)&&(items$|async)?.length}">
      <span class="mat-bg-grey-50">
        <mat-paginator *ngIf="!noPagination" [length]="itemsCount$ | async" [pageSize]="limit$ | async"
          [pageIndex]="pageIndex$ |Â async" [pageSizeOptions]="pageSizeOptions" [showFirstLastButtons]=true
          [hidden]="(itemsCount$ | async) <= limit" (page)="onPageChange($event)">
        </mat-paginator>
      </span>
      <mat-divider [hidden]="(itemsCount$ | async) <= limit"></mat-divider>
      <div #dropList cdkDropList [cdkDropListConnectedTo]="viewFieldDropListService.connectedToDropLists$|async"
        [gvViewFieldDropList]="viewFieldDropListService" [dlField]="field" [dlSource]="source" [dlScope]="scope"
        [dlLimit$]="limit$" [dlPageIndex$]="pageIndex$" [dlItems$]="items$" [cdkDropListData]="viewFieldDropListService"
        [id]="source.fkInfo+ '_f_'+field.property.fkProperty+'_'+field.isOutgoing"
        (cdkDropListDropped)="viewFieldDropListService.drop($event)"
        [ngClass]="{'loc-dropzone-accepts':viewFieldDropListService.dropZoneAccepts$|async}">

        <gv-view-field-item-container *ngIf="!((itemsCount$ |async) > 0) && !hideNoItemsInfo">
          <div class="loc-no-items mat-caption mat-text-secondary">No items</div>
        </gv-view-field-item-container>
        <gv-view-field-item-container *ngIf="!(itemsCount$ |async) && viewFieldDropListService.dropZoneAccepts$|async">
          <div class="loc-no-items mat-caption mat-text-secondary">Drop here</div>
        </gv-view-field-item-container>
        <div *ngFor="let item of (items$ | async); let i = index; trackBy:trackByFn"
          [ngClass]="{'mb-3': (addMode$|async), 'mt-3': (addMode$|async)}" cdkDrag [cdkDragData]="item"
          (cdkDragStarted)="dragStarted()" (cdkDragEnded)="dragEnded()" (cdkDragReleased)="dragReleased()">
          <gv-view-field-item [item]=item [readonly$]=readonly$ [showOntoInfo$]=showOntoInfo$ [addMode$]=addMode$
            [field]=field [scope]=scope [checked]="selection.isSelected(item.statement.pk_entity)"
            [allowMultiSelect]=allowMultiSelect (selectionChange)="toggleSelection($event)"></gv-view-field-item>
          <mat-divider></mat-divider>
        </div>

      </div>
    </div>

    <ng-container *ngIf="(items$|async)?.length">
      <div *ngIf="addMode$|async" class="gv-row-space-between">
        <div class="gv-row-center">
          <button [disabled]="(selectedCount$ | async) < 1 || (adding$|async)" type="submit" mat-flat-button
            color="primary" class="mr-2" (click)="add()">
            <ng-container *ngIf="!(adding$|async)">
              Add selected ({{selectedCount$|async}})
            </ng-container>
            <div *ngIf="(adding$|async)" style="margin: 6px;">
              <mat-spinner [diameter]="20"></mat-spinner>
            </div>
          </button>
          <button [disabled]="targetIsUnique" type="submit" mat-flat-button color="primary" class="mr-2"
            (click)="next.emit()">Create new</button>
        </div>
        <button type="button" mat-button (click)="close.emit()">Cancel</button>
      </div>


    </ng-container>


    <div *ngIf="!(items$|async)" class="gv-flex-fh justify-content-center align-items-center">
      <mat-spinner [diameter]="20"></mat-spinner>
    </div>
  </div>
</div>
