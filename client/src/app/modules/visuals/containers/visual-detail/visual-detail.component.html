<as-split class="gv-split-style" [ngClass]="{'gv-hide-split-gutter': !t.showRightArea}" [direction]="'horizontal'"
  gutterSize="1" [useTransition]="t.useTransition" (dragEnd)="t.onResizeArea($event)">

  <!-------------------------------------------------------------------
     Query Definition
  -------------------------------------------------------------------->
  <as-split-area [size]="t.splitSizeLeft" class="d-flex flex-column">

    <gv-detail-top-bar [openRightAreaBtn]="!t.showRightArea" (openRight)="onCreatePreview()">
      <span class="ml-2">Visual</span>
      <button class="ml-auto btn btn-sm btn-primary" (click)="onSave()">Save</button>
      <button class="ml-3 mr-2 btn btn-sm btn-primary" (click)="onCreatePreview()">Preview >></button>
    </gv-detail-top-bar>
    <gv-detail-content>

      <div *ngIf="(deleted$ | async)" class="alert alert-info">
        The Visual has been successfully deleted. To recover it, click on save.
      </div>

      <mat-vertical-stepper [linear]="true" #stepper class="bg-gray-100">
        <mat-step [stepControl]="firstFormGroup">
          <form [formGroup]="firstFormGroup">
            <ng-template matStepLabel>
              Choose a type of visulalization.
              <mat-error *ngIf="firstFormGroup.invalid && firstFormGroup.touched">
                <small>Invalid</small>
              </mat-error>
            </ng-template>
            <mat-form-field>
              <mat-label>Visualization Type</mat-label>
              <mat-select [formControl]="visualTypeCtrl">
                <mat-option *ngFor="let o of visualTypeOptions" [value]="o.value">{{o.label}}</mat-option>
              </mat-select>
            </mat-form-field>

            <div>
              <button mat-flat-button color="primary" matStepperNext>Next</button>
            </div>
          </form>
        </mat-step>
        <mat-step [stepControl]="secondFormGroup">
          <form [formGroup]="secondFormGroup">
            <ng-template matStepLabel>
              Visualization settings
              <mat-error *ngIf="secondFormGroup.invalid && secondFormGroup.touched">
                <small>Invalid</small>
              </mat-error>
            </ng-template>

            <div *ngIf="visualTypeCtrl.value === 'map'" class="my-3">
              <mat-form-field class="w-100">
                <gv-map-settings [formControl]="visualSettingsCtrl" #c [gvNoInvalidChildren]="c.formGroup.controls">
                </gv-map-settings>
                <!-- <mat-error *ngIf="m.invalid">You must enter a value</mat-error> -->
              </mat-form-field>
            </div>

          </form>
        </mat-step>
        <mat-step [stepControl]="thirdFormGroup">
          <form [formGroup]="thirdFormGroup">
            <ng-template matStepLabel>
              Save
              <mat-error *ngIf="thirdFormGroup.invalid && thirdFormGroup.touched">
                <small>Invalid</small>
              </mat-error>
            </ng-template>
            <p>Give your visual a name and description.</p>
            <p>
              <mat-form-field class="w-100 gv-w-max-500">
                <input matInput placeholder="Name" formControlName="nameCtrl" required>
                <mat-hint>Name of the visual.</mat-hint>
              </mat-form-field>
            </p>
            <p class="mt-3">
              <mat-form-field class="w-100 gv-w-max-500">
                <textarea matInput placeholder="Description" formControlName="descriptionCtrl"></textarea>
                <mat-hint>Description of the visual.</mat-hint>
              </mat-form-field>
            </p>
            <div class="mt-5">
              <button mat-flat-button type="button" class="mr-2" color="primary" (click)="onSave()">Save</button>
              <button mat-flat-button type="button" class="mr-2" color="primary" *ngIf="(comVisual$ | async)?.pk_entity"
                (click)="onSaveAs()">
                Save As
              </button>
              <button mat-flat-button type="button" color="warn" *ngIf="(comVisual$ | async)?.pk_entity"
                (click)="onDelete()">
                Delete
              </button>
            </div>
          </form>
        </mat-step>
      </mat-vertical-stepper>
    </gv-detail-content>
  </as-split-area>

  <!-------------------------------------------------------------------
    Visual Results
  -------------------------------------------------------------------->
  <as-split-area *ngIf="t.showRightArea" [size]="t.splitSizeRight" [ngClass]="{
      'd-flex flex-column': t.showRightArea,
      'd-none': !t.showRightArea
    }">
    <gv-detail-top-bar closeRightAreaBtn="true" (closeRight)="t.setShowRightArea(false)">

      <span class="ml-2">
        Result
      </span>
      <div class="ml-auto">
        <button class="btn btn-sm btn-primary mr-2">Embed</button>
      </div>
    </gv-detail-top-bar>
    <gv-detail-content>
      <!-- {{visualTypeCtrl.value | json:2}}
      Settings
      <pre>
          {{visualSettingsCtrl.value | json:2}}
        </pre>

      Visualization
      {{loading$ | async}}
      <pre>
        {{queryResByVersion$ | async | json:2}}
      </pre> -->

      <gv-map-visual *ngIf="visualTypeCtrl.value === 'map'" [settings$]="visualSettings$" [data$]="queryResByVersion$">
      </gv-map-visual>

    </gv-detail-content>


  </as-split-area>
</as-split>
