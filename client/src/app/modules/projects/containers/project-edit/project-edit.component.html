<gv-navbar>
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a routerLink="/"><i class="fa fa-home"></i> Home</a></li>
    <li class="breadcrumb-item"><a routerLink="/projects">Your Projects</a></li>
    <li class="breadcrumb-item">{{((p.activeProject$|async)?.labels || [])[0]?.label}}</li>
  </ol>
</gv-navbar>
<mat-drawer-container class="gv-flex-fh">
  <mat-drawer class="bg-light" mode="side" opened style="width: 80px;">

    <div class="h-100 d-flex flex-column">

      <div class="btn-group-vertical rounded-0 d-block">
        <button class="gv-nav-btn d-flex flex-column align-items-center justify-content-center" [routerLink]="[{ outlets: { list: ['sources']} }]"
          routerLinkActive="active" (click)="list.open()">
          <div class="fa-2x gv-icon gv-icon-source text-info"></div>
          <div>Sources</div>
        </button>
        <button class="gv-nav-btn d-flex flex-column align-items-center justify-content-center" [routerLink]="[{ outlets: { list: ['entities']} }]"
          routerLinkActive="active" (click)="list.open()">
          <div class="fa-2x gv-icon gv-icon-information-simple text-primary"></div>
          <div>Entities</div>
        </button>
        <button class="gv-nav-btn d-flex flex-column align-items-center justify-content-center">
          Queries
        </button>
        <button class="gv-nav-btn d-flex flex-column align-items-center justify-content-center">
          Visuals
        </button>

        <button class="gv-nav-btn d-flex flex-column align-items-center justify-content-center">
          Stories
        </button>

      </div>


      <div class="btn-group-vertical rounded-0 d-block mt-auto">
        <button class="gv-nav-btn" [routerLink]="['../', 'settings']">
          Settings
        </button>
      </div>
    </div>

  </mat-drawer>
  <mat-drawer-content style="display:flex; flex-direction:column">
    <mat-drawer-container style="flex-grow: 1; flex-basis:100%;">
      <mat-drawer class="bg-gray-300" #list mode="side" opened style="width: 300px;">
        <button class="btn btn-link-white position-absolute" style="right: 0;" (click)="list.close(); closeList()"> <i
            class="fa fa-chevron-left"></i> </button>
        <router-outlet name="list"></router-outlet>
      </mat-drawer>
      <mat-drawer-content class="d-flex" cdkDropListGroup>

        <div *ngFor="let panel of (p.panels$ | async); let i = index; trackBy:trackByFn" class="border-left border-gray-300 gv-grow-1 gv-flex-fh"
          style="overflow: hidden;" (mousedown)="p.focusPanel(i)" [ngClass]="{'focus': ((p.focusedPanel$|async ) === i) }">
          <div>
            <div cdkDropList [cdkDropListData]="i" cdkDropListOrientation="horizontal" (cdkDropListDropped)="dropTab($event)"
              class="tab-list">
              <div *ngFor="let tab of panel.tabs; let j=index;" cdkDrag class="tab-box" [cdkDragData]="{'panelIndex': i, 'tabIndex': j}"
                [ngClass]="{'active': tab.active }" (cdkDragEnded)="tabDragEnded()" (cdkDragStarted)="tabDragStarted()">
                <div class="left" (mousedown)="p.activateTab(i,j)">
                  <div class="icon">
                    <i *ngIf="tab.icon =='persistent-entity'" class="gv-icon gv-icon-information-simple text-primary"></i>
                    <i *ngIf="tab.icon =='source'" class="gv-icon gv-icon-source text-info"></i>
                  </div>
                  <div class="label">
                    {{tab.pkEntity}} Ganz vieeeeeeeeel Text
                  </div>
                </div>
                <div class="right" (click)="p.closeTab(i,j)">
                  <i class="fa fa-close"></i>
                </div>
              </div>
            </div>
            <!-- <button (click)="p.addTab()">Split</button> -->
          </div>

          <div class="panel-body gv-flex-fh position-relative">
            <div class="split-panel-drop-zone" [ngClass]="{'active': highlightPanel[i] === 'full', 'enabled': tabDragging}">

              <div class="highlight left" [ngClass]="{'active': highlightPanel[i] === 'left'}"></div>
              <div class="highlight right" [ngClass]="{'active': highlightPanel[i] === 'right'}"></div>

              <div class="split left" [ngClass]="{'enabled': tabDragging}" cdkDropList (cdkDropListEntered)="setHighlightPanel(i, 'left')"
                (cdkDropListExited)="unsetHighlightPanel(i, 'left')" (cdkDropListDropped)="splitPanel(i, $event)">
              </div>
              <div class="split center" cdkDropList (cdkDropListEntered)="setHighlightPanel(i, 'full')"
                (cdkDropListExited)="unsetHighlightPanel(i, 'full')"> </div>
              <div class="split right" cdkDropList (cdkDropListEntered)="setHighlightPanel(i, 'right')"
                (cdkDropListExited)="unsetHighlightPanel(i, 'right')" (cdkDropListDropped)="splitPanel(i+1, $event)">
              </div>

            </div>
            <div class="gv-flex-fh" [attr.id]="('panel_'+panel.id)">
              <!-- Tab body will be placed dynamically via Cdk Portal -->
            </div>
          </div>

        </div>


        <gv-tab-body [active]="tab.active" [panelIndex]="tab.panelIndex" *ngFor="let tab of (allTabs$ | async); let j=index; trackBy:trackByPath;">
          <gv-entity-detail *ngIf="tab.component=='entity-detail'" [pkEntity]="tab.pkEntity" [basePath]="tab.path"></gv-entity-detail>
          <gv-source-detail *ngIf="tab.component=='source-detail'" [pkEntity]="tab.pkEntity" [basePath]="tab.path"></gv-source-detail>
        </gv-tab-body>

      </mat-drawer-content>
    </mat-drawer-container>

  </mat-drawer-content>
</mat-drawer-container>