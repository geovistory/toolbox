{"version":3,"sources":["../../../node_modules/tslib/tslib.es6.js","ng://@kleiolab/lib-queries/lib/queries/decorators/method-decorators.ts","ng://@kleiolab/lib-queries/lib/queries/module/redux-queries.module.ts","ng://@kleiolab/lib-queries/lib/queries/selectors/dat.service.ts","ng://@kleiolab/lib-queries/lib/queries/services/should-pause.service.ts","ng://@kleiolab/lib-queries/lib/queries/selectors/dfh.service.ts","ng://@kleiolab/lib-queries/lib/queries/selectors/inf.service.ts","ng://@kleiolab/lib-queries/lib/queries/selectors/pro.service.ts","ng://@kleiolab/lib-queries/lib/queries/selectors/sys.service.ts","ng://@kleiolab/lib-queries/lib/queries/selectors/tab.service.ts","ng://@kleiolab/lib-queries/lib/queries/selectors/war.service.ts","ng://@kleiolab/lib-queries/lib/queries/services/schema-selectors.service.ts","ng://@kleiolab/lib-queries/lib/queries/services/active-project-pipes.service.ts","ng://@kleiolab/lib-queries/lib/queries/services/configuration-pipes.service.ts","ng://@kleiolab/lib-queries/lib/queries/services/information-basic-pipes.service.ts","ng://@kleiolab/lib-queries/lib/queries/services/information-pipes.service.ts","ng://@kleiolab/lib-queries/lib/queries/functions/functions.ts"],"names":["extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__extends","__","this","constructor","prototype","create","__assign","assign","t","s","i","n","arguments","length","call","apply","__decorate","decorators","target","key","desc","c","r","getOwnPropertyDescriptor","Reflect","decorate","defineProperty","__metadata","metadataKey","metadataValue","metadata","__values","o","m","Symbol","iterator","next","value","done","__read","e","ar","push","error","__spread","concat","cache","options","propertyKey","descriptor","refCount","Map","originalFunction","request","_i","uniq","JSON","stringify","has","boundOriginalFunction","bind","set","pipe","shareReplay","bufferSize","tag","name","join","get","spyTag","ReduxQueriesModule","parentModule","reduxModule","errors","Error","NgModule","args","declarations","imports","CommonModule","providers","type","Optional","SkipSelf","ReduxModule","Selector","ngRedux","configs","model","selector","indexKey","_this","all$","select","datRoot","x","DatDigitalSelections","_super","by_pk_entity__entity_version$","by_pk_entity$","by_pk_text$","tslib_1.__extends","latestVersion","pkDigital","map","versions","DatNamespaceSelections","by_fk_project$","DatChunkSelections","by_fk_text$","DatClassColumnMappingSelections","by_fk_column$","DatColumnSelections","by_fk_digital$","DatTextPropertySelections","by_fk_entity__fk_system_type$","DatSelector","digital$","datDefinitions","namespace$","chunk$","column$","class_column_mapping$","text_property$","Injectable","providedIn","NgRedux","DatActions","ShouldPauseService","shouldPause$","BehaviorSubject","slice$","dfhRoot","allNoPause$","switchMap","shouldPause","empty","noPause","DfhProfileSelections","by_pk_profile$","DfhClassSelections","by_pk_class$","by_basic_type$","DfhPropertySelections","pk_property__has_domain__has_range$","by_pk_property$","by_has_domain__pk_property$","by_has_range__pk_property$","by_has_domain$","by_has_range$","by_is_has_type_subproperty$","DfhLabelSelections","by_fks$","by_fk_class__type$","by_fk_property__type$","by_fk_profile__type$","DfhSelector","pause","profile$","dfhDefinitions","class$","property$","label$","DfhActions","Selector$2","pkProject$","pk","path","facetteByPk","infRoot","paginationSelector","pipePage","page","pagBy","paginateBy","createPaginateByKey","filter","count","undefined","start","offset","end","limit","obs$","combineLatestOrEmpty","pipeCount","pipeItemsInProject","getFkEntity","items","pkProject","proRelsAndKey$","k","item","rel","proRels","itemsInProject","proRel","is_in_project","pipeItemInProject","of","InfPersistentItemSelections","_by_pk_entity$","_by_fk_class$","by_pk_entity_key$","ofProject","selection$","pk_entity","by_pk_entity_all$","by_fk_class_key$","InfTemporalEntitySelections","InfStatementSelections","by_fk_subject_data$","pagination$","by_subject$","foreignKeys","indexStatementBySubject","values","by_subject_and_property$","by_subject_and_property_indexed$","statementIdx","indexStatementBySubjectProperty","by_object$","indexStatementByObject","by_object_and_property$","by_object_and_property_indexed$","indexStatementByObjectProperty","InfTextPropertySelections","_by_fk_concerned_entity__fk_class_field$","_by_fk_concerned_entity$","by_fk_concerned_entity__fk_class_field_indexed$","by_fk_concerned_entity_indexed$","InfAppellationSelections","InfLangStringSelections","InfPlaceSelections","InfTimePrimitiveSelections","InfLanguageSelections","InfDimensionSelections","InfSelector","persistent_item$","infDefinitions","temporal_entity$","statement$","appellation$","place$","lang_string$","time_primitive$","language$","dimension$","pkEntityModelMap$","PR_ENTITY_MODEL_MAP","getModelOfEntity$","pkEntity","Selector$3","proRoot","part","toString","ProProjectSelector","ProInfoProjRelSelector","by_fk_project__fk_entity$","ProDfhClassProjRelSelector","by_fk_project__enabled_in_entities$","by_fk_project__fk_class$","ProDfhProfileProjRelSelector","by_fk_project__enabled$","by_fk_project__fk_profile$","ProClassFieldConfigSelector","ProTextPropertySelector","by_fks_without_lang$","ProAnalysisSelector","ProSelector","project$","proDefinitions","info_proj_rel$","dfh_class_proj_rel$","dfh_profile_proj_rel$","class_field_config$","analysis$","ProActions","sysRoot","SysSystemRelevantClassSelections","by_fk_class$","by_required_by_sources$","by_required$","SysConfigSelections","main$","SysSelector","system_relevant_class$","sysDefinitions","config$","SysActions","Selector$5","tabRoot","TabCellSelections","by_pk_cell$","by_fk_column_fk_row$","TabSelector","cell$","tabDefinitions","TabActions","Selector$6","warRoot","WarEntityPreviewSelector","WarSelector","entity_preview$","warDefinitions","WarActions","SchemaSelectorsService","dat$","tab$","pro$","dfh$","sys$","distinctUntilChanged","y","inf$","ActiveProjectPipesService","entityPreviewSocket","requestedEntityPreviews","fromEvent","subscribe","disconnect","first","pks","keys","getState","war","entity_preview","emit","pipeActiveProject","l","pipeActiveDefaultLanguage","project","fk_language","streamEntityPreview","forceReload","by_pk_entity","equals","prev","EntityPreviewSocket","tslib_1.__decorate","Observable","ConfigurationPipesService","a","pipeProfilesEnabledByProject","projectProfileRels","enabled","fk_profile","DfhConfig","PK_PROFILE_GEOVISTORY_BASIC","pipeFields","pkClass","combineLatest","indexed","_a","rangeClass","profiles","_b","sourceKlass","outgoingProps","ingoingProps","sysConfig","enabledProfiles","CLASS_PK_APPELLATION_FOR_LANGUAGE","removed_from_api","has_domain","pk_property","PROPERTY_PK_IS_APPELLATION_OF","has_range","domain_instances_max_quantifier","domain_instances_min_quantifier","range_instances_max_quantifier","range_instances_min_quantifier","identifier_in_namespace","identity_defining","is_inherited","is_has_type_subproperty","basic_type","domainClass","PROPERTY_PK_HAS_TIME_SPAN","ClASS_PK_TIME_SPAN","createHasTimeSpanProperty","PROPERTY_PK_P18_HAS_DEFINITION","createHasDefinitionProperty","pipePropertiesToSubfields","pipeFieldConfigs","_c","subfields1","subfields2","fieldConfigs","subfields","fieldConfigIdx","indexBy","fk_domain_class","fk_range_class","fk_property","uniqFields","uniqSubfieldCache","subfields_1","tslib_1.__values","subfields_1_1","fieldId","sourceClass","property","pkProperty","isOutgoing","subfieldId","targetClass","fieldConfig","allSubfieldsRemovedFromAllProfiles","removedFromAllProfiles","targetClasses","listDefinitions","isSpecialField","isHasTypeField","sourceClassLabel","sourceMaxQuantity","sourceMinQuantity","targetMinQuantity","targetMaxQuantity","label","identityDefiningForSource","identityDefiningForTarget","ontoInfoLabel","ontoInfoUrl","placeOfDisplay","getPlaceOfDisplay","specialFields","pipeSpecificFieldOfClass","fields","field","specificFields","sort","position","pipeBasicFieldsOfClass","basicFields","pipeFieldsForTeEnForm","allFields","whenField","find","typeField","pipeBasicAndSpecificFields","pipeSpecificAndBasicFields","properties","pipeClassLabel","pipeSubfieldTypeOfClass","pipeFieldLabel","targetClassLabel","listType","isRemovedFromAllProfiles","config","klass","classConfig","classes","pk_class","valueObjectType","typeItem","entityPreview","temporalEntity","getSubfieldType","fkProject","activeProjectkey","proClassFieldConfgByProjectAndClassKey","fk_class_for_class_field","fk_project","defaultProjectkey","ProConfig","PK_PROJECT_OF_DEFAULT_CONFIG_PROJECT","activeProjectFields","defaultProjectFields","ord_num","language","pipeLabels","text","fk_system_type","SysConfig","PK_SYSTEM_TYPE__TEXT_PROPERTY__LABEL","console","warn","fkProperty","pipeProTextProperty","fk_dfh_class","fk_dfh_property","fk_dfh_property_domain","fkPropertyDomain","fk_dfh_property_range","fkPropertyRange","origin","string","pipeDfhLabel","iso6391","trim","fk_class","textPropertyByFksKey","dfhLabelByFksKey","some","pipeTableNameOfClass","targetClassPk","includes","appellation","place","timePrimitive","langString","dimension","pipeClassesInEntitiesOrSources","pipeClassesEnabledInEntities","pipeClassesRequiredBySources","startWith","pipeClassesEnabledByProjectProfiles","classesByPk","profilesMap","profile","pipeTypeClassesEnabledByProjectProfiles","CLASS_PK_LANGUAGE","CLASS_PK_MANIFESTATION_PRODUCT_TYPE","rels","pipeSelectedTeEnClassesInProject","pipeTeEnClassesEnabledInEntities","pipeTeEnClassesRequiredBySources","cs","dfhClasses","filterTeEnCasses","pipeTypeAndTypedClasses","enabledIn","pks$","fromSources$","fromEntities$","arrayOfPkArrays","flatten","pipeTypeAndTypedClassesOfTypedClasses","pkTypedClasses","allHasTypeProps","byDomain","typedClass","typeClass","pipeTypeClassOfTypedClass","pkTypedClass","pipeTypedClassesOfTypeClasses","pkTypeClasses","pipeTypePropertyOfTypedClass","typeProp","pipeTargetClassesOfProperties","pkProperties","res","forEach","pkProp","prop","subfield","projectFieldConfig","settings","hasTypeSubproperties","bySourceClass","outgoingProperties","incomingProperties","getSettingsFromSysConfig","displayInBasicFields","hidden","Number","POSITIVE_INFINITY","InformationBasicPipesService","timePrimitiveOfStatements","pipeInfTimePrimitive","fk_object_info","infTimePrimitive","statement","ipr","calendar","julianDay","julian_day","duration","pipeStatements","pipeOutgoingStatements","pipeIngoingStatements","fk_subject_info","pipeStatementsOfList","listDefinition","fk_property_of_property","pkPropertyOfProperty","pipeOutgoingStatementsByProperty","pipeIngoingStatementsByProperty","pipeOutgoingBasicStatementItemsByProperty","statements","pipeBasicStatementItem","pipeIngoingBasicStatementItemsByProperty","projRel","ordNum","ord_num_of_range","ord_num_of_domain","pipeBasicStatementItemByPkStatement","pkStatement","pipeTimeSpan","_72","_71","_150","_151","_152","_153","TimeSpanUtil","p82","p81","p82a","p81a","p81b","p82b","pipeClassOfEntity","merge","pipeClassesOfPersistentItems","pkEntities","peIts","typePk","pipeRepoOutgoingStatements","pipeRepoIngoingStatements","pipeRepoOutgoingStatementsByProperty","rs","sortStatementsByRepoPopularity","slice","pipeRepoIngoingStatementsByProperty","pipeAlternativeBasicStatementItemByPkStatement","inrepo","pipeAlternativeIngoingStatements","inproject","omit","pipeAlternativeOutgoingStatements","pipePersistentItemPksByClass","ob","parseInt","pipeIconType","preview","entity_type","CLASS_PK_EXPRESSION_PORTION","CLASS_PKS_SOURCE_PE_IT","is_in_project_count","InfStatement","Boolean","InformationPipesService","timePrimitivePipe","timeSpanPipe","infRepo","pipeListLength","pipeList","tap","pipeListAppellation","pipeListEntityPreview","pipeListLanguage","pipeListPlace","pipeListDimension","pipeListLangString","timeSpan","pipeItemTimeSpan","ts","pipeListBasicStatementItems","pipeItemAppellation","nodes","node","fkClass","limitTo","pipeItemEntityPreview","pipeItemLanguage","pipeItemPlace","pipeItemDimension","pipeItemLangString","pipeProjRelOfStatement","stmt","scope","inProject","pipeTargetOfStatement","subfieldType","targetInfo","targetLabel","pipeStatementWithTarget","pipeSubfieldPage","pkStmts","pkStmt","pipeItemTeEnRow","fieldDefinitions","repo","outgoingStatements$","ingoingStatements$","outgoingItems$","pipeItem","ingoingItems$","sortItems","outgoingItems","ingoingItems","groupedOut","groupBy","groupedIn","row","fieldDefinition","cell","t_1","pick","itemsCount","timeSpanKeys_1","fromTimeSpanDialogData","transform","isTimeSpan","firstItem","propIsOutgoing","targetEntity","modelName","pipeItemTimePrimitive","pipeEntityProperties","listDef","fkEntity","getEntityProperties","timeSpanItem","PROPERTY_PK_TO_EXISTENCE_TIME_KEY","pipeTemporalEntityRemoveProperties","textProperties","fieldDefs","fieldDef","switchMapOr","TimePrimitive","notes","lat","long","fk_measurement_unit","numeric_value","entity_label","quill_doc","ops","op","insert","fkLanguage","community_favorite_calendar","pipeAltListLength","pipeAltListStatements","pipeAltList","pipeAltListAppellation","pipeAltListEntityPreview","pipeAltListLanguage","pipeAltListPlace","pipeAltListDimension","pipeAltListLangString","pipeRepoListAppellation","pipeRepoListLanguage","pipeRepoListPlace","pipeRepoListDimension","pipeRepoListEntityPreview","pipeRepoItemTimeSpan","props","pipeLabelOfEntity","pipeClassLabelOfEntity","pipeTypeOfEntity","hasTypeProperty","pipeClassesAndTypes","pipeClassAndTypeNodes","pipeClassesAndTypesOfClasses","typeAndTypedClasses","data","pkType","iif","typePks","sortAbc","children","pipeClassesFromClassesAndTypes","classesAndTypes","types","typeClasses","typedClasses","pipePropertyOptionsFromClassesAndTypes","pipePropertyOptionsFormClasses","isTeEn","classFields","f","PROPERTY_PKS_WHERE_TIME_PRIMITIVE_IS_RANGE","CLASS_PK_TIME_PRIMITIVE","propertyFieldKey","propertyOptionFieldKey","pipePkClassesFromPropertySelectModel","ingoingProperties","out","ing","getPkClassesFromPropertySelectModel$","model$","getPropertyOptions$","classTypes$","TimePrimitivePipe","TimeSpanPipe"],"mappings":"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","sourcesContent":["/*! *****************************************************************************\r\nCopyright (c) Microsoft Corporation. All rights reserved.\r\nLicensed under the Apache License, Version 2.0 (the \"License\"); you may not use\r\nthis file except in compliance with the License. You may obtain a copy of the\r\nLicense at http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nTHIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED\r\nWARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,\r\nMERCHANTABLITY OR NON-INFRINGEMENT.\r\n\r\nSee the Apache Version 2.0 License for specific language governing permissions\r\nand limitations under the License.\r\n***************************************************************************** */\r\n/* global Reflect, Promise */\r\n\r\nvar extendStatics = function(d, b) {\r\n    extendStatics = Object.setPrototypeOf ||\r\n        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n    return extendStatics(d, b);\r\n};\r\n\r\nexport function __extends(d, b) {\r\n    extendStatics(d, b);\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n}\r\n\r\nexport var __assign = function() {\r\n    __assign = Object.assign || function __assign(t) {\r\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n            s = arguments[i];\r\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\r\n        }\r\n        return t;\r\n    }\r\n    return __assign.apply(this, arguments);\r\n}\r\n\r\nexport function __rest(s, e) {\r\n    var t = {};\r\n    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n        t[p] = s[p];\r\n    if (s != null && typeof Object.getOwnPropertySymbols === \"function\")\r\n        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\r\n            if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i]))\r\n                t[p[i]] = s[p[i]];\r\n        }\r\n    return t;\r\n}\r\n\r\nexport function __decorate(decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n}\r\n\r\nexport function __param(paramIndex, decorator) {\r\n    return function (target, key) { decorator(target, key, paramIndex); }\r\n}\r\n\r\nexport function __metadata(metadataKey, metadataValue) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(metadataKey, metadataValue);\r\n}\r\n\r\nexport function __awaiter(thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n}\r\n\r\nexport function __generator(thisArg, body) {\r\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\r\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\r\n    function verb(n) { return function (v) { return step([n, v]); }; }\r\n    function step(op) {\r\n        if (f) throw new TypeError(\"Generator is already executing.\");\r\n        while (_) try {\r\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\r\n            if (y = 0, t) op = [op[0] & 2, t.value];\r\n            switch (op[0]) {\r\n                case 0: case 1: t = op; break;\r\n                case 4: _.label++; return { value: op[1], done: false };\r\n                case 5: _.label++; y = op[1]; op = [0]; continue;\r\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\r\n                default:\r\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\r\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\r\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\r\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\r\n                    if (t[2]) _.ops.pop();\r\n                    _.trys.pop(); continue;\r\n            }\r\n            op = body.call(thisArg, _);\r\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\r\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\r\n    }\r\n}\r\n\r\nexport function __exportStar(m, exports) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n\r\nexport function __values(o) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator], i = 0;\r\n    if (m) return m.call(o);\r\n    return {\r\n        next: function () {\r\n            if (o && i >= o.length) o = void 0;\r\n            return { value: o && o[i++], done: !o };\r\n        }\r\n    };\r\n}\r\n\r\nexport function __read(o, n) {\r\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\r\n    if (!m) return o;\r\n    var i = m.call(o), r, ar = [], e;\r\n    try {\r\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\r\n    }\r\n    catch (error) { e = { error: error }; }\r\n    finally {\r\n        try {\r\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\r\n        }\r\n        finally { if (e) throw e.error; }\r\n    }\r\n    return ar;\r\n}\r\n\r\nexport function __spread() {\r\n    for (var ar = [], i = 0; i < arguments.length; i++)\r\n        ar = ar.concat(__read(arguments[i]));\r\n    return ar;\r\n}\r\n\r\nexport function __spreadArrays() {\r\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\r\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\r\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\r\n            r[k] = a[j];\r\n    return r;\r\n};\r\n\r\nexport function __await(v) {\r\n    return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n}\r\n\r\nexport function __asyncGenerator(thisArg, _arguments, generator) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n    return i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i;\r\n    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }\r\n    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }\r\n    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }\r\n    function fulfill(value) { resume(\"next\", value); }\r\n    function reject(value) { resume(\"throw\", value); }\r\n    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }\r\n}\r\n\r\nexport function __asyncDelegator(o) {\r\n    var i, p;\r\n    return i = {}, verb(\"next\"), verb(\"throw\", function (e) { throw e; }), verb(\"return\"), i[Symbol.iterator] = function () { return this; }, i;\r\n    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === \"return\" } : f ? f(v) : v; } : f; }\r\n}\r\n\r\nexport function __asyncValues(o) {\r\n    if (!Symbol.asyncIterator) throw new TypeError(\"Symbol.asyncIterator is not defined.\");\r\n    var m = o[Symbol.asyncIterator], i;\r\n    return m ? m.call(o) : (o = typeof __values === \"function\" ? __values(o) : o[Symbol.iterator](), i = {}, verb(\"next\"), verb(\"throw\"), verb(\"return\"), i[Symbol.asyncIterator] = function () { return this; }, i);\r\n    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }\r\n    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }\r\n}\r\n\r\nexport function __makeTemplateObject(cooked, raw) {\r\n    if (Object.defineProperty) { Object.defineProperty(cooked, \"raw\", { value: raw }); } else { cooked.raw = raw; }\r\n    return cooked;\r\n};\r\n\r\nexport function __importStar(mod) {\r\n    if (mod && mod.__esModule) return mod;\r\n    var result = {};\r\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\r\n    result.default = mod;\r\n    return result;\r\n}\r\n\r\nexport function __importDefault(mod) {\r\n    return (mod && mod.__esModule) ? mod : { default: mod };\r\n}\r\n","// TODO DELETE\nimport { shareReplay } from 'rxjs/operators';\nimport { tag } from 'rxjs-spy/operators';\n\nexport interface CacheOptions {\n  refCount: boolean\n}\n/**\n * Decorator function for methods that take any argument and return an\n * obsevable. Decorated Methods will be extended by a cache:\n * For each call to the method with the same input arguments a cache\n * shareReplay operator is added, acting as a middleman subcribing to\n * the Source (the observable returned by the decorated function) and\n * emtting the latest value. Read more about shareReplay here:\n * https://itnext.io/the-magic-of-rxjs-sharing-operators-and-their-differences-3a03d699d255\n *\n * @options:\n */\n\nexport const cache = (options?: CacheOptions) => (target, propertyKey, descriptor) => {\n  const o: CacheOptions = {\n    // default option\n    refCount: true,\n    // override with custom options\n    ...options\n  }\n  const c = new Map()\n  const originalFunction = descriptor.value;\n  descriptor.value = function (...request) {\n    const uniq = JSON.stringify(request)\n    if (!c.has(uniq)) {\n      const boundOriginalFunction = originalFunction.bind(this)\n      // const x = target, y = propertyKey;\n      c.set(uniq, boundOriginalFunction(...request).pipe(\n        shareReplay({ refCount: o.refCount, bufferSize: 1 }),\n        tag(`FROM-CACHE-${target.constructor.name}::${propertyKey}::${request.join(':')}`)\n      ))\n    }\n    return c.get(uniq)\n  };\n  return descriptor;\n}\n\n\nexport function spyTag(target, propertyKey, descriptor) {\n  const originalFunction = descriptor.value;\n  descriptor.value = function (...request) {\n    const boundOriginalFunction = originalFunction.bind(this)\n    return boundOriginalFunction(...request).pipe(\n      tag(`${target.constructor.name}::${propertyKey}::${request.join(':')}`)\n    )\n  };\n  return descriptor;\n}\n","import { CommonModule } from '@angular/common';\nimport { NgModule, Optional, SkipSelf } from '@angular/core';\nimport { ReduxModule } from '@kleiolab/lib-redux';\n\n\n\n@NgModule({\n  declarations: [],\n  imports: [\n    CommonModule,\n  ],\n  providers: [\n\n  ]\n})\nexport class ReduxQueriesModule {\n  constructor(\n    @Optional() @SkipSelf() parentModule: ReduxQueriesModule,\n    @Optional() reduxModule: ReduxModule,\n  ) {\n    const errors: string[] = []\n    if (parentModule) errors.push('ReduxQueriesModule is already loaded. Import in your base AppModule only.');\n    if (!reduxModule) errors.push('You need to import the ReduxModule in your AppModule!');\n    if (errors.length) throw new Error(errors.join('\\n'));\n  }\n}\n","import { NgRedux } from '@angular-redux/store';\nimport { Injectable } from '@angular/core';\nimport { ByPk, DatActions, datDefinitions, datRoot, IAppState, ReducerConfigCollection } from '@kleiolab/lib-redux';\nimport { DatChunk, DatColumn, DatDigital, DatNamespace, DatTextProperty } from '@kleiolab/lib-sdk-lb3';\nimport { DatClassColumnMapping } from '@kleiolab/lib-sdk-lb4';\nimport { latestVersion } from '@kleiolab/lib-utils';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\n\nclass Selector {\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { }\n\n  selector<M>(indexKey: string): { all$: Observable<ByPk<M>>, key: (x) => Observable<M> } {\n\n    const all$ = this.ngRedux.select<ByPk<M>>([datRoot, this.model, indexKey])\n    // .pipe(\n    //   distinctUntilChanged<M>(equals)\n    // )\n\n    const key = (x): Observable<M> => this.ngRedux.select<M>([datRoot, this.model, indexKey, x])\n    // .pipe(\n    //   distinctUntilChanged<M>(equals)\n    // )\n\n    return { all$, key }\n  }\n}\n\nclass DatDigitalSelections extends Selector {\n  public by_pk_entity__entity_version$ = this.selector<DatDigital>('by_pk_entity__entity_version')\n  public by_pk_entity$ = this.selector<ByPk<DatDigital>>('by_pk_entity')\n  public by_pk_text$ = this.selector<ByPk<DatDigital>>('by_pk_text')\n\n\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, configs, model) }\n\n  latestVersion(pkDigital: number): Observable<DatDigital> {\n    return this.by_pk_entity$.key(pkDigital).pipe(\n      map(versions => latestVersion(versions)),\n    )\n  }\n}\n\nclass DatNamespaceSelections extends Selector {\n  public by_pk_entity$ = this.selector<DatNamespace>('by_pk_entity')\n  public by_fk_project$ = this.selector<ByPk<DatNamespace>>('by_fk_project')\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, configs, model) }\n}\n\nclass DatChunkSelections extends Selector {\n  public by_pk_entity$ = this.selector<DatChunk>('by_pk_entity')\n  public by_fk_text$ = this.selector<ByPk<DatChunk>>('by_fk_text')\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, configs, model) }\n}\n\nclass DatClassColumnMappingSelections extends Selector {\n  public by_pk_entity$ = this.selector<DatClassColumnMapping>('by_pk_entity')\n  public by_fk_column$ = this.selector<ByPk<DatClassColumnMapping>>('by_fk_column')\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, configs, model) }\n}\n\nclass DatColumnSelections extends Selector {\n  public by_pk_entity$ = this.selector<DatColumn>('by_pk_entity')\n  public by_fk_digital$ = this.selector<ByPk<DatColumn>>('by_fk_digital')\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, configs, model) }\n}\n\nclass DatTextPropertySelections extends Selector {\n  public by_pk_entity$ = this.selector<DatTextProperty>('by_pk_entity')\n  public by_fk_entity__fk_system_type$ = this.selector<ByPk<DatTextProperty>>('by_fk_entity__fk_system_type')\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, configs, model) }\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DatSelector extends DatActions {\n\n  digital$ = new DatDigitalSelections(this.ngRedux, datDefinitions, 'digital');\n  namespace$ = new DatNamespaceSelections(this.ngRedux, datDefinitions, 'namespace');\n  chunk$ = new DatChunkSelections(this.ngRedux, datDefinitions, 'chunk');\n  column$ = new DatColumnSelections(this.ngRedux, datDefinitions, 'column');\n  class_column_mapping$ = new DatClassColumnMappingSelections(this.ngRedux, datDefinitions, 'class_column_mapping');\n  text_property$ = new DatTextPropertySelections(this.ngRedux, datDefinitions, 'text_property');\n\n  constructor(public ngRedux: NgRedux<IAppState>) {\n    super(ngRedux)\n  }\n\n}\n","import { Injectable } from '@angular/core';\nimport { BehaviorSubject } from 'rxjs';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ShouldPauseService {\n  shouldPause$ = new BehaviorSubject(false)\n  constructor() { }\n}\n","import { NgRedux } from '@angular-redux/store';\nimport { Injectable } from '@angular/core';\nimport { IAppState } from '@kleiolab/lib-redux';\nimport { ByPk } from '@kleiolab/lib-redux';\nimport { empty, Observable } from 'rxjs';\nimport { switchMap } from 'rxjs/operators';\nimport { DfhProperty } from '@kleiolab/lib-sdk-lb4';\nimport { DfhProfile } from '@kleiolab/lib-sdk-lb4';\nimport { DfhLabel } from '@kleiolab/lib-sdk-lb4';\nimport { DfhClass } from '@kleiolab/lib-sdk-lb4';\nimport { ReducerConfigCollection } from '@kleiolab/lib-redux';\nimport { DfhActions } from '@kleiolab/lib-redux';\nimport { dfhDefinitions, dfhRoot } from '@kleiolab/lib-redux';\nimport { DfhClassSlice, DfhLabelSlice, DfhProfileSlice, DfhPropertySlice } from '@kleiolab/lib-redux';\nimport { ShouldPauseService } from '../services/should-pause.service';\nclass Selector<Slice> {\n\n  slice$ = this.ngRedux.select<Slice>([dfhRoot, this.model])\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public configs: ReducerConfigCollection,\n    public model: string,\n    public shouldPause$: Observable<boolean>\n  ) {\n  }\n\n  selector<M>(indexKey: string): { all$: Observable<ByPk<M>>, key: (x) => Observable<M>, noPause: { all$: Observable<ByPk<M>>, key: (x) => Observable<M> } } {\n\n    const allNoPause$ = this.ngRedux.select<ByPk<M>>([dfhRoot, this.model, indexKey]);\n    const all$ = this.shouldPause$.pipe(\n      switchMap(shouldPause => shouldPause ?\n        empty() :\n        allNoPause$\n      )\n    );\n\n    const keyNoPause = (x) => this.ngRedux.select<M>([dfhRoot, this.model, indexKey, x]);\n    const key = (x): Observable<M> => this.shouldPause$.pipe(\n      switchMap(shouldPause => shouldPause ?\n        empty() :\n        this.ngRedux.select<M>([dfhRoot, this.model, indexKey, x])\n      )\n    )\n\n    return { all$, key, noPause: { all$: allNoPause$, key: keyNoPause } }\n  }\n}\n// Profile Selectors\nclass DfhProfileSelections extends Selector<DfhProfileSlice> {\n  public by_pk_profile$ = this.selector<DfhProfile>('by_pk_profile');\n}\n\n// Class Selectors\nclass DfhClassSelections extends Selector<DfhClassSlice> {\n  public by_pk_class$ = this.selector<DfhClass>('by_pk_class');\n  public by_basic_type$ = this.selector<ByPk<DfhClass>>('by_basic_type');\n}\n\n// Property Selectors\nclass DfhPropertySelections extends Selector<DfhPropertySlice> {\n  public pk_property__has_domain__has_range$ = this.selector<DfhProperty>('pk_property__has_domain__has_range');\n  public by_pk_property$ = this.selector<ByPk<DfhProperty>>('by_pk_property');\n  public by_has_domain__pk_property$ = this.selector<ByPk<DfhProperty>>('by_has_domain__pk_property');\n  public by_has_range__pk_property$ = this.selector<ByPk<DfhProperty>>('by_has_range__pk_property');\n  public by_has_domain$ = this.selector<ByPk<DfhProperty>>('by_has_domain');\n  public by_has_range$ = this.selector<ByPk<DfhProperty>>('by_has_range');\n  public by_is_has_type_subproperty$ = this.selector<ByPk<DfhProperty>>('by_is_has_type_subproperty');\n}\n\n// Label Selectors\nclass DfhLabelSelections extends Selector<DfhLabelSlice> {\n  public by_fks$ = this.selector<DfhLabel>('by_fks');\n  public by_fk_class__type$ = this.selector<ByPk<DfhLabel>>('by_fk_class__type');\n  public by_fk_property__type$ = this.selector<ByPk<DfhLabel>>('by_fk_property__type');\n  public by_fk_profile__type$ = this.selector<ByPk<DfhLabel>>('by_fk_profile__type');\n}\n\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class DfhSelector extends DfhActions {\n\n  profile$ = new DfhProfileSelections(this.ngRedux, dfhDefinitions, 'profile', this.pause.shouldPause$)\n  class$ = new DfhClassSelections(this.ngRedux, dfhDefinitions, 'klass', this.pause.shouldPause$)\n  property$ = new DfhPropertySelections(this.ngRedux, dfhDefinitions, 'property', this.pause.shouldPause$)\n  label$ = new DfhLabelSelections(this.ngRedux, dfhDefinitions, 'label', this.pause.shouldPause$)\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public pause: ShouldPauseService\n  ) {\n    super(ngRedux)\n  }\n}\n","import { NgRedux } from '@angular-redux/store';\nimport { ByPk, createPaginateByKey, EntityModelAndClass, IAppState, IndexStatementByObject, indexStatementByObject, IndexStatementByObjectProperty, indexStatementByObjectProperty, IndexStatementBySubject, indexStatementBySubject, IndexStatementBySubjectProperty, indexStatementBySubjectProperty, infDefinitions, infRoot, paginateBy, PR_ENTITY_MODEL_MAP, ReducerConfigCollection } from '@kleiolab/lib-redux';\nimport { InfAppellation, InfDimension, InfLangString, InfLanguage, InfPersistentItem, InfPlace, InfStatement, InfTemporalEntity, InfTextProperty, InfTimePrimitive, ProInfoProjRel } from '@kleiolab/lib-sdk-lb3';\nimport { GvSubfieldPage } from '@kleiolab/lib-sdk-lb4';\nimport { combineLatestOrEmpty } from '@kleiolab/lib-utils';\nimport { values } from 'd3';\nimport { Observable, of, pipe } from 'rxjs';\nimport { filter, map, switchMap } from 'rxjs/operators';\nexport type InfModelName = 'persistent_item' | 'temporal_entity' | 'statement' | 'text_property' | 'appellation' | 'language' | 'place' | 'dimension' | 'lang_string' | 'time_primitive';\n\nclass Selector {\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public pkProject$: Observable<number | string>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { }\n\n  selector<M>(indexKey: string): { all$: Observable<ByPk<M>>, key: (x) => Observable<M> } {\n\n    const all$ = this.pkProject$.pipe(\n      switchMap(pk => {\n        let path: any[];\n        if (this.configs[this.model].facetteByPk) {\n          path = [infRoot, this.model, this.configs[this.model].facetteByPk, pk, indexKey];\n        } else {\n          path = [infRoot, this.model, indexKey];\n        }\n        return this.ngRedux.select<ByPk<M>>(path)\n      })\n    )\n\n\n    const key = (x): Observable<M> => {\n      return this.pkProject$.pipe(\n        switchMap(pk => {\n          let path: any[];\n          if (this.configs[this.model].facetteByPk) {\n            path = [infRoot, this.model, this.configs[this.model].facetteByPk, pk, indexKey, x];\n          } else {\n            path = [infRoot, this.model, indexKey, x];\n          }\n          return this.ngRedux.select<M>(path)\n        })\n      )\n\n    }\n\n    return { all$, key }\n  }\n\n  paginationSelector<M>() {\n\n    const pipePage = (page: GvSubfieldPage): Observable<M[]> => this.pkProject$.pipe(\n      switchMap(pk => {\n        let path: any[];\n        const pagBy = paginateBy\n        const key = createPaginateByKey(page)\n        if (this.configs[this.model].facetteByPk) {\n          path = [infRoot, this.model, this.configs[this.model].facetteByPk, pk, pagBy, key];\n        } else {\n          path = [infRoot, this.model, pagBy, key];\n        }\n        return this.ngRedux.select<number>([...path, 'count'])\n          .pipe(\n            filter(count => count !== undefined),\n            switchMap(count => {\n              const start = page.offset;\n              const end = count <= (start + page.limit) ? count : (start + page.limit);\n              const obs$: Observable<M>[] = [];\n              for (let i = start; i < end; i++) {\n                obs$.push(\n                  this.ngRedux.select<M>([...path, 'rows', i]).pipe(filter(x => !!x))\n                )\n              }\n              return combineLatestOrEmpty(obs$)\n            })\n          )\n      })\n    )\n\n    // const pipePageLoadNeeded = (page: GvSubfieldPage, trigger$?: Observable<any>): Observable<boolean> => this.pkProject$.pipe(\n    //   switchMap(pk => {\n    //     let path: any[];\n    //     const pagBy = paginateBy\n    //     const key = createPaginateByKey(page)\n    //     if (this.configs[this.model].facetteByPk) {\n    //       path = [infRoot, this.model, this.configs[this.model].facetteByPk, pk, pagBy, key];\n    //     } else {\n    //       path = [infRoot, this.model, pagBy, key];\n    //     }\n\n    //     return trigger$.pipe(\n    //       switchMap(() => this.ngRedux.select<boolean>([...path, 'loading', getFromTo(page.limit, page.offset)])\n    //         .pipe(\n    //           first(),\n    //           map(loading => !loading)\n    //         )\n    //       ))\n\n    //   })\n    // )\n\n    const pipeCount = (page: GvSubfieldPage): Observable<number | undefined> => this.pkProject$.pipe(\n      switchMap(pk => {\n        let path: any[];\n        const pagBy = paginateBy\n        const key = createPaginateByKey(page)\n        if (this.configs[this.model].facetteByPk) {\n          path = [infRoot, this.model, this.configs[this.model].facetteByPk, pk, pagBy, key];\n        } else {\n          path = [infRoot, this.model, pagBy, key];\n        }\n        return this.ngRedux.select<number>([...path, 'count'])\n      })\n    )\n\n    return { pipePage, pipeCount }\n\n  }\n\n\n  pipeItemsInProject<M>(pkProject$: Observable<number | string>, getFkEntity: (item: M) => number) {\n    return pipe(\n      switchMap((items: ByPk<M>) => {\n        return pkProject$.pipe(\n          switchMap(pkProject => {\n            const proRelsAndKey$: Observable<{ key: string, rel: ProInfoProjRel }>[] = [];\n            for (const k in items) {\n              if (items.hasOwnProperty(k)) {\n                const item = items[k];\n                proRelsAndKey$.push(\n                  this.ngRedux.select<ProInfoProjRel>(['pro', 'info_proj_rel', 'by_fk_project__fk_entity', pkProject + '_' + getFkEntity(item)])\n                    .pipe(map(rel => ({ key: k, rel })))\n                )\n              }\n            }\n            return combineLatestOrEmpty(proRelsAndKey$).pipe(\n              map(proRels => {\n                const itemsInProject: ByPk<M> = {};\n                for (let i = 0; i < proRels.length; i++) {\n                  const proRel = proRels[i];\n                  if (proRel.rel && proRel.rel.is_in_project) {\n                    itemsInProject[proRel.key] = items[proRel.key]\n                  }\n                }\n                return itemsInProject;\n              })\n            )\n          })\n        )\n\n      })\n    )\n  }\n\n  pipeItemInProject<M>(pkProject$: Observable<number | string>, getFkEntity: (item: M) => number) {\n    return pipe(\n      switchMap((item: M) => {\n        if (!item) return of(undefined);\n        return pkProject$.pipe(\n          switchMap(pkProject => {\n            const proRel$ = this.ngRedux.select<ProInfoProjRel>(['pro', 'info_proj_rel', 'by_fk_project__fk_entity', pkProject + '_' + getFkEntity(item)])\n            return proRel$.pipe(\n              // filter(proRel => proRel.is_in_project == true),\n              map((proRel) => proRel && proRel.is_in_project == true ? item : undefined)\n            )\n          })\n        )\n      })\n    )\n  }\n}\n\nclass InfPersistentItemSelections extends Selector {\n  private _by_pk_entity$ = this.selector<InfPersistentItem>('by_pk_entity')\n  private _by_fk_class$ = this.selector<ByPk<InfPersistentItem>>('by_fk_class')\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public pkProject$: Observable<number | string>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, pkProject$, configs, model) }\n\n  by_pk_entity_key$(key: string | number, ofProject = true) {\n    const selection$ = this._by_pk_entity$.key(key)\n    if (ofProject) return selection$.pipe(this.pipeItemInProject(this.pkProject$, (i) => i.pk_entity))\n    return selection$\n  }\n  by_pk_entity_all$(ofProject = true) {\n    const selection$ = this._by_pk_entity$.all$\n    if (ofProject) return selection$.pipe(this.pipeItemsInProject(this.pkProject$, (i) => i.pk_entity))\n    return selection$\n  }\n  by_fk_class_key$(key: string | number, ofProject = true) {\n    const selection$ = this._by_fk_class$.key(key)\n    if (ofProject) return selection$.pipe(this.pipeItemsInProject(this.pkProject$, (i) => i.pk_entity))\n    return selection$\n  }\n}\n\nclass InfTemporalEntitySelections extends Selector {\n  private _by_pk_entity$ = this.selector<InfTemporalEntity>('by_pk_entity')\n  // public by_fk_class$ = this.selector<ByPk<InfTemporalEntity>>('by_fk_class')\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public pkProject$: Observable<number | string>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, pkProject$, configs, model) }\n\n  by_pk_entity_key$(key: string | number, ofProject = true) {\n    const selection$ = this._by_pk_entity$.key(key)\n    if (ofProject) return selection$.pipe(this.pipeItemInProject(this.pkProject$, (i) => i.pk_entity))\n    return selection$\n  }\n}\n\n\nclass InfStatementSelections extends Selector {\n\n  public by_pk_entity$ = this.selector<InfStatement>('by_pk_entity')\n  public by_fk_subject_data$ = this.selector<ByPk<InfStatement>>('by_fk_subject_data')\n\n  public pagination$ = this.paginationSelector<number>()\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public pkProject$: Observable<number | string>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, pkProject$, configs, model) }\n\n  by_pk_entity_key$(key: string | number, ofProject = true) {\n    const selection$ = this.by_pk_entity$.key(key)\n    if (ofProject) return selection$.pipe(this.pipeItemInProject(this.pkProject$, (i) => i.pk_entity))\n    return selection$\n  }\n\n  by_subject$(foreignKeys: IndexStatementBySubject, ofProject = true): Observable<InfStatement[]> {\n    const key = indexStatementBySubject(foreignKeys);\n    const selection$ = this.selector<ByPk<InfStatement>>('by_subject').key(key)\n    if (ofProject) {\n      return selection$.pipe(\n        this.pipeItemsInProject(this.pkProject$, (item) => item.pk_entity),\n        map(items => values(items))\n      )\n    }\n    return selection$.pipe(\n      map(items => values(items))\n    );\n  }\n\n  by_subject_and_property$(foreignKeys: IndexStatementBySubjectProperty, ofProject = true): Observable<InfStatement[]> {\n    return this.by_subject_and_property_indexed$(foreignKeys, ofProject).pipe(\n      map(statementIdx => values(statementIdx))\n    )\n  }\n  by_subject_and_property_indexed$(foreignKeys: IndexStatementBySubjectProperty, ofProject = true): Observable<ByPk<InfStatement>> {\n    const key = indexStatementBySubjectProperty(foreignKeys);\n    const selection$ = this.selector<ByPk<InfStatement>>('by_subject+property').key(key)\n    if (ofProject) {\n      return selection$.pipe(this.pipeItemsInProject(this.pkProject$, (item) => item.pk_entity))\n    }\n    return selection$\n  }\n\n  by_object$(foreignKeys: IndexStatementByObject, ofProject = true): Observable<InfStatement[]> {\n    const key = indexStatementByObject(foreignKeys);\n    const selection$ = this.selector<ByPk<InfStatement>>('by_object').key(key)\n    if (ofProject) {\n      return selection$.pipe(\n        this.pipeItemsInProject(this.pkProject$, (item) => item.pk_entity),\n        map(items => values(items))\n      )\n    }\n    return selection$.pipe(\n      map(items => values(items))\n    );\n  }\n\n  by_object_and_property$(foreignKeys: IndexStatementByObjectProperty, ofProject = true): Observable<InfStatement[]> {\n    return this.by_object_and_property_indexed$(foreignKeys, ofProject).pipe(\n      map(statementIdx => values(statementIdx))\n    )\n  }\n\n  by_object_and_property_indexed$(foreignKeys: IndexStatementByObjectProperty, ofProject = true): Observable<ByPk<InfStatement>> {\n    const key = indexStatementByObjectProperty(foreignKeys);\n    const selection$ = this.selector<ByPk<InfStatement>>('by_object+property').key(key)\n    if (ofProject) {\n      return selection$.pipe(\n        this.pipeItemsInProject(this.pkProject$, (item) => item.pk_entity),\n      )\n    }\n    return selection$\n  }\n\n}\n\n\nclass InfTextPropertySelections extends Selector {\n  private _by_pk_entity$ = this.selector<InfTextProperty>('by_pk_entity')\n  private _by_fk_concerned_entity__fk_class_field$ = this.selector<ByPk<InfTextProperty>>('by_fk_concerned_entity__fk_class_field')\n  private _by_fk_concerned_entity$ = this.selector<ByPk<InfTextProperty>>('by_fk_concerned_entity')\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public pkProject$: Observable<number | string>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, pkProject$, configs, model) }\n\n  by_pk_entity_key$(key: string | number, ofProject = true) {\n    const selection$ = this._by_pk_entity$.key(key)\n    if (ofProject) return selection$.pipe(this.pipeItemInProject(this.pkProject$, (i) => i.pk_entity))\n    return selection$\n  }\n\n  by_fk_concerned_entity__fk_class_field_indexed$(key: string, ofProject = true): Observable<ByPk<InfTextProperty>> {\n    const selection$ = this._by_fk_concerned_entity__fk_class_field$.key(key)\n    if (ofProject) {\n      return selection$.pipe(\n        this.pipeItemsInProject(this.pkProject$, (item) => item.pk_entity),\n      )\n    }\n    return selection$\n  }\n\n\n  by_fk_concerned_entity_indexed$(key: string | number, ofProject = true): Observable<ByPk<InfTextProperty>> {\n    const selection$ = this._by_fk_concerned_entity$.key(key)\n    if (ofProject) {\n      return selection$.pipe(\n        this.pipeItemsInProject(this.pkProject$, (item) => item.pk_entity),\n      )\n    }\n    return selection$\n  }\n\n}\n\n\nclass InfAppellationSelections extends Selector {\n  public by_pk_entity$ = this.selector<InfAppellation>('by_pk_entity')\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public pkProject$: Observable<number | string>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, pkProject$, configs, model) }\n}\n\nclass InfLangStringSelections extends Selector {\n  public by_pk_entity$ = this.selector<InfLangString>('by_pk_entity')\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public pkProject$: Observable<number | string>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, pkProject$, configs, model) }\n}\n\nclass InfPlaceSelections extends Selector {\n  public by_pk_entity$ = this.selector<InfPlace>('by_pk_entity')\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public pkProject$: Observable<number | string>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, pkProject$, configs, model) }\n}\n\nclass InfTimePrimitiveSelections extends Selector {\n  public by_pk_entity$ = this.selector<InfTimePrimitive>('by_pk_entity')\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public pkProject$: Observable<number | string>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, pkProject$, configs, model) }\n}\n\nclass InfLanguageSelections extends Selector {\n  public by_pk_entity$ = this.selector<InfLanguage>('by_pk_entity')\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public pkProject$: Observable<number | string>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, pkProject$, configs, model) }\n}\n\nclass InfDimensionSelections extends Selector {\n  public by_pk_entity$ = this.selector<InfDimension>('by_pk_entity')\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public pkProject$: Observable<number | string>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, pkProject$, configs, model) }\n}\n\nexport class InfSelector {\n\n  persistent_item$ = new InfPersistentItemSelections(this.ngRedux, this.pkProject$, infDefinitions, 'persistent_item');\n  temporal_entity$ = new InfTemporalEntitySelections(this.ngRedux, this.pkProject$, infDefinitions, 'temporal_entity');\n  statement$ = new InfStatementSelections(this.ngRedux, this.pkProject$, infDefinitions, 'statement');\n  appellation$ = new InfAppellationSelections(this.ngRedux, this.pkProject$, infDefinitions, 'appellation');\n  place$ = new InfPlaceSelections(this.ngRedux, this.pkProject$, infDefinitions, 'place');\n  text_property$ = new InfTextPropertySelections(this.ngRedux, this.pkProject$, infDefinitions, 'text_property');\n  lang_string$ = new InfLangStringSelections(this.ngRedux, this.pkProject$, infDefinitions, 'lang_string');\n  time_primitive$ = new InfTimePrimitiveSelections(this.ngRedux, this.pkProject$, infDefinitions, 'time_primitive');\n  language$ = new InfLanguageSelections(this.ngRedux, this.pkProject$, infDefinitions, 'language');\n  dimension$ = new InfDimensionSelections(this.ngRedux, this.pkProject$, infDefinitions, 'dimension');\n\n  pkEntityModelMap$ = this.ngRedux.select([infRoot, PR_ENTITY_MODEL_MAP]);\n\n  constructor(public ngRedux: NgRedux<IAppState>, public pkProject$: Observable<number | string>) { }\n\n  getModelOfEntity$(pkEntity: number) {\n    return this.ngRedux.select<EntityModelAndClass<InfModelName>>([infRoot, PR_ENTITY_MODEL_MAP, pkEntity]);\n  }\n}\n","import { NgRedux } from '@angular-redux/store';\nimport { Injectable } from '@angular/core';\nimport { ByPk, IAppState, ProActions, proDefinitions, proRoot, ReducerConfigCollection } from '@kleiolab/lib-redux';\nimport { ProDfhClassProjRel, ProDfhProfileProjRel, ProInfoProjRel, ProTextProperty } from '@kleiolab/lib-sdk-lb3';\nimport { ProAnalysis, ProClassFieldConfig, ProProject } from '@kleiolab/lib-sdk-lb4';\nimport { toString } from 'ramda';\nimport { Observable } from 'rxjs';\n\n\n\n\nclass Selector {\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { }\n\n  selector<M>(indexKey: string): { all$: Observable<ByPk<M>>, key: (x: string | (string | number)[]) => Observable<M> } {\n\n    const all$ = this.ngRedux.select<ByPk<M>>([proRoot, this.model, indexKey])\n\n    const key = (x: string | (string | number)[]): Observable<M> => {\n      const k = typeof x === 'string' ? x : x.map((part: string | number) => toString(part)).join('_');;\n\n      return this.ngRedux.select<M>([proRoot, this.model, indexKey, k])\n    }\n\n    return { all$, key }\n  }\n}\n\nclass ProProjectSelector extends Selector {\n  public by_pk_entity$ = this.selector<ProProject>('by_pk_entity')\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, configs, model) }\n}\n\n\nclass ProInfoProjRelSelector extends Selector {\n  public by_fk_project__fk_entity$ = this.selector<ProInfoProjRel>('by_fk_project__fk_entity')\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, configs, model) }\n}\n\n\nclass ProDfhClassProjRelSelector extends Selector {\n  public by_fk_project__enabled_in_entities$ = this.selector<ByPk<ProDfhClassProjRel>>('by_fk_project__enabled_in_entities')\n  public by_fk_project__fk_class$ = this.selector<ProDfhClassProjRel>('by_fk_project__fk_class')\n  public by_fk_project$ = this.selector<ProDfhClassProjRel>('by_fk_project')\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, configs, model) }\n}\n\nclass ProDfhProfileProjRelSelector extends Selector {\n  public by_fk_project__enabled$ = this.selector<ByPk<ProDfhProfileProjRel>>('by_fk_project__enabled')\n  public by_fk_project__fk_profile$ = this.selector<ProDfhProfileProjRel>('by_fk_project__fk_profile')\n  public by_fk_project$ = this.selector<ProDfhProfileProjRel>('by_fk_project')\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, configs, model) }\n}\n\nclass ProClassFieldConfigSelector extends Selector {\n  public by_fk_project__fk_class$ = this.selector<ByPk<ProClassFieldConfig>>('by_fk_project__fk_class')\n  public by_pk_entity$ = this.selector<ProClassFieldConfig>('by_pk_entity')\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, configs, model) }\n}\n\n\nclass ProTextPropertySelector extends Selector {\n  public by_fks$ = this.selector<ProTextProperty>('by_fks')\n  public by_fks_without_lang$ = this.selector<ByPk<ProTextProperty>>('by_fks_without_lang')\n  // public fk_project__fk_dfh_property__fk_dfh_property_domain__fk_system_type__fk_language$ = this.selector<ByPk<ProTextProperty>>('fk_project__fk_dfh_property__fk_dfh_property_domain__fk_system_type__fk_language')\n  // public fk_project__fk_dfh_property__fk_dfh_property_range__fk_system_type__fk_language$ = this.selector<ByPk<ProTextProperty>>('fk_project__fk_dfh_property__fk_dfh_property_range__fk_system_type__fk_language')\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, configs, model) }\n}\n\n\nclass ProAnalysisSelector extends Selector {\n\n  public by_pk_entity$ = this.selector<ProAnalysis>('by_pk_entity')\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, configs, model) }\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ProSelector extends ProActions {\n\n  project$ = new ProProjectSelector(this.ngRedux, proDefinitions, 'project');\n  info_proj_rel$ = new ProInfoProjRelSelector(this.ngRedux, proDefinitions, 'info_proj_rel');\n  dfh_class_proj_rel$ = new ProDfhClassProjRelSelector(this.ngRedux, proDefinitions, 'dfh_class_proj_rel');\n  dfh_profile_proj_rel$ = new ProDfhProfileProjRelSelector(this.ngRedux, proDefinitions, 'dfh_profile_proj_rel');\n  class_field_config$ = new ProClassFieldConfigSelector(this.ngRedux, proDefinitions, 'class_field_config');\n  text_property$ = new ProTextPropertySelector(this.ngRedux, proDefinitions, 'text_property');\n  analysis$ = new ProAnalysisSelector(this.ngRedux, proDefinitions, 'analysis');\n\n  constructor(public ngRedux: NgRedux<IAppState>) {\n    super(ngRedux)\n  }\n}\n","import { NgRedux } from '@angular-redux/store';\nimport { ByPk, IAppState, ReducerConfigCollection, SysActions, SysConfigSlice, sysDefinitions, SysRelevantClassSlice, sysRoot } from '@kleiolab/lib-redux';\nimport { SysSystemRelevantClass } from '@kleiolab/lib-sdk-lb3';\nimport { SysConfigValue } from '@kleiolab/lib-sdk-lb4';\nimport { Observable } from 'rxjs';\nimport { Injectable } from '@angular/core';\n\nclass Selector<Slice> {\n\n  slice$ = this.ngRedux.select<Slice>([sysRoot, this.model])\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { }\n\n  selector<M>(indexKey: string): { all$: Observable<ByPk<M>>, key: (x) => Observable<M> } {\n\n    const all$ = this.ngRedux.select<ByPk<M>>([sysRoot, this.model, indexKey])\n\n    const key = (x): Observable<M> => this.ngRedux.select<M>([sysRoot, this.model, indexKey, x])\n\n    return { all$, key }\n  }\n}\n\n// SystemRelevantClass Selectors\nclass SysSystemRelevantClassSelections extends Selector<SysRelevantClassSlice> {\n  public by_pk_entity$ = this.selector<SysSystemRelevantClass>('by_pk_entity');\n  public by_fk_class$ = this.selector<ByPk<SysSystemRelevantClass>>('by_fk_class');\n  public by_required_by_sources$ = this.selector<ByPk<SysSystemRelevantClass>>('by_required_by_sources');\n  public by_required$ = this.selector<ByPk<SysSystemRelevantClass>>('by_required');\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, configs, model) }\n}\n\n// // AnalysisType Selectors\n// class SysAnalysisTypeSelections extends Selector<SysAnalysisTypeSlice> {\n//   public by_pk_entity$ = this.selector<SysAnalysisType>('by_pk_entity');\n//   constructor(\n//     public ngRedux: NgRedux<IAppState>,\n//     public configs: ReducerConfigCollection,\n//     public model: string\n//   ) { super(ngRedux, configs, model) }\n// }\n\n\n// Config Selectors\nclass SysConfigSelections extends Selector<SysConfigSlice> {\n  public main$ = this.ngRedux.select<SysConfigValue>([sysRoot, this.model, 'by_main', 'main'])\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, configs, model) }\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class SysSelector extends SysActions {\n  system_relevant_class$ = new SysSystemRelevantClassSelections(this.ngRedux, sysDefinitions, 'system_relevant_class')\n  // analysis_type$ = new SysAnalysisTypeSelections(this.ngRedux, sysDefinitions, 'analysis_type')\n\n  config$ = new SysConfigSelections(this.ngRedux, sysDefinitions, 'config')\n}\n","import { NgRedux } from '@angular-redux/store';\nimport { Injectable } from '@angular/core';\nimport { ByPk, IAppState, ReducerConfigCollection, TabActions, tabDefinitions, tabRoot } from '@kleiolab/lib-redux';\nimport { TabCell } from '@kleiolab/lib-sdk-lb4';\nimport { Observable } from 'rxjs';\n\nclass Selector {\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { }\n\n  selector<M>(indexKey: string): { all$: Observable<ByPk<M>>, key: (x) => Observable<M> } {\n\n    const all$ = this.ngRedux.select<ByPk<M>>([tabRoot, this.model, indexKey])\n\n    const key = (x): Observable<M> => this.ngRedux.select<M>([tabRoot, this.model, indexKey, x])\n\n    return { all$, key }\n  }\n}\n\nclass TabCellSelections extends Selector {\n  public by_pk_cell$ = this.selector<TabCell>('by_pk_cell')\n  public by_fk_column_fk_row$ = this.selector<ByPk<TabCell>>('by_fk_column_fk_row')\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, configs, model) }\n\n}\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class TabSelector extends TabActions {\n\n  cell$ = new TabCellSelections(this.ngRedux, tabDefinitions, 'cell');\n\n  constructor(public ngRedux: NgRedux<IAppState>) {\n    super(ngRedux)\n  }\n\n}\n","import { NgRedux } from '@angular-redux/store';\nimport { Injectable } from '@angular/core';\nimport { ByPk, IAppState, ReducerConfigCollection, WarActions, warDefinitions, warRoot } from '@kleiolab/lib-redux';\nimport { WarEntityPreview } from '@kleiolab/lib-sdk-lb4';\nimport { toString } from 'ramda';\nimport { Observable } from 'rxjs';\n\n\nclass Selector {\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { }\n\n  selector<M>(indexKey: string): { all$: Observable<ByPk<M>>, key: (x: string | (string | number)[]) => Observable<M> } {\n\n    const all$ = this.ngRedux.select<ByPk<M>>([warRoot, this.model, indexKey])\n\n    const key = (x: string | (string | number)[]): Observable<M> => {\n      const k = typeof x === 'string' ? x : x.map((part: string | number) => toString(part)).join('_');;\n\n      return this.ngRedux.select<M>([warRoot, this.model, indexKey, k])\n    }\n\n    return { all$, key }\n  }\n}\n\nclass WarEntityPreviewSelector extends Selector {\n  public by_pk_entity$ = this.selector<WarEntityPreview>('by_pk_entity')\n\n  constructor(\n    public ngRedux: NgRedux<IAppState>,\n    public configs: ReducerConfigCollection,\n    public model: string\n  ) { super(ngRedux, configs, model) }\n}\n\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class WarSelector extends WarActions {\n\n  entity_preview$ = new WarEntityPreviewSelector(this.ngRedux, warDefinitions, 'entity_preview');\n\n  constructor(public ngRedux: NgRedux<IAppState>) {\n    super(ngRedux)\n  }\n}\n","import { NgRedux } from '@angular-redux/store';\nimport { Injectable } from '@angular/core';\nimport { IAppState } from '@kleiolab/lib-redux';\nimport { distinctUntilChanged, filter } from 'rxjs/operators';\nimport { InfSelector } from '../selectors/inf.service';\nimport { DatSelector } from '../selectors/dat.service';\nimport { TabSelector } from '../selectors/tab.service';\nimport { ProSelector } from '../selectors/pro.service';\nimport { DfhSelector } from '../selectors/dfh.service';\nimport { SysSelector } from '../selectors/sys.service';\n\n/**\n * This class provides access to the part of the redux store\n * that mirrors the geovistory schema (inf, dat, sys, etc.)\n *\n * The selecors of inf are wrapped into helpers that select\n * the items that are in the current project (redux.activeProject)\n * using pro.info_proj_rel\n *\n * All other selectors (dat, sys, tab, pro, dfh) are directly\n * accessing the store.\n */\n@Injectable({\n  providedIn: 'root'\n})\nexport class SchemaSelectorsService {\n  inf$: InfSelector;\n\n  constructor(\n    ngRedux: NgRedux<IAppState>,\n    public dat$: DatSelector,\n    public tab$: TabSelector,\n    public pro$: ProSelector,\n    public dfh$: DfhSelector,\n    public sys$: SysSelector,\n  ) {\n    const pkProject$ = ngRedux.select<number>(['activeProject', 'pk_project']).pipe(\n      filter(p => p !== undefined),\n      distinctUntilChanged((x, y) => {\n        return x === y\n      })\n    );\n    this.inf$ = new InfSelector(ngRedux, pkProject$);\n  }\n}\n","import { NgRedux } from '@angular-redux/store';\nimport { Injectable } from '@angular/core';\nimport { IAppState } from '@kleiolab/lib-redux';\nimport { InfLanguage, ProProject, WarEntityPreview } from '@kleiolab/lib-sdk-lb4';\nimport { EntityPreviewSocket } from '@kleiolab/lib-sockets';\nimport { equals } from 'ramda';\nimport { Observable } from 'rxjs';\nimport { distinctUntilChanged, filter, first, switchMap } from 'rxjs/operators';\nimport { cache } from '../decorators/method-decorators';\nimport { SchemaSelectorsService } from './schema-selectors.service';\n\n@Injectable({\n  providedIn: 'root'\n})\nexport class ActiveProjectPipesService {\n  public pkProject$: Observable<number>;\n\n  requestedEntityPreviews: { [pkEntity: number]: boolean } = {}\n\n\n  constructor(\n    private ngRedux: NgRedux<IAppState>,\n    private s: SchemaSelectorsService,\n    private entityPreviewSocket: EntityPreviewSocket,\n\n  ) {\n    this.pkProject$ = ngRedux.select<number>(['activeProject', 'pk_project'])\n      .pipe(\n        filter(p => p !== undefined),\n        distinctUntilChanged((x, y) => {\n          return x === y\n        })\n      );\n\n\n\n    this.entityPreviewSocket.fromEvent('reconnect').subscribe(disconnect => {\n      // get all EntityPreview keys from state and send them to the\n      // server so that they will be streamed. This is important for\n      // when connection was lost.\n      this.pkProject$.pipe(first())\n        .subscribe((pkProject) => {\n          const pks = Object.keys({\n            ...this.ngRedux.getState().war.entity_preview,\n            ...this.requestedEntityPreviews\n          });\n          if (pks.length) {\n            this.entityPreviewSocket.emit('addToStream', {\n              pkProject,\n              pks\n            })\n          }\n        })\n    })\n\n\n\n  }\n  @cache({ refCount: false }) pipeActiveProject(): Observable<ProProject> {\n    return this.pkProject$.pipe(\n      switchMap(pkProject => this.s.pro$.project$.by_pk_entity$.key(pkProject.toString()))\n    ).pipe(filter(l => !!l))\n  }\n  @cache({ refCount: false }) pipeActiveDefaultLanguage(): Observable<InfLanguage> {\n\n    return this.pipeActiveProject().pipe(\n      filter(p => !!p),\n      switchMap(project => {\n\n        return this.s.inf$.language$.by_pk_entity$.key(project.fk_language.toString())\n      })\n    ).pipe(filter(l => !!l))\n  }\n\n\n\n  /**\n   * Loads a data unit preview, if it is not yet available in state or if\n   * forceReload is true;\n   *\n   * @param pkEntity\n   * @param forceReload\n   */\n  streamEntityPreview(pkEntity: number, forceReload?: boolean): Observable<WarEntityPreview> {\n    const state = this.ngRedux.getState();\n\n    if (\n      (\n        !(((state.war || {}).entity_preview || {}).by_pk_entity || {})[pkEntity] &&\n        !this.requestedEntityPreviews[pkEntity]\n      ) || forceReload) {\n      this.pkProject$.pipe(first(pk => !!pk)).subscribe(pkProject => {\n\n        this.entityPreviewSocket.emit('addToStream', {\n          pkProject,\n          pks: [pkEntity]\n        })\n        // const pkUiContext = SysConfig.PK_UI_CONTEXT_DATAUNITS_EDITABLE;\n\n        // this.ngRedux.dispatch(this.actions.loadEntityPreview(pkProject, pkEntity, pkUiContext))\n        this.requestedEntityPreviews[pkEntity] = true;\n      })\n    }\n\n    return this.ngRedux.select<WarEntityPreview>(['war', 'entity_preview', 'by_pk_entity', pkEntity])\n      .pipe(\n        distinctUntilChanged<WarEntityPreview>(equals),\n        filter(prev => (!!prev))\n      )\n  }\n\n}\n","\nimport { Injectable } from '@angular/core';\nimport { DfhConfig, ProConfig, SysConfig } from '@kleiolab/lib-config';\nimport { dfhLabelByFksKey, proClassFieldConfgByProjectAndClassKey, textPropertyByFksKey } from '@kleiolab/lib-redux';\nimport { ClassConfig, DfhClass, DfhLabel, DfhProperty, InfLanguage, ProClassFieldConfig, ProTextProperty, RelatedProfile, SysConfigFieldDisplay, SysConfigSpecialFields, SysConfigValue } from '@kleiolab/lib-sdk-lb4';\nimport { combineLatestOrEmpty } from '@kleiolab/lib-utils';\nimport { flatten, indexBy, uniq, values } from 'ramda';\nimport { combineLatest, Observable } from 'rxjs';\nimport { filter, map, startWith, switchMap } from 'rxjs/operators';\nimport { cache } from '../decorators/method-decorators';\nimport { Field } from '../models/Field';\nimport { FieldPlaceOfDisplay } from '../models/FieldPosition';\nimport { SpecialFieldType } from '../models/SpecialFieldType';\nimport { Subfield } from '../models/Subfield';\nimport { SubfieldType } from '../models/SubfieldType';\nimport { ActiveProjectPipesService } from './active-project-pipes.service';\nimport { SchemaSelectorsService } from './schema-selectors.service';\n\n\n// this is the\nexport type TableName = 'appellation' | 'language' | 'place' | 'time_primitive' | 'lang_string' | 'dimension' | 'persistent_item' | 'temporal_entity'\n\nexport interface DfhPropertyStatus extends DfhProperty {\n  // true, if removed from all profiles of the current project\n  removedFromAllProfiles: boolean\n}\n\ntype LabelOrigin = 'of project in project lang' | 'of default project in project lang' | 'of default project in english' | 'of ontome in project lang' | 'of ontome in english'\ntype Profiles = {\n  fk_profile: number;\n  removed_from_api: boolean;\n}[];\n\n\n@Injectable({\n  providedIn: 'root'\n})\n\n/**\n * This Service provides a collection of pipes that aggregate or transform configuration data.\n * When talking about configuration, we mean the conceptual reference model and the additional\n * configurations on system and project level.\n * For Example\n * - the fields of a class\n * - the labels of classes and properties\n */\nexport class ConfigurationPipesService {\n\n  constructor(\n    private a: ActiveProjectPipesService,\n    private s: SchemaSelectorsService,\n  ) { }\n\n\n  /**\n  * returns observable number[] wher the numbers are the pk_profile\n  * of all profiles that are enabled by the given project.\n  * The array will always include PK_PROFILE_GEOVISTORY_BASIC\n  */\n  // @spyTag\n  @cache({ refCount: false })\n  public pipeProfilesEnabledByProject(): Observable<number[]> {\n    return this.a.pkProject$.pipe(\n      switchMap(pkProject => this.s.pro$.dfh_profile_proj_rel$.by_fk_project__enabled$\n        .key(pkProject + '_true').pipe(\n          map(projectProfileRels => values(projectProfileRels)\n            .filter(rel => rel.enabled)\n            .map(rel => rel.fk_profile)\n          ),\n          map(enabled => [...enabled, DfhConfig.PK_PROFILE_GEOVISTORY_BASIC]),\n        )),\n    )\n  }\n\n  /**\n   * Pipe all fields of given class\n   * The Fields are not ordered and not filtered\n   * If you want specific subsets of Fields and/or ordered Fields, use the pipes\n   * that build on this pipe.\n   */\n  @cache({ refCount: false }) public pipeFields(pkClass: number): Observable<Field[]> {\n\n    return combineLatest(\n      // pipe source class\n      this.s.dfh$.class$.by_pk_class$.key(pkClass),\n      // pipe outgoing properties\n      this.s.dfh$.property$.by_has_domain$.key(pkClass).pipe(map(indexed => values(indexed))),\n      // pipe ingoing properties\n      this.s.dfh$.property$.by_has_range$.key(pkClass).pipe(map(indexed => values(indexed))),\n      // pipe sys config\n      this.s.sys$.config$.main$.pipe(filter(x => !!x)),\n      // pipe enabled profiles\n      this.pipeProfilesEnabledByProject(),\n    ).pipe(\n      switchMap(([sourceKlass, outgoingProps, ingoingProps, sysConfig, enabledProfiles]) => {\n\n        // if class is not appellation for language, add appellation for language (1111) property\n        if (pkClass !== DfhConfig.CLASS_PK_APPELLATION_FOR_LANGUAGE) {\n          ingoingProps.push(createAppellationProperty(pkClass))\n        }\n        // if is temporal entity, add has time span property\n        if (sourceKlass.basic_type === 9) {\n          outgoingProps.push(createHasTimeSpanProperty(pkClass))\n        }\n\n        outgoingProps.push(createHasDefinitionProperty(pkClass))\n\n        return combineLatest(\n          this.pipePropertiesToSubfields(outgoingProps, true, enabledProfiles, sysConfig),\n          this.pipePropertiesToSubfields(ingoingProps, false, enabledProfiles, sysConfig),\n          this.pipeFieldConfigs(pkClass)\n        ).pipe(\n          map(([subfields1, subfields2, fieldConfigs]) => {\n            const subfields = [...subfields1, ...subfields2]\n\n            const fieldConfigIdx = indexBy((x) => [\n              (x.fk_domain_class || x.fk_range_class),\n              x.fk_property,\n              !!x.fk_domain_class\n            ].join('_'), fieldConfigs)\n\n            const uniqFields: { [uid: string]: Field } = {}\n            const uniqSubfieldCache: { [uid: string]: true } = {}\n\n\n            // group by source, pkProperty and isOutgoing\n            for (const s of subfields) {\n              const fieldId = [s.sourceClass, s.property.pkProperty, s.isOutgoing].join('_')\n              const subfieldId = [s.sourceClass, s.property.pkProperty, s.isOutgoing, s.targetClass].join('_')\n              const fieldConfig: ProClassFieldConfig | undefined = fieldConfigIdx[fieldId];\n              // the first time the group is established\n              if (!uniqFields[fieldId]) {\n                let isSpecialField: SpecialFieldType = false;\n                if (s.isHasTypeField) isSpecialField = 'has-type';\n                else if (s.property.pkProperty === DfhConfig.PROPERTY_PK_HAS_TIME_SPAN) isSpecialField = 'time-span';\n                uniqFields[fieldId] = {\n                  sourceClass: s.sourceClass,\n                  sourceClassLabel: s.sourceClassLabel,\n                  sourceMaxQuantity: s.sourceMaxQuantity,\n                  sourceMinQuantity: s.sourceMinQuantity,\n                  targetMinQuantity: s.targetMinQuantity,\n                  targetMaxQuantity: s.targetMaxQuantity,\n                  label: s.label,\n                  isHasTypeField: s.isHasTypeField,\n                  property: s.property,\n                  isOutgoing: s.isOutgoing,\n                  identityDefiningForSource: s.identityDefiningForSource,\n                  identityDefiningForTarget: s.identityDefiningForTarget,\n                  ontoInfoLabel: s.ontoInfoLabel,\n                  ontoInfoUrl: s.ontoInfoUrl,\n                  allSubfieldsRemovedFromAllProfiles: s.removedFromAllProfiles,\n                  targetClasses: [s.targetClass],\n                  listDefinitions: [s],\n                  fieldConfig,\n                  placeOfDisplay: getPlaceOfDisplay(sysConfig.specialFields, s, fieldConfig),\n                  isSpecialField\n                }\n\n                // mark subfield as added\n                uniqSubfieldCache[subfieldId] = true;\n\n\n              }\n              // ignore duplications of subfields\n              else if (!uniqSubfieldCache[subfieldId]) {\n                uniqFields[fieldId].allSubfieldsRemovedFromAllProfiles === false ?\n                  uniqFields[fieldId].allSubfieldsRemovedFromAllProfiles = false :\n                  uniqFields[fieldId].allSubfieldsRemovedFromAllProfiles = s.removedFromAllProfiles;\n                uniqFields[fieldId].targetClasses.push(s.targetClass)\n                uniqFields[fieldId].listDefinitions.push(s)\n              }\n            }\n\n            return values(uniqFields)\n          })\n        )\n      })\n    )\n  }\n\n\n\n  /**\n   * pipe all the specific fields of a class,\n   * ordered by the position of the field within the specific fields\n   */\n  // @spyTag\n  @cache({ refCount: false }) public pipeSpecificFieldOfClass(pkClass: number): Observable<Field[]> {\n\n    return this.pipeFields(pkClass).pipe(\n      map(fields => fields\n        // filter fields that are displayd in specific fields\n        .filter(field => field.placeOfDisplay.specificFields)\n        // sort fields by the position defined in the specific fields\n        .sort((a, b) => a.placeOfDisplay.specificFields.position - b.placeOfDisplay.specificFields.position)\n      )\n    )\n  }\n\n  /**\n    * pipe all the basic fields of a class,\n    * ordered by the position of the field within the basic fields\n    */\n  // @spyTag\n  @cache({ refCount: false }) public pipeBasicFieldsOfClass(pkClass: number): Observable<Field[]> {\n    return this.pipeFields(pkClass).pipe(\n      map(fields => fields\n        // filter fields that are displayd in basic fields\n        .filter(field => field.placeOfDisplay.basicFields)\n        // sort fields by the position defined in the basic fields\n        .sort((a, b) => a.placeOfDisplay.basicFields.position - b.placeOfDisplay.basicFields.position)\n      )\n    )\n  }\n\n\n\n\n  /**\n     * Pipes the fields for temporal entity forms\n     * - the specific fields\n     * - the when field\n     * - if available: the type field\n     */\n  // @spyTag\n  @cache({ refCount: false }) public pipeFieldsForTeEnForm(pkClass: number): Observable<Field[]> {\n    return this.pipeFields(pkClass).pipe(\n      // filter fields that are displayd in specific fields\n      map(allFields => {\n        const fields = allFields\n          // filter fields that are displayd in specific fields\n          .filter(field => field.placeOfDisplay.specificFields)\n          // sort fields by the position defined in the specific fields\n          .sort((a, b) => a.placeOfDisplay.specificFields.position - a.placeOfDisplay.specificFields.position)\n\n        const whenField = allFields.find(field => field.property.pkProperty === DfhConfig.PROPERTY_PK_HAS_TIME_SPAN)\n        if (whenField) fields.push(whenField)\n\n        const typeField = allFields.find(field => field.isHasTypeField)\n        if (typeField) fields.push(typeField)\n\n        return fields;\n      })\n    )\n  }\n\n\n\n\n\n\n  /**\n   * Pipes the fields of given class in this order:\n   * - basic fields\n   * - specific fields\n   */\n  // @spyTag\n  @cache({ refCount: false }) pipeBasicAndSpecificFields(pkClass: number): Observable<Field[]> {\n    return combineLatest(\n      this.pipeBasicFieldsOfClass(pkClass),\n      this.pipeSpecificFieldOfClass(pkClass)\n    )\n      .pipe(\n        map(([a, b]) => [...a, ...b])\n      )\n  }\n\n  /**\n  * Pipes the fields of given class in this order:\n  * - specific fields\n  * - basic fields\n  */\n  // @spyTag\n  @cache({ refCount: false }) pipeSpecificAndBasicFields(pkClass: number): Observable<Field[]> {\n    return combineLatest(\n      this.pipeSpecificFieldOfClass(pkClass),\n      this.pipeBasicFieldsOfClass(pkClass),\n    )\n      .pipe(\n        map(([a, b]) => [...a, ...b])\n      )\n  }\n\n\n\n\n\n\n\n\n  @cache({ refCount: false }) private pipePropertiesToSubfields(\n    properties: DfhProperty[],\n    isOutgoing: boolean,\n    enabledProfiles: number[],\n    sysConfig: SysConfigValue\n  ): Observable<Subfield[]> {\n    return combineLatestOrEmpty(\n      properties.map(p => {\n\n        const o = isOutgoing;\n        const targetClass = o ? p.has_range : p.has_domain;\n        const sourceClass = o ? p.has_domain : p.has_range;\n        const targetMaxQuantity = o ?\n          p.range_instances_max_quantifier :\n          p.domain_instances_max_quantifier;\n\n        const sourceMaxQuantity = o ?\n          p.domain_instances_max_quantifier :\n          p.range_instances_max_quantifier;\n\n        const targetMinQuantity = o ?\n          p.range_instances_min_quantifier :\n          p.domain_instances_min_quantifier;\n\n        const sourceMinQuantity = o ?\n          p.domain_instances_min_quantifier :\n          p.range_instances_min_quantifier;\n\n        return combineLatest(\n          this.pipeClassLabel(sourceClass),\n          this.pipeClassLabel(targetClass),\n          this.pipeSubfieldTypeOfClass(sysConfig, targetClass, targetMaxQuantity),\n          this.pipeFieldLabel(\n            p.pk_property,\n            isOutgoing ? p.has_domain : null,\n            isOutgoing ? null : p.has_range,\n          )\n        ).pipe(\n          map(([sourceClassLabel, targetClassLabel, listType, label]) => {\n\n            const node: Subfield = {\n              listType,\n              sourceClass,\n              sourceClassLabel,\n              sourceMaxQuantity,\n              sourceMinQuantity,\n              targetClass,\n              targetClassLabel,\n              targetMinQuantity,\n              targetMaxQuantity,\n              label,\n              isHasTypeField: o && p.is_has_type_subproperty,\n              property: { pkProperty: p.pk_property },\n              isOutgoing: o,\n              identityDefiningForSource: o ? p.identity_defining : false, // replace false with p.identity_defining_for_range when available\n              identityDefiningForTarget: o ? false : p.identity_defining, // replace false with p.identity_defining_for_range when available\n              ontoInfoLabel: p.identifier_in_namespace,\n              ontoInfoUrl: 'https://ontome.dataforhistory.org/property/' + p.pk_property,\n              removedFromAllProfiles: isRemovedFromAllProfiles(enabledProfiles, (p.profiles || [])),\n            }\n            return node\n          })\n        )\n      })\n    )\n\n  }\n\n\n  /**\n   * Pipes the type of Subfield for a given class\n   * Currently (to be revised if good) sublcasses of E55 Type,\n   * that are the target of a field with targetMaxQantity=1,\n   * get Subfield type 'hasType'.\n   * Therefore targetMaxQuantity is needed.\n   *\n   * This behavior has to be revised, because it can lead to problems\n   * when the Subfield belongs to a Field with multiple target classes\n   * (and thus Subfields) because the UI then does not allow to choose\n   * the right target class.\n   */\n  // @spyTag\n  @cache({ refCount: false }) pipeSubfieldTypeOfClass(config: SysConfigValue, pkClass: number, targetMaxQuantity: number): Observable<SubfieldType> {\n    return this.s.dfh$.class$.by_pk_class$.key(pkClass).pipe(\n      filter(i => !!i),\n      map((klass) => getSubfieldType(config, klass, targetMaxQuantity))\n    )\n  }\n\n\n  /**\n   * Gets class field configs of given pkClass\n   *\n   * - of active project, if any, else\n   * - of default config project, else\n   * - empty array\n   *\n   */\n  // @spyTag\n  @cache({ refCount: false }) pipeFieldConfigs(pkClass: number): Observable<ProClassFieldConfig[]> {\n    return this.a.pkProject$.pipe(\n      switchMap((fkProject) => {\n\n        const activeProjectkey = proClassFieldConfgByProjectAndClassKey({\n          fk_class_for_class_field: pkClass,\n          fk_project: fkProject\n        })\n        const defaultProjectkey = proClassFieldConfgByProjectAndClassKey({\n          fk_class_for_class_field: pkClass,\n          fk_project: ProConfig.PK_PROJECT_OF_DEFAULT_CONFIG_PROJECT\n        })\n        return combineLatest(\n          this.s.pro$.class_field_config$.by_fk_project__fk_class$.key(activeProjectkey),\n          this.s.pro$.class_field_config$.by_fk_project__fk_class$.key(defaultProjectkey)\n        )\n          .pipe(\n            map(([activeProjectFields, defaultProjectFields]) => {\n              if (activeProjectFields && values(activeProjectFields).length) return activeProjectFields;\n\n              return defaultProjectFields\n            }),\n            map((items) => values(items).sort((a, b) => (a.ord_num > b.ord_num ? 1 : -1))),\n          )\n      })\n    )\n  }\n\n  /********************************************** */\n\n\n  /**\n   * Delivers class label for active project\n   */\n  // @spyTag\n  @cache({ refCount: false }) pipeClassLabel(pkClass?: number): Observable<string> {\n\n    return combineLatest(\n      this.a.pkProject$,\n      this.a.pipeActiveDefaultLanguage()\n    ).pipe(\n      switchMap(([fkProject, language]) => this.pipeLabels({ pkClass, fkProject, language, type: 'label' })\n        .pipe(\n          map(items => {\n\n            const i = items.find(item => !!item)\n            return i ? i.text : `* no label (id: ${pkClass}) *`\n          })\n        ))\n    )\n  }\n\n\n  /**\n   * Delivers array of objects with\n   * text ~ the text of the property\n   * origin, in this order:\n   * - origin == 'of project in project lang'         (from projects.text_property)\n   * - origin == 'of default project in project lang' (from projects.text_property)\n   * - origin == 'of default project in english'      (from projects.text_property)\n   * - origin == 'of ontome in project lang'          (from data_for_history.label)\n   * - origin == 'of ontome in english'               (from data_for_history.label)\n   */\n  // @spyTag\n  @cache({ refCount: false }) pipeLabels(d: {\n    fkProject: number,\n    type: 'label' | 'definition' | 'scopeNote',\n    language: InfLanguage,\n    pkClass?: number,\n    fkProperty?: number,\n    fkPropertyDomain?: number,\n    fkPropertyRange?: number,\n  }): Observable<{\n    origin: LabelOrigin\n    text: string\n  }[]> {\n    let fk_system_type: number;\n\n    if (d.pkClass) {\n      switch (d.type) {\n        case 'label':\n          fk_system_type = SysConfig.PK_SYSTEM_TYPE__TEXT_PROPERTY__LABEL\n          break;\n        default:\n          console.warn('fk_system_type not found')\n          break;\n      }\n    }\n    else if (d.fkProperty) {\n      switch (d.type) {\n        case 'label':\n          fk_system_type = SysConfig.PK_SYSTEM_TYPE__TEXT_PROPERTY__LABEL\n          break;\n        default:\n          console.warn('fk_system_type not found')\n          break;\n      }\n    }\n\n\n    return combineLatest(\n      // label of project in default language of project\n      this.pipeProTextProperty({\n        fk_project: d.fkProject,\n        fk_language: d.language.pk_entity,\n        fk_system_type,\n        fk_dfh_class: d.pkClass,\n        fk_dfh_property: d.fkProperty,\n        fk_dfh_property_domain: d.fkPropertyDomain,\n        fk_dfh_property_range: d.fkPropertyRange\n      }).pipe(map((item) => {\n        if (!item) return undefined;\n        const origin: LabelOrigin = 'of project in project lang';\n        return { origin, text: item.string }\n      })),\n\n      // label of default project\n      this.pipeProTextProperty({\n        fk_project: ProConfig.PK_PROJECT_OF_DEFAULT_CONFIG_PROJECT,\n        fk_language: d.language.pk_entity,\n        fk_system_type,\n        fk_dfh_class: d.pkClass,\n        fk_dfh_property: d.fkProperty,\n        fk_dfh_property_domain: d.fkPropertyDomain,\n        fk_dfh_property_range: d.fkPropertyRange\n      }).pipe(map((item) => {\n        if (!item) return undefined;\n        const origin: LabelOrigin = 'of default project in project lang';\n        return { origin, text: item.string }\n      })),\n\n      // label of default project\n      this.pipeProTextProperty({\n        fk_project: ProConfig.PK_PROJECT_OF_DEFAULT_CONFIG_PROJECT,\n        fk_language: 18889,\n        fk_system_type,\n        fk_dfh_class: d.pkClass,\n        fk_dfh_property: d.fkProperty,\n        fk_dfh_property_domain: d.fkPropertyDomain,\n        fk_dfh_property_range: d.fkPropertyRange\n      }).pipe(map((item) => {\n        if (!item) return undefined;\n        const origin: LabelOrigin = 'of default project in english';\n        return { origin, text: item.string }\n      })),\n\n      // label from ontome in default language of project\n      this.pipeDfhLabel({\n        language: d.language.iso6391.trim(),\n        type: 'label',\n        fk_class: d.pkClass,\n        fk_property: d.fkProperty\n      }).pipe(map((item) => {\n        if (!item) return undefined;\n        const origin: LabelOrigin = 'of ontome in project lang';\n        return { origin, text: item.label }\n      })),\n\n      // label from ontome in english\n      this.pipeDfhLabel({\n        language: 'en',\n        type: 'label',\n        fk_class: d.pkClass,\n        fk_property: d.fkProperty\n      }).pipe(map((item) => {\n        if (!item) return undefined;\n        const origin: LabelOrigin = 'of ontome in english';\n        return { origin, text: item.label }\n      })),\n    )\n  }\n\n  /**\n   * Pipes ProTextProperty\n   */\n  // @spyTag\n  @cache({ refCount: false }) pipeProTextProperty(d: {\n    fk_project: number,\n    fk_system_type: number,\n    fk_language: number,\n    fk_dfh_class?: number,\n    fk_dfh_property?: number,\n    fk_dfh_property_domain?: number,\n    fk_dfh_property_range?: number,\n  }): Observable<ProTextProperty> {\n    const key = textPropertyByFksKey(d)\n    return this.s.pro$.text_property$.by_fks$.key(key)\n  }\n\n  /**\n   * Pipes DfhLabel\n   */\n  // @spyTag\n  @cache({ refCount: false }) pipeDfhLabel(d: {\n    type: 'label' | 'definition' | 'scopeNote',\n    language: string,\n    fk_class?: number,\n    fk_profile?: number,\n    fk_property?: number,\n    fk_project?: number,\n  }): Observable<DfhLabel> {\n    const key = dfhLabelByFksKey(d)\n    return this.s.dfh$.label$.by_fks$.key(key)\n  }\n\n  /**\n   * Delivers best fitting field label for active project\n  */\n  // @spyTag\n  @cache({ refCount: false }) pipeFieldLabel(fkProperty: number, fkPropertyDomain: number, fkPropertyRange: number): Observable<string> {\n    const isOutgoing = !!fkPropertyDomain;\n    // const system_type = isOutgoing ? (singular ? 180 : 181) : (singular ? 182 : 183)\n\n    return combineLatest(\n      this.a.pkProject$,\n      this.a.pipeActiveDefaultLanguage()\n    ).pipe(\n      switchMap(([fkProject, language]) => this.pipeLabels(\n        {\n          fkProject,\n          type: 'label',\n          language,\n          fkProperty,\n          fkPropertyDomain,\n          fkPropertyRange\n        }\n      )\n        .pipe(\n          map(items => {\n            let label = `* no label (id: ${fkProperty}) *`;\n            items.some((item) => {\n              if (\n                item &&\n                (\n                  item.origin === 'of project in project lang' ||\n                  item.origin === 'of default project in project lang' ||\n                  item.origin === 'of default project in english'\n                )\n              ) {\n                label = item.text\n                return true\n              }\n              else if (\n                item &&\n                (\n                  item.origin === 'of ontome in project lang' ||\n                  item.origin === 'of ontome in english'\n                )\n              ) {\n                label = isOutgoing ? item.text : '* reverse of: ' + item.text + '*'\n                return true\n              }\n            })\n            return label\n          })\n        ))\n    )\n\n  }\n\n\n  /**\n   * maps the class to the corresponding model (database table)\n   * this is used by Forms to create new data in the shape of\n   * the data model\n   */\n  // @spyTag\n  @cache({ refCount: false }) pipeTableNameOfClass(targetClassPk: number): Observable<TableName> {\n    return combineLatest(\n      this.s.sys$.config$.main$,\n      this.s.dfh$.class$.by_pk_class$.key(targetClassPk)\n    ).pipe(\n      filter(i => !i.includes(undefined)),\n      map(([config, klass]) => {\n        const classConfig: ClassConfig = config.classes[targetClassPk];\n        if (classConfig && classConfig.valueObjectType) {\n\n          const keys = Object.keys(classConfig.valueObjectType)\n          if (classConfig.valueObjectType.appellation) return\n          const key = keys[0];\n          if (classConfig.valueObjectType.appellation) return 'appellation';\n          else if (classConfig.valueObjectType.language) return 'language';\n          else if (classConfig.valueObjectType.place) return 'place';\n          else if (classConfig.valueObjectType.timePrimitive) return 'time_primitive';\n          else if (classConfig.valueObjectType.langString) return 'lang_string';\n          else if (classConfig.valueObjectType.dimension) return 'dimension';\n          else {\n            console.warn('unsupported list type')\n          }\n        }\n        else if (klass.basic_type === 8 || klass.basic_type === 30) {\n          return 'persistent_item'\n        }\n        else {\n          return 'temporal_entity'\n        }\n      })\n    )\n  }\n\n\n  /**\n   * returns an object where the keys are the pks of the Classes\n   * used by the given project:\n   * - or because the class is enabled by class_proj_rel\n   * - or because the class is required by sources\n   *\n   * This is usefull to create select dropdowns of classes users will know\n   */\n  // @spyTag\n  @cache({ refCount: false }) pipeClassesInEntitiesOrSources(): Observable<{ [key: string]: number }> {\n    return combineLatest(\n      this.pipeClassesEnabledInEntities(),\n      this.pipeClassesRequiredBySources()\n    ).pipe(\n      map(([a, b]) => indexBy((x) => x.toString(), uniq([...a, ...b]))),\n      startWith({})\n    )\n  }\n\n  // @spyTag\n  @cache({ refCount: false }) pipeClassesRequiredBySources() {\n    return this.s.sys$.system_relevant_class$.by_required_by_sources$.key('true')\n      .pipe(map(c => values(c).map(k => k.fk_class)))\n  }\n\n  /**\n   * returns observable number[] wher the numbers are the pk_class\n   * of all classes that are enabled by at least one of the activated profiles\n   * of thte given project\n   */\n  // @spyTag\n  @cache({ refCount: false }) pipeClassesEnabledByProjectProfiles(): Observable<DfhClass[]> {\n    return this.a.pkProject$.pipe(switchMap(pkProject => combineLatest([\n      this.s.dfh$.class$.by_pk_class$.all$,\n      this.pipeProfilesEnabledByProject()\n    ]).pipe(\n      map(([classesByPk, enabledProfiles]) => {\n        const profilesMap = indexBy((k) => k.toString(), values(enabledProfiles))\n        return values(classesByPk)\n          .filter(klass => klass.profiles.some(profile => profilesMap[profile.fk_profile]))\n      })\n    )\n    ))\n  }\n\n  /**\n  * returns observable number[] wher the numbers are the pk_class\n  * of all type classes that are enabled by at least one of the activated profiles\n  * of thte given project\n  */\n  // @spyTag\n  @cache({ refCount: false }) pipeTypeClassesEnabledByProjectProfiles(): Observable<DfhClass[]> {\n    return combineLatest([\n      this.s.dfh$.class$.by_basic_type$.key(30),\n      this.pipeProfilesEnabledByProject()\n    ]).pipe(\n      map(([classesByPk, enabledProfiles]) => {\n        const profilesMap = indexBy((k) => k.toString(), values(enabledProfiles))\n        return values(classesByPk)\n          .filter(klass => {\n            return klass.profiles.some(profile => profilesMap[profile.fk_profile]) &&\n              // Exclude Manifestation product type and language\n              ![\n                DfhConfig.CLASS_PK_LANGUAGE,\n                DfhConfig.CLASS_PK_MANIFESTATION_PRODUCT_TYPE\n              ].includes(klass.pk_class)\n          })\n      })\n    )\n  }\n\n\n\n  /**\n   * returns observable number[] where the numbers are the pk_class\n   * of all classes that are enabled by active project (using class_proj_rel)\n   */\n  // @spyTag\n  @cache({ refCount: false }) pipeClassesEnabledInEntities() {\n    return this.a.pkProject$.pipe(switchMap(pkProject => this.s.pro$.dfh_class_proj_rel$.by_fk_project__enabled_in_entities$.key(pkProject + '_true')\n      .pipe(\n        map((rels) => values(rels).map(rel => rel.fk_class))\n      )\n    ))\n  }\n\n  /**\n  * returns an object where the keys are the pks of the TeEn Classes\n  * used by the given project\n  */\n  // @spyTag\n  @cache({ refCount: false }) pipeSelectedTeEnClassesInProject(): Observable<{ [key: string]: number }> {\n    return combineLatest(\n      this.pipeTeEnClassesEnabledInEntities(),\n      this.pipeTeEnClassesRequiredBySources()\n    ).pipe(\n      map(([a, b]) => indexBy((x) => x.toString(), uniq([...a, ...b]))),\n      startWith({})\n    )\n  }\n\n  /**\n   * Gets array of pk_class with teEn classes enabled in entities\n   */\n  // @spyTag\n  @cache({ refCount: false }) pipeTeEnClassesEnabledInEntities() {\n    return this.a.pkProject$.pipe(switchMap(pkProject => this.s.pro$.dfh_class_proj_rel$.by_fk_project__enabled_in_entities$.key(pkProject + '_true')\n      .pipe(\n        switchMap((cs) => combineLatest(\n          values(cs).map(c => this.s.dfh$.class$.by_pk_class$.key(c.fk_class).pipe(\n            filter(item => !!item)\n          ))\n        ).pipe(\n          map(dfhClasses => this.filterTeEnCasses(dfhClasses))\n        ))\n      )\n    ))\n  }\n\n  /**\n   * Filters array of DfhClass for TeEn Classes and returns array of pk_class\n   * @param dfhClasses array of DfhClass\n   * @returns returns array of pk_class where class is TeEn class\n   */\n  private filterTeEnCasses(dfhClasses: DfhClass[]): number[] {\n    const pks: number[] = [];\n    for (let i = 0; i < dfhClasses.length; i++) {\n      const c = dfhClasses[i];\n      if (c.basic_type === 9) pks.push(c.pk_class);\n    }\n    return pks;\n  }\n\n  /**\n   * Gets array of pk_class with teEn classes required by sources\n   */\n  // @spyTag\n  @cache({ refCount: false }) pipeTeEnClassesRequiredBySources() {\n    return this.s.sys$.system_relevant_class$.by_required_by_sources$.key('true')\n      .pipe(\n        switchMap((cs) => combineLatest(\n          values(cs).map(c => this.s.dfh$.class$.by_pk_class$.key(c.fk_class).pipe(\n            filter(item => !!item)\n          ))\n        ).pipe(\n          map(dfhClasses => {\n            return this.filterTeEnCasses(dfhClasses)\n          })\n        ))\n      )\n  }\n\n\n\n\n\n\n  /**\n   *\n   */\n  // @spyTag\n  @cache({ refCount: false }) pipeTypeAndTypedClasses(enabledIn?: 'entities' | 'sources'): Observable<{ typedClass: number, typeClass: number }[]> {\n\n    let pks$: Observable<number[]>[];\n\n    const fromSources$ = this.s.sys$.system_relevant_class$.by_required_by_sources$.key('true').pipe(\n      map(classes => values(classes).map(k => k.fk_class)),\n    )\n\n    const fromEntities$ = this.pipeClassesEnabledInEntities()\n\n    if (enabledIn === 'sources') {\n      pks$ = [fromSources$];\n    } else if (enabledIn === 'entities') {\n      pks$ = [fromEntities$];\n    } else {\n      pks$ = [fromSources$, fromEntities$]\n    }\n\n    return combineLatest(pks$).pipe(\n      map(arrayOfPkArrays => uniq(flatten<number>(arrayOfPkArrays))),\n      switchMap(pks => this.pipeTypeAndTypedClassesOfTypedClasses(pks))\n    )\n  }\n\n  // @spyTag\n  @cache({ refCount: false }) pipeTypeAndTypedClassesOfTypedClasses(pkTypedClasses: number[]): Observable<{ typedClass: number, typeClass: number }[]> {\n\n    return this.s.dfh$.property$.by_is_has_type_subproperty$.key('true').pipe(\n      map((allHasTypeProps) => {\n        const byDomain = indexBy(k => k.has_domain.toString(), values(allHasTypeProps));\n        return pkTypedClasses.map(pk => ({\n          typedClass: pk,\n          typeClass: byDomain[pk] ? byDomain[pk].has_range : undefined\n        }))\n      }))\n  }\n\n  // @spyTag\n  @cache({ refCount: false }) pipeTypeClassOfTypedClass(pkTypedClass): Observable<number> {\n    return this.s.dfh$.property$.by_is_has_type_subproperty$.key('true').pipe(\n      map((allHasTypeProps) => {\n        const byDomain = indexBy(k => k.has_domain.toString(), values(allHasTypeProps));\n        return byDomain[pkTypedClass] ? byDomain[pkTypedClass].has_range : undefined\n      }))\n  }\n\n  // @spyTag\n  @cache({ refCount: false }) pipeTypedClassesOfTypeClasses(pkTypeClasses: number[]): Observable<number[]> {\n\n    return this.s.dfh$.property$.by_is_has_type_subproperty$.key('true').pipe(\n      map((allHasTypeProps) => {\n        const byDomain = indexBy(k => k.has_range.toString(), values(allHasTypeProps));\n        return pkTypeClasses.map(pk => byDomain[pk] ? byDomain[pk].has_domain : undefined)\n      }))\n  }\n\n\n  // @spyTag\n  @cache({ refCount: false }) pipeTypePropertyOfTypedClass(pkTypedClass): Observable<number> {\n    return this.s.dfh$.property$.by_is_has_type_subproperty$.key('true').pipe(\n      map((allHasTypeProps) => {\n        const typeProp = values(allHasTypeProps).find(p => p.has_domain === pkTypedClass)\n        return typeProp ? typeProp.pk_property : undefined;\n      }))\n  }\n\n  // @spyTag\n  @cache({ refCount: false }) pipeTargetClassesOfProperties(pkProperties: number[], isOutgoing: boolean): Observable<number[]> {\n    return this.s.dfh$.property$.by_pk_property$.all$.pipe(\n      map(x => {\n        if (!pkProperties || !pkProperties.length) return [];\n\n        const res = []\n        const targetClasses = {};\n        pkProperties.forEach(pkProp => {\n          const props = values(x[pkProp]);\n          props.forEach(prop => {\n            const targetClass = isOutgoing ? prop.has_range : prop.has_domain;\n            if (!targetClasses[targetClass]) {\n              targetClasses[targetClass] = true;\n              res.push(targetClass)\n            }\n          })\n        })\n        return res;\n      })\n    )\n  }\n}\n\n\nfunction getSubfieldType(config: SysConfigValue, klass: DfhClass, targetMaxQuantity: number): SubfieldType {\n\n  let classConfig: ClassConfig\n  if (config) classConfig = config.classes[klass.pk_class];\n  if (classConfig && classConfig.valueObjectType) {\n    return classConfig.valueObjectType\n  }\n\n  else if (klass.basic_type === 30 && targetMaxQuantity == 1) {\n    return { typeItem: 'true' }\n  }\n  else if (klass.basic_type === 8 || klass.basic_type === 30) {\n    return { entityPreview: 'true' }\n  }\n  else {\n    return { temporalEntity: 'true' }\n  }\n}\n\n\nfunction createHasDefinitionProperty(domainClass: number) {\n  const profiles: Profiles = [\n    {\n      removed_from_api: false,\n      fk_profile: DfhConfig.PK_PROFILE_GEOVISTORY_BASIC\n    }\n  ]\n\n  const hasDefinition: DfhProperty = {\n    has_domain: domainClass,\n    pk_property: DfhConfig.PROPERTY_PK_P18_HAS_DEFINITION,\n    has_range: 785,\n    domain_instances_max_quantifier: -1,\n    domain_instances_min_quantifier: 1,\n    range_instances_max_quantifier: 1,\n    range_instances_min_quantifier: 1,\n    identifier_in_namespace: 'P18',\n    identity_defining: false,\n    is_inherited: true,\n    is_has_type_subproperty: false,\n    profiles\n  }\n  return hasDefinition\n}\n\n\nfunction createAppellationProperty(rangeClass: number) {\n  const profiles: Profiles = [\n    {\n      removed_from_api: false,\n      fk_profile: DfhConfig.PK_PROFILE_GEOVISTORY_BASIC\n    }\n  ]\n  const hasAppeProp: DfhProperty = {\n    has_domain: DfhConfig.CLASS_PK_APPELLATION_FOR_LANGUAGE,\n    pk_property: DfhConfig.PROPERTY_PK_IS_APPELLATION_OF,\n    has_range: rangeClass,\n    domain_instances_max_quantifier: -1,\n    domain_instances_min_quantifier: 0,\n    range_instances_max_quantifier: 1,\n    range_instances_min_quantifier: 1,\n    identifier_in_namespace: 'histP9',\n    identity_defining: true,\n    is_inherited: true,\n    is_has_type_subproperty: false,\n    profiles\n  }\n  return hasAppeProp\n}\n\n\n\nfunction createHasTimeSpanProperty(domainClass: number) {\n  const profiles: Profiles = [\n    {\n      removed_from_api: false,\n      fk_profile: DfhConfig.PK_PROFILE_GEOVISTORY_BASIC\n    }\n  ]\n  const hasAppeProp: DfhProperty = {\n    has_domain: domainClass,\n    pk_property: DfhConfig.PROPERTY_PK_HAS_TIME_SPAN,\n    has_range: DfhConfig.ClASS_PK_TIME_SPAN,\n    domain_instances_max_quantifier: 1,\n    domain_instances_min_quantifier: 1,\n    range_instances_max_quantifier: 1,\n    range_instances_min_quantifier: 0,\n    identifier_in_namespace: 'P4',\n    identity_defining: false,\n    is_inherited: true,\n    is_has_type_subproperty: false,\n    profiles\n  }\n  return hasAppeProp\n}\n\n\nfunction isRemovedFromAllProfiles(enabledProfiles: number[], profiles: RelatedProfile[]): boolean {\n  return !profiles.some(p => p.removed_from_api === false && enabledProfiles.includes(p.fk_profile))\n\n}\n\nfunction getPlaceOfDisplay(specialFields: SysConfigSpecialFields, subfield: Subfield, projectFieldConfig?: ProClassFieldConfig): FieldPlaceOfDisplay {\n  let settings: SysConfigFieldDisplay;\n\n  settings = getSettingsFromSysConfig(subfield, specialFields, settings);\n\n  // if this is a special field, create corresponding display settings and return it\n  if (settings) {\n    if (settings.displayInBasicFields) {\n      return { basicFields: { position: settings.displayInBasicFields.position } }\n    } else if (settings.hidden) {\n      return { hidden: true }\n    }\n  }\n\n  // otherwise display the field in specific fields (default)\n  let position = Number.POSITIVE_INFINITY;\n  if (projectFieldConfig) position = projectFieldConfig.ord_num\n  return { specificFields: { position } }\n\n}\nfunction getSettingsFromSysConfig(\n  subfield: Subfield, specialFields: SysConfigSpecialFields, settings: SysConfigFieldDisplay) {\n  if (subfield.isOutgoing) {\n    // get settings by has-type-subproperty\n    if (subfield.isHasTypeField &&\n      specialFields.hasTypeSubproperties) {\n      settings = specialFields.hasTypeSubproperties;\n    }\n    // get settings by source class and property\n    else if (specialFields.bySourceClass &&\n      specialFields.bySourceClass[subfield.sourceClass] &&\n      specialFields.bySourceClass[subfield.sourceClass].outgoingProperties &&\n      specialFields.bySourceClass[subfield.sourceClass].outgoingProperties[subfield.property.pkProperty]) {\n      settings = specialFields.bySourceClass[subfield.sourceClass].outgoingProperties[subfield.property.pkProperty];\n    }\n    // get seetings by property\n    else if (specialFields.outgoingProperties &&\n      specialFields.outgoingProperties[subfield.property.pkProperty]) {\n      settings = specialFields.outgoingProperties[subfield.property.pkProperty];\n    }\n  }\n  else {\n    // get settings by source class and property\n    if (specialFields.bySourceClass &&\n      specialFields.bySourceClass[subfield.sourceClass] &&\n      specialFields.bySourceClass[subfield.sourceClass].incomingProperties &&\n      specialFields.bySourceClass[subfield.sourceClass].incomingProperties[subfield.property.pkProperty]) {\n      settings = specialFields.bySourceClass[subfield.sourceClass].incomingProperties[subfield.property.pkProperty];\n    }\n    // get seetings by property\n    else if (specialFields.incomingProperties &&\n      specialFields.incomingProperties[subfield.property.pkProperty]) {\n      settings = specialFields.incomingProperties[subfield.property.pkProperty];\n    }\n  }\n  return settings;\n}\n\n\n\n\n\n\n/**\n * Pipes the fields for temporal entity forms\n * - the specific fields\n * - the when field\n * - if available: the type field\n */\n// @spyTag @cache({ refCount: false }) pipeFieldDefinitionsForTeEnForm(pkClass: number): Observable<Field[]> {\n//   return of([])\n// const hasTypeListDef$ = this.pipeHasTypeSubfield(pkClass)\n// return combineLatest(\n//   this.pipeSpecificFieldDefinitions(pkClass)\n//     .pipe(\n//       map(fields => fields.filter(f => f.allSubfieldsRemovedFromAllProfiles === false))\n//     )\n//   ,\n//   hasTypeListDef$,\n// ).pipe(\n//   map(([fields, hasTypeListDefs]) => {\n//     const when = this.getClassFieldDefinition(SysConfig.PK_CLASS_FIELD_WHEN)\n//     return [\n//       ...fields,\n//       when,\n//       ...hasTypeListDefs.map((hasTypeListDef) => {\n//         const typeField: Field = { ...hasTypeListDef, listDefinitions: [hasTypeListDef] }\n//         return typeField;\n//       })\n//     ]\n//   })\n// )\n// }\n\n\n/**\n * Pipe the specific fields of given class\n */\n// @spyTag @cache({ refCount: false }) pipeSpecificFieldDefinitions(pkClass: number): Observable<Field[]> {\n// return combineLatest(\n//   this.pipePropertiesOfClass(pkClass, true).pipe(\n//     // filter out the 'has type' property, since it is part of the default fields\n//     map(outgoing => outgoing.filter(o => !o.is_has_type_subproperty))\n//   ),\n//   this.pipePropertiesOfClass(pkClass, false).pipe(\n//     // filter out the 'has appellation' property, since it is part of the default fields\n//     map(ingoing => ingoing.filter(i =>\n//       i.pk_property !== DfhConfig.PROPERTY_PK_IS_APPELLATION_OF\n//       && i.pk_property !== DfhConfig.PROPERTY_PK_GEOVP1_IS_REPRODUCTION_OF\n//     ))\n//   ),\n//   this.pipeFieldConfigs(pkClass)\n// ).pipe(\n//   switchMap(([outgoing, ingoing, fieldConfigs]) => {\n\n//     const key = (fc: Partial<ProClassFieldConfig>) => `${fc.fk_property}_${fc.fk_domain_class}_${fc.fk_range_class}`;\n//     const indexed = indexBy((fc) => `${fc.fk_property}_${fc.fk_domain_class}_${fc.fk_range_class}`, fieldConfigs)\n//     const getFieldConfig = (listDef: Subfield): ProClassFieldConfig => {\n//       return indexed[key({\n//         fk_property: listDef.property.pkProperty,\n//         fk_domain_class: listDef.isOutgoing ? listDef.sourceClass : null,\n//         fk_range_class: listDef.isOutgoing ? null : listDef.sourceClass,\n//       })]\n//     }\n\n//     // Create list definitions\n//     return combineLatest(\n//       this.pipePropertiesToSubfields(ingoing, false),\n//       this.pipePropertiesToSubfields(outgoing, true)\n//     ).pipe(\n//       map(([ingoingListDefs, outgoingListDefs]) => {\n//         const listDefinitions = [...ingoingListDefs, ...outgoingListDefs];\n\n//         // Create field definitions\n//         const fieldDefs: { [key: string]: Field } = {}\n//         listDefinitions.forEach(listDef => {\n\n//           const k = listDef.property.pkProperty + '_' + listDef.isOutgoing;\n\n//           if (!fieldDefs[k]) {\n//             fieldDefs[k] = {\n//               ...listDef,\n//               placeOfDisplay: {},\n//               allSubfieldsRemovedFromAllProfiles: false,\n//               fieldConfig: getFieldConfig(listDef),\n//               listDefinitions: [listDef],\n//               targetClasses: [listDef.targetClass]\n//             }\n//           } else {\n//             fieldDefs[k].listDefinitions.push(listDef)\n//             fieldDefs[k].targetClasses.push(listDef.targetClass)\n//           }\n\n//           // }\n\n//         })\n//         // Order the fields according to ord_num (from project's config, kleiolab's config) or put it at end of list.\n//         return sort(\n//           (a, b) => {\n//             const getOrdNum = (item: Field) => {\n//               if (item && item.fieldConfig) return item.fieldConfig.ord_num;\n//               return Number.POSITIVE_INFINITY;\n//             }\n//             const ordNumA = getOrdNum(a);\n//             const ordNumB = getOrdNum(b);\n//             return ordNumA - ordNumB;\n//           },\n//           values(fieldDefs))\n//       })\n//     )\n//   })\n// )\n// }\n\n\n/**\n * Pipe the fields for identification of given class\n */\n// @spyTag @cache({ refCount: false }) pipeDefaultFieldDefinitions(pkClass: number): Observable<Field[]> {\n\n\n// /**\n//  * Pipe the generic field has appellation\n//  * with the given class as range\n//  */\n// const hasAppeProp: DfhPropertyStatus = {\n//   has_domain: DfhConfig.CLASS_PK_APPELLATION_FOR_LANGUAGE,\n//   pk_property: DfhConfig.PROPERTY_PK_IS_APPELLATION_OF,\n//   has_range: pkClass,\n//   domain_instances_max_quantifier: -1,\n//   domain_instances_min_quantifier: 0,\n//   range_instances_max_quantifier: 1,\n//   range_instances_min_quantifier: 1,\n//   identifier_in_namespace: 'histP9',\n//   identity_defining: true,\n//   is_inherited: true,\n//   is_has_type_subproperty: false,\n//   removedFromAllProfiles: false,\n//   profiles: []\n// }\n// const hasAppeListDef$ = this.pipePropertiesToSubfields([hasAppeProp], false).pipe(\n//   filter(listDefs => !!listDefs && !!listDefs[0]),\n//   map(listDefs => listDefs[0])\n// );\n\n// /**\n//  * Pipe the generic field has type\n//  * with the given class as range\n//  */\n// const hasTypeListDef$ = this.pipeHasTypeSubfield(pkClass)\n// return combineLatest(\n//   hasAppeListDef$,\n//   hasTypeListDef$,\n//   this.s.dfh$.class$.by_pk_class$.key(pkClass).pipe(filter(c => !!c))\n// ).pipe(\n//   map(([hasAppeListDef, hasTypeListDefs, klass]) => {\n//     const fields: Field[] = []\n\n\n//     // /*\n//     //  * Add 'short title' text-property to\n//     //  *\n//     //  * Manifestation Product Type  F3, 219\n//     //  * Manifestation Singleton  F4, 220\n//     //  * Item  F5, 221\n//     //  * Web Request  geovC4, 502\n//     //  */\n//     // if ([\n//     //   DfhConfig.CLASS_PK_MANIFESTATION_PRODUCT_TYPE,\n//     //   DfhConfig.CLASS_PK_MANIFESTATION_SINGLETON,\n//     //   DfhConfig.CLASS_PK_ITEM,\n//     //   DfhConfig.CLASS_PK_WEB_REQUEST].includes(pkClass)) {\n//     //   fields.push(this.getClassFieldDefinition(SysConfig.PK_CLASS_FIELD_SHORT_TITLE));\n//     // }\n\n//     // /*\n//     // * Add 'has appellation for language  histP9' to\n//     // *\n//     // * all classes except 'Appellation for language  histC10', 365\n//     // */\n//     // if (pkClass !== DfhConfig.CLASS_PK_APPELLATION_FOR_LANGUAGE) {\n//     //   const appeField: Field = { ...hasAppeListDef, listDefinitions: [hasAppeListDef] }\n//     //   fields.push(appeField);\n//     // }\n\n\n//     // /*\n//     // * Add 'hasType' fields\n//     // */\n//     // if (hasTypeListDefs && hasTypeListDefs.length > 0) {\n//     //   hasTypeListDefs.forEach((hasTypeListDef) => {\n//     //     const typeField: Field = { ...hasTypeListDef, listDefinitions: [hasTypeListDef] }\n//     //     fields.push(typeField);\n//     //   })\n//     // }\n\n//     // /*\n//     // * Add 'entity definition' text-property to\n//     // *\n//     // * all classes except 'Appellation for language  histC10', 365\n//     // */\n//     // if (pkClass !== DfhConfig.CLASS_PK_APPELLATION_FOR_LANGUAGE) {\n//     //   fields.push(this.getClassFieldDefinition(SysConfig.PK_CLASS_FIELD_ENTITY_DEFINITION));\n//     // }\n//     // /*\n//     // * Add 'identifier / exact reference / url / ...' text-property to\n//     // *\n//     // * Web Request  geovC4, 502\n//     // */\n//     // if (DfhConfig.CLASS_PK_WEB_REQUEST === pkClass) {\n//     //   fields.push(this.getClassFieldDefinition(SysConfig.PK_CLASS_FIELD_EXACT_REFERENCE));\n//     // }\n\n//     // /*\n//     // * Add 'comment' text-property to\n//     // *\n//     // * Manifestation Product Type  F3, 219\n//     // * Manifestation Singleton  F4, 220\n//     // * Item  F5, 221\n//     // * Web Request  geovC4, 502\n//     // * Expression portion  geovC5, 503\n//     // */\n//     // if ([\n//     //   DfhConfig.CLASS_PK_MANIFESTATION_PRODUCT_TYPE,\n//     //   DfhConfig.CLASS_PK_MANIFESTATION_SINGLETON,\n//     //   DfhConfig.CLASS_PK_ITEM,\n//     //   DfhConfig.CLASS_PK_WEB_REQUEST,\n//     //   DfhConfig.CLASS_PK_EXPRESSION_PORTION].includes(pkClass)) {\n//     //   fields.push(this.getClassFieldDefinition(SysConfig.PK_CLASS_FIELD_COMMENT));\n//     // }\n\n//     // /*\n//     // * Add 'time-span' field to\n//     // *\n//     // * all temporal entity classes\n//     // */\n//     // if (klass.basic_type === 9) {\n//     //   fields.push(this.getClassFieldDefinition(SysConfig.PK_CLASS_FIELD_WHEN));\n//     // }\n\n//     return fields\n\n//   })\n// )\n// }\n\n\n// private pipeHasTypeSubfield(pkClass: number) {\n//   return this.pipePropertiesOfClass(pkClass, true).pipe(\n//     // check if this class has 'has type' subproperty\n//     map(outgoing => {\n//       return outgoing.filter((prop) => prop.is_has_type_subproperty);\n//     }), switchMap(hasTypeProps => combineLatestOrEmpty(hasTypeProps.map(dfhProp => {\n//       return this.pipePropertiesToSubfields([dfhProp], true).pipe(filter(listDefs => !!listDefs && !!listDefs[0]), map(listDefs => {\n//         const listDef = listDefs[0];\n//         listDef.listType = { typeItem: 'true' };\n//         return listDef;\n//       }));\n//     }))));\n// }\n\n// getClassFieldSubfield(pkClassField: number): Subfield {\n//   const template = {\n//     property: {},\n//     sourceClass: undefined,\n//     sourceClassLabel: undefined,\n//     targetClass: undefined,\n//     isOutgoing: undefined,\n//     identityDefiningForSource: undefined,\n//     identityDefiningForTarget: undefined,\n//     targetMaxQuantity: undefined,\n//     targetMinQuantity: undefined,\n//     sourceMaxQuantity: undefined,\n//     sourceMinQuantity: undefined,\n//     removedFromAllProfiles: false\n//   }\n//   switch (pkClassField) {\n//     case SysConfig.PK_CLASS_FIELD_WHEN:\n//       return {\n//         ...template,\n//         listType: { timeSpan: 'true' },\n//         label: 'When',\n//         isOutgoing: true,\n//         // fkClassField: pkClassField,\n//         ontoInfoLabel: 'P4',\n//         ontoInfoUrl: 'https://ontome.dataforhistory.org/property/4',\n//         targetMaxQuantity: 1\n//       }\n//     case SysConfig.PK_CLASS_FIELD_ENTITY_DEFINITION:\n//       return {\n//         ...template,\n//         listType:  { textProperty: 'true' },\n//         label: 'Description',\n//         // fkClassField: pkClassField,\n//         ontoInfoLabel: 'P3',\n//         ontoInfoUrl: 'https://ontome.dataforhistory.org/property/3',\n//         targetMaxQuantity: -1\n//       }\n//     case SysConfig.PK_CLASS_FIELD_COMMENT:\n//       return {\n//         ...template,\n//         // fkClassField: SysConfig.PK_CLASS_FIELD_COMMENT,\n//         listType:  { textProperty: 'true' },\n//         label: 'Comments',\n//         ontoInfoLabel: 'P3',\n//         ontoInfoUrl: 'https://ontome.dataforhistory.org/property/3',\n//         targetMaxQuantity: -1\n//       }\n//     case SysConfig.PK_CLASS_FIELD_EXACT_REFERENCE:\n//       return {\n//         ...template,\n//         listType:  { textProperty: 'true' },\n//         label: 'Exact Reference',\n//         // fkClassField: pkClassField,\n//         ontoInfoLabel: 'P3',\n//         ontoInfoUrl: 'https://ontome.dataforhistory.org/property/3',\n//         targetMaxQuantity: -1\n//       }\n//     case SysConfig.PK_CLASS_FIELD_SHORT_TITLE:\n//       return {\n//         ...template,\n//         listType:  { textProperty: 'true' },\n//         label: 'Short Title',\n//         // fkClassField: pkClassField,\n//         ontoInfoLabel: 'P3',\n//         ontoInfoUrl: 'https://ontome.dataforhistory.org/property/3',\n//         targetMaxQuantity: -1\n//       }\n//     default:\n//       break;\n//   }\n// }\n\n// getClassFieldDefinition(pkClassField: number): Field {\n//   const listDef = this.getClassFieldSubfield(pkClassField)\n//   return { ...listDef, listDefinitions: [listDef] }\n// }\n\n\n// @spyTag @cache({ refCount: false }) pipeClassesRequired() {\n//   return this.s.sys$.system_relevant_class$.by_required$.key('true')\n//     .pipe(map(c => values(c).map(k => k.fk_class)))\n// }\n\n\n\n// /**\n//  * Pipes all the enabled properties of a class\n//  */\n// @spyTag @cache({ refCount: false }) pipePropertiesOfClass(pkClass: number, isOutgoing: boolean): Observable<DfhPropertyStatus[]> {\n\n\n//   let $: Observable<ByPk<DfhProperty>>\n//   if (isOutgoing) {\n//     $ = this.s.dfh$.property$.by_has_domain$.key(pkClass)\n//   }\n//   else {\n//     $ = this.s.dfh$.property$.by_has_range$.key(pkClass)\n//   }\n\n//   // filter properties that are in at least one profile enabled by project\n//   const profiles$ = this.pipeProfilesEnabledByProject()\n\n\n//   // Filter out only the properties for which target class is allowed\n//   return combineLatest($, profiles$)\n//     .pipe(\n//       map(([props, profiles]) => {\n//         const p: DfhPropertyStatus[] = []\n\n//         values(props).forEach(prop => {\n\n\n//           const propProfileRel = prop.profiles as Profiles\n\n//           let enabledInAProfile = false;\n\n//           let removedFromAllProfiles = true;\n\n//           propProfileRel.forEach(item => {\n//             if (profiles.includes(item.fk_profile)) {\n//               enabledInAProfile = true;\n//               if (item.removed_from_api === false) {\n//                 removedFromAllProfiles = false\n//               }\n//             }\n//           })\n\n//           if (enabledInAProfile) {\n//             p.push({\n//               ...prop,\n//               removedFromAllProfiles\n//             })\n//           }\n//         })\n\n//         return p\n//       })\n//     )\n\n// }\n\n\n// /**\n//  * returns an object where the keys are the pks of the Classes\n//  * used by the given project\n//  * - or because the class is enabled by class_proj_rel\n//  * - or because the class is required by sources or by basics\n//  *\n//  * this is usefull to check if a class is available at all\n//  */\n// @spyTag @cache({ refCount: false }) pipeClassesInEntitesOrRequired(): Observable<{ [key: string]: number }> {\n//   return combineLatest(\n//     this.pipeClassesEnabledInEntities(),\n//     this.pipeClassesRequired()\n//   ).pipe(\n//     map(([a, b]) => indexBy((x) => x.toString(), uniq([...a, ...b]))),\n//     startWith({})\n//   )\n// }\n","import { Injectable } from '@angular/core';\nimport { DfhConfig } from '@kleiolab/lib-config';\nimport { IconType } from '@kleiolab/lib-redux';\nimport { InfStatement, InfTimePrimitive } from '@kleiolab/lib-sdk-lb3';\nimport { CalendarType, combineLatestOrEmpty, Granularity, TimePrimitive, TimeSpanUtil } from '@kleiolab/lib-utils';\nimport { omit, values } from 'ramda';\nimport { combineLatest, merge, Observable, of, pipe, BehaviorSubject } from 'rxjs';\nimport { filter, map, switchMap } from 'rxjs/operators';\nimport { spyTag } from '../decorators/method-decorators';\nimport { BasicStatementItem, } from '../models/BasicStatementItem';\nimport { Subfield } from '../models/Subfield';\nimport { ActiveProjectPipesService } from './active-project-pipes.service';\nimport { SchemaSelectorsService } from './schema-selectors.service';\nimport { TimePrimitiveWithCal } from '@kleiolab/lib-sdk-lb4';\n\n\n\n\n@Injectable({\n  providedIn: 'root'\n})\n/**\n * This service contains a basic pipes for creating more complex\n * rxjs pipes. Each pipe takes non-observable parameters and\n * returns an observable. The method names are mainly\n * based on the type of the observable data\n */\nexport class InformationBasicPipesService {\n  // infRepo: InfSelector;\n\n  constructor(\n    private p: ActiveProjectPipesService,\n    private s: SchemaSelectorsService,\n  ) { }\n\n  /*********************************************************************\n   * Project\n  *********************************************************************/\n\n  // @spyTag pipeRelatedTemporalEntities(pkEntity: number): Observable<InfTemporalEntity[]> {\n  //   return this.s.inf$.statement$\n  //     .by_object$({ fk_object_info: pkEntity })\n  //     .pipe(\n  //       auditTime(1),\n  //       switchMapOr([], (statements) => combineLatest(\n  //         statements.map(statement => this.s.inf$.temporal_entity$.by_pk_entity_key$(statement.fk_subject_info).pipe(\n  //         ))\n  //       ).pipe(\n  //         map(x => x.filter((y) => !!y)),\n  //       )),\n  //     )\n  // }\n\n\n\n\n  /**\n * Pipe statements of an entity\n */\n  @spyTag pipeStatements(pkEntity: number, isOutgoing): Observable<InfStatement[]> {\n    return isOutgoing ? this.pipeOutgoingStatements(pkEntity) : this.pipeIngoingStatements(pkEntity)\n  }\n\n\n  /**\n  * Pipe outgoing statements of an entity\n  */\n  @spyTag pipeOutgoingStatements(pkEntity): Observable<InfStatement[]> {\n    return this.s.inf$.statement$.by_subject$({ fk_subject_info: pkEntity })\n  }\n\n\n  /**\n   * Pipe ingoing statements of an entity\n   */\n  @spyTag pipeIngoingStatements(pkEntity): Observable<InfStatement[]> {\n    return this.s.inf$.statement$.by_object$({ fk_object_info: pkEntity })\n  }\n\n\n  pipeStatementsOfList(listDefinition: Subfield, pkEntity): Observable<InfStatement[]> {\n    if (listDefinition.isOutgoing) {\n      return this.s.inf$.statement$.by_subject_and_property$({\n        fk_property: listDefinition.property.pkProperty,\n        fk_property_of_property: listDefinition.property.pkPropertyOfProperty,\n        fk_subject_info: pkEntity\n      })\n    } else {\n      return this.s.inf$.statement$.by_object_and_property$({\n        fk_property: listDefinition.property.pkProperty,\n        fk_property_of_property: listDefinition.property.pkPropertyOfProperty,\n        fk_object_info: pkEntity\n      })\n    }\n  }\n\n  /**\n   * Pipe outgoing statements of temporal entity\n   */\n  @spyTag pipeOutgoingStatementsByProperty(pkProperty, pkEntity): Observable<InfStatement[]> {\n    return this.s.inf$.statement$.by_subject_and_property$({\n      fk_property: pkProperty,\n      fk_subject_info: pkEntity\n    })\n\n  }\n\n\n  /**\n   * Pipe ingoing statements of an entity\n   */\n  @spyTag pipeIngoingStatementsByProperty(pkProperty, pkEntity): Observable<InfStatement[]> {\n    return this.s.inf$.statement$.by_object_and_property$({\n      fk_property: pkProperty,\n      fk_object_info: pkEntity\n    })\n  }\n\n  /**\n * Pipe outgoing statements of temporal entity\n */\n  @spyTag pipeOutgoingBasicStatementItemsByProperty(pkProperty, pkEntity, pkProject: number): Observable<BasicStatementItem[]> {\n    return this.s.inf$.statement$.by_subject_and_property$({\n      fk_property: pkProperty,\n      fk_subject_info: pkEntity\n    }).pipe(\n      switchMap(statements => combineLatestOrEmpty(\n        statements.map(statement => this.pipeBasicStatementItem(pkProject, statement, true))\n      ))\n    )\n  }\n\n\n\n  /**\n   * Pipe ingoing statements of an entity\n   */\n  @spyTag pipeIngoingBasicStatementItemsByProperty(pkProperty, pkEntity, pkProject: number): Observable<BasicStatementItem[]> {\n    return this.s.inf$.statement$.by_object_and_property$({\n      fk_property: pkProperty,\n      fk_object_info: pkEntity\n    }).pipe(\n      switchMap(statements => combineLatestOrEmpty(\n        statements.map(statement => this.pipeBasicStatementItem(pkProject, statement, false))\n      ))\n    )\n  }\n\n  @spyTag private pipeBasicStatementItem(pkProject: number, statement: InfStatement, isOutgoing: boolean): Observable<BasicStatementItem> {\n    return this.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(pkProject + '_' + statement.pk_entity).pipe(\n      filter(x => !!x),\n      map(projRel => ({\n        projRel, statement, label: '', ordNum: (isOutgoing ? projRel.ord_num_of_range : projRel.ord_num_of_domain), isOutgoing\n      }))\n    );\n  }\n\n  @spyTag pipeBasicStatementItemByPkStatement(pkProject: number, pkStatement: number, isOutgoing: boolean): Observable<BasicStatementItem> {\n    return this.s.inf$.statement$.by_pk_entity_key$(pkStatement).pipe(\n      switchMap(statement => (!statement) ? of(undefined) : this.pipeBasicStatementItem(pkProject, statement, isOutgoing))\n    )\n  }\n\n\n  @spyTag pipeInfTimePrimitive(pkEntity: number): Observable<InfTimePrimitive> {\n    return this.s.inf$.time_primitive$.by_pk_entity$.key(pkEntity)\n  }\n\n  /**\n   * pipes the TimeSpan of a temporal entity\n   * @param pkEntity the pk_entity of the termporal entity\n   */\n  @spyTag pipeTimeSpan(pkEntity: number): Observable<TimeSpanUtil> {\n    // Get the properties leading to presences\n    return combineLatest(\n      this.pipeOutgoingStatementsByProperty(72, pkEntity).pipe(this.timePrimitiveOfStatements()),\n      this.pipeOutgoingStatementsByProperty(71, pkEntity).pipe(this.timePrimitiveOfStatements()),\n      this.pipeOutgoingStatementsByProperty(150, pkEntity).pipe(this.timePrimitiveOfStatements()),\n      this.pipeOutgoingStatementsByProperty(151, pkEntity).pipe(this.timePrimitiveOfStatements()),\n      this.pipeOutgoingStatementsByProperty(152, pkEntity).pipe(this.timePrimitiveOfStatements()),\n      this.pipeOutgoingStatementsByProperty(153, pkEntity).pipe(this.timePrimitiveOfStatements()),\n\n    ).pipe(\n      map(([_72, _71, _150, _151, _152, _153]) => new TimeSpanUtil({\n        p82: _72,\n        p81: _71,\n        p82a: _152,\n        p81a: _150,\n        p81b: _151,\n        p82b: _153,\n      })),\n    )\n  }\n\n\n\n  /**\n   * Pipes max. one time primitive for an array of statements, assuming that the statements\n   * are of the same properties.\n   */\n  timePrimitiveOfStatements = () => pipe(\n    map((r: InfStatement[]) => r[0]),\n    switchMap((r) => {\n      if (!r) return new BehaviorSubject(undefined)\n      return this.pipeInfTimePrimitive(r.fk_object_info).pipe(\n        switchMap((infTimePrimitive) => this.p.pkProject$.pipe(\n          switchMap((pkProject) => this.s.pro$.info_proj_rel$.by_fk_project__fk_entity$\n            .key(pkProject + '_' + r[0].pk_entity).pipe(\n              filter(statement => !!statement),\n              map(ipr => {\n                const y: TimePrimitiveWithCal = {\n                  calendar: (ipr.calendar ? ipr.calendar : 'gregorian') as CalendarType,\n                  julianDay: infTimePrimitive.julian_day,\n                  duration: infTimePrimitive.duration as Granularity\n                }\n                return y;\n              })\n            ))\n        ))\n      )\n    })\n  )\n\n  /**\n   * Pipes the fk_class of the given entity\n   */\n  @spyTag pipeClassOfEntity(pkEntity: number): Observable<number> {\n    return merge(\n      this.s.inf$.persistent_item$.by_pk_entity_key$(pkEntity).pipe(\n        filter(e => !!e),\n        map(e => e.fk_class)\n      ),\n      this.s.inf$.temporal_entity$.by_pk_entity_key$(pkEntity).pipe(\n        filter(e => !!e),\n        map(e => e.fk_class)\n      )\n    )\n  }\n\n  /**\n   * Pipes distinct fk_classes of the given persistent items\n   */\n  @spyTag pipeClassesOfPersistentItems(pkEntities: number[]): Observable<number[]> {\n    return this.s.inf$.persistent_item$.by_pk_entity_all$().pipe(\n      map((peIts) => {\n        if (!pkEntities || pkEntities.length === 0) {\n          return []\n        }\n        const classes = {};\n        const a = [];\n        pkEntities.forEach(typePk => {\n          if (!classes[peIts[typePk].fk_class]) {\n            classes[peIts[typePk].fk_class] = true;\n            a.push(peIts[typePk].fk_class)\n          }\n        })\n        return a;\n      })\n    )\n\n  }\n\n\n  /*********************************************************************\n   * Repo\n  *********************************************************************/\n\n  /**\n    * Pipe repo outgoing statements.\n    */\n  @spyTag pipeRepoOutgoingStatements(pkEntity): Observable<InfStatement[]> {\n    return this.s.inf$.statement$.by_subject$({ fk_subject_info: pkEntity }, false)\n  }\n\n  /**\n  * Pipe repo ingoing statements.\n  */\n  @spyTag pipeRepoIngoingStatements(pkEntity): Observable<InfStatement[]> {\n    return this.s.inf$.statement$.by_object$({ fk_object_info: pkEntity }, false)\n  }\n\n  /**\n    * Pipe repo outgoing statements.\n    * If max quantity is limited, takes only max allowed number of statements, starting with highest is_in_project_count\n    */\n  @spyTag pipeRepoOutgoingStatementsByProperty(pkProperty, pkEntity): Observable<InfStatement[]> {\n    return combineLatest(\n      this.s.dfh$.property$.by_pk_property$.key(pkProperty)\n        .pipe(filter(x => !!x && Object.keys(x).length > 0), map(p => values(p)[0].range_instances_max_quantifier)),\n      this.s.inf$.statement$\n        .by_subject_and_property$({\n          fk_property: pkProperty,\n          fk_subject_info: pkEntity\n        }, false)\n      // .pipe(filter(x => !!x))\n    ).pipe(\n      map(([m, rs]) => {\n        if (rs.length === 0) return rs;\n        const r = this.sortStatementsByRepoPopularity(rs);\n        return (m === -1 || m === null) ? r : r.slice(0, m);\n      })\n    )\n  }\n\n  /**\n  * Pipe repo ingoing statements.\n  * If max quantity is limited, takes only max allowed number of statements, starting with highest is_in_project_count\n  */\n  @spyTag pipeRepoIngoingStatementsByProperty(pkProperty, pkEntity): Observable<InfStatement[]> {\n    return combineLatest(\n      this.s.dfh$.property$.by_pk_property$.key(pkProperty)\n        .pipe(filter(x => !!x && Object.keys(x).length > 0), map(p => values(p)[0].domain_instances_max_quantifier)),\n      this.s.inf$.statement$\n        .by_object_and_property$({\n          fk_property: pkProperty,\n          fk_object_info: pkEntity\n        }, false)\n      // .pipe(filter(x => !!x))\n    ).pipe(\n      map(([m, rs]) => {\n        if (rs.length === 0) return rs;\n        const r = this.sortStatementsByRepoPopularity(rs);\n        return (m === -1 || m === null) ? r : r.slice(0, m);\n      })\n    )\n  }\n\n\n  /*********************************************************************\n   * Alternatives (Repo minus Project)\n  *********************************************************************/\n\n  @spyTag pipeAlternativeBasicStatementItemByPkStatement(pkStatement: number, isOutgoing: boolean): Observable<BasicStatementItem> {\n    return combineLatest(\n      this.s.inf$.statement$.by_pk_entity_key$(pkStatement, false),\n      this.s.inf$.statement$.by_pk_entity_key$(pkStatement),\n    )\n      .pipe(\n        filter(([inrepo]) => !!inrepo),\n        map(([inrepo, inproject]) => {\n          if (inproject) {\n            return undefined\n          } else {\n            const i: BasicStatementItem = {\n              projRel: undefined,\n              statement: inrepo,\n              ordNum: undefined,\n              isOutgoing,\n              label: ''\n            }\n            return i\n          }\n        })\n      )\n  }\n\n\n  /**\n     * Pipe alternative ingoing statements (= statements not in active project)\n     */\n  @spyTag pipeAlternativeIngoingStatements(pkProperty, pkEntity): Observable<InfStatement[]> {\n    return combineLatest(\n      this.s.inf$.statement$.by_object_and_property_indexed$({\n        fk_property: pkProperty,\n        fk_object_info: pkEntity\n      }, false),\n      this.s.inf$.statement$.by_object_and_property_indexed$({\n        fk_property: pkProperty,\n        fk_object_info: pkEntity\n      }).pipe(\n        map(inproject => inproject ? Object.keys(inproject) : [])\n      )\n    ).pipe(\n      map(([inrepo, inproject]) => omit(inproject, inrepo)),\n      map(statements => values(statements))\n    )\n  }\n\n\n  /**\n   * Pipe alternative outgoing statements (= statements not in active project)\n   */\n  @spyTag pipeAlternativeOutgoingStatements(pkProperty, pkEntity): Observable<InfStatement[]> {\n    return combineLatest(\n      this.s.inf$.statement$.by_subject_and_property_indexed$({\n        fk_property: pkProperty,\n        fk_subject_info: pkEntity\n      }, false),\n      this.s.inf$.statement$.by_subject_and_property_indexed$({\n        fk_property: pkProperty,\n        fk_subject_info: pkEntity\n      }).pipe(\n        map(inproject => inproject ? Object.keys(inproject) : [])\n      ),\n    ).pipe(\n      map(([inrepo, inproject]) => omit(inproject, inrepo)),\n      map(statements => values(statements))\n    )\n  }\n\n\n\n  /**\n   * get array of pks of persistent items of a specific class\n   */\n  @spyTag pipePersistentItemPksByClass(pkClass): Observable<number[]> {\n    return this.s.inf$.persistent_item$.by_fk_class_key$(pkClass).pipe(\n      map(ob => {\n        if (ob) return Object.keys(ob).map(k => parseInt(k, 10));\n        return []\n      }))\n  }\n\n  /**\n   * gets the css classes for that entity\n   * @param pkEntity\n   */\n  pipeIconType(pkEntity: number): Observable<IconType> {\n\n    return this.p.streamEntityPreview(pkEntity).pipe(\n      map(preview => {\n        if (preview.entity_type == 'teEn') {\n          return 'temporal-entity'\n        }\n        if (preview.fk_class === DfhConfig.CLASS_PK_EXPRESSION_PORTION) {\n          return 'expression-portion'\n        } else if (DfhConfig.CLASS_PKS_SOURCE_PE_IT.includes(preview.fk_class)) {\n          return 'source'\n        }\n        return 'persistent-entity'\n      })\n    )\n\n  }\n\n\n  /*********************************************************************\n   * Helpers\n   *********************************************************************/\n  sortStatementsByRepoPopularity(statements: InfStatement[]): InfStatement[] {\n    return statements.sort((a, b) => a.is_in_project_count > b.is_in_project_count ? 1 : -1)\n  }\n\n\n\n}\n","\nimport { NgRedux } from '@angular-redux/store';\nimport { Injectable } from '@angular/core';\nimport { DfhConfig } from '@kleiolab/lib-config';\nimport { IAppState } from '@kleiolab/lib-redux';\nimport { InfStatement } from '@kleiolab/lib-sdk-lb3';\nimport { GvSubfieldPage } from '@kleiolab/lib-sdk-lb4';\nimport { CalendarType, combineLatestOrEmpty, Granularity, limitTo, sortAbc, switchMapOr, TimePrimitive, TimePrimitivePipe, TimeSpanPipe, TimeSpanUtil } from '@kleiolab/lib-utils';\nimport { equals, flatten, groupBy, pick, uniq, values } from 'ramda';\nimport { BehaviorSubject, combineLatest, empty, iif, Observable, of } from 'rxjs';\nimport { tag } from 'rxjs-spy/operators';\nimport { distinctUntilChanged, filter, map, startWith, switchMap, tap } from 'rxjs/operators';\nimport { cache, spyTag } from '../decorators/method-decorators';\nimport { timeSpanItemToTimeSpan } from '../functions/functions';\nimport { AppellationItem } from '../models/AppellationItem';\nimport { BasicStatementItem } from '../models/BasicStatementItem';\nimport { ClassAndTypeNode } from '../models/ClassAndTypeNode';\nimport { ClassAndTypeSelectModel } from '../models/ClassAndTypeSelectModel';\nimport { CtrlTimeSpanDialogResult } from '../models/CtrlTimeSpanDialogResult';\nimport { DimensionItem } from '../models/DimensionItem';\nimport { EntityPreviewItem } from '../models/EntityPreviewItem';\nimport { EntityProperties } from '../models/EntityProperties';\nimport { Field } from '../models/Field';\nimport { ItemList } from '../models/ItemList';\nimport { LangStringItem } from '../models/LangStringItem';\nimport { LanguageItem } from '../models/LanguageItem';\nimport { PlaceItem } from '../models/PlaceItem';\nimport { PropertyOption } from '../models/PropertyOption';\nimport { PropertySelectModel } from '../models/PropertySelectModel';\nimport { StatementItem } from '../models/StatementItem';\nimport { StatementProjRel, StatementTarget, StatementWithTarget } from '../models/StatementWithTarget';\nimport { Subfield } from '../models/Subfield';\nimport { SubfieldType } from '../models/SubfieldType';\nimport { TemporalEntityCell } from '../models/TemporalEntityCell';\nimport { TemporalEntityRemoveProperties } from '../models/TemporalEntityRemoveProperties';\nimport { TemporalEntityRow } from '../models/TemporalEntityRow';\nimport { TimePrimitiveItem } from '../models/TimePrimitiveItem';\nimport { TimeSpanItem } from '../models/TimeSpanItem';\nimport { TimeSpanProperty } from '../models/TimeSpanProperty';\nimport { InfModelName, InfSelector } from '../selectors/inf.service';\nimport { ActiveProjectPipesService } from './active-project-pipes.service';\nimport { ConfigurationPipesService } from './configuration-pipes.service';\nimport { InformationBasicPipesService } from './information-basic-pipes.service';\nimport { SchemaSelectorsService } from './schema-selectors.service';\n\n\n\n\n\n\n\n@Injectable({\n  providedIn: 'root'\n})\n/**\n * This Service provides a collecion of pipes that aggregate or transform information.\n * For Example\n * - the lists of text properties, appellaitons, places, time-primitives / time-spans etc.\n * - the label of temporal entity or persistent item\n *\n * This mainly selects data from the information schema and the relation to projects.\n * It combines pipes selecting data from the\n * - activated project\n * - alternatives (not in project but in others)\n * - repo\n *\n */\nexport class InformationPipesService {\n\n  infRepo: InfSelector;\n\n  constructor(\n    private b: InformationBasicPipesService,\n    private p: ActiveProjectPipesService,\n    private s: SchemaSelectorsService,\n    private c: ConfigurationPipesService,\n    public timePrimitivePipe: TimePrimitivePipe,\n    private timeSpanPipe: TimeSpanPipe,\n    ngRedux: NgRedux<IAppState>\n  ) {\n    this.infRepo = new InfSelector(ngRedux, of('repo'))\n  }\n\n\n  /*********************************************************************\n   * Pipe the project entities\n   *********************************************************************/\n\n  // @spyTag\n  pipeListLength(l: Subfield, pkEntity: number): Observable<number> {\n    switch (l.listType) {\n      case 'appellation':\n      case 'entity-preview':\n      case 'language':\n      case 'place':\n      case 'dimension':\n      case 'langString':\n      case 'temporal-entity':\n        return this.pipeList(l, pkEntity).pipe(map(items => items.length))\n\n      case 'time-span':\n        return combineLatest(\n          this.b.pipeOutgoingStatementsByProperty(72, pkEntity),\n          this.b.pipeOutgoingStatementsByProperty(71, pkEntity),\n          this.b.pipeOutgoingStatementsByProperty(150, pkEntity),\n          this.b.pipeOutgoingStatementsByProperty(151, pkEntity),\n          this.b.pipeOutgoingStatementsByProperty(152, pkEntity),\n          this.b.pipeOutgoingStatementsByProperty(153, pkEntity)\n        ).pipe(\n          tap((x) => {\n\n          }),\n          map(items => items.filter(x => x.length > 0).length))\n\n      // case 'text-property':\n      //   return this.pipeListTextProperty(l, pkEntity).pipe(map(items => items.length))\n\n      default:\n        console.warn('unsupported listType')\n        return new BehaviorSubject(0);\n    }\n  }\n\n  // @spyTag\n  pipeList(l: Subfield, pkEntity, limit?: number): Observable<ItemList> {\n    if (l.listType.appellation) return this.pipeListAppellation(l, pkEntity, limit)\n    else if (l.listType.entityPreview) return this.pipeListEntityPreview(l, pkEntity, limit)\n    else if (l.listType.language) return this.pipeListLanguage(l, pkEntity, limit)\n    else if (l.listType.place) return this.pipeListPlace(l, pkEntity, limit)\n    else if (l.listType.dimension) return this.pipeListDimension(l, pkEntity, limit)\n    else if (l.listType.langString) return this.pipeListLangString(l, pkEntity, limit)\n    else if (l.listType.temporalEntity) return this.pipeListEntityPreview(l, pkEntity, limit)\n    else if (l.listType.timeSpan) {\n      return this.pipeItemTimeSpan(pkEntity).pipe(\n        map((ts) => [ts].filter(i => i.properties.length > 0))\n      )\n    }\n    else console.warn('unsupported listType')\n  }\n\n  // @spyTag\n  pipeListBasicStatementItems(listDefinition: Subfield, pkEntity: number, pkProject: number): Observable<BasicStatementItem[]> {\n    return (listDefinition.isOutgoing ?\n      this.b.pipeOutgoingBasicStatementItemsByProperty(listDefinition.property.pkProperty, pkEntity, pkProject) :\n      this.b.pipeIngoingBasicStatementItemsByProperty(listDefinition.property.pkProperty, pkEntity, pkProject)\n    )\n  }\n\n  /**\n   * Pipe the items in appellation field\n   */\n  // @spyTag\n  pipeListAppellation<T>(listDefinition: Subfield, pkEntity: number, limit?: number): Observable<AppellationItem[]> {\n    return this.b.pipeStatementsOfList(listDefinition, pkEntity)\n      .pipe(\n        switchMap((statements) => {\n          return combineLatest(statements.map((r, i) => this.pipeItemAppellation(r)))\n            .pipe(\n              map(nodes => nodes.filter(node => !!node && node.fkClass === listDefinition.targetClass)),\n              limitTo(limit),\n              startWith([]))\n        }))\n  }\n\n  /**\n * Pipe the items in entity preview field\n */\n  // @spyTag\n  pipeListEntityPreview<T>(listDefinition: Subfield, pkEntity: number, limit?: number): Observable<EntityPreviewItem[]> {\n\n    return this.b.pipeStatementsOfList(listDefinition, pkEntity)\n      .pipe(\n        tag(`before-${pkEntity}-${listDefinition.property.pkProperty}-${listDefinition.targetClass}`),\n        switchMap((statements) => {\n          return combineLatest(statements.map((r, i) => this.pipeItemEntityPreview(r, listDefinition.isOutgoing)))\n            .pipe(\n              map(nodes => nodes.filter(node => !!node && node.fkClass === listDefinition.targetClass)\n                .sort((a, b) => a.ordNum > b.ordNum ? 1 : -1),\n                limitTo(limit),\n              ),\n              startWith([])\n            )\n        }),\n        tag(`after-${pkEntity}-${listDefinition.property.pkProperty}-${listDefinition.targetClass}`),\n      )\n\n  }\n\n\n  // @spyTag\n  pipeListLanguage<T>(listDefinition: Subfield, pkEntity: number, limit?: number): Observable<LanguageItem[]> {\n\n    return this.b.pipeStatementsOfList(listDefinition, pkEntity)\n      .pipe(\n        switchMap((statements) => {\n          return combineLatest(statements.map((r, i) => this.pipeItemLanguage(r)))\n            .pipe(\n              map(nodes => nodes.filter(node => !!node && node.fkClass === listDefinition.targetClass)),\n              limitTo(limit),\n              startWith([]))\n        }))\n  }\n\n  /**\n   * Pipe the items in place list\n   */\n  // @spyTag\n  pipeListPlace<T>(listDefinition: Subfield, pkEntity: number, limit?: number): Observable<PlaceItem[]> {\n\n    return this.b.pipeStatementsOfList(listDefinition, pkEntity)\n      .pipe(\n        switchMap((statements) => {\n          return combineLatest(statements.map((r, i) => this.pipeItemPlace(r)))\n            .pipe(\n              map(nodes => nodes.filter(node => !!node && node.fkClass === listDefinition.targetClass)),\n              limitTo(limit),\n              startWith([]))\n        }))\n  }\n\n  /**\n   * Pipe the items in place list\n   */\n  // @spyTag\n  pipeListDimension<T>(listDefinition: Subfield, pkEntity: number, limit?: number): Observable<DimensionItem[]> {\n\n    return this.b.pipeStatementsOfList(listDefinition, pkEntity)\n      .pipe(\n        switchMap((statements) => {\n          return combineLatest(statements.map((r, i) => this.pipeItemDimension(r)))\n            .pipe(\n              map(nodes => nodes.filter(node => !!node && node.fkClass === listDefinition.targetClass)),\n              limitTo(limit),\n              startWith([]))\n        }))\n  }\n\n  /**\n * Pipe the items in langString list\n */\n  // @spyTag\n  pipeListLangString<T>(listDefinition: Subfield, pkEntity: number, limit?: number): Observable<LangStringItem[]> {\n\n    return this.b.pipeStatementsOfList(listDefinition, pkEntity)\n      .pipe(\n        switchMap((statements) => {\n          return combineLatest(statements.map((r, i) => this.pipeItemLangString(r)))\n            .pipe(\n              map(nodes => nodes.filter(node => !!node && node.fkClass === listDefinition.targetClass)),\n              limitTo(limit),\n              startWith([]))\n        }))\n\n  }\n\n  /**\n   * pipe the project relation of given statment, if the scope of this page is inProject\n   * @param stmt InfStatement to be completed with projRel\n   * @param page page for which we are piping this stuff\n   */\n  pipeProjRelOfStatement(stmt: InfStatement, page: GvSubfieldPage): Observable<StatementProjRel> {\n    if (page.scope.inProject) {\n      return this.s.pro$.info_proj_rel$.by_fk_project__fk_entity$\n        .key(page.scope.inProject + '_' + stmt.pk_entity).pipe(\n          map(\n            projRel => ({\n              projRel,\n              ordNum: page.isOutgoing ? projRel.ord_num_of_range : projRel.ord_num_of_domain\n            })\n          )\n        )\n    }\n  }\n  /**\n   * pipe the target of given statment\n   * @param stmt InfStatement to be completed with target\n   * @param page page for which we are piping this stuff\n   * @param subfieldType type of subfield for which we pipe this stupp\n   */\n  pipeTargetOfStatement(stmt: InfStatement, page: GvSubfieldPage, subfieldType: SubfieldType): Observable<StatementTarget> {\n    const isOutgoing = page.isOutgoing\n    const targetInfo = isOutgoing ? stmt.fk_object_info : stmt.fk_subject_info;\n    // here you could add targetData or targetCell\n\n    if (subfieldType.appellation) {\n      return this.s.inf$.appellation$.by_pk_entity$.key(targetInfo).pipe(\n        map(appellation => {\n          const stmtTarget: StatementTarget = {\n            statement: stmt,\n            isOutgoing,\n            targetLabel: appellation.string,\n            targetClass: appellation.fk_class,\n            target: {\n              appellation\n            }\n          }\n          return stmtTarget\n        })\n      )\n    }\n    else if (subfieldType.temporalEntity) {\n      // pipe the subfields of the temporalEntity class\n      // if the subfieldTypes of these are temporalEntity again, replace it with entityPreview\n      // in order to prevent infinit cycle\n\n      // for each of these subfields\n      // - create page:GvSubfieldPage\n      // - call this.pipeSubfieldPage(page, subfieldType)\n    }\n\n    throw new Error(`No implementation found for subfieldType ${JSON.stringify(subfieldType)}`);\n  }\n\n  /**\n   * pipe target and projRel of the given statement\n   */\n  pipeStatementWithTarget(stmt: InfStatement, page: GvSubfieldPage, subfieldType: SubfieldType): Observable<StatementWithTarget> {\n    return combineLatest(\n      this.pipeTargetOfStatement(stmt, page, subfieldType),\n      this.pipeProjRelOfStatement(stmt, page)\n    ).pipe(\n      map(([target, projRel]) => ({ ...target, ...projRel }))\n    )\n  }\n\n  pipeSubfieldPage(page: GvSubfieldPage, subfieldType: SubfieldType): Observable<StatementWithTarget[]> {\n    // get the statments of that page\n    return this.s.inf$.statement$.pagination$.pipePage(page)\n      .pipe(\n        switchMap(\n          pkStmts => combineLatestOrEmpty(\n            pkStmts.map(pkStmt => this.s.inf$.statement$.by_pk_entity$.key(pkStmt)\n              // for each statement, depending on the subfieldType, load the corresponding target\n              .pipe(\n                switchMap(stmt => this.pipeStatementWithTarget(stmt, page, subfieldType))\n              )\n            )\n          )\n        )\n      )\n  }\n\n  // pipeStatementListPage(\n  //   paginateBy: PaginateByParam[],\n  //   limit: number,\n  //   offset: number,\n  //   pkProject: number,\n  //   listDefinition: Subfield,\n  //   alternative = false): Observable<EntityPreviewItem[]> {\n\n  //   // prepare page loader\n  //   const pageLoader$ = alternative ? this.infRepo.statement$.pagination$ : this.s.inf$.statement$.pagination$;\n\n  //   // prepare basic statement item loader\n  //   const basicStatementItemLoader = (pkStatement, isOutgoing, pkProj) => {\n  //     return alternative ?\n  //       this.b.pipeAlternativeBasicStatementItemByPkStatement(pkStatement, isOutgoing) :\n  //       this.b.pipeBasicStatementItemByPkStatement(pkProj, pkStatement, isOutgoing)\n  //   }\n\n  //   const paginatedStatementPks$ = pageLoader$.pipePage(paginateBy, limit, offset)\n\n  //   return paginatedStatementPks$.pipe(\n  //     switchMap((paginatedStatementPks) => combineLatestOrEmpty(\n  //       paginatedStatementPks.map(pkStatement => basicStatementItemLoader(pkStatement, listDefinition.isOutgoing, pkProject)\n  //         .pipe(\n  //           filter(x => !!x),\n  //           switchMap(x => this.p.streamEntityPreview(x.isOutgoing ? x.statement.fk_object_info : x.statement.fk_subject_info)\n  //             .pipe(\n  //               map((preview) => {\n  //                 const item: EntityPreviewItem = {\n  //                   ...x,\n  //                   preview,\n  //                   fkClass: preview.fk_class\n  //                 }\n  //                 return item;\n  //               })\n  //             )\n  //           ))\n\n  //       )\n  //     )\n  //     ))\n\n  // }\n\n\n  /**\n   * Pipe the temporal entities connected to given entity by statements that are in the current project\n   */\n  // @spyTag\n  // pipeTemporalEntityTableRows(\n  //   paginateBy: PaginateByParam[],\n  //   limit: number,\n  //   offset: number,\n  //   pkProject: number,\n  //   listDefinition: Subfield,\n  //   fieldDefinitions: Field[],\n  //   alternative = false): Observable<TemporalEntityItem[]> {\n\n  //   // const propertyItemType = this.propertyItemType(fieldDefinitions)\n\n  //   const targetEntityOfStatementItem = (r: BasicStatementItem) => r.isOutgoing ? r.statement.fk_object_info : r.statement.fk_subject_info;\n\n  //   // prepare page loader\n  //   const pageLoader$ = alternative ? this.infRepo.statement$.pagination$ : this.s.inf$.statement$.pagination$;\n\n  //   // prepare basic statement item loader\n  //   const basicStatementItemLoader = (pkStatement, isOutgoing, pkProj) => {\n  //     return alternative ?\n  //       this.b.pipeAlternativeBasicStatementItemByPkStatement(pkStatement, isOutgoing) :\n  //       this.b.pipeBasicStatementItemByPkStatement(pkProj, pkStatement, isOutgoing)\n  //   }\n\n  //   // prepare TeEnRow loader\n  //   const rowLoader = (targetEntityPk, fieldDef, pkProj) => {\n  //     return alternative ?\n  //       this.pipeItemTeEnRow(targetEntityPk, fieldDef, null, true) :\n  //       this.pipeItemTeEnRow(targetEntityPk, fieldDef, pkProj, false)\n  //   }\n\n  //   const paginatedStatementPks$ = pageLoader$.pipePage(paginateBy, limit, offset)\n\n  //   const rows$ = paginatedStatementPks$.pipe(\n  //     switchMap((paginatedStatementPks) => combineLatestOrEmpty(\n  //       paginatedStatementPks.map(pkStatement => basicStatementItemLoader(pkStatement, listDefinition.isOutgoing, pkProject)\n  //         .pipe(filter(x => !!x))\n  //       )\n  //     )\n  //       .pipe(\n  //         switchMap((teEnStatement) => combineLatestOrEmpty(\n  //           teEnStatement.map((basicStatementItem) => {\n  //             const pkTeEn = targetEntityOfStatementItem(basicStatementItem);\n  //             return combineLatest(\n  //               rowLoader(\n  //                 pkTeEn,\n  //                 fieldDefinitions,\n  //                 // propertyItemType,\n  //                 pkProject\n  //               ),\n  //               this.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(pkProject + '_' + pkTeEn)\n  //             ).pipe(\n  //               map(([row, teEnProjRel]) => {\n  //                 const item: TemporalEntityItem = {\n  //                   ...basicStatementItem,\n  //                   row,\n  //                   pkEntity: pkTeEn,\n  //                   teEnProjRel\n  //                 };\n  //                 return item\n  //               })\n  //             )\n  //           })\n  //         )),\n  //       )),\n\n  //   )\n  //   return rows$\n  // }\n\n\n\n  // @spyTag\n  pipeItemTeEnRow(pkEntity: number, fieldDefinitions: Field[], pkProject: number, repo: boolean): Observable<TemporalEntityRow> {\n\n    // pipe outgoing statements\n    const outgoingStatements$ = repo ? this.b.pipeRepoOutgoingStatements(pkEntity) : this.b.pipeOutgoingStatements(pkEntity);\n    // pipe ingoing statements\n    const ingoingStatements$ = repo ? this.b.pipeRepoIngoingStatements(pkEntity) : this.b.pipeIngoingStatements(pkEntity);\n\n\n    // pipe all statements with information leaf items\n\n    const outgoingItems$: Observable<StatementItem[]> = outgoingStatements$.pipe(\n      switchMap(statements => combineLatestOrEmpty(\n        statements\n          .filter(statement => !!statement.fk_object_info) // remove statements not pointing to information\n          .map(s => {\n            const isOutgoing = true;\n            return this.pipeItem(s, pkProject, isOutgoing);\n          })\n      ))\n\n    )\n    const ingoingItems$: Observable<StatementItem[]> = ingoingStatements$.pipe(\n      switchMap(statements => combineLatestOrEmpty(\n        statements\n          .filter(statement => !!statement.fk_subject_info) // remove statements not pointing to information\n          .map(s => {\n            const isOutgoing = false;\n            return this.pipeItem(s, pkProject, isOutgoing);\n          })\n      ))\n\n    )\n\n    const sortItems = repo ?\n      (item: StatementItem[]) => item.sort((a, b) => a.statement.is_in_project_count > b.statement.is_in_project_count ? 1 : -1) :\n      (item: StatementItem[]) => item;\n\n\n    return combineLatest(outgoingItems$, ingoingItems$).pipe(\n\n      map(([outgoingItems, ingoingItems]) => {\n        const groupedOut = groupBy((i) => (i && i.statement ? i.statement.fk_property.toString() : undefined), outgoingItems);\n        const groupedIn = groupBy((i) => (i && i.statement ? i.statement.fk_property.toString() : undefined), ingoingItems);\n        return { groupedOut, groupedIn }\n      }),\n      // auditTime(10),\n      map((d) => {\n        const row: TemporalEntityRow = {}\n\n        fieldDefinitions.forEach(fieldDefinition => {\n\n          let cell: TemporalEntityCell;\n          fieldDefinition.listDefinitions.forEach(listDefinition => {\n            if (listDefinition.listType.timeSpan) {\n\n              const t = pick(['71', '72', '150', '151', '152', '153'], d.groupedOut);\n              const keys = Object.keys(t);\n              const itemsCount = keys.length;\n\n              let label;\n              if (itemsCount > 0) {\n                const timeSpanKeys: CtrlTimeSpanDialogResult = {}\n                keys.forEach(key => { timeSpanKeys[key] = t[key][0].timePrimitive })\n                const timeSpan = TimeSpanUtil.fromTimeSpanDialogData(timeSpanKeys);\n                label = this.timeSpanPipe.transform(timeSpan);\n              }\n              cell = {\n                isOutgoing: listDefinition.isOutgoing,\n                itemsCount,\n                label,\n                entityPreview: undefined,\n                pkProperty: undefined,\n                isTimeSpan: true\n              }\n            }\n            else {\n              if (listDefinition.isOutgoing) {\n                if (d.groupedOut[listDefinition.property.pkProperty]) {\n                  const items = sortItems(d.groupedOut[listDefinition.property.pkProperty])\n                  const firstItem = items[0];\n                  cell = {\n                    isOutgoing: listDefinition.isOutgoing,\n                    itemsCount: items.length,\n                    entityPreview: ((firstItem || {}) as EntityPreviewItem).preview,\n                    label: firstItem.label,\n                    pkProperty: listDefinition.property.pkProperty,\n                    firstItem,\n                    items\n                  }\n                }\n              } else {\n                if (d.groupedIn[listDefinition.property.pkProperty]) {\n                  const items = sortItems(d.groupedIn[listDefinition.property.pkProperty])\n                  const firstItem = items[0];\n                  cell = {\n                    isOutgoing: listDefinition.isOutgoing,\n                    itemsCount: items.length,\n                    entityPreview: ((firstItem || {}) as EntityPreviewItem).preview,\n                    label: firstItem.label,\n                    pkProperty: listDefinition.property.pkProperty,\n                    firstItem,\n                    items\n                  }\n                }\n              }\n            }\n\n          })\n\n\n          row[fieldDefinition.label] = cell;\n        })\n        return row\n      })\n\n\n    )\n  }\n\n\n\n  // @spyTag\n  private pipeItem(r: InfStatement, pkProject: number, propIsOutgoing: boolean) {\n\n    const targetEntity = propIsOutgoing ? r.fk_object_info : r.fk_subject_info;\n    return this.s.inf$.getModelOfEntity$(targetEntity).pipe(\n      switchMap(m => {\n        const modelName: InfModelName = m ? m.modelName : undefined;\n        switch (modelName) {\n          case 'appellation':\n            return this.pipeItemAppellation(r);\n          case 'language':\n            return this.pipeItemLanguage(r);\n          case 'place':\n            return this.pipeItemPlace(r);\n          case 'dimension':\n            return this.pipeItemDimension(r);\n          case 'lang_string':\n            return this.pipeItemLangString(r);\n          case 'time_primitive':\n            return this.pipeItemTimePrimitive(r, pkProject); // TODO: emits twice\n          default:\n            return this.pipeItemEntityPreview(r, propIsOutgoing);\n        }\n\n\n      })\n    )\n\n\n  }\n\n\n  // @spyTag\n  pipeEntityProperties(listDef: Subfield, fkEntity: number, limit?: number): Observable<EntityProperties> {\n\n    if (listDef.listType.appellation) {\n      return this.pipeListAppellation(listDef, fkEntity, limit)\n        .pipe(map((items) => this.getEntityProperties(listDef, items)))\n    }\n    else if (listDef.listType.language) {\n      return this.pipeListLanguage(listDef, fkEntity, limit)\n        .pipe(map((items) => this.getEntityProperties(listDef, items)))\n    }\n    else if (listDef.listType.place) {\n      return this.pipeListPlace(listDef, fkEntity, limit)\n        .pipe(map((items) => this.getEntityProperties(listDef, items)))\n    }\n    else if (listDef.listType.dimension) {\n      return this.pipeListDimension(listDef, fkEntity, limit)\n        .pipe(map((items) => this.getEntityProperties(listDef, items)))\n    }\n    else if (listDef.listType.langString) {\n      return this.pipeListLangString(listDef, fkEntity, limit)\n        .pipe(map((items) => this.getEntityProperties(listDef, items)))\n    }\n\n\n    else if (listDef.listType.entityPreview || listDef.listType.temporalEntity) {\n      return this.pipeListEntityPreview(listDef, fkEntity, limit)\n        .pipe(map((items) => this.getEntityProperties(listDef, items)))\n    }\n    else if (listDef.listType.timeSpan) {\n      return this.pipeItemTimeSpan(fkEntity)\n        .pipe(map((item) => {\n          const items = item.properties.find(p => p.items.length > 0) ? [{\n            label: this.timeSpanPipe.transform(timeSpanItemToTimeSpan(item)),\n            properties: [] // TODO check if the properties or the item are really not needed\n          }] : []\n          return {\n            listDefinition: listDef,\n            items\n          }\n        }))\n    }\n    else return of(null)\n  }\n\n  // @spyTag\n  pipeTemporalEntityRemoveProperties(pkEntity: number): Observable<TemporalEntityRemoveProperties> {\n    return combineLatest(\n      this.s.inf$.temporal_entity$.by_pk_entity_key$(pkEntity),\n      this.s.inf$.statement$.by_subject$({ fk_subject_info: pkEntity }),\n      this.s.inf$.text_property$.by_fk_concerned_entity_indexed$(pkEntity)\n    ).pipe(\n      map(([temporalEntity, statements, textProperties]) => {\n        const res: TemporalEntityRemoveProperties = {\n          temporalEntity,\n          statements: statements,\n          textProperties: values(textProperties)\n        }\n        return res\n      })\n    )\n  }\n\n  getEntityProperties(listDefinition: Subfield, items): EntityProperties {\n    return {\n      listDefinition,\n      items,\n    }\n  }\n\n  /**\n   * Pipe time span item in version of project\n   */\n  // @spyTag\n  pipeItemTimeSpan(pkEntity): Observable<TimeSpanItem> {\n\n    return this.p.pkProject$.pipe(\n      switchMap(pkProject => {\n        return this.c.pipeSpecificFieldOfClass(\n          DfhConfig.ClASS_PK_TIME_SPAN\n        ).pipe(\n          switchMap(fieldDefs => {\n            return combineLatest(fieldDefs.map(fieldDef => this.s.inf$.statement$.by_subject_and_property$({\n              fk_property: fieldDef.property.pkProperty,\n              fk_subject_info: pkEntity\n            })\n              .pipe(\n                switchMapOr([], statements => combineLatest(\n                  statements.map(statement => combineLatest(\n                    this.s.inf$.time_primitive$.by_pk_entity$.key(statement.fk_object_info).pipe(filter(x => !!x)),\n                    this.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(pkProject + '_' + statement.pk_entity)\n                  ).pipe(map(([infTimePrimitive, projRel]) => {\n                    const timePrimitive = new TimePrimitive({\n                      julianDay: infTimePrimitive.julian_day,\n                      calendar: ((projRel.calendar || 'gregorian') as CalendarType),\n                      duration: (infTimePrimitive.duration as Granularity)\n                    })\n                    const item: TimePrimitiveItem = {\n                      statement,\n                      ordNum: undefined,\n                      projRel,\n                      timePrimitive,\n                      label: this.timePrimitivePipe.transform(timePrimitive),\n                      fkClass: infTimePrimitive.fk_class\n                    }\n                    return item;\n                  }))\n                  )\n                )),\n                map(items => {\n                  const res: TimeSpanProperty = {\n                    listDefinition: fieldDef.listDefinitions[0], items\n                  }\n                  return res\n                })\n              )\n            )).pipe(\n              map((properties) => {\n                const props = properties.filter(p => p.items.length > 0);\n                const timespanitem: TimeSpanItem = {\n                  label: '',\n                  properties: props\n                }\n                return timespanitem\n              })\n            )\n          })\n        )\n      })\n\n    )\n  }\n\n  // @spyTag\n  pipeItemAppellation(statement: InfStatement): Observable<AppellationItem> {\n    return this.s.inf$.appellation$.by_pk_entity$.key(statement.fk_object_info).pipe(\n      filter(x => !!x),\n      map(appellation => {\n        if (!appellation) return null;\n        const node: AppellationItem = {\n          ordNum: undefined,\n          projRel: undefined,\n          statement,\n          label: appellation.string,\n          fkClass: appellation.fk_class\n        }\n        return node\n      }))\n  }\n\n  // @spyTag\n  pipeItemLanguage(statement: InfStatement): Observable<LanguageItem> {\n    return this.s.inf$.language$.by_pk_entity$.key(statement.fk_object_info).pipe(\n      filter(x => !!x),\n      map(language => {\n        if (!language) return null;\n        const node: LanguageItem = {\n          ordNum: undefined,\n          projRel: undefined,\n          statement,\n          label: language.notes,\n          fkClass: language.fk_class\n        }\n        return node\n      }))\n  }\n\n  // @spyTag\n  pipeItemPlace(statement: InfStatement): Observable<PlaceItem> {\n    return this.s.inf$.place$.by_pk_entity$.key(statement.fk_object_info).pipe(\n      filter(x => !!x),\n      map(place => {\n        if (!place) return null;\n        const node: PlaceItem = {\n          ordNum: undefined,\n          projRel: undefined,\n          statement,\n          label: 'WGS84: ' + place.lat + ', ' + place.long + '',\n          fkClass: place.fk_class\n        }\n        return node\n      }))\n  }\n\n  // @spyTag\n  pipeItemDimension(statement: InfStatement): Observable<DimensionItem> {\n    return this.s.inf$.dimension$.by_pk_entity$.key(statement.fk_object_info).pipe(\n      filter(x => !!x),\n      switchMap((dimension) => {\n        return this.p.streamEntityPreview(dimension.fk_measurement_unit)\n          .pipe(\n            map(preview => {\n\n              const node: DimensionItem = {\n                ordNum: undefined,\n                projRel: undefined,\n                statement,\n                label: `${dimension.numeric_value} ${preview.entity_label}`,\n                fkClass: dimension.fk_class,\n              }\n              return node\n            })\n          )\n      })\n    )\n  }\n\n\n  // @spyTag\n  pipeItemLangString(statement: InfStatement): Observable<LangStringItem> {\n    return this.s.inf$.lang_string$.by_pk_entity$.key(statement.fk_object_info).pipe(\n      switchMap(\n        (langString) => {\n          if (!langString) return new BehaviorSubject(null)\n          return this.s.inf$.language$.by_pk_entity$.key(langString.fk_language)\n            .pipe(\n              map(language => {\n                if (!language) return null;\n                let label = '';\n                if (langString.string) label = langString.string\n                else if (langString.quill_doc && langString.quill_doc.ops && langString.quill_doc.ops.length) {\n                  label = langString.quill_doc.ops.map(op => op.insert).join('');\n                }\n                const node: LangStringItem = {\n                  ordNum: undefined,\n                  projRel: undefined,\n                  statement,\n                  label,\n                  fkClass: langString.fk_class,\n                  language,\n                  fkLanguage: langString.fk_language\n                }\n                return node\n              })\n            )\n        })\n    )\n  }\n\n\n  // @spyTag\n  pipeItemEntityPreview(statement: InfStatement, isOutgoing: boolean): Observable<EntityPreviewItem> {\n    return this.p.streamEntityPreview((isOutgoing ? statement.fk_object_info : statement.fk_subject_info)).pipe(\n      // filter(preview => !preview.loading && !!preview && !!preview.entity_type),\n      map(preview => {\n        if (!preview) {\n          return null;\n        }\n        const node: EntityPreviewItem = {\n          ordNum: undefined,\n          projRel: undefined,\n          statement,\n          preview,\n          label: preview.entity_label || '',\n          fkClass: preview.fk_class\n        }\n        return node\n      }))\n  }\n\n  /**\n   * @param pk\n   */\n  // @spyTag\n  pipeItemTimePrimitive(statement: InfStatement, pkProject): Observable<TimePrimitiveItem> {\n    if (pkProject) {\n      return combineLatest(\n        this.s.inf$.time_primitive$.by_pk_entity$.key(statement.fk_object_info).pipe(filter(x => !!x)),\n        this.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(pkProject + '_' + statement.pk_entity).pipe(filter(x => !!x))\n      ).pipe(\n        map(([infTimePrimitive, projRel]) => {\n          if (!infTimePrimitive) return null;\n          const timePrimitive = new TimePrimitive({\n            julianDay: infTimePrimitive.julian_day,\n            calendar: ((projRel.calendar || 'gregorian') as CalendarType),\n            duration: (infTimePrimitive.duration as Granularity)\n          })\n          const node: TimePrimitiveItem = {\n            ordNum: undefined,\n            projRel: undefined,\n            statement,\n            timePrimitive,\n            label: this.timePrimitivePipe.transform(timePrimitive),\n            fkClass: infTimePrimitive.fk_class\n          }\n          return node\n        }))\n    } else {\n      return this.infRepo.time_primitive$.by_pk_entity$.key(statement.fk_object_info).pipe(filter(x => !!x)).pipe(\n        map(infTimePrimitive => {\n          const timePrimitive = new TimePrimitive({\n            julianDay: infTimePrimitive.julian_day,\n            calendar: ((statement.community_favorite_calendar || 'gregorian') as CalendarType),\n            duration: (infTimePrimitive.duration as Granularity)\n          })\n          const node: TimePrimitiveItem = {\n            ordNum: undefined,\n            projRel: undefined,\n            statement,\n            timePrimitive,\n            label: this.timePrimitivePipe.transform(timePrimitive),\n            fkClass: infTimePrimitive.fk_class\n          }\n          return node\n        })\n      )\n    }\n  }\n\n\n  /*********************************************************************\n  * Pipe alternatives (not in project)\n  *********************************************************************/\n  // @spyTag\n  pipeAltListLength(l: Subfield, pkEntity: number): Observable<number> {\n    switch (l.listType) {\n      case 'appellation':\n      case 'entity-preview':\n      case 'language':\n      case 'place':\n      case 'langString':\n      case 'temporal-entity':\n      case 'time-span':\n        return this.pipeAltListStatements(l, pkEntity).pipe(map(items => items.length))\n\n      default:\n        console.warn('unsupported listType')\n        break;\n    }\n  }\n\n  // @spyTag\n  pipeAltList(l: Subfield, pkEntity): Observable<ItemList> {\n    if (l.listType.appellation) return this.pipeAltListAppellation(l, pkEntity)\n    else if (l.listType.entityPreview) return this.pipeAltListEntityPreview(l, pkEntity)\n    else if (l.listType.language) return this.pipeAltListLanguage(l, pkEntity)\n    else if (l.listType.place) return this.pipeAltListPlace(l, pkEntity)\n    else if (l.listType.dimension) return this.pipeAltListDimension(l, pkEntity)\n    else if (l.listType.langString) return this.pipeAltListLangString(l, pkEntity)\n    else if (l.listType.temporalEntity) return this.pipeAltListEntityPreview(l, pkEntity)\n    else console.warn('unsupported listType')\n  }\n\n  // @spyTag\n  pipeAltListStatements(listDefinition: Subfield, pkEntity: number): Observable<InfStatement[]> {\n    return (listDefinition.isOutgoing ?\n      this.b.pipeAlternativeIngoingStatements(listDefinition.property.pkProperty, pkEntity) :\n      this.b.pipeAlternativeIngoingStatements(listDefinition.property.pkProperty, pkEntity)\n    )\n  }\n\n  /**\n  * Pipe the items in entity preview field\n  */\n  // @spyTag\n  pipeAltListEntityPreview<T>(listDefinition: Subfield, pkEntity): Observable<EntityPreviewItem[]> {\n\n    return (listDefinition.isOutgoing ?\n      this.b.pipeAlternativeOutgoingStatements(listDefinition.property.pkProperty, pkEntity) :\n      this.b.pipeAlternativeIngoingStatements(listDefinition.property.pkProperty, pkEntity)\n    ).pipe(\n      switchMap((statements) => {\n        return combineLatest(statements.map((r, i) => this.pipeItemEntityPreview(r, listDefinition.isOutgoing)))\n          .pipe(\n            map(nodes => nodes\n              .filter(node => !!node)\n              .sort((a, b) => a.ordNum > b.ordNum ? 1 : -1)\n            ),\n            startWith([]))\n      }))\n\n  }\n\n  /**\n   * Pipe the alternative items in place list\n   */\n  // @spyTag\n  pipeAltListPlace<T>(listDefinition: Subfield, pkEntity): Observable<PlaceItem[]> {\n\n    if (listDefinition.isOutgoing) {\n      return this.b.pipeAlternativeOutgoingStatements(listDefinition.property.pkProperty, pkEntity).pipe(\n        switchMap((statements) => {\n          return combineLatest(statements.map((r, i) => this.pipeItemPlace(r)))\n            .pipe(\n              map(nodes => nodes.filter(node => !!node && node.fkClass === listDefinition.targetClass)),\n              startWith([]))\n        }))\n    }\n  }\n\n\n  /**\n   * Pipe the alternative items in dimension list\n   */\n  // @spyTag\n  pipeAltListDimension<T>(listDefinition: Subfield, pkEntity): Observable<DimensionItem[]> {\n\n    if (listDefinition.isOutgoing) {\n      return this.b.pipeAlternativeOutgoingStatements(listDefinition.property.pkProperty, pkEntity).pipe(\n        switchMap((statements) => {\n          return combineLatest(statements.map((r, i) => this.pipeItemDimension(r)))\n            .pipe(\n              map(nodes => nodes.filter(node => !!node && node.fkClass === listDefinition.targetClass)),\n              startWith([]))\n        }))\n    }\n  }\n\n\n  /**\n   * Pipe the alternative items in langString list\n   */\n  // @spyTag\n  pipeAltListLangString<T>(listDefinition: Subfield, pkEntity): Observable<LangStringItem[]> {\n\n    if (listDefinition.isOutgoing) {\n      return this.b.pipeAlternativeOutgoingStatements(listDefinition.property.pkProperty, pkEntity).pipe(\n        switchMap((statements) => {\n          return combineLatest(statements.map((r, i) => this.pipeItemLangString(r)))\n            .pipe(\n              map(nodes => nodes.filter(node => !!node && node.fkClass === listDefinition.targetClass)),\n              startWith([]))\n        }))\n    }\n  }\n\n  /**\n   * Pipe the alternative items in appellation field\n   */\n  // @spyTag\n  pipeAltListAppellation<T>(listDefinition: Subfield, pkEntity): Observable<AppellationItem[]> {\n\n    if (listDefinition.isOutgoing) {\n      return this.b.pipeAlternativeOutgoingStatements(listDefinition.property.pkProperty, pkEntity).pipe(\n        switchMap((statements) => {\n          return combineLatest(statements.map((r, i) => this.pipeItemAppellation(r)))\n            .pipe(\n              map(nodes => nodes.filter(node => !!node && node.fkClass === listDefinition.targetClass)),\n              startWith([]))\n        }))\n    }\n  }\n\n  /**\n   * Pipe the alternative items in language field\n   */\n  // @spyTag\n  pipeAltListLanguage<T>(listDefinition: Subfield, pkEntity): Observable<LanguageItem[]> {\n\n    if (listDefinition.isOutgoing) {\n      return this.b.pipeAlternativeOutgoingStatements(listDefinition.property.pkProperty, pkEntity).pipe(\n        switchMap((statements) => {\n          return combineLatest(statements.map((r, i) => this.pipeItemLanguage(r)))\n            .pipe(\n              map(nodes => nodes.filter(node => !!node && node.fkClass === listDefinition.targetClass)),\n              startWith([]))\n        }))\n    }\n  }\n\n  /*********************************************************************\n   * Pipe repo views (community favorites, where restricted by quantifiers)\n   *********************************************************************/\n\n  /**\n   * Pipe repository temporal entity item in the way it is defined by the repository\n   */\n\n\n  /**\n   * Pipe appellation list in the way it is defined by the repository\n   */\n  // @spyTag\n  pipeRepoListAppellation<T>(listDefinition: Subfield, pkEntity): Observable<AppellationItem[]> {\n\n    if (listDefinition.isOutgoing) {\n      return this.b.pipeRepoOutgoingStatementsByProperty(listDefinition.property.pkProperty, pkEntity).pipe(\n        switchMap((statements) => {\n          return combineLatest(statements.map((r, i) => this.pipeItemAppellation(r)))\n            .pipe(\n              map(nodes => nodes.filter(node => !!node && node.fkClass === listDefinition.targetClass)),\n              startWith([]))\n        }))\n    }\n  }\n\n  /**\n  * Pipe language list in the way it is defined by the repository\n  */\n  // @spyTag\n  pipeRepoListLanguage<T>(listDefinition: Subfield, pkEntity): Observable<LanguageItem[]> {\n\n    if (listDefinition.isOutgoing) {\n      return this.b.pipeRepoOutgoingStatementsByProperty(listDefinition.property.pkProperty, pkEntity).pipe(\n        switchMap((statements) => {\n          return combineLatest(statements.map((r, i) => this.pipeItemLanguage(r)))\n            .pipe(\n              map(nodes => nodes.filter(node => !!node && node.fkClass === listDefinition.targetClass)),\n              startWith([]))\n        }))\n    }\n  }\n\n  /**\n   * Pipe place list in the way it is defined by the repository\n   */\n  // @spyTag\n  pipeRepoListPlace<T>(listDefinition: Subfield, pkEntity): Observable<PlaceItem[]> {\n\n    if (listDefinition.isOutgoing) {\n      return this.b.pipeRepoOutgoingStatementsByProperty(listDefinition.property.pkProperty, pkEntity).pipe(\n        switchMap((statements) => {\n          return combineLatest(statements.map((r, i) => this.pipeItemPlace(r)))\n            .pipe(\n              map(nodes => nodes.filter(node => !!node && node.fkClass === listDefinition.targetClass)),\n              startWith([]))\n        }))\n    }\n  }\n\n  /**\n  * Pipe place list in the way it is defined by the repository\n  */\n  // @spyTag\n  pipeRepoListDimension<T>(listDefinition: Subfield, pkEntity): Observable<DimensionItem[]> {\n\n    if (listDefinition.isOutgoing) {\n      return this.b.pipeRepoOutgoingStatementsByProperty(listDefinition.property.pkProperty, pkEntity).pipe(\n        switchMap((statements) => {\n          return combineLatest(statements.map((r, i) => this.pipeItemDimension(r)))\n            .pipe(\n              map(nodes => nodes.filter(node => !!node && node.fkClass === listDefinition.targetClass)),\n              startWith([]))\n        }))\n    }\n  }\n  /**\n  * Pipe the items in entity preview field, connected by community favorite statements\n  */\n  // @spyTag\n  pipeRepoListEntityPreview<T>(listDefinition: Subfield, pkEntity): Observable<EntityPreviewItem[]> {\n\n    return (listDefinition.isOutgoing ?\n      this.b.pipeRepoOutgoingStatementsByProperty(listDefinition.property.pkProperty, pkEntity) :\n      this.b.pipeRepoIngoingStatementsByProperty(listDefinition.property.pkProperty, pkEntity)\n    ).pipe(\n      switchMap((statements) => {\n        return combineLatest(statements.map((r, i) => this.pipeItemEntityPreview(r, listDefinition.isOutgoing)))\n          .pipe(\n            map(nodes => nodes.filter(node => !!node && node.fkClass === listDefinition.targetClass)\n              // .sort((a, b) => a.ordNum > b.ordNum ? 1 : -1)\n            ))\n      }),\n      startWith([])\n    )\n\n  }\n\n\n  /**\n   * Pipe repo time span item\n   */\n  // @spyTag\n  pipeRepoItemTimeSpan(pkEntity): Observable<TimeSpanItem> {\n    return this.p.pkProject$.pipe(\n      switchMap(pkProject => {\n        return this.c.pipeBasicAndSpecificFields(\n          DfhConfig.ClASS_PK_TIME_SPAN\n        ).pipe(\n          switchMap(fieldDefinitions => {\n\n            return combineLatest(fieldDefinitions.map(fieldDef =>\n              this.b.pipeRepoOutgoingStatementsByProperty(fieldDef.property.pkProperty, pkEntity)\n                .pipe(\n                  switchMapOr([], statements => combineLatest(\n                    statements.map(statement =>\n                      this.infRepo.time_primitive$.by_pk_entity$.key(statement.fk_object_info)\n                        .pipe(map((infTimePrimitive) => {\n                          const timePrimitive = new TimePrimitive({\n                            julianDay: infTimePrimitive.julian_day,\n                            calendar: ((statement.community_favorite_calendar || 'gregorian') as CalendarType),\n                            duration: (infTimePrimitive.duration as Granularity)\n                          })\n                          const item: TimePrimitiveItem = {\n                            statement,\n                            ordNum: undefined,\n                            projRel: undefined,\n                            timePrimitive,\n                            label: this.timePrimitivePipe.transform(timePrimitive),\n                            fkClass: infTimePrimitive.fk_class\n                          }\n                          return item;\n                        }))\n                    )\n                  )),\n                  map(items => {\n                    const res: TimeSpanProperty = {\n                      listDefinition: fieldDef.listDefinitions[0], items\n                    }\n                    return res\n                  }),\n                  startWith({ listDefinition: fieldDef.listDefinitions[0], items: [] } as TimeSpanProperty)\n                )\n            )).pipe(\n              map((properties) => {\n                const timespanitem: TimeSpanItem = {\n                  label: '',\n                  properties: properties.filter(props => props.items.length > 0)\n                }\n                return timespanitem\n              })\n            )\n          })\n        )\n      })\n\n    )\n  }\n\n\n  /**\n   * Pipes the label of given entity\n   * This will use entity previews for getting strings of related temporal entities\n   * So this may take a little while\n   */\n  // @spyTag\n  pipeLabelOfEntity(fkEntity: number): Observable<string> {\n    return this.b.pipeClassOfEntity(fkEntity).pipe(\n\n      // get the definition of the first field\n      switchMap(fkClass => this.c.pipeBasicAndSpecificFields(fkClass).pipe(\n        // get the first item of that field\n        switchMap(fieldDef => combineLatestOrEmpty(\n          fieldDef && fieldDef.length ?\n            fieldDef[0].listDefinitions.map(listDef => this.pipeEntityProperties(listDef, fkEntity, 1)) :\n            []\n        ).pipe(\n          map(props => {\n            props = props.filter(prop => prop.items.length > 0)\n            if (props.length && props[0].items.length) {\n              return props[0].items[0].label\n            }\n            return ''\n          })\n        )))\n      ))\n  }\n\n\n  /**\n   * Pipes the class label of given entity\n   */\n  // @spyTag\n  pipeClassLabelOfEntity(fkEntity: number): Observable<string> {\n    return this.b.pipeClassOfEntity(fkEntity).pipe(\n      switchMap(pkClass => this.c.pipeClassLabel(pkClass))\n    )\n  }\n\n  /**\n   * Pipes the pk_entity of the type of an entity\n   */\n  // @spyTag\n  pipeTypeOfEntity(pkEntity: number, hasTypeProperty: number, isOutgoing: boolean): Observable<InfStatement> {\n    if (isOutgoing) {\n      return this.s.inf$.statement$.by_subject_and_property_indexed$({ fk_property: hasTypeProperty, fk_subject_info: pkEntity }).pipe(map(items => {\n        if (!items || Object.keys(items).length < 1) return undefined;\n        else return values(items)[0]\n      })\n      )\n    }\n    else {\n      return this.s.inf$.statement$.by_object_and_property_indexed$({ fk_property: hasTypeProperty, fk_object_info: pkEntity }).pipe(\n        map(items => {\n          if (!items || Object.keys(items).length < 1) return undefined;\n          else return values(items)[0]\n        })\n      )\n    }\n  }\n\n  @spyTag\n  @cache({ refCount: false })\n  pipeClassesAndTypes(enabledIn: 'entities' | 'sources') {\n    return this.c.pipeTypeAndTypedClasses(enabledIn).pipe(\n      switchMap(items => this.pipeClassAndTypeNodes(items)),\n    )\n  }\n\n  @spyTag\n  @cache({ refCount: false })\n  pipeClassesAndTypesOfClasses(classes: number[]) {\n    return this.c.pipeTypeAndTypedClassesOfTypedClasses(classes).pipe(\n      switchMap(items => this.pipeClassAndTypeNodes(items)),\n    )\n  }\n\n  @spyTag\n  @cache({ refCount: false })\n  pipeClassAndTypeNodes(typeAndTypedClasses: { typedClass: number; typeClass: number; }[]): Observable<ClassAndTypeNode[]> {\n    return combineLatestOrEmpty(\n      typeAndTypedClasses.map(item => this.c.pipeClassLabel(item.typedClass).pipe(\n        map(label => ({\n          label,\n          data: { pkClass: item.typedClass, pkType: null }\n        } as ClassAndTypeNode)),\n        switchMap(node => iif(\n          () => !!item.typeClass,\n          this.b.pipePersistentItemPksByClass(item.typeClass).pipe(\n            switchMap(typePks => combineLatestOrEmpty(\n              typePks.map(pkType => this.p.streamEntityPreview(pkType).pipe(\n                map(preview => ({\n                  label: preview.entity_label,\n                  data: { pkClass: item.typedClass, pkType }\n                } as ClassAndTypeNode))\n              ))\n            ).pipe(\n              sortAbc(n => n.label),\n            )),\n            map(children => {\n              node.children = children\n              return node\n            })\n          ),\n          of({ ...node, children: [] } as ClassAndTypeNode)\n        )\n        )\n      ))\n    ).pipe(\n      sortAbc((node) => node.label),\n    )\n  }\n\n  /**\n   * returns array of pk_class of all classes and typed classes.\n   * @param classesAndTypes a object containing {classes: [], types[]}\n   */\n  pipeClassesFromClassesAndTypes(classesAndTypes: ClassAndTypeSelectModel): Observable<number[]> {\n    const typedClasses$ = (!classesAndTypes || !classesAndTypes.types || !classesAndTypes.types.length) ?\n      of([] as number[]) :\n      this.b.pipeClassesOfPersistentItems(classesAndTypes.types)\n        .pipe(\n          filter((pks) => !!pks),\n          switchMap(typeClasses => this.c.pipeTypedClassesOfTypeClasses(typeClasses))\n        )\n    return typedClasses$.pipe(\n      map(typedClasses => uniq([...typedClasses, ...((classesAndTypes || { classes: [] }).classes || [])]))\n    );\n  }\n\n  pipePropertyOptionsFromClassesAndTypes(classesAndTypes: ClassAndTypeSelectModel): Observable<PropertyOption[]> {\n    return this.pipeClassesFromClassesAndTypes(classesAndTypes).pipe(\n      switchMap(classes => this.pipePropertyOptionsFormClasses(classes))\n    )\n  }\n\n  @cache({ refCount: false })\n  pipePropertyOptionsFormClasses(classes: number[]): Observable<PropertyOption[]> {\n    return combineLatestOrEmpty(classes.map(pkClass => this.s.dfh$.class$.by_pk_class$.key(pkClass).pipe(\n      map(c => c.basic_type === 9),\n      switchMap(isTeEn => this.c.pipeSpecificAndBasicFields(pkClass)\n        .pipe(\n          map(classFields => classFields\n            .filter(f => !!f.property.pkProperty)\n            .map(f => ({\n              isOutgoing: f.isOutgoing,\n              fkPropertyDomain: f.isOutgoing ? f.sourceClass : null,\n              fkPropertyRange: f.isOutgoing ? null : f.sourceClass,\n              pkProperty: f.property.pkProperty\n            }))),\n          switchMap(items => {\n            if (isTeEn) {\n              // add time properties (at some time within, ...)\n              DfhConfig.PROPERTY_PKS_WHERE_TIME_PRIMITIVE_IS_RANGE.map(pkProperty => {\n                items.push({\n                  pkProperty,\n                  fkPropertyDomain: pkClass,\n                  fkPropertyRange: DfhConfig.CLASS_PK_TIME_PRIMITIVE,\n                  isOutgoing: true\n                })\n              })\n            }\n\n            return combineLatestOrEmpty(items.map(item => this.c.pipeFieldLabel(\n              item.pkProperty,\n              item.fkPropertyDomain,\n              item.fkPropertyRange,\n            ).pipe(map(label => {\n              const isOutgoing = item.isOutgoing;\n              const o: PropertyOption = {\n                isOutgoing,\n                label,\n                pk: item.pkProperty,\n                propertyFieldKey: propertyOptionFieldKey(item.pkProperty, isOutgoing)\n              };\n              return o;\n            }))));\n          })))\n    )\n\n\n    )).pipe(map(y => flatten<PropertyOption>(y)));\n  }\n\n  @cache({ refCount: false })\n  pipePkClassesFromPropertySelectModel(model: PropertySelectModel): Observable<number[]> {\n    return combineLatestOrEmpty(\n      [\n        this.c.pipeTargetClassesOfProperties(model.outgoingProperties, true),\n        this.c.pipeTargetClassesOfProperties(model.ingoingProperties, false),\n      ]\n    ).pipe(\n      map(([out, ing]) => uniq([...out, ...ing]))\n    )\n  }\n\n  getPkClassesFromPropertySelectModel$(model$: Observable<PropertySelectModel>): Observable<number[]> {\n    return model$.pipe(\n      switchMap(model => combineLatestOrEmpty(\n        [\n          this.c.pipeTargetClassesOfProperties(model.outgoingProperties, true),\n          this.c.pipeTargetClassesOfProperties(model.ingoingProperties, false),\n        ]\n      ).pipe(\n        map(([out, ing]) => uniq([...out, ...ing]))\n      ))\n    )\n  }\n\n\n\n  getPropertyOptions$(classTypes$: Observable<ClassAndTypeSelectModel>): Observable<PropertyOption[]> {\n    return classTypes$.pipe<ClassAndTypeSelectModel, PropertyOption[]>(\n      // make sure only it passes only if data of the arrayClasses are changed (not children)\n      distinctUntilChanged<ClassAndTypeSelectModel>((a, b) => {\n        return equals(a, b);\n      }),\n      switchMap((x) => !x ? empty() : this.b.pipeClassesOfPersistentItems(x.types)\n        .pipe(\n          filter((pks) => !!pks),\n          switchMap(typeClasses => this.c.pipeTypedClassesOfTypeClasses(typeClasses).pipe(\n            switchMap(typedClasses => {\n              const classes = uniq([...typedClasses, ...(x.classes || [])]);\n              return this.pipePropertyOptionsFormClasses(classes)\n            }))\n          )\n        )\n      )\n    );\n  }\n\n}\n\nexport function propertyOptionFieldKey(fkProperty: number, isOutgoing: boolean): string {\n  return '_' + fkProperty + '_' + (isOutgoing ? 'outgoing' : 'ingoing');\n}\n\n","import { TimeSpanItem } from '../models/TimeSpanItem';\nimport { TimeSpanUtil } from '@kleiolab/lib-utils';\nimport { DfhConfig } from '@kleiolab/lib-config';\n\nexport function timeSpanItemToTimeSpan(timeSpanItem: TimeSpanItem): TimeSpanUtil {\n  const t = new TimeSpanUtil();\n\n  timeSpanItem.properties.forEach(p => {\n    const key = DfhConfig.PROPERTY_PK_TO_EXISTENCE_TIME_KEY[p.listDefinition.property.pkProperty]\n    if (p.items && p.items.length) t[key] = p.items[0].timePrimitive\n  })\n  return t;\n}\n"]}