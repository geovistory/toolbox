!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs/operators"),require("rxjs-spy/operators"),require("@angular/common"),require("@angular/core"),require("@kleiolab/lib-redux"),require("@angular-redux/store"),require("@kleiolab/lib-utils"),require("rxjs"),require("d3"),require("ramda"),require("@kleiolab/lib-sockets"),require("@kleiolab/lib-config"),require("@kleiolab/lib-sdk-lb3")):"function"==typeof define&&define.amd?define("@kleiolab/lib-queries/src/lib/queries",["exports","rxjs/operators","rxjs-spy/operators","@angular/common","@angular/core","@kleiolab/lib-redux","@angular-redux/store","@kleiolab/lib-utils","rxjs","d3","ramda","@kleiolab/lib-sockets","@kleiolab/lib-config","@kleiolab/lib-sdk-lb3"],t):t(((e=e||self).kleiolab=e.kleiolab||{},e.kleiolab["lib-queries"]=e.kleiolab["lib-queries"]||{},e.kleiolab["lib-queries"].src=e.kleiolab["lib-queries"].src||{},e.kleiolab["lib-queries"].src.lib=e.kleiolab["lib-queries"].src.lib||{},e.kleiolab["lib-queries"].src.lib.queries={}),e.rxjs.operators,e.operators$1,e.ng.common,e.ng.core,e.libRedux,e.store,e.libUtils,e.rxjs,e.d3,e.ramda,e.libSockets,e.libConfig,e.libSdkLb3)}(this,(function(e,t,n,i,r,p,o,s,a,u,c,l,f,y){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var _=function(e,t){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function d(e,t){function n(){this.constructor=e}_(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var m=function(){return(m=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function g(e,t,n,i){var r,p=arguments.length,o=p<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(o=(p<3?r(o):p>3?r(t,n,o):r(t,n))||o);return p>3&&o&&Object.defineProperty(t,n,o),o}function b(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function h(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function k(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,p=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=p.next()).done;)o.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}return o}function v(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(k(arguments[t]));return e}var P=function(e){return function(i,r,p){var o=m({refCount:!0},e),s=new Map,a=p.value;return p.value=function(){for(var e=[],p=0;p<arguments.length;p++)e[p]=arguments[p];var u=JSON.stringify(e);if(!s.has(u)){var c=a.bind(this);s.set(u,c.apply(void 0,v(e)).pipe(t.shareReplay({refCount:o.refCount,bufferSize:1}),n.tag("FROM-CACHE-"+i.constructor.name+"::"+r+"::"+e.join(":"))))}return s.get(u)},p}};function $(e,t,i){var r=i.value;return i.value=function(){for(var i=[],p=0;p<arguments.length;p++)i[p]=arguments[p];var o=r.bind(this);return o.apply(void 0,v(i)).pipe(n.tag(e.constructor.name+"::"+t+"::"+i.join(":")))},i}var j=function(){function e(e,t){var n=[];if(e&&n.push("ReduxQueriesModule is already loaded. Import in your base AppModule only."),t||n.push("You need to import the ReduxModule in your AppModule!"),n.length)throw new Error(n.join("\n"))}return e.decorators=[{type:r.NgModule,args:[{declarations:[],imports:[i.CommonModule],providers:[]}]}],e.ctorParameters=function(){return[{type:e,decorators:[{type:r.Optional},{type:r.SkipSelf}]},{type:p.ReduxModule,decorators:[{type:r.Optional}]}]},e}(),O=function(){function e(e,t,n){this.ngRedux=e,this.configs=t,this.model=n}return e.prototype.selector=function(e){var t=this;return{all$:this.ngRedux.select([p.datRoot,this.model,e]),key:function(n){return t.ngRedux.select([p.datRoot,t.model,e,n])}}},e}();var C=function(e){function n(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity__entity_version$=r.selector("by_pk_entity__entity_version"),r.by_pk_entity$=r.selector("by_pk_entity"),r.by_pk_text$=r.selector("by_pk_text"),r}return d(n,e),n.prototype.latestVersion=function(e){return this.by_pk_entity$.key(e).pipe(t.map((function(e){return s.latestVersion(e)})))},n}(O);var S=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_project$=r.selector("by_fk_project"),r}return d(t,e),t}(O);var R=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_text$=r.selector("by_fk_text"),r}return d(t,e),t}(O);var I=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_column$=r.selector("by_fk_column"),r}return d(t,e),t}(O);var T=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_digital$=r.selector("by_fk_digital"),r}return d(t,e),t}(O);var x=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_entity__fk_system_type$=r.selector("by_fk_entity__fk_system_type"),r}return d(t,e),t}(O);var w=function(e){function t(t){var n=e.call(this,t)||this;return n.ngRedux=t,n.digital$=new C(n.ngRedux,p.datDefinitions,"digital"),n.namespace$=new S(n.ngRedux,p.datDefinitions,"namespace"),n.chunk$=new R(n.ngRedux,p.datDefinitions,"chunk"),n.column$=new T(n.ngRedux,p.datDefinitions,"column"),n.class_column_mapping$=new I(n.ngRedux,p.datDefinitions,"class_column_mapping"),n.text_property$=new x(n.ngRedux,p.datDefinitions,"text_property"),n}return d(t,e),t.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:o.NgRedux}]},t.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new t(r.ɵɵinject(o.NgRedux))},token:t,providedIn:"root"}),t}(p.DatActions);var L=function(){function e(){this.shouldPause$=new a.BehaviorSubject(!1)}return e.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}();var E=function(){function e(e,t,n,i){this.ngRedux=e,this.configs=t,this.model=n,this.shouldPause$=i,this.slice$=this.ngRedux.select([p.dfhRoot,this.model])}return e.prototype.selector=function(e){var n=this,i=this.ngRedux.select([p.dfhRoot,this.model,e]);return{all$:this.shouldPause$.pipe(t.switchMap((function(e){return e?a.empty():i}))),key:function(i){return n.shouldPause$.pipe(t.switchMap((function(t){return t?a.empty():n.ngRedux.select([p.dfhRoot,n.model,e,i])})))},noPause:{all$:i,key:function(t){return n.ngRedux.select([p.dfhRoot,n.model,e,t])}}}},e}();var F=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.by_pk_profile$=t.selector("by_pk_profile"),t}return d(t,e),t}(E);var A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.by_pk_class$=t.selector("by_pk_class"),t.by_basic_type$=t.selector("by_basic_type"),t}return d(t,e),t}(E);var D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pk_property__has_domain__has_range$=t.selector("pk_property__has_domain__has_range"),t.by_pk_property$=t.selector("by_pk_property"),t.by_has_domain__pk_property$=t.selector("by_has_domain__pk_property"),t.by_has_range__pk_property$=t.selector("by_has_range__pk_property"),t.by_has_domain$=t.selector("by_has_domain"),t.by_has_range$=t.selector("by_has_range"),t.by_is_has_type_subproperty$=t.selector("by_is_has_type_subproperty"),t}return d(t,e),t}(E);var B=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.by_fks$=t.selector("by_fks"),t.by_fk_class__type$=t.selector("by_fk_class__type"),t.by_fk_property__type$=t.selector("by_fk_property__type"),t.by_fk_profile__type$=t.selector("by_fk_profile__type"),t}return d(t,e),t}(E);var M=function(e){function t(t,n){var i=e.call(this,t)||this;return i.ngRedux=t,i.pause=n,i.profile$=new F(i.ngRedux,p.dfhDefinitions,"profile",i.pause.shouldPause$),i.class$=new A(i.ngRedux,p.dfhDefinitions,"klass",i.pause.shouldPause$),i.property$=new D(i.ngRedux,p.dfhDefinitions,"property",i.pause.shouldPause$),i.label$=new B(i.ngRedux,p.dfhDefinitions,"label",i.pause.shouldPause$),i}return d(t,e),t.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:o.NgRedux},{type:L}]},t.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new t(r.ɵɵinject(o.NgRedux),r.ɵɵinject(L))},token:t,providedIn:"root"}),t}(p.DfhActions);var N=function(){function e(e,t,n,i){this.ngRedux=e,this.pkProject$=t,this.configs=n,this.model=i}return e.prototype.selector=function(e){var n=this;return{all$:this.pkProject$.pipe(t.switchMap((function(t){var i;return i=n.configs[n.model].facetteByPk?[p.infRoot,n.model,n.configs[n.model].facetteByPk,t,e]:[p.infRoot,n.model,e],n.ngRedux.select(i)}))),key:function(i){return n.pkProject$.pipe(t.switchMap((function(t){var r;return r=n.configs[n.model].facetteByPk?[p.infRoot,n.model,n.configs[n.model].facetteByPk,t,e,i]:[p.infRoot,n.model,e,i],n.ngRedux.select(r)})))}}},e.prototype.paginationSelector=function(){var e=this;return{pipePage:function(n){return e.pkProject$.pipe(t.switchMap((function(i){var r,o=p.paginateBy,a=p.createPaginateByKey(n);return r=e.configs[e.model].facetteByPk?[p.infRoot,e.model,e.configs[e.model].facetteByPk,i,o,a]:[p.infRoot,e.model,o,a],e.ngRedux.select(v(r,["count"])).pipe(t.filter((function(e){return void 0!==e})),t.switchMap((function(i){for(var p=n.offset,o=i<=p+n.limit?i:p+n.limit,a=[],u=p;u<o;u++)a.push(e.ngRedux.select(v(r,["rows",u])).pipe(t.filter((function(e){return!!e}))));return s.combineLatestOrEmpty(a)})))})))},pipeCount:function(n){return e.pkProject$.pipe(t.switchMap((function(t){var i,r=p.paginateBy,o=p.createPaginateByKey(n);return i=e.configs[e.model].facetteByPk?[p.infRoot,e.model,e.configs[e.model].facetteByPk,t,r,o]:[p.infRoot,e.model,r,o],e.ngRedux.select(v(i,["count"]))})))}}},e.prototype.pipeItemsInProject=function(e,n){var i=this;return a.pipe(t.switchMap((function(r){return e.pipe(t.switchMap((function(e){var p=[],o=function(o){if(r.hasOwnProperty(o)){var s=r[o];p.push(i.ngRedux.select(["pro","info_proj_rel","by_fk_project__fk_entity",e+"_"+n(s)]).pipe(t.map((function(e){return{key:o,rel:e}}))))}};for(var a in r)o(a);return s.combineLatestOrEmpty(p).pipe(t.map((function(e){for(var t={},n=0;n<e.length;n++){var i=e[n];i.rel&&i.rel.is_in_project&&(t[i.key]=r[i.key])}return t})))})))})))},e.prototype.pipeItemInProject=function(e,n){var i=this;return a.pipe(t.switchMap((function(r){return r?e.pipe(t.switchMap((function(e){return i.ngRedux.select(["pro","info_proj_rel","by_fk_project__fk_entity",e+"_"+n(r)]).pipe(t.map((function(e){return e&&1==e.is_in_project?r:void 0})))}))):a.of(void 0)})))},e}();var q=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p._by_pk_entity$=p.selector("by_pk_entity"),p._by_fk_class$=p.selector("by_fk_class"),p}return d(t,e),t.prototype.by_pk_entity_key$=function(e,t){void 0===t&&(t=!0);var n=this._by_pk_entity$.key(e);return t?n.pipe(this.pipeItemInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t.prototype.by_pk_entity_all$=function(e){void 0===e&&(e=!0);var t=this._by_pk_entity$.all$;return e?t.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):t},t.prototype.by_fk_class_key$=function(e,t){void 0===t&&(t=!0);var n=this._by_fk_class$.key(e);return t?n.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t}(N);var K=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p._by_pk_entity$=p.selector("by_pk_entity"),p}return d(t,e),t.prototype.by_pk_entity_key$=function(e,t){void 0===t&&(t=!0);var n=this._by_pk_entity$.key(e);return t?n.pipe(this.pipeItemInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t}(N);var W=function(e){function n(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p.by_pk_entity$=p.selector("by_pk_entity"),p.by_fk_subject_data$=p.selector("by_fk_subject_data"),p.pagination$=p.paginationSelector(),p}return d(n,e),n.prototype.by_pk_entity_key$=function(e,t){void 0===t&&(t=!0);var n=this.by_pk_entity$.key(e);return t?n.pipe(this.pipeItemInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},n.prototype.by_subject$=function(e,n){void 0===n&&(n=!0);var i=p.indexStatementBySubject(e),r=this.selector("by_subject").key(i);return n?r.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity})),t.map((function(e){return u.values(e)}))):r.pipe(t.map((function(e){return u.values(e)})))},n.prototype.by_subject_and_property$=function(e,n){return void 0===n&&(n=!0),this.by_subject_and_property_indexed$(e,n).pipe(t.map((function(e){return u.values(e)})))},n.prototype.by_subject_and_property_indexed$=function(e,t){void 0===t&&(t=!0);var n=p.indexStatementBySubjectProperty(e),i=this.selector("by_subject+property").key(n);return t?i.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):i},n.prototype.by_object$=function(e,n){void 0===n&&(n=!0);var i=p.indexStatementByObject(e),r=this.selector("by_object").key(i);return n?r.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity})),t.map((function(e){return u.values(e)}))):r.pipe(t.map((function(e){return u.values(e)})))},n.prototype.by_object_and_property$=function(e,n){return void 0===n&&(n=!0),this.by_object_and_property_indexed$(e,n).pipe(t.map((function(e){return u.values(e)})))},n.prototype.by_object_and_property_indexed$=function(e,t){void 0===t&&(t=!0);var n=p.indexStatementByObjectProperty(e),i=this.selector("by_object+property").key(n);return t?i.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):i},n}(N);var Y=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p._by_pk_entity$=p.selector("by_pk_entity"),p._by_fk_concerned_entity__fk_class_field$=p.selector("by_fk_concerned_entity__fk_class_field"),p._by_fk_concerned_entity$=p.selector("by_fk_concerned_entity"),p}return d(t,e),t.prototype.by_pk_entity_key$=function(e,t){void 0===t&&(t=!0);var n=this._by_pk_entity$.key(e);return t?n.pipe(this.pipeItemInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t.prototype.by_fk_concerned_entity__fk_class_field_indexed$=function(e,t){void 0===t&&(t=!0);var n=this._by_fk_concerned_entity__fk_class_field$.key(e);return t?n.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t.prototype.by_fk_concerned_entity_indexed$=function(e,t){void 0===t&&(t=!0);var n=this._by_fk_concerned_entity$.key(e);return t?n.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t}(N);var U=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p.by_pk_entity$=p.selector("by_pk_entity"),p}return d(t,e),t}(N);var G=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p.by_pk_entity$=p.selector("by_pk_entity"),p}return d(t,e),t}(N);var Q=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p.by_pk_entity$=p.selector("by_pk_entity"),p}return d(t,e),t}(N);var H=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p.by_pk_entity$=p.selector("by_pk_entity"),p}return d(t,e),t}(N);var V=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p.by_pk_entity$=p.selector("by_pk_entity"),p}return d(t,e),t}(N);var J=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p.by_pk_entity$=p.selector("by_pk_entity"),p}return d(t,e),t}(N);var X=function(){function e(e,t){this.ngRedux=e,this.pkProject$=t,this.persistent_item$=new q(this.ngRedux,this.pkProject$,p.infDefinitions,"persistent_item"),this.temporal_entity$=new K(this.ngRedux,this.pkProject$,p.infDefinitions,"temporal_entity"),this.statement$=new W(this.ngRedux,this.pkProject$,p.infDefinitions,"statement"),this.appellation$=new U(this.ngRedux,this.pkProject$,p.infDefinitions,"appellation"),this.place$=new Q(this.ngRedux,this.pkProject$,p.infDefinitions,"place"),this.text_property$=new Y(this.ngRedux,this.pkProject$,p.infDefinitions,"text_property"),this.lang_string$=new G(this.ngRedux,this.pkProject$,p.infDefinitions,"lang_string"),this.time_primitive$=new H(this.ngRedux,this.pkProject$,p.infDefinitions,"time_primitive"),this.language$=new V(this.ngRedux,this.pkProject$,p.infDefinitions,"language"),this.dimension$=new J(this.ngRedux,this.pkProject$,p.infDefinitions,"dimension"),this.pkEntityModelMap$=this.ngRedux.select([p.infRoot,p.PR_ENTITY_MODEL_MAP])}return e.prototype.getModelOfEntity$=function(e){return this.ngRedux.select([p.infRoot,p.PR_ENTITY_MODEL_MAP,e])},e}();var z=function(){function e(e,t,n){this.ngRedux=e,this.configs=t,this.model=n}return e.prototype.selector=function(e){var t=this;return{all$:this.ngRedux.select([p.proRoot,this.model,e]),key:function(n){var i="string"==typeof n?n:n.map((function(e){return c.toString(e)})).join("_");return t.ngRedux.select([p.proRoot,t.model,e,i])}}},e}();var Z=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r}return d(t,e),t}(z);var ee=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_fk_project__fk_entity$=r.selector("by_fk_project__fk_entity"),r}return d(t,e),t}(z);var te=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_fk_project__enabled_in_entities$=r.selector("by_fk_project__enabled_in_entities"),r.by_fk_project__fk_class$=r.selector("by_fk_project__fk_class"),r.by_fk_project$=r.selector("by_fk_project"),r}return d(t,e),t}(z);var ne=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_fk_project__enabled$=r.selector("by_fk_project__enabled"),r.by_fk_project__fk_profile$=r.selector("by_fk_project__fk_profile"),r.by_fk_project$=r.selector("by_fk_project"),r}return d(t,e),t}(z);var ie=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_fk_project__fk_class$=r.selector("by_fk_project__fk_class"),r.by_pk_entity$=r.selector("by_pk_entity"),r}return d(t,e),t}(z);var re=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_fks$=r.selector("by_fks"),r.by_fks_without_lang$=r.selector("by_fks_without_lang"),r}return d(t,e),t}(z);var pe=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r}return d(t,e),t}(z);var oe=function(e){function t(t){var n=e.call(this,t)||this;return n.ngRedux=t,n.project$=new Z(n.ngRedux,p.proDefinitions,"project"),n.info_proj_rel$=new ee(n.ngRedux,p.proDefinitions,"info_proj_rel"),n.dfh_class_proj_rel$=new te(n.ngRedux,p.proDefinitions,"dfh_class_proj_rel"),n.dfh_profile_proj_rel$=new ne(n.ngRedux,p.proDefinitions,"dfh_profile_proj_rel"),n.class_field_config$=new ie(n.ngRedux,p.proDefinitions,"class_field_config"),n.text_property$=new re(n.ngRedux,p.proDefinitions,"text_property"),n.analysis$=new pe(n.ngRedux,p.proDefinitions,"analysis"),n}return d(t,e),t.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:o.NgRedux}]},t.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new t(r.ɵɵinject(o.NgRedux))},token:t,providedIn:"root"}),t}(p.ProActions);var se=function(){function e(e,t,n){this.ngRedux=e,this.configs=t,this.model=n,this.slice$=this.ngRedux.select([p.sysRoot,this.model])}return e.prototype.selector=function(e){var t=this;return{all$:this.ngRedux.select([p.sysRoot,this.model,e]),key:function(n){return t.ngRedux.select([p.sysRoot,t.model,e,n])}}},e}();var ae=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_class$=r.selector("by_fk_class"),r.by_required_by_sources$=r.selector("by_required_by_sources"),r.by_required$=r.selector("by_required"),r}return d(t,e),t}(se);var ue=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.main$=r.ngRedux.select([p.sysRoot,r.model,"by_main","main"]),r}return d(t,e),t}(se);var ce=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.system_relevant_class$=new ae(t.ngRedux,p.sysDefinitions,"system_relevant_class"),t.config$=new ue(t.ngRedux,p.sysDefinitions,"config"),t}return d(t,e),t.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],t.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new t(r.ɵɵinject(o.NgRedux))},token:t,providedIn:"root"}),t}(p.SysActions);var le=function(){function e(e,t,n){this.ngRedux=e,this.configs=t,this.model=n}return e.prototype.selector=function(e){var t=this;return{all$:this.ngRedux.select([p.tabRoot,this.model,e]),key:function(n){return t.ngRedux.select([p.tabRoot,t.model,e,n])}}},e}();var fe=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_cell$=r.selector("by_pk_cell"),r.by_fk_column_fk_row$=r.selector("by_fk_column_fk_row"),r}return d(t,e),t}(le);var ye=function(e){function t(t){var n=e.call(this,t)||this;return n.ngRedux=t,n.cell$=new fe(n.ngRedux,p.tabDefinitions,"cell"),n}return d(t,e),t.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:o.NgRedux}]},t.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new t(r.ɵɵinject(o.NgRedux))},token:t,providedIn:"root"}),t}(p.TabActions);var _e=function(){function e(e,t,n){this.ngRedux=e,this.configs=t,this.model=n}return e.prototype.selector=function(e){var t=this;return{all$:this.ngRedux.select([p.warRoot,this.model,e]),key:function(n){var i="string"==typeof n?n:n.map((function(e){return c.toString(e)})).join("_");return t.ngRedux.select([p.warRoot,t.model,e,i])}}},e}();var de=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r}return d(t,e),t}(_e);var me=function(e){function t(t){var n=e.call(this,t)||this;return n.ngRedux=t,n.entity_preview$=new de(n.ngRedux,p.warDefinitions,"entity_preview"),n}return d(t,e),t.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:o.NgRedux}]},t.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new t(r.ɵɵinject(o.NgRedux))},token:t,providedIn:"root"}),t}(p.WarActions);var ge=function(){function e(e,n,i,r,p,o){this.dat$=n,this.tab$=i,this.pro$=r,this.dfh$=p,this.sys$=o;var s=e.select(["activeProject","pk_project"]).pipe(t.filter((function(e){return void 0!==e})),t.distinctUntilChanged((function(e,t){return e===t})));this.inf$=new X(e,s)}return e.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:o.NgRedux},{type:w},{type:ye},{type:oe},{type:M},{type:ce}]},e.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new e(r.ɵɵinject(o.NgRedux),r.ɵɵinject(w),r.ɵɵinject(ye),r.ɵɵinject(oe),r.ɵɵinject(M),r.ɵɵinject(ce))},token:e,providedIn:"root"}),e}();var be=function(){function e(e,n,i){var r=this;this.ngRedux=e,this.s=n,this.entityPreviewSocket=i,this.requestedEntityPreviews={},this.pkProject$=e.select(["activeProject","pk_project"]).pipe(t.filter((function(e){return void 0!==e})),t.distinctUntilChanged((function(e,t){return e===t}))),this.entityPreviewSocket.fromEvent("reconnect").subscribe((function(e){r.pkProject$.pipe(t.first()).subscribe((function(e){var t=Object.keys(m({},r.ngRedux.getState().war.entity_preview,r.requestedEntityPreviews));t.length&&r.entityPreviewSocket.emit("addToStream",{pkProject:e,pks:t})}))}))}return e.prototype.pipeActiveProject=function(){var e=this;return this.pkProject$.pipe(t.switchMap((function(t){return e.s.pro$.project$.by_pk_entity$.key(t.toString())}))).pipe(t.filter((function(e){return!!e})))},e.prototype.pipeActiveDefaultLanguage=function(){var e=this;return this.pipeActiveProject().pipe(t.filter((function(e){return!!e})),t.switchMap((function(t){return e.s.inf$.language$.by_pk_entity$.key(t.fk_language.toString())}))).pipe(t.filter((function(e){return!!e})))},e.prototype.streamEntityPreview=function(e,n){var i=this;return(!(((this.ngRedux.getState().war||{}).entity_preview||{}).by_pk_entity||{})[e]&&!this.requestedEntityPreviews[e]||n)&&this.pkProject$.pipe(t.first((function(e){return!!e}))).subscribe((function(t){i.entityPreviewSocket.emit("addToStream",{pkProject:t,pks:[e]}),i.requestedEntityPreviews[e]=!0})),this.ngRedux.select(["war","entity_preview","by_pk_entity",e]).pipe(t.distinctUntilChanged(c.equals),t.filter((function(e){return!!e})))},e.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:o.NgRedux},{type:ge},{type:l.EntityPreviewSocket}]},e.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new e(r.ɵɵinject(o.NgRedux),r.ɵɵinject(ge),r.ɵɵinject(l.EntityPreviewSocket))},token:e,providedIn:"root"}),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",a.Observable)],e.prototype,"pipeActiveProject",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",a.Observable)],e.prototype,"pipeActiveDefaultLanguage",null),e}();var he=function(){function e(e,t){this.a=e,this.s=t}return e.prototype.pipeProfilesEnabledByProject=function(){var e=this;return this.a.pkProject$.pipe(t.switchMap((function(n){return e.s.pro$.dfh_profile_proj_rel$.by_fk_project__enabled$.key(n+"_true").pipe(t.map((function(e){return c.values(e).filter((function(e){return e.enabled})).map((function(e){return e.fk_profile}))})),t.map((function(e){return v(e,[f.DfhConfig.PK_PROFILE_GEOVISTORY_BASIC])})))})))},e.prototype.pipeFields=function(e){var n=this;return a.combineLatest(this.s.dfh$.class$.by_pk_class$.key(e),this.s.dfh$.property$.by_has_domain$.key(e).pipe(t.map((function(e){return c.values(e)}))),this.s.dfh$.property$.by_has_range$.key(e).pipe(t.map((function(e){return c.values(e)}))),this.s.sys$.config$.main$.pipe(t.filter((function(e){return!!e}))),this.pipeProfilesEnabledByProject()).pipe(t.switchMap((function(i){var r,p,o=k(i,5),s=o[0],u=o[1],l=o[2],y=o[3],_=o[4];return e!==f.DfhConfig.CLASS_PK_APPELLATION_FOR_LANGUAGE&&l.push((r=e,p=[{removed_from_api:!1,fk_profile:f.DfhConfig.PK_PROFILE_GEOVISTORY_BASIC}],{has_domain:f.DfhConfig.CLASS_PK_APPELLATION_FOR_LANGUAGE,pk_property:f.DfhConfig.PROPERTY_PK_IS_APPELLATION_OF,has_range:r,domain_instances_max_quantifier:-1,domain_instances_min_quantifier:0,range_instances_max_quantifier:1,range_instances_min_quantifier:1,identifier_in_namespace:"histP9",identity_defining:!0,is_inherited:!0,is_has_type_subproperty:!1,profiles:p})),9===s.basic_type&&u.push(function(e){var t=[{removed_from_api:!1,fk_profile:f.DfhConfig.PK_PROFILE_GEOVISTORY_BASIC}];return{has_domain:e,pk_property:f.DfhConfig.PROPERTY_PK_HAS_TIME_SPAN,has_range:f.DfhConfig.ClASS_PK_TIME_SPAN,domain_instances_max_quantifier:1,domain_instances_min_quantifier:1,range_instances_max_quantifier:1,range_instances_min_quantifier:0,identifier_in_namespace:"P4",identity_defining:!1,is_inherited:!0,is_has_type_subproperty:!1,profiles:t}}(e)),u.push(function(e){var t=[{removed_from_api:!1,fk_profile:f.DfhConfig.PK_PROFILE_GEOVISTORY_BASIC}];return{has_domain:e,pk_property:f.DfhConfig.PROPERTY_PK_P18_HAS_DEFINITION,has_range:785,domain_instances_max_quantifier:-1,domain_instances_min_quantifier:1,range_instances_max_quantifier:1,range_instances_min_quantifier:1,identifier_in_namespace:"P18",identity_defining:!1,is_inherited:!0,is_has_type_subproperty:!1,profiles:t}}(e)),a.combineLatest(n.pipePropertiesToSubfields(u,!0,_,y),n.pipePropertiesToSubfields(l,!1,_,y),n.pipeFieldConfigs(e)).pipe(t.map((function(e){var t,n,i=k(e,3),r=i[0],p=i[1],o=i[2],s=v(r,p),a=c.indexBy((function(e){return[e.fk_domain_class||e.fk_range_class,e.fk_property,!!e.fk_domain_class].join("_")}),o),u={},l={};try{for(var _=h(s),d=_.next();!d.done;d=_.next()){var m=d.value,g=[m.sourceClass,m.property.pkProperty,m.isOutgoing].join("_"),b=[m.sourceClass,m.property.pkProperty,m.isOutgoing,m.targetClass].join("_"),P=a[g];if(u[g])l[b]||(!1===u[g].allSubfieldsRemovedFromAllProfiles?u[g].allSubfieldsRemovedFromAllProfiles=!1:u[g].allSubfieldsRemovedFromAllProfiles=m.removedFromAllProfiles,u[g].targetClasses.push(m.targetClass),u[g].listDefinitions.push(m));else{var $=!1;m.isHasTypeField?$="has-type":m.property.pkProperty===f.DfhConfig.PROPERTY_PK_HAS_TIME_SPAN&&($="time-span"),u[g]={sourceClass:m.sourceClass,sourceClassLabel:m.sourceClassLabel,sourceMaxQuantity:m.sourceMaxQuantity,sourceMinQuantity:m.sourceMinQuantity,targetMinQuantity:m.targetMinQuantity,targetMaxQuantity:m.targetMaxQuantity,label:m.label,isHasTypeField:m.isHasTypeField,property:m.property,isOutgoing:m.isOutgoing,identityDefiningForSource:m.identityDefiningForSource,identityDefiningForTarget:m.identityDefiningForTarget,ontoInfoLabel:m.ontoInfoLabel,ontoInfoUrl:m.ontoInfoUrl,allSubfieldsRemovedFromAllProfiles:m.removedFromAllProfiles,targetClasses:[m.targetClass],listDefinitions:[m],fieldConfig:P,placeOfDisplay:ve(y.specialFields,m,P),isSpecialField:$},l[b]=!0}}}catch(e){t={error:e}}finally{try{d&&!d.done&&(n=_.return)&&n.call(_)}finally{if(t)throw t.error}}return c.values(u)})))})))},e.prototype.pipeSpecificFieldOfClass=function(e){return this.pipeFields(e).pipe(t.map((function(e){return e.filter((function(e){return e.placeOfDisplay.specificFields})).sort((function(e,t){return e.placeOfDisplay.specificFields.position-t.placeOfDisplay.specificFields.position}))})))},e.prototype.pipeBasicFieldsOfClass=function(e){return this.pipeFields(e).pipe(t.map((function(e){return e.filter((function(e){return e.placeOfDisplay.basicFields})).sort((function(e,t){return e.placeOfDisplay.basicFields.position-t.placeOfDisplay.basicFields.position}))})))},e.prototype.pipeFieldsForTeEnForm=function(e){return this.pipeFields(e).pipe(t.map((function(e){var t=e.filter((function(e){return e.placeOfDisplay.specificFields})).sort((function(e,t){return e.placeOfDisplay.specificFields.position-e.placeOfDisplay.specificFields.position})),n=e.find((function(e){return e.property.pkProperty===f.DfhConfig.PROPERTY_PK_HAS_TIME_SPAN}));n&&t.push(n);var i=e.find((function(e){return e.isHasTypeField}));return i&&t.push(i),t})))},e.prototype.pipeBasicAndSpecificFields=function(e){return a.combineLatest(this.pipeBasicFieldsOfClass(e),this.pipeSpecificFieldOfClass(e)).pipe(t.map((function(e){var t=k(e,2);return v(t[0],t[1])})))},e.prototype.pipeSpecificAndBasicFields=function(e){return a.combineLatest(this.pipeSpecificFieldOfClass(e),this.pipeBasicFieldsOfClass(e)).pipe(t.map((function(e){var t=k(e,2);return v(t[0],t[1])})))},e.prototype.pipePropertiesToSubfields=function(e,n,i,r){var p=this;return s.combineLatestOrEmpty(e.map((function(e){var o=n,s=o?e.has_range:e.has_domain,u=o?e.has_domain:e.has_range,c=o?e.range_instances_max_quantifier:e.domain_instances_max_quantifier,l=o?e.domain_instances_max_quantifier:e.range_instances_max_quantifier,f=o?e.range_instances_min_quantifier:e.domain_instances_min_quantifier,y=o?e.domain_instances_min_quantifier:e.range_instances_min_quantifier;return a.combineLatest(p.pipeClassLabel(u),p.pipeClassLabel(s),p.pipeSubfieldTypeOfClass(r,s,c),p.pipeFieldLabel(e.pk_property,n?e.has_domain:null,n?null:e.has_range)).pipe(t.map((function(t){var n=k(t,4),r=n[0],p=n[1],a=n[2],_=n[3];return{listType:a,sourceClass:u,sourceClassLabel:r,sourceMaxQuantity:l,sourceMinQuantity:y,targetClass:s,targetClassLabel:p,targetMinQuantity:f,targetMaxQuantity:c,label:_,isHasTypeField:o&&e.is_has_type_subproperty,property:{pkProperty:e.pk_property},isOutgoing:o,identityDefiningForSource:!!o&&e.identity_defining,identityDefiningForTarget:!o&&e.identity_defining,ontoInfoLabel:e.identifier_in_namespace,ontoInfoUrl:"https://ontome.dataforhistory.org/property/"+e.pk_property,removedFromAllProfiles:ke(i,e.profiles||[])}})))})))},e.prototype.pipeSubfieldTypeOfClass=function(e,n,i){return this.s.dfh$.class$.by_pk_class$.key(n).pipe(t.filter((function(e){return!!e})),t.map((function(t){return function(e,t,n){var i;e&&(i=e.classes[t.pk_class]);return i&&i.valueObjectType?i.valueObjectType:30===t.basic_type&&1==n?{typeItem:"true"}:8===t.basic_type||30===t.basic_type?{entityPreview:"true"}:{temporalEntity:"true"}}(e,t,i)})))},e.prototype.pipeFieldConfigs=function(e){var n=this;return this.a.pkProject$.pipe(t.switchMap((function(i){var r=p.proClassFieldConfgByProjectAndClassKey({fk_class_for_class_field:e,fk_project:i}),o=p.proClassFieldConfgByProjectAndClassKey({fk_class_for_class_field:e,fk_project:f.ProConfig.PK_PROJECT_OF_DEFAULT_CONFIG_PROJECT});return a.combineLatest(n.s.pro$.class_field_config$.by_fk_project__fk_class$.key(r),n.s.pro$.class_field_config$.by_fk_project__fk_class$.key(o)).pipe(t.map((function(e){var t=k(e,2),n=t[0],i=t[1];return n&&c.values(n).length?n:i})),t.map((function(e){return c.values(e).sort((function(e,t){return e.ord_num>t.ord_num?1:-1}))})))})))},e.prototype.pipeClassLabel=function(e){var n=this;return a.combineLatest(this.a.pkProject$,this.a.pipeActiveDefaultLanguage()).pipe(t.switchMap((function(i){var r=k(i,2),p=r[0],o=r[1];return n.pipeLabels({pkClass:e,fkProject:p,language:o,type:"label"}).pipe(t.map((function(t){var n=t.find((function(e){return!!e}));return n?n.text:"* no label (id: "+e+") *"})))})))},e.prototype.pipeLabels=function(e){var n;if(e.pkClass)switch(e.type){case"label":n=f.SysConfig.PK_SYSTEM_TYPE__TEXT_PROPERTY__LABEL;break;default:console.warn("fk_system_type not found")}else if(e.fkProperty)switch(e.type){case"label":n=f.SysConfig.PK_SYSTEM_TYPE__TEXT_PROPERTY__LABEL;break;default:console.warn("fk_system_type not found")}return a.combineLatest(this.pipeProTextProperty({fk_project:e.fkProject,fk_language:e.language.pk_entity,fk_system_type:n,fk_dfh_class:e.pkClass,fk_dfh_property:e.fkProperty,fk_dfh_property_domain:e.fkPropertyDomain,fk_dfh_property_range:e.fkPropertyRange}).pipe(t.map((function(e){if(e){return{origin:"of project in project lang",text:e.string}}}))),this.pipeProTextProperty({fk_project:f.ProConfig.PK_PROJECT_OF_DEFAULT_CONFIG_PROJECT,fk_language:e.language.pk_entity,fk_system_type:n,fk_dfh_class:e.pkClass,fk_dfh_property:e.fkProperty,fk_dfh_property_domain:e.fkPropertyDomain,fk_dfh_property_range:e.fkPropertyRange}).pipe(t.map((function(e){if(e){return{origin:"of default project in project lang",text:e.string}}}))),this.pipeProTextProperty({fk_project:f.ProConfig.PK_PROJECT_OF_DEFAULT_CONFIG_PROJECT,fk_language:18889,fk_system_type:n,fk_dfh_class:e.pkClass,fk_dfh_property:e.fkProperty,fk_dfh_property_domain:e.fkPropertyDomain,fk_dfh_property_range:e.fkPropertyRange}).pipe(t.map((function(e){if(e){return{origin:"of default project in english",text:e.string}}}))),this.pipeDfhLabel({language:e.language.iso6391.trim(),type:"label",fk_class:e.pkClass,fk_property:e.fkProperty}).pipe(t.map((function(e){if(e){return{origin:"of ontome in project lang",text:e.label}}}))),this.pipeDfhLabel({language:"en",type:"label",fk_class:e.pkClass,fk_property:e.fkProperty}).pipe(t.map((function(e){if(e){return{origin:"of ontome in english",text:e.label}}}))))},e.prototype.pipeProTextProperty=function(e){var t=p.textPropertyByFksKey(e);return this.s.pro$.text_property$.by_fks$.key(t)},e.prototype.pipeDfhLabel=function(e){var t=p.dfhLabelByFksKey(e);return this.s.dfh$.label$.by_fks$.key(t)},e.prototype.pipeFieldLabel=function(e,n,i){var r=this,p=!!n;return a.combineLatest(this.a.pkProject$,this.a.pipeActiveDefaultLanguage()).pipe(t.switchMap((function(o){var s=k(o,2),a=s[0],u=s[1];return r.pipeLabels({fkProject:a,type:"label",language:u,fkProperty:e,fkPropertyDomain:n,fkPropertyRange:i}).pipe(t.map((function(t){var n="* no label (id: "+e+") *";return t.some((function(e){return!e||"of project in project lang"!==e.origin&&"of default project in project lang"!==e.origin&&"of default project in english"!==e.origin?!e||"of ontome in project lang"!==e.origin&&"of ontome in english"!==e.origin?void 0:(n=p?e.text:"* reverse of: "+e.text+"*",!0):(n=e.text,!0)})),n})))})))},e.prototype.pipeTableNameOfClass=function(e){return a.combineLatest(this.s.sys$.config$.main$,this.s.dfh$.class$.by_pk_class$.key(e)).pipe(t.filter((function(e){return!e.includes(void 0)})),t.map((function(t){var n=k(t,2),i=n[0],r=n[1],p=i.classes[e];if(!p||!p.valueObjectType)return 8===r.basic_type||30===r.basic_type?"persistent_item":"temporal_entity";var o=Object.keys(p.valueObjectType);if(!p.valueObjectType.appellation){o[0];return p.valueObjectType.appellation?"appellation":p.valueObjectType.language?"language":p.valueObjectType.place?"place":p.valueObjectType.timePrimitive?"time_primitive":p.valueObjectType.langString?"lang_string":p.valueObjectType.dimension?"dimension":void console.warn("unsupported list type")}})))},e.prototype.pipeClassesInEntitiesOrSources=function(){return a.combineLatest(this.pipeClassesEnabledInEntities(),this.pipeClassesRequiredBySources()).pipe(t.map((function(e){var t=k(e,2),n=t[0],i=t[1];return c.indexBy((function(e){return e.toString()}),c.uniq(v(n,i)))})),t.startWith({}))},e.prototype.pipeClassesRequiredBySources=function(){return this.s.sys$.system_relevant_class$.by_required_by_sources$.key("true").pipe(t.map((function(e){return c.values(e).map((function(e){return e.fk_class}))})))},e.prototype.pipeClassesEnabledByProjectProfiles=function(){var e=this;return this.a.pkProject$.pipe(t.switchMap((function(n){return a.combineLatest([e.s.dfh$.class$.by_pk_class$.all$,e.pipeProfilesEnabledByProject()]).pipe(t.map((function(e){var t=k(e,2),n=t[0],i=t[1],r=c.indexBy((function(e){return e.toString()}),c.values(i));return c.values(n).filter((function(e){return e.profiles.some((function(e){return r[e.fk_profile]}))}))})))})))},e.prototype.pipeTypeClassesEnabledByProjectProfiles=function(){return a.combineLatest([this.s.dfh$.class$.by_basic_type$.key(30),this.pipeProfilesEnabledByProject()]).pipe(t.map((function(e){var t=k(e,2),n=t[0],i=t[1],r=c.indexBy((function(e){return e.toString()}),c.values(i));return c.values(n).filter((function(e){return e.profiles.some((function(e){return r[e.fk_profile]}))&&![f.DfhConfig.CLASS_PK_LANGUAGE,f.DfhConfig.CLASS_PK_MANIFESTATION_PRODUCT_TYPE].includes(e.pk_class)}))})))},e.prototype.pipeClassesEnabledInEntities=function(){var e=this;return this.a.pkProject$.pipe(t.switchMap((function(n){return e.s.pro$.dfh_class_proj_rel$.by_fk_project__enabled_in_entities$.key(n+"_true").pipe(t.map((function(e){return c.values(e).map((function(e){return e.fk_class}))})))})))},e.prototype.pipeSelectedTeEnClassesInProject=function(){return a.combineLatest(this.pipeTeEnClassesEnabledInEntities(),this.pipeTeEnClassesRequiredBySources()).pipe(t.map((function(e){var t=k(e,2),n=t[0],i=t[1];return c.indexBy((function(e){return e.toString()}),c.uniq(v(n,i)))})),t.startWith({}))},e.prototype.pipeTeEnClassesEnabledInEntities=function(){var e=this;return this.a.pkProject$.pipe(t.switchMap((function(n){return e.s.pro$.dfh_class_proj_rel$.by_fk_project__enabled_in_entities$.key(n+"_true").pipe(t.switchMap((function(n){return a.combineLatest(c.values(n).map((function(n){return e.s.dfh$.class$.by_pk_class$.key(n.fk_class).pipe(t.filter((function(e){return!!e})))}))).pipe(t.map((function(t){return e.filterTeEnCasses(t)})))})))})))},e.prototype.filterTeEnCasses=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];9===i.basic_type&&t.push(i.pk_class)}return t},e.prototype.pipeTeEnClassesRequiredBySources=function(){var e=this;return this.s.sys$.system_relevant_class$.by_required_by_sources$.key("true").pipe(t.switchMap((function(n){return a.combineLatest(c.values(n).map((function(n){return e.s.dfh$.class$.by_pk_class$.key(n.fk_class).pipe(t.filter((function(e){return!!e})))}))).pipe(t.map((function(t){return e.filterTeEnCasses(t)})))})))},e.prototype.pipeTypeAndTypedClasses=function(e){var n,i=this,r=this.s.sys$.system_relevant_class$.by_required_by_sources$.key("true").pipe(t.map((function(e){return c.values(e).map((function(e){return e.fk_class}))}))),p=this.pipeClassesEnabledInEntities();return n="sources"===e?[r]:"entities"===e?[p]:[r,p],a.combineLatest(n).pipe(t.map((function(e){return c.uniq(c.flatten(e))})),t.switchMap((function(e){return i.pipeTypeAndTypedClassesOfTypedClasses(e)})))},e.prototype.pipeTypeAndTypedClassesOfTypedClasses=function(e){return this.s.dfh$.property$.by_is_has_type_subproperty$.key("true").pipe(t.map((function(t){var n=c.indexBy((function(e){return e.has_domain.toString()}),c.values(t));return e.map((function(e){return{typedClass:e,typeClass:n[e]?n[e].has_range:void 0}}))})))},e.prototype.pipeTypeClassOfTypedClass=function(e){return this.s.dfh$.property$.by_is_has_type_subproperty$.key("true").pipe(t.map((function(t){var n=c.indexBy((function(e){return e.has_domain.toString()}),c.values(t));return n[e]?n[e].has_range:void 0})))},e.prototype.pipeTypedClassesOfTypeClasses=function(e){return this.s.dfh$.property$.by_is_has_type_subproperty$.key("true").pipe(t.map((function(t){var n=c.indexBy((function(e){return e.has_range.toString()}),c.values(t));return e.map((function(e){return n[e]?n[e].has_domain:void 0}))})))},e.prototype.pipeTypePropertyOfTypedClass=function(e){return this.s.dfh$.property$.by_is_has_type_subproperty$.key("true").pipe(t.map((function(t){var n=c.values(t).find((function(t){return t.has_domain===e}));return n?n.pk_property:void 0})))},e.prototype.pipeTargetClassesOfProperties=function(e,n){return this.s.dfh$.property$.by_pk_property$.all$.pipe(t.map((function(t){if(!e||!e.length)return[];var i=[],r={};return e.forEach((function(e){c.values(t[e]).forEach((function(e){var t=n?e.has_range:e.has_domain;r[t]||(r[t]=!0,i.push(t))}))})),i})))},e.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:be},{type:ge}]},e.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new e(r.ɵɵinject(be),r.ɵɵinject(ge))},token:e,providedIn:"root"}),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",a.Observable)],e.prototype,"pipeProfilesEnabledByProject",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeFields",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeSpecificFieldOfClass",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeBasicFieldsOfClass",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeFieldsForTeEnForm",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeBasicAndSpecificFields",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeSpecificAndBasicFields",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Array,Boolean,Array,Object]),b("design:returntype",a.Observable)],e.prototype,"pipePropertiesToSubfields",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Object,Number,Number]),b("design:returntype",a.Observable)],e.prototype,"pipeSubfieldTypeOfClass",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeFieldConfigs",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeClassLabel",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",a.Observable)],e.prototype,"pipeLabels",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",a.Observable)],e.prototype,"pipeProTextProperty",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",a.Observable)],e.prototype,"pipeDfhLabel",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number,Number,Number]),b("design:returntype",a.Observable)],e.prototype,"pipeFieldLabel",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeTableNameOfClass",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",a.Observable)],e.prototype,"pipeClassesInEntitiesOrSources",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",void 0)],e.prototype,"pipeClassesRequiredBySources",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",a.Observable)],e.prototype,"pipeClassesEnabledByProjectProfiles",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",a.Observable)],e.prototype,"pipeTypeClassesEnabledByProjectProfiles",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",void 0)],e.prototype,"pipeClassesEnabledInEntities",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",a.Observable)],e.prototype,"pipeSelectedTeEnClassesInProject",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",void 0)],e.prototype,"pipeTeEnClassesEnabledInEntities",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",void 0)],e.prototype,"pipeTeEnClassesRequiredBySources",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[String]),b("design:returntype",a.Observable)],e.prototype,"pipeTypeAndTypedClasses",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Array]),b("design:returntype",a.Observable)],e.prototype,"pipeTypeAndTypedClassesOfTypedClasses",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",a.Observable)],e.prototype,"pipeTypeClassOfTypedClass",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Array]),b("design:returntype",a.Observable)],e.prototype,"pipeTypedClassesOfTypeClasses",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",a.Observable)],e.prototype,"pipeTypePropertyOfTypedClass",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Array,Boolean]),b("design:returntype",a.Observable)],e.prototype,"pipeTargetClassesOfProperties",null),e}();function ke(e,t){return!t.some((function(t){return!1===t.removed_from_api&&e.includes(t.fk_profile)}))}function ve(e,t,n){var i;if(i=function(e,t,n){e.isOutgoing?e.isHasTypeField&&t.hasTypeSubproperties?n=t.hasTypeSubproperties:t.bySourceClass&&t.bySourceClass[e.sourceClass]&&t.bySourceClass[e.sourceClass].outgoingProperties&&t.bySourceClass[e.sourceClass].outgoingProperties[e.property.pkProperty]?n=t.bySourceClass[e.sourceClass].outgoingProperties[e.property.pkProperty]:t.outgoingProperties&&t.outgoingProperties[e.property.pkProperty]&&(n=t.outgoingProperties[e.property.pkProperty]):t.bySourceClass&&t.bySourceClass[e.sourceClass]&&t.bySourceClass[e.sourceClass].incomingProperties&&t.bySourceClass[e.sourceClass].incomingProperties[e.property.pkProperty]?n=t.bySourceClass[e.sourceClass].incomingProperties[e.property.pkProperty]:t.incomingProperties&&t.incomingProperties[e.property.pkProperty]&&(n=t.incomingProperties[e.property.pkProperty]);return n}(t,e,i)){if(i.displayInBasicFields)return{basicFields:{position:i.displayInBasicFields.position}};if(i.hidden)return{hidden:!0}}var r=Number.POSITIVE_INFINITY;return n&&(r=n.ord_num),{specificFields:{position:r}}}var Pe=function(){function e(e,n){var i=this;this.p=e,this.s=n,this.timePrimitiveOfStatements=function(){return a.pipe(t.map((function(e){return e[0]})),t.switchMap((function(e){return e?i.pipeInfTimePrimitive(e.fk_object_info).pipe(t.switchMap((function(n){return i.p.pkProject$.pipe(t.switchMap((function(r){return i.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(r+"_"+e[0].pk_entity).pipe(t.filter((function(e){return!!e})),t.map((function(e){return{calendar:e.calendar?e.calendar:"gregorian",julianDay:n.julian_day,duration:n.duration}})))})))}))):new a.BehaviorSubject(void 0)})))}}return e.prototype.pipeStatements=function(e,t){return t?this.pipeOutgoingStatements(e):this.pipeIngoingStatements(e)},e.prototype.pipeOutgoingStatements=function(e){return this.s.inf$.statement$.by_subject$({fk_subject_info:e})},e.prototype.pipeIngoingStatements=function(e){return this.s.inf$.statement$.by_object$({fk_object_info:e})},e.prototype.pipeStatementsOfList=function(e,t){return e.isOutgoing?this.s.inf$.statement$.by_subject_and_property$({fk_property:e.property.pkProperty,fk_property_of_property:e.property.pkPropertyOfProperty,fk_subject_info:t}):this.s.inf$.statement$.by_object_and_property$({fk_property:e.property.pkProperty,fk_property_of_property:e.property.pkPropertyOfProperty,fk_object_info:t})},e.prototype.pipeOutgoingStatementsByProperty=function(e,t){return this.s.inf$.statement$.by_subject_and_property$({fk_property:e,fk_subject_info:t})},e.prototype.pipeIngoingStatementsByProperty=function(e,t){return this.s.inf$.statement$.by_object_and_property$({fk_property:e,fk_object_info:t})},e.prototype.pipeOutgoingBasicStatementItemsByProperty=function(e,n,i){var r=this;return this.s.inf$.statement$.by_subject_and_property$({fk_property:e,fk_subject_info:n}).pipe(t.switchMap((function(e){return s.combineLatestOrEmpty(e.map((function(e){return r.pipeBasicStatementItem(i,e,!0)})))})))},e.prototype.pipeIngoingBasicStatementItemsByProperty=function(e,n,i){var r=this;return this.s.inf$.statement$.by_object_and_property$({fk_property:e,fk_object_info:n}).pipe(t.switchMap((function(e){return s.combineLatestOrEmpty(e.map((function(e){return r.pipeBasicStatementItem(i,e,!1)})))})))},e.prototype.pipeBasicStatementItem=function(e,n,i){return this.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(e+"_"+n.pk_entity).pipe(t.filter((function(e){return!!e})),t.map((function(e){return{projRel:e,statement:n,label:"",ordNum:i?e.ord_num_of_range:e.ord_num_of_domain,isOutgoing:i}})))},e.prototype.pipeBasicStatementItemByPkStatement=function(e,n,i){var r=this;return this.s.inf$.statement$.by_pk_entity_key$(n).pipe(t.switchMap((function(t){return t?r.pipeBasicStatementItem(e,t,i):a.of(void 0)})))},e.prototype.pipeInfTimePrimitive=function(e){return this.s.inf$.time_primitive$.by_pk_entity$.key(e)},e.prototype.pipeTimeSpan=function(e){return a.combineLatest(this.pipeOutgoingStatementsByProperty(72,e).pipe(this.timePrimitiveOfStatements()),this.pipeOutgoingStatementsByProperty(71,e).pipe(this.timePrimitiveOfStatements()),this.pipeOutgoingStatementsByProperty(150,e).pipe(this.timePrimitiveOfStatements()),this.pipeOutgoingStatementsByProperty(151,e).pipe(this.timePrimitiveOfStatements()),this.pipeOutgoingStatementsByProperty(152,e).pipe(this.timePrimitiveOfStatements()),this.pipeOutgoingStatementsByProperty(153,e).pipe(this.timePrimitiveOfStatements())).pipe(t.map((function(e){var t=k(e,6),n=t[0],i=t[1],r=t[2],p=t[3],o=t[4],a=t[5];return new s.TimeSpanUtil({p82:n,p81:i,p82a:o,p81a:r,p81b:p,p82b:a})})))},e.prototype.pipeClassOfEntity=function(e){return a.merge(this.s.inf$.persistent_item$.by_pk_entity_key$(e).pipe(t.filter((function(e){return!!e})),t.map((function(e){return e.fk_class}))),this.s.inf$.temporal_entity$.by_pk_entity_key$(e).pipe(t.filter((function(e){return!!e})),t.map((function(e){return e.fk_class}))))},e.prototype.pipeClassesOfPersistentItems=function(e){return this.s.inf$.persistent_item$.by_pk_entity_all$().pipe(t.map((function(t){if(!e||0===e.length)return[];var n={},i=[];return e.forEach((function(e){n[t[e].fk_class]||(n[t[e].fk_class]=!0,i.push(t[e].fk_class))})),i})))},e.prototype.pipeRepoOutgoingStatements=function(e){return this.s.inf$.statement$.by_subject$({fk_subject_info:e},!1)},e.prototype.pipeRepoIngoingStatements=function(e){return this.s.inf$.statement$.by_object$({fk_object_info:e},!1)},e.prototype.pipeRepoOutgoingStatementsByProperty=function(e,n){var i=this;return a.combineLatest(this.s.dfh$.property$.by_pk_property$.key(e).pipe(t.filter((function(e){return!!e&&Object.keys(e).length>0})),t.map((function(e){return c.values(e)[0].range_instances_max_quantifier}))),this.s.inf$.statement$.by_subject_and_property$({fk_property:e,fk_subject_info:n},!1)).pipe(t.map((function(e){var t=k(e,2),n=t[0],r=t[1];if(0===r.length)return r;var p=i.sortStatementsByRepoPopularity(r);return-1===n||null===n?p:p.slice(0,n)})))},e.prototype.pipeRepoIngoingStatementsByProperty=function(e,n){var i=this;return a.combineLatest(this.s.dfh$.property$.by_pk_property$.key(e).pipe(t.filter((function(e){return!!e&&Object.keys(e).length>0})),t.map((function(e){return c.values(e)[0].domain_instances_max_quantifier}))),this.s.inf$.statement$.by_object_and_property$({fk_property:e,fk_object_info:n},!1)).pipe(t.map((function(e){var t=k(e,2),n=t[0],r=t[1];if(0===r.length)return r;var p=i.sortStatementsByRepoPopularity(r);return-1===n||null===n?p:p.slice(0,n)})))},e.prototype.pipeAlternativeBasicStatementItemByPkStatement=function(e,n){return a.combineLatest(this.s.inf$.statement$.by_pk_entity_key$(e,!1),this.s.inf$.statement$.by_pk_entity_key$(e)).pipe(t.filter((function(e){return!!k(e,1)[0]})),t.map((function(e){var t=k(e,2),i=t[0];if(!t[1])return{projRel:void 0,statement:i,ordNum:void 0,isOutgoing:n,label:""}})))},e.prototype.pipeAlternativeIngoingStatements=function(e,n){return a.combineLatest(this.s.inf$.statement$.by_object_and_property_indexed$({fk_property:e,fk_object_info:n},!1),this.s.inf$.statement$.by_object_and_property_indexed$({fk_property:e,fk_object_info:n}).pipe(t.map((function(e){return e?Object.keys(e):[]})))).pipe(t.map((function(e){var t=k(e,2),n=t[0],i=t[1];return c.omit(i,n)})),t.map((function(e){return c.values(e)})))},e.prototype.pipeAlternativeOutgoingStatements=function(e,n){return a.combineLatest(this.s.inf$.statement$.by_subject_and_property_indexed$({fk_property:e,fk_subject_info:n},!1),this.s.inf$.statement$.by_subject_and_property_indexed$({fk_property:e,fk_subject_info:n}).pipe(t.map((function(e){return e?Object.keys(e):[]})))).pipe(t.map((function(e){var t=k(e,2),n=t[0],i=t[1];return c.omit(i,n)})),t.map((function(e){return c.values(e)})))},e.prototype.pipePersistentItemPksByClass=function(e){return this.s.inf$.persistent_item$.by_fk_class_key$(e).pipe(t.map((function(e){return e?Object.keys(e).map((function(e){return parseInt(e,10)})):[]})))},e.prototype.pipeIconType=function(e){return this.p.streamEntityPreview(e).pipe(t.map((function(e){return"teEn"==e.entity_type?"temporal-entity":e.fk_class===f.DfhConfig.CLASS_PK_EXPRESSION_PORTION?"expression-portion":f.DfhConfig.CLASS_PKS_SOURCE_PE_IT.includes(e.fk_class)?"source":"persistent-entity"})))},e.prototype.sortStatementsByRepoPopularity=function(e){return e.sort((function(e,t){return e.is_in_project_count>t.is_in_project_count?1:-1}))},e.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:be},{type:ge}]},e.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new e(r.ɵɵinject(be),r.ɵɵinject(ge))},token:e,providedIn:"root"}),g([$,b("design:type",Function),b("design:paramtypes",[Number,Object]),b("design:returntype",a.Observable)],e.prototype,"pipeStatements",null),g([$,b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",a.Observable)],e.prototype,"pipeOutgoingStatements",null),g([$,b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",a.Observable)],e.prototype,"pipeIngoingStatements",null),g([$,b("design:type",Function),b("design:paramtypes",[Object,Object]),b("design:returntype",a.Observable)],e.prototype,"pipeOutgoingStatementsByProperty",null),g([$,b("design:type",Function),b("design:paramtypes",[Object,Object]),b("design:returntype",a.Observable)],e.prototype,"pipeIngoingStatementsByProperty",null),g([$,b("design:type",Function),b("design:paramtypes",[Object,Object,Number]),b("design:returntype",a.Observable)],e.prototype,"pipeOutgoingBasicStatementItemsByProperty",null),g([$,b("design:type",Function),b("design:paramtypes",[Object,Object,Number]),b("design:returntype",a.Observable)],e.prototype,"pipeIngoingBasicStatementItemsByProperty",null),g([$,b("design:type",Function),b("design:paramtypes",[Number,y.InfStatement,Boolean]),b("design:returntype",a.Observable)],e.prototype,"pipeBasicStatementItem",null),g([$,b("design:type",Function),b("design:paramtypes",[Number,Number,Boolean]),b("design:returntype",a.Observable)],e.prototype,"pipeBasicStatementItemByPkStatement",null),g([$,b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeInfTimePrimitive",null),g([$,b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeTimeSpan",null),g([$,b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeClassOfEntity",null),g([$,b("design:type",Function),b("design:paramtypes",[Array]),b("design:returntype",a.Observable)],e.prototype,"pipeClassesOfPersistentItems",null),g([$,b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",a.Observable)],e.prototype,"pipeRepoOutgoingStatements",null),g([$,b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",a.Observable)],e.prototype,"pipeRepoIngoingStatements",null),g([$,b("design:type",Function),b("design:paramtypes",[Object,Object]),b("design:returntype",a.Observable)],e.prototype,"pipeRepoOutgoingStatementsByProperty",null),g([$,b("design:type",Function),b("design:paramtypes",[Object,Object]),b("design:returntype",a.Observable)],e.prototype,"pipeRepoIngoingStatementsByProperty",null),g([$,b("design:type",Function),b("design:paramtypes",[Number,Boolean]),b("design:returntype",a.Observable)],e.prototype,"pipeAlternativeBasicStatementItemByPkStatement",null),g([$,b("design:type",Function),b("design:paramtypes",[Object,Object]),b("design:returntype",a.Observable)],e.prototype,"pipeAlternativeIngoingStatements",null),g([$,b("design:type",Function),b("design:paramtypes",[Object,Object]),b("design:returntype",a.Observable)],e.prototype,"pipeAlternativeOutgoingStatements",null),g([$,b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",a.Observable)],e.prototype,"pipePersistentItemPksByClass",null),e}();var $e=function(){function e(e,t,n,i,r,p,o){this.b=e,this.p=t,this.s=n,this.c=i,this.timePrimitivePipe=r,this.timeSpanPipe=p,this.infRepo=new X(o,a.of("repo"))}return e.prototype.pipeListLength=function(e,n){switch(e.listType){case"appellation":case"entity-preview":case"language":case"place":case"dimension":case"langString":case"temporal-entity":return this.pipeList(e,n).pipe(t.map((function(e){return e.length})));case"time-span":return a.combineLatest(this.b.pipeOutgoingStatementsByProperty(72,n),this.b.pipeOutgoingStatementsByProperty(71,n),this.b.pipeOutgoingStatementsByProperty(150,n),this.b.pipeOutgoingStatementsByProperty(151,n),this.b.pipeOutgoingStatementsByProperty(152,n),this.b.pipeOutgoingStatementsByProperty(153,n)).pipe(t.tap((function(e){})),t.map((function(e){return e.filter((function(e){return e.length>0})).length})));default:return console.warn("unsupported listType"),new a.BehaviorSubject(0)}},e.prototype.pipeList=function(e,n,i){return e.listType.appellation?this.pipeListAppellation(e,n,i):e.listType.entityPreview?this.pipeListEntityPreview(e,n,i):e.listType.language?this.pipeListLanguage(e,n,i):e.listType.place?this.pipeListPlace(e,n,i):e.listType.dimension?this.pipeListDimension(e,n,i):e.listType.langString?this.pipeListLangString(e,n,i):e.listType.temporalEntity?this.pipeListEntityPreview(e,n,i):e.listType.timeSpan?this.pipeItemTimeSpan(n).pipe(t.map((function(e){return[e].filter((function(e){return e.properties.length>0}))}))):void console.warn("unsupported listType")},e.prototype.pipeListBasicStatementItems=function(e,t,n){return e.isOutgoing?this.b.pipeOutgoingBasicStatementItemsByProperty(e.property.pkProperty,t,n):this.b.pipeIngoingBasicStatementItemsByProperty(e.property.pkProperty,t,n)},e.prototype.pipeListAppellation=function(e,n,i){var r=this;return this.b.pipeStatementsOfList(e,n).pipe(t.switchMap((function(n){return a.combineLatest(n.map((function(e,t){return r.pipeItemAppellation(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),s.limitTo(i),t.startWith([]))})))},e.prototype.pipeListEntityPreview=function(e,i,r){var p=this;return this.b.pipeStatementsOfList(e,i).pipe(n.tag("before-"+i+"-"+e.property.pkProperty+"-"+e.targetClass),t.switchMap((function(n){return a.combineLatest(n.map((function(t,n){return p.pipeItemEntityPreview(t,e.isOutgoing)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass})).sort((function(e,t){return e.ordNum>t.ordNum?1:-1}))}),s.limitTo(r)),t.startWith([]))})),n.tag("after-"+i+"-"+e.property.pkProperty+"-"+e.targetClass))},e.prototype.pipeListLanguage=function(e,n,i){var r=this;return this.b.pipeStatementsOfList(e,n).pipe(t.switchMap((function(n){return a.combineLatest(n.map((function(e,t){return r.pipeItemLanguage(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),s.limitTo(i),t.startWith([]))})))},e.prototype.pipeListPlace=function(e,n,i){var r=this;return this.b.pipeStatementsOfList(e,n).pipe(t.switchMap((function(n){return a.combineLatest(n.map((function(e,t){return r.pipeItemPlace(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),s.limitTo(i),t.startWith([]))})))},e.prototype.pipeListDimension=function(e,n,i){var r=this;return this.b.pipeStatementsOfList(e,n).pipe(t.switchMap((function(n){return a.combineLatest(n.map((function(e,t){return r.pipeItemDimension(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),s.limitTo(i),t.startWith([]))})))},e.prototype.pipeListLangString=function(e,n,i){var r=this;return this.b.pipeStatementsOfList(e,n).pipe(t.switchMap((function(n){return a.combineLatest(n.map((function(e,t){return r.pipeItemLangString(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),s.limitTo(i),t.startWith([]))})))},e.prototype.pipeProjRelOfStatement=function(e,n){if(n.scope.inProject)return this.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(n.scope.inProject+"_"+e.pk_entity).pipe(t.map((function(e){return{projRel:e,ordNum:n.isOutgoing?e.ord_num_of_range:e.ord_num_of_domain}})))},e.prototype.pipeTargetOfStatement=function(e,n,i){var r=n.isOutgoing,p=r?e.fk_object_info:e.fk_subject_info;if(i.appellation)return this.s.inf$.appellation$.by_pk_entity$.key(p).pipe(t.map((function(t){return{statement:e,isOutgoing:r,targetLabel:t.string,targetClass:t.fk_class,target:{appellation:t}}})));throw i.temporalEntity,new Error("No implementation found for subfieldType "+JSON.stringify(i))},e.prototype.pipeStatementWithTarget=function(e,n,i){return a.combineLatest(this.pipeTargetOfStatement(e,n,i),this.pipeProjRelOfStatement(e,n)).pipe(t.map((function(e){var t=k(e,2),n=t[0],i=t[1];return m({},n,i)})))},e.prototype.pipeSubfieldPage=function(e,n){var i=this;return this.s.inf$.statement$.pagination$.pipePage(e).pipe(t.switchMap((function(r){return s.combineLatestOrEmpty(r.map((function(r){return i.s.inf$.statement$.by_pk_entity$.key(r).pipe(t.switchMap((function(t){return i.pipeStatementWithTarget(t,e,n)})))})))})))},e.prototype.pipeItemTeEnRow=function(e,n,i,r){var p=this,o=r?this.b.pipeRepoOutgoingStatements(e):this.b.pipeOutgoingStatements(e),u=r?this.b.pipeRepoIngoingStatements(e):this.b.pipeIngoingStatements(e),l=o.pipe(t.switchMap((function(e){return s.combineLatestOrEmpty(e.filter((function(e){return!!e.fk_object_info})).map((function(e){return p.pipeItem(e,i,!0)})))}))),f=u.pipe(t.switchMap((function(e){return s.combineLatestOrEmpty(e.filter((function(e){return!!e.fk_subject_info})).map((function(e){return p.pipeItem(e,i,!1)})))}))),y=r?function(e){return e.sort((function(e,t){return e.statement.is_in_project_count>t.statement.is_in_project_count?1:-1}))}:function(e){return e};return a.combineLatest(l,f).pipe(t.map((function(e){var t=k(e,2),n=t[0],i=t[1];return{groupedOut:c.groupBy((function(e){return e&&e.statement?e.statement.fk_property.toString():void 0}),n),groupedIn:c.groupBy((function(e){return e&&e.statement?e.statement.fk_property.toString():void 0}),i)}})),t.map((function(e){var t={};return n.forEach((function(n){var i;n.listDefinitions.forEach((function(t){if(t.listType.timeSpan){var n=c.pick(["71","72","150","151","152","153"],e.groupedOut),r=Object.keys(n),o=r.length,a=void 0;if(o>0){var u={};r.forEach((function(e){u[e]=n[e][0].timePrimitive}));var l=s.TimeSpanUtil.fromTimeSpanDialogData(u);a=p.timeSpanPipe.transform(l)}i={isOutgoing:t.isOutgoing,itemsCount:o,label:a,entityPreview:void 0,pkProperty:void 0,isTimeSpan:!0}}else if(t.isOutgoing){if(e.groupedOut[t.property.pkProperty]){var f=(_=y(e.groupedOut[t.property.pkProperty]))[0];i={isOutgoing:t.isOutgoing,itemsCount:_.length,entityPreview:(f||{}).preview,label:f.label,pkProperty:t.property.pkProperty,firstItem:f,items:_}}}else if(e.groupedIn[t.property.pkProperty]){var _;f=(_=y(e.groupedIn[t.property.pkProperty]))[0];i={isOutgoing:t.isOutgoing,itemsCount:_.length,entityPreview:(f||{}).preview,label:f.label,pkProperty:t.property.pkProperty,firstItem:f,items:_}}})),t[n.label]=i})),t})))},e.prototype.pipeItem=function(e,n,i){var r=this,p=i?e.fk_object_info:e.fk_subject_info;return this.s.inf$.getModelOfEntity$(p).pipe(t.switchMap((function(t){switch(t?t.modelName:void 0){case"appellation":return r.pipeItemAppellation(e);case"language":return r.pipeItemLanguage(e);case"place":return r.pipeItemPlace(e);case"dimension":return r.pipeItemDimension(e);case"lang_string":return r.pipeItemLangString(e);case"time_primitive":return r.pipeItemTimePrimitive(e,n);default:return r.pipeItemEntityPreview(e,i)}})))},e.prototype.pipeEntityProperties=function(e,n,i){var r=this;return e.listType.appellation?this.pipeListAppellation(e,n,i).pipe(t.map((function(t){return r.getEntityProperties(e,t)}))):e.listType.language?this.pipeListLanguage(e,n,i).pipe(t.map((function(t){return r.getEntityProperties(e,t)}))):e.listType.place?this.pipeListPlace(e,n,i).pipe(t.map((function(t){return r.getEntityProperties(e,t)}))):e.listType.dimension?this.pipeListDimension(e,n,i).pipe(t.map((function(t){return r.getEntityProperties(e,t)}))):e.listType.langString?this.pipeListLangString(e,n,i).pipe(t.map((function(t){return r.getEntityProperties(e,t)}))):e.listType.entityPreview||e.listType.temporalEntity?this.pipeListEntityPreview(e,n,i).pipe(t.map((function(t){return r.getEntityProperties(e,t)}))):e.listType.timeSpan?this.pipeItemTimeSpan(n).pipe(t.map((function(t){var n,i,p=t.properties.find((function(e){return e.items.length>0}))?[{label:r.timeSpanPipe.transform((n=t,i=new s.TimeSpanUtil,n.properties.forEach((function(e){var t=f.DfhConfig.PROPERTY_PK_TO_EXISTENCE_TIME_KEY[e.listDefinition.property.pkProperty];e.items&&e.items.length&&(i[t]=e.items[0].timePrimitive)})),i)),properties:[]}]:[];return{listDefinition:e,items:p}}))):a.of(null)},e.prototype.pipeTemporalEntityRemoveProperties=function(e){return a.combineLatest(this.s.inf$.temporal_entity$.by_pk_entity_key$(e),this.s.inf$.statement$.by_subject$({fk_subject_info:e}),this.s.inf$.text_property$.by_fk_concerned_entity_indexed$(e)).pipe(t.map((function(e){var t=k(e,3),n=t[0],i=t[1],r=t[2];return{temporalEntity:n,statements:i,textProperties:c.values(r)}})))},e.prototype.getEntityProperties=function(e,t){return{listDefinition:e,items:t}},e.prototype.pipeItemTimeSpan=function(e){var n=this;return this.p.pkProject$.pipe(t.switchMap((function(i){return n.c.pipeSpecificFieldOfClass(f.DfhConfig.ClASS_PK_TIME_SPAN).pipe(t.switchMap((function(r){return a.combineLatest(r.map((function(r){return n.s.inf$.statement$.by_subject_and_property$({fk_property:r.property.pkProperty,fk_subject_info:e}).pipe(s.switchMapOr([],(function(e){return a.combineLatest(e.map((function(e){return a.combineLatest(n.s.inf$.time_primitive$.by_pk_entity$.key(e.fk_object_info).pipe(t.filter((function(e){return!!e}))),n.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(i+"_"+e.pk_entity)).pipe(t.map((function(t){var i=k(t,2),r=i[0],p=i[1],o=new s.TimePrimitive({julianDay:r.julian_day,calendar:p.calendar||"gregorian",duration:r.duration});return{statement:e,ordNum:void 0,projRel:p,timePrimitive:o,label:n.timePrimitivePipe.transform(o),fkClass:r.fk_class}})))})))})),t.map((function(e){return{listDefinition:r.listDefinitions[0],items:e}})))}))).pipe(t.map((function(e){return{label:"",properties:e.filter((function(e){return e.items.length>0}))}})))})))})))},e.prototype.pipeItemAppellation=function(e){return this.s.inf$.appellation$.by_pk_entity$.key(e.fk_object_info).pipe(t.filter((function(e){return!!e})),t.map((function(t){return t?{ordNum:void 0,projRel:void 0,statement:e,label:t.string,fkClass:t.fk_class}:null})))},e.prototype.pipeItemLanguage=function(e){return this.s.inf$.language$.by_pk_entity$.key(e.fk_object_info).pipe(t.filter((function(e){return!!e})),t.map((function(t){return t?{ordNum:void 0,projRel:void 0,statement:e,label:t.notes,fkClass:t.fk_class}:null})))},e.prototype.pipeItemPlace=function(e){return this.s.inf$.place$.by_pk_entity$.key(e.fk_object_info).pipe(t.filter((function(e){return!!e})),t.map((function(t){return t?{ordNum:void 0,projRel:void 0,statement:e,label:"WGS84: "+t.lat+"°, "+t.long+"°",fkClass:t.fk_class}:null})))},e.prototype.pipeItemDimension=function(e){var n=this;return this.s.inf$.dimension$.by_pk_entity$.key(e.fk_object_info).pipe(t.filter((function(e){return!!e})),t.switchMap((function(i){return n.p.streamEntityPreview(i.fk_measurement_unit).pipe(t.map((function(t){return{ordNum:void 0,projRel:void 0,statement:e,label:i.numeric_value+" "+t.entity_label,fkClass:i.fk_class}})))})))},e.prototype.pipeItemLangString=function(e){var n=this;return this.s.inf$.lang_string$.by_pk_entity$.key(e.fk_object_info).pipe(t.switchMap((function(i){return i?n.s.inf$.language$.by_pk_entity$.key(i.fk_language).pipe(t.map((function(t){if(!t)return null;var n="";return i.string?n=i.string:i.quill_doc&&i.quill_doc.ops&&i.quill_doc.ops.length&&(n=i.quill_doc.ops.map((function(e){return e.insert})).join("")),{ordNum:void 0,projRel:void 0,statement:e,label:n,fkClass:i.fk_class,language:t,fkLanguage:i.fk_language}}))):new a.BehaviorSubject(null)})))},e.prototype.pipeItemEntityPreview=function(e,n){return this.p.streamEntityPreview(n?e.fk_object_info:e.fk_subject_info).pipe(t.map((function(t){return t?{ordNum:void 0,projRel:void 0,statement:e,preview:t,label:t.entity_label||"",fkClass:t.fk_class}:null})))},e.prototype.pipeItemTimePrimitive=function(e,n){var i=this;return n?a.combineLatest(this.s.inf$.time_primitive$.by_pk_entity$.key(e.fk_object_info).pipe(t.filter((function(e){return!!e}))),this.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(n+"_"+e.pk_entity).pipe(t.filter((function(e){return!!e})))).pipe(t.map((function(t){var n=k(t,2),r=n[0],p=n[1];if(!r)return null;var o=new s.TimePrimitive({julianDay:r.julian_day,calendar:p.calendar||"gregorian",duration:r.duration});return{ordNum:void 0,projRel:void 0,statement:e,timePrimitive:o,label:i.timePrimitivePipe.transform(o),fkClass:r.fk_class}}))):this.infRepo.time_primitive$.by_pk_entity$.key(e.fk_object_info).pipe(t.filter((function(e){return!!e}))).pipe(t.map((function(t){var n=new s.TimePrimitive({julianDay:t.julian_day,calendar:e.community_favorite_calendar||"gregorian",duration:t.duration});return{ordNum:void 0,projRel:void 0,statement:e,timePrimitive:n,label:i.timePrimitivePipe.transform(n),fkClass:t.fk_class}})))},e.prototype.pipeAltListLength=function(e,n){switch(e.listType){case"appellation":case"entity-preview":case"language":case"place":case"langString":case"temporal-entity":case"time-span":return this.pipeAltListStatements(e,n).pipe(t.map((function(e){return e.length})));default:console.warn("unsupported listType")}},e.prototype.pipeAltList=function(e,t){return e.listType.appellation?this.pipeAltListAppellation(e,t):e.listType.entityPreview?this.pipeAltListEntityPreview(e,t):e.listType.language?this.pipeAltListLanguage(e,t):e.listType.place?this.pipeAltListPlace(e,t):e.listType.dimension?this.pipeAltListDimension(e,t):e.listType.langString?this.pipeAltListLangString(e,t):e.listType.temporalEntity?this.pipeAltListEntityPreview(e,t):void console.warn("unsupported listType")},e.prototype.pipeAltListStatements=function(e,t){return e.isOutgoing,this.b.pipeAlternativeIngoingStatements(e.property.pkProperty,t)},e.prototype.pipeAltListEntityPreview=function(e,n){var i=this;return(e.isOutgoing?this.b.pipeAlternativeOutgoingStatements(e.property.pkProperty,n):this.b.pipeAlternativeIngoingStatements(e.property.pkProperty,n)).pipe(t.switchMap((function(n){return a.combineLatest(n.map((function(t,n){return i.pipeItemEntityPreview(t,e.isOutgoing)}))).pipe(t.map((function(e){return e.filter((function(e){return!!e})).sort((function(e,t){return e.ordNum>t.ordNum?1:-1}))})),t.startWith([]))})))},e.prototype.pipeAltListPlace=function(e,n){var i=this;if(e.isOutgoing)return this.b.pipeAlternativeOutgoingStatements(e.property.pkProperty,n).pipe(t.switchMap((function(n){return a.combineLatest(n.map((function(e,t){return i.pipeItemPlace(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),t.startWith([]))})))},e.prototype.pipeAltListDimension=function(e,n){var i=this;if(e.isOutgoing)return this.b.pipeAlternativeOutgoingStatements(e.property.pkProperty,n).pipe(t.switchMap((function(n){return a.combineLatest(n.map((function(e,t){return i.pipeItemDimension(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),t.startWith([]))})))},e.prototype.pipeAltListLangString=function(e,n){var i=this;if(e.isOutgoing)return this.b.pipeAlternativeOutgoingStatements(e.property.pkProperty,n).pipe(t.switchMap((function(n){return a.combineLatest(n.map((function(e,t){return i.pipeItemLangString(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),t.startWith([]))})))},e.prototype.pipeAltListAppellation=function(e,n){var i=this;if(e.isOutgoing)return this.b.pipeAlternativeOutgoingStatements(e.property.pkProperty,n).pipe(t.switchMap((function(n){return a.combineLatest(n.map((function(e,t){return i.pipeItemAppellation(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),t.startWith([]))})))},e.prototype.pipeAltListLanguage=function(e,n){var i=this;if(e.isOutgoing)return this.b.pipeAlternativeOutgoingStatements(e.property.pkProperty,n).pipe(t.switchMap((function(n){return a.combineLatest(n.map((function(e,t){return i.pipeItemLanguage(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),t.startWith([]))})))},e.prototype.pipeRepoListAppellation=function(e,n){var i=this;if(e.isOutgoing)return this.b.pipeRepoOutgoingStatementsByProperty(e.property.pkProperty,n).pipe(t.switchMap((function(n){return a.combineLatest(n.map((function(e,t){return i.pipeItemAppellation(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),t.startWith([]))})))},e.prototype.pipeRepoListLanguage=function(e,n){var i=this;if(e.isOutgoing)return this.b.pipeRepoOutgoingStatementsByProperty(e.property.pkProperty,n).pipe(t.switchMap((function(n){return a.combineLatest(n.map((function(e,t){return i.pipeItemLanguage(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),t.startWith([]))})))},e.prototype.pipeRepoListPlace=function(e,n){var i=this;if(e.isOutgoing)return this.b.pipeRepoOutgoingStatementsByProperty(e.property.pkProperty,n).pipe(t.switchMap((function(n){return a.combineLatest(n.map((function(e,t){return i.pipeItemPlace(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),t.startWith([]))})))},e.prototype.pipeRepoListDimension=function(e,n){var i=this;if(e.isOutgoing)return this.b.pipeRepoOutgoingStatementsByProperty(e.property.pkProperty,n).pipe(t.switchMap((function(n){return a.combineLatest(n.map((function(e,t){return i.pipeItemDimension(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),t.startWith([]))})))},e.prototype.pipeRepoListEntityPreview=function(e,n){var i=this;return(e.isOutgoing?this.b.pipeRepoOutgoingStatementsByProperty(e.property.pkProperty,n):this.b.pipeRepoIngoingStatementsByProperty(e.property.pkProperty,n)).pipe(t.switchMap((function(n){return a.combineLatest(n.map((function(t,n){return i.pipeItemEntityPreview(t,e.isOutgoing)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})))})),t.startWith([]))},e.prototype.pipeRepoItemTimeSpan=function(e){var n=this;return this.p.pkProject$.pipe(t.switchMap((function(i){return n.c.pipeBasicAndSpecificFields(f.DfhConfig.ClASS_PK_TIME_SPAN).pipe(t.switchMap((function(i){return a.combineLatest(i.map((function(i){return n.b.pipeRepoOutgoingStatementsByProperty(i.property.pkProperty,e).pipe(s.switchMapOr([],(function(e){return a.combineLatest(e.map((function(e){return n.infRepo.time_primitive$.by_pk_entity$.key(e.fk_object_info).pipe(t.map((function(t){var i=new s.TimePrimitive({julianDay:t.julian_day,calendar:e.community_favorite_calendar||"gregorian",duration:t.duration});return{statement:e,ordNum:void 0,projRel:void 0,timePrimitive:i,label:n.timePrimitivePipe.transform(i),fkClass:t.fk_class}})))})))})),t.map((function(e){return{listDefinition:i.listDefinitions[0],items:e}})),t.startWith({listDefinition:i.listDefinitions[0],items:[]}))}))).pipe(t.map((function(e){return{label:"",properties:e.filter((function(e){return e.items.length>0}))}})))})))})))},e.prototype.pipeLabelOfEntity=function(e){var n=this;return this.b.pipeClassOfEntity(e).pipe(t.switchMap((function(i){return n.c.pipeBasicAndSpecificFields(i).pipe(t.switchMap((function(i){return s.combineLatestOrEmpty(i&&i.length?i[0].listDefinitions.map((function(t){return n.pipeEntityProperties(t,e,1)})):[]).pipe(t.map((function(e){return(e=e.filter((function(e){return e.items.length>0}))).length&&e[0].items.length?e[0].items[0].label:""})))})))})))},e.prototype.pipeClassLabelOfEntity=function(e){var n=this;return this.b.pipeClassOfEntity(e).pipe(t.switchMap((function(e){return n.c.pipeClassLabel(e)})))},e.prototype.pipeTypeOfEntity=function(e,n,i){return i?this.s.inf$.statement$.by_subject_and_property_indexed$({fk_property:n,fk_subject_info:e}).pipe(t.map((function(e){return!e||Object.keys(e).length<1?void 0:c.values(e)[0]}))):this.s.inf$.statement$.by_object_and_property_indexed$({fk_property:n,fk_object_info:e}).pipe(t.map((function(e){return!e||Object.keys(e).length<1?void 0:c.values(e)[0]})))},e.prototype.pipeClassesAndTypes=function(e){var n=this;return this.c.pipeTypeAndTypedClasses(e).pipe(t.switchMap((function(e){return n.pipeClassAndTypeNodes(e)})))},e.prototype.pipeClassesAndTypesOfClasses=function(e){var n=this;return this.c.pipeTypeAndTypedClassesOfTypedClasses(e).pipe(t.switchMap((function(e){return n.pipeClassAndTypeNodes(e)})))},e.prototype.pipeClassAndTypeNodes=function(e){var n=this;return s.combineLatestOrEmpty(e.map((function(e){return n.c.pipeClassLabel(e.typedClass).pipe(t.map((function(t){return{label:t,data:{pkClass:e.typedClass,pkType:null}}})),t.switchMap((function(i){return a.iif((function(){return!!e.typeClass}),n.b.pipePersistentItemPksByClass(e.typeClass).pipe(t.switchMap((function(i){return s.combineLatestOrEmpty(i.map((function(i){return n.p.streamEntityPreview(i).pipe(t.map((function(t){return{label:t.entity_label,data:{pkClass:e.typedClass,pkType:i}}})))}))).pipe(s.sortAbc((function(e){return e.label})))})),t.map((function(e){return i.children=e,i}))),a.of(m({},i,{children:[]})))})))}))).pipe(s.sortAbc((function(e){return e.label})))},e.prototype.pipeClassesFromClassesAndTypes=function(e){var n=this;return(e&&e.types&&e.types.length?this.b.pipeClassesOfPersistentItems(e.types).pipe(t.filter((function(e){return!!e})),t.switchMap((function(e){return n.c.pipeTypedClassesOfTypeClasses(e)}))):a.of([])).pipe(t.map((function(t){return c.uniq(v(t,(e||{classes:[]}).classes||[]))})))},e.prototype.pipePropertyOptionsFromClassesAndTypes=function(e){var n=this;return this.pipeClassesFromClassesAndTypes(e).pipe(t.switchMap((function(e){return n.pipePropertyOptionsFormClasses(e)})))},e.prototype.pipePropertyOptionsFormClasses=function(e){var n=this;return s.combineLatestOrEmpty(e.map((function(e){return n.s.dfh$.class$.by_pk_class$.key(e).pipe(t.map((function(e){return 9===e.basic_type})),t.switchMap((function(i){return n.c.pipeSpecificAndBasicFields(e).pipe(t.map((function(e){return e.filter((function(e){return!!e.property.pkProperty})).map((function(e){return{isOutgoing:e.isOutgoing,fkPropertyDomain:e.isOutgoing?e.sourceClass:null,fkPropertyRange:e.isOutgoing?null:e.sourceClass,pkProperty:e.property.pkProperty}}))})),t.switchMap((function(r){return i&&f.DfhConfig.PROPERTY_PKS_WHERE_TIME_PRIMITIVE_IS_RANGE.map((function(t){r.push({pkProperty:t,fkPropertyDomain:e,fkPropertyRange:f.DfhConfig.CLASS_PK_TIME_PRIMITIVE,isOutgoing:!0})})),s.combineLatestOrEmpty(r.map((function(e){return n.c.pipeFieldLabel(e.pkProperty,e.fkPropertyDomain,e.fkPropertyRange).pipe(t.map((function(t){var n=e.isOutgoing;return{isOutgoing:n,label:t,pk:e.pkProperty,propertyFieldKey:je(e.pkProperty,n)}})))})))})))})))}))).pipe(t.map((function(e){return c.flatten(e)})))},e.prototype.pipePkClassesFromPropertySelectModel=function(e){return s.combineLatestOrEmpty([this.c.pipeTargetClassesOfProperties(e.outgoingProperties,!0),this.c.pipeTargetClassesOfProperties(e.ingoingProperties,!1)]).pipe(t.map((function(e){var t=k(e,2),n=t[0],i=t[1];return c.uniq(v(n,i))})))},e.prototype.getPkClassesFromPropertySelectModel$=function(e){var n=this;return e.pipe(t.switchMap((function(e){return s.combineLatestOrEmpty([n.c.pipeTargetClassesOfProperties(e.outgoingProperties,!0),n.c.pipeTargetClassesOfProperties(e.ingoingProperties,!1)]).pipe(t.map((function(e){var t=k(e,2),n=t[0],i=t[1];return c.uniq(v(n,i))})))})))},e.prototype.getPropertyOptions$=function(e){var n=this;return e.pipe(t.distinctUntilChanged((function(e,t){return c.equals(e,t)})),t.switchMap((function(e){return e?n.b.pipeClassesOfPersistentItems(e.types).pipe(t.filter((function(e){return!!e})),t.switchMap((function(i){return n.c.pipeTypedClassesOfTypeClasses(i).pipe(t.switchMap((function(t){var i=c.uniq(v(t,e.classes||[]));return n.pipePropertyOptionsFormClasses(i)})))}))):a.empty()})))},e.decorators=[{type:r.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:Pe},{type:be},{type:ge},{type:he},{type:s.TimePrimitivePipe},{type:s.TimeSpanPipe},{type:o.NgRedux}]},e.ngInjectableDef=r.ɵɵdefineInjectable({factory:function(){return new e(r.ɵɵinject(Pe),r.ɵɵinject(be),r.ɵɵinject(ge),r.ɵɵinject(he),r.ɵɵinject(s.TimePrimitivePipe),r.ɵɵinject(s.TimeSpanPipe),r.ɵɵinject(o.NgRedux))},token:e,providedIn:"root"}),g([$,P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[String]),b("design:returntype",void 0)],e.prototype,"pipeClassesAndTypes",null),g([$,P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Array]),b("design:returntype",void 0)],e.prototype,"pipeClassesAndTypesOfClasses",null),g([$,P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Array]),b("design:returntype",a.Observable)],e.prototype,"pipeClassAndTypeNodes",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Array]),b("design:returntype",a.Observable)],e.prototype,"pipePropertyOptionsFormClasses",null),g([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",a.Observable)],e.prototype,"pipePkClassesFromPropertySelectModel",null),e}();function je(e,t){return"_"+e+"_"+(t?"outgoing":"ingoing")}e.ActiveProjectPipesService=be,e.ConfigurationPipesService=he,e.DatSelector=w,e.DfhSelector=M,e.InfSelector=X,e.InformationBasicPipesService=Pe,e.InformationPipesService=$e,e.ProSelector=oe,e.ReduxQueriesModule=j,e.SchemaSelectorsService=ge,e.ShouldPauseService=L,e.SysSelector=ce,e.TabSelector=ye,e.WarSelector=me,e.cache=P,e.propertyOptionFieldKey=je,e.spyTag=$,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=kleiolab-lib-queries-src-lib-queries.umd.min.js.map