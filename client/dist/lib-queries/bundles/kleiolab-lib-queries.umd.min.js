!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs/operators"),require("rxjs-spy/operators"),require("@kleiolab/lib-config"),require("@kleiolab/lib-utils"),require("@angular/common"),require("@angular/core"),require("@kleiolab/lib-redux"),require("@angular-redux/store"),require("rxjs"),require("d3"),require("ramda"),require("@kleiolab/lib-sockets"),require("@kleiolab/lib-sdk-lb3")):"function"==typeof define&&define.amd?define("@kleiolab/lib-queries",["exports","rxjs/operators","rxjs-spy/operators","@kleiolab/lib-config","@kleiolab/lib-utils","@angular/common","@angular/core","@kleiolab/lib-redux","@angular-redux/store","rxjs","d3","ramda","@kleiolab/lib-sockets","@kleiolab/lib-sdk-lb3"],t):t(((e=e||self).kleiolab=e.kleiolab||{},e.kleiolab["lib-queries"]={}),e.rxjs.operators,e.operators$1,e.libConfig,e.libUtils,e.ng.common,e.ng.core,e.libRedux,e.store,e.rxjs,e.d3,e.ramda,e.libSockets,e.libSdkLb3)}(this,(function(e,t,n,i,r,o,p,s,a,u,c,l,f,y){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var _=function(e,t){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function d(e,t){function n(){this.constructor=e}_(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var g=function(){return(g=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function m(e,t,n,i){var r,o=arguments.length,p=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)p=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(p=(o<3?r(p):o>3?r(t,n,p):r(t,n))||p);return o>3&&p&&Object.defineProperty(t,n,p),p}function b(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function h(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function k(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,o=n.call(e),p=[];try{for(;(void 0===t||t-- >0)&&!(i=o.next()).done;)p.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return p}function v(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(k(arguments[t]));return e}var P=function(e){return function(i,r,o){var p=g({refCount:!0},e),s=new Map,a=o.value;return o.value=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];var u=JSON.stringify(e);if(!s.has(u)){var c=a.bind(this);s.set(u,c.apply(void 0,v(e)).pipe(t.shareReplay({refCount:p.refCount,bufferSize:1}),n.tag("FROM-CACHE-"+i.constructor.name+"::"+r+"::"+e.join(":"))))}return s.get(u)},o}};function $(e,t,i){var r=i.value;return i.value=function(){for(var i=[],o=0;o<arguments.length;o++)i[o]=arguments[o];var p=r.bind(this);return p.apply(void 0,v(i)).pipe(n.tag(e.constructor.name+"::"+t+"::"+i.join(":")))},i}function j(e,t){return{julianDay:e.julian_day,duration:e.duration,calendar:t}}var O=function(){function e(e,t){var n=[];if(e&&n.push("ReduxQueriesModule is already loaded. Import in your base AppModule only."),t||n.push("You need to import the ReduxModule in your AppModule!"),n.length)throw new Error(n.join("\n"))}return e.decorators=[{type:p.NgModule,args:[{declarations:[],imports:[o.CommonModule],providers:[]}]}],e.ctorParameters=function(){return[{type:e,decorators:[{type:p.Optional},{type:p.SkipSelf}]},{type:s.ReduxModule,decorators:[{type:p.Optional}]}]},e}(),C=function(){function e(e,t,n){this.ngRedux=e,this.configs=t,this.model=n}return e.prototype.selector=function(e){var t=this;return{all$:this.ngRedux.select([s.datRoot,this.model,e]),key:function(n){return t.ngRedux.select([s.datRoot,t.model,e,n])}}},e}();var S=function(e){function n(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity__entity_version$=r.selector("by_pk_entity__entity_version"),r.by_pk_entity$=r.selector("by_pk_entity"),r.by_pk_text$=r.selector("by_pk_text"),r}return d(n,e),n.prototype.latestVersion=function(e){return this.by_pk_entity$.key(e).pipe(t.map((function(e){return r.latestVersion(e)})))},n}(C);var R=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_project$=r.selector("by_fk_project"),r}return d(t,e),t}(C);var I=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_text$=r.selector("by_fk_text"),r}return d(t,e),t}(C);var T=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_column$=r.selector("by_fk_column"),r}return d(t,e),t}(C);var x=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_digital$=r.selector("by_fk_digital"),r}return d(t,e),t}(C);var E=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_entity__fk_system_type$=r.selector("by_fk_entity__fk_system_type"),r}return d(t,e),t}(C);var w=function(e){function t(t){var n=e.call(this,t)||this;return n.ngRedux=t,n.digital$=new S(n.ngRedux,s.datDefinitions,"digital"),n.namespace$=new R(n.ngRedux,s.datDefinitions,"namespace"),n.chunk$=new I(n.ngRedux,s.datDefinitions,"chunk"),n.column$=new x(n.ngRedux,s.datDefinitions,"column"),n.class_column_mapping$=new T(n.ngRedux,s.datDefinitions,"class_column_mapping"),n.text_property$=new E(n.ngRedux,s.datDefinitions,"text_property"),n}return d(t,e),t.decorators=[{type:p.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:a.NgRedux}]},t.ngInjectableDef=p.ɵɵdefineInjectable({factory:function(){return new t(p.ɵɵinject(a.NgRedux))},token:t,providedIn:"root"}),t}(s.DatActions);var F=function(){function e(){this.shouldPause$=new u.BehaviorSubject(!1)}return e.decorators=[{type:p.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=p.ɵɵdefineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}();var A=function(){function e(e,t,n,i){this.ngRedux=e,this.configs=t,this.model=n,this.shouldPause$=i,this.slice$=this.ngRedux.select([s.dfhRoot,this.model])}return e.prototype.selector=function(e){var n=this,i=this.ngRedux.select([s.dfhRoot,this.model,e]);return{all$:this.shouldPause$.pipe(t.switchMap((function(e){return e?u.empty():i}))),key:function(i){return n.shouldPause$.pipe(t.switchMap((function(t){return t?u.empty():n.ngRedux.select([s.dfhRoot,n.model,e,i])})))},noPause:{all$:i,key:function(t){return n.ngRedux.select([s.dfhRoot,n.model,e,t])}}}},e}();var D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.by_pk_profile$=t.selector("by_pk_profile"),t}return d(t,e),t}(A);var L=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.by_pk_class$=t.selector("by_pk_class"),t.by_basic_type$=t.selector("by_basic_type"),t}return d(t,e),t}(A);var M=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pk_property__has_domain__has_range$=t.selector("by_pk_property__has_domain__has_range"),t.by_pk_property$=t.selector("by_pk_property"),t.by_has_domain$=t.selector("by_has_domain"),t.by_has_range$=t.selector("by_has_range"),t.by_is_has_type_subproperty$=t.selector("by_is_has_type_subproperty"),t}return d(t,e),t}(A);var B=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.by_fks$=t.selector("by_fks"),t.by_fk_class__type$=t.selector("by_fk_class__type"),t.by_fk_property__type$=t.selector("by_fk_property__type"),t.by_fk_profile__type$=t.selector("by_fk_profile__type"),t}return d(t,e),t}(A);var N=function(e){function t(t,n){var i=e.call(this,t)||this;return i.ngRedux=t,i.pause=n,i.profile$=new D(i.ngRedux,s.dfhDefinitions,"profile",i.pause.shouldPause$),i.class$=new L(i.ngRedux,s.dfhDefinitions,"klass",i.pause.shouldPause$),i.property$=new M(i.ngRedux,s.dfhDefinitions,"property",i.pause.shouldPause$),i.label$=new B(i.ngRedux,s.dfhDefinitions,"label",i.pause.shouldPause$),i}return d(t,e),t.decorators=[{type:p.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:a.NgRedux},{type:F}]},t.ngInjectableDef=p.ɵɵdefineInjectable({factory:function(){return new t(p.ɵɵinject(a.NgRedux),p.ɵɵinject(F))},token:t,providedIn:"root"}),t}(s.DfhActions);var q=function(){function e(e,t,n,i){this.ngRedux=e,this.pkProject$=t,this.configs=n,this.model=i}return e.prototype.selector=function(e){var t=this;return{all$:this.ngRedux.select([s.infRoot,this.model,e]),key:function(n){return t.ngRedux.select([s.infRoot,t.model,e,n],l.equals)}}},e.prototype.paginationSelector=function(){var e=this;return{pipePage:function(n){var i,o=s.paginateBy,p=s.subfieldIdToString(n);return i=[s.infRoot,e.model,o,p],e.ngRedux.select(v(i,["count"])).pipe(t.filter((function(e){return void 0!==e})),t.switchMap((function(o){for(var p=n.offset,s=o<=p+n.limit?o:p+n.limit,a=[],u=p;u<s;u++)a.push(e.ngRedux.select(v(i,["rows",u])).pipe(t.filter((function(e){return!!e}))));return r.combineLatestOrEmpty(a)})))},pipeCount:function(t){var n,i=s.paginateBy,r=s.subfieldIdToString(t);return n=[s.infRoot,e.model,i,r],e.ngRedux.select(v(n,["count"]))},pipePageLoadNeeded:function(n,i){var r,o=s.paginateBy,p=s.subfieldIdToString(n);r=[s.infRoot,e.model,o,p];var a=s.getFromTo(n.limit,n.offset);return i.pipe(t.switchMap((function(){return e.ngRedux.select(v(r,["loading",a])).pipe(t.first(),t.map((function(e){return!e})))})))}}},e.prototype.pipeItemsInProject=function(e,n){var i=this;return u.pipe(t.switchMap((function(o){return e.pipe(t.switchMap((function(e){var p=[],s=function(r){if(o.hasOwnProperty(r)){var s=o[r];p.push(i.ngRedux.select(["pro","info_proj_rel","by_fk_project__fk_entity",e+"_"+n(s)]).pipe(t.map((function(e){return{key:r,rel:e}}))))}};for(var a in o)s(a);return r.combineLatestOrEmpty(p).pipe(t.throttleTime(0),t.map((function(e){for(var t={},n=0;n<e.length;n++){var i=e[n];i.rel&&i.rel.is_in_project&&(t[i.key]=o[i.key])}return t})))})))})))},e.prototype.pipeItemInProject=function(e,n){var i=this;return u.pipe(t.switchMap((function(r){return r?e.pipe(t.switchMap((function(e){return i.ngRedux.select(["pro","info_proj_rel","by_fk_project__fk_entity",e+"_"+n(r)]).pipe(t.map((function(e){return e&&1==e.is_in_project?r:void 0})))}))):u.of(void 0)})))},e}();var K=function(e){function t(t,n,i,r){var o=e.call(this,t,n,i,r)||this;return o.ngRedux=t,o.pkProject$=n,o.configs=i,o.model=r,o._by_pk_entity$=o.selector("by_pk_entity"),o._by_fk_class$=o.selector("by_fk_class"),o}return d(t,e),t.prototype.by_pk_entity_key$=function(e,t){void 0===t&&(t=!0);var n=this._by_pk_entity$.key(e);return t?n.pipe(this.pipeItemInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t.prototype.by_pk_entity_all$=function(e){void 0===e&&(e=!0);var t=this._by_pk_entity$.all$;return e?t.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):t},t.prototype.by_fk_class_key$=function(e,t){void 0===t&&(t=!0);var n=this._by_fk_class$.key(e);return t?n.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t}(q);var Y=function(e){function t(t,n,i,r){var o=e.call(this,t,n,i,r)||this;return o.ngRedux=t,o.pkProject$=n,o.configs=i,o.model=r,o._by_pk_entity$=o.selector("by_pk_entity"),o}return d(t,e),t.prototype.by_pk_entity_key$=function(e,t){void 0===t&&(t=!0);var n=this._by_pk_entity$.key(e);return t?n.pipe(this.pipeItemInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t}(q);var U=function(e){function n(t,n,i,r){var o=e.call(this,t,n,i,r)||this;return o.ngRedux=t,o.pkProject$=n,o.configs=i,o.model=r,o.by_pk_entity$=o.selector("by_pk_entity"),o.by_fk_subject_data$=o.selector("by_fk_subject_data"),o.pagination$=o.paginationSelector(),o}return d(n,e),n.prototype.by_pk_entity_key$=function(e,t){void 0===t&&(t=!0);var n=this.by_pk_entity$.key(e);return t?n.pipe(this.pipeItemInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},n.prototype.by_subject$=function(e,n){void 0===n&&(n=!0);var i=s.indexStatementBySubject(e),r=this.selector("by_subject").key(i);return n?r.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity})),t.map((function(e){return c.values(e)}))):r.pipe(t.map((function(e){return c.values(e)})))},n.prototype.by_subject_and_property$=function(e,n){return void 0===n&&(n=!0),this.by_subject_and_property_indexed$(e,n).pipe(t.map((function(e){return c.values(e)})))},n.prototype.by_subject_and_property_indexed$=function(e,t){void 0===t&&(t=!0);var n=s.indexStatementBySubjectProperty(e),i=this.selector("by_subject+property").key(n);return t?i.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):i},n.prototype.by_object$=function(e,n){void 0===n&&(n=!0);var i=s.indexStatementByObject(e),r=this.selector("by_object").key(i);return n?r.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity})),t.map((function(e){return c.values(e)}))):r.pipe(t.map((function(e){return c.values(e)})))},n.prototype.by_object_and_property$=function(e,n){return void 0===n&&(n=!0),this.by_object_and_property_indexed$(e,n).pipe(t.map((function(e){return c.values(e)})))},n.prototype.by_object_and_property_indexed$=function(e,t){void 0===t&&(t=!0);var n=s.indexStatementByObjectProperty(e),i=this.selector("by_object+property").key(n);return t?i.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):i},n}(q);var H=function(e){function t(t,n,i,r){var o=e.call(this,t,n,i,r)||this;return o.ngRedux=t,o.pkProject$=n,o.configs=i,o.model=r,o._by_pk_entity$=o.selector("by_pk_entity"),o._by_fk_concerned_entity__fk_class_field$=o.selector("by_fk_concerned_entity__fk_class_field"),o._by_fk_concerned_entity$=o.selector("by_fk_concerned_entity"),o}return d(t,e),t.prototype.by_pk_entity_key$=function(e,t){void 0===t&&(t=!0);var n=this._by_pk_entity$.key(e);return t?n.pipe(this.pipeItemInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t.prototype.by_fk_concerned_entity__fk_class_field_indexed$=function(e,t){void 0===t&&(t=!0);var n=this._by_fk_concerned_entity__fk_class_field$.key(e);return t?n.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t.prototype.by_fk_concerned_entity_indexed$=function(e,t){void 0===t&&(t=!0);var n=this._by_fk_concerned_entity$.key(e);return t?n.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t}(q);var Q=function(e){function t(t,n,i,r){var o=e.call(this,t,n,i,r)||this;return o.ngRedux=t,o.pkProject$=n,o.configs=i,o.model=r,o.by_pk_entity$=o.selector("by_pk_entity"),o}return d(t,e),t}(q);var G=function(e){function t(t,n,i,r){var o=e.call(this,t,n,i,r)||this;return o.ngRedux=t,o.pkProject$=n,o.configs=i,o.model=r,o.by_pk_entity$=o.selector("by_pk_entity"),o}return d(t,e),t}(q);var V=function(e){function t(t,n,i,r){var o=e.call(this,t,n,i,r)||this;return o.ngRedux=t,o.pkProject$=n,o.configs=i,o.model=r,o.by_pk_entity$=o.selector("by_pk_entity"),o}return d(t,e),t}(q);var W=function(e){function t(t,n,i,r){var o=e.call(this,t,n,i,r)||this;return o.ngRedux=t,o.pkProject$=n,o.configs=i,o.model=r,o.by_pk_entity$=o.selector("by_pk_entity"),o}return d(t,e),t}(q);var J=function(e){function t(t,n,i,r){var o=e.call(this,t,n,i,r)||this;return o.ngRedux=t,o.pkProject$=n,o.configs=i,o.model=r,o.by_pk_entity$=o.selector("by_pk_entity"),o}return d(t,e),t}(q);var X=function(e){function t(t,n,i,r){var o=e.call(this,t,n,i,r)||this;return o.ngRedux=t,o.pkProject$=n,o.configs=i,o.model=r,o.by_pk_entity$=o.selector("by_pk_entity"),o}return d(t,e),t}(q);var z=function(){function e(e,t){this.ngRedux=e,this.pkProject$=t,this.persistent_item$=new K(this.ngRedux,this.pkProject$,s.infDefinitions,"persistent_item"),this.temporal_entity$=new Y(this.ngRedux,this.pkProject$,s.infDefinitions,"temporal_entity"),this.statement$=new U(this.ngRedux,this.pkProject$,s.infDefinitions,"statement"),this.appellation$=new Q(this.ngRedux,this.pkProject$,s.infDefinitions,"appellation"),this.place$=new V(this.ngRedux,this.pkProject$,s.infDefinitions,"place"),this.text_property$=new H(this.ngRedux,this.pkProject$,s.infDefinitions,"text_property"),this.lang_string$=new G(this.ngRedux,this.pkProject$,s.infDefinitions,"lang_string"),this.time_primitive$=new W(this.ngRedux,this.pkProject$,s.infDefinitions,"time_primitive"),this.language$=new J(this.ngRedux,this.pkProject$,s.infDefinitions,"language"),this.dimension$=new X(this.ngRedux,this.pkProject$,s.infDefinitions,"dimension"),this.pkEntityModelMap$=this.ngRedux.select([s.infRoot,s.PR_ENTITY_MODEL_MAP])}return e.prototype.getModelOfEntity$=function(e){return this.ngRedux.select([s.infRoot,s.PR_ENTITY_MODEL_MAP,e])},e}();var Z=function(){function e(e,t,n){this.ngRedux=e,this.configs=t,this.model=n}return e.prototype.selector=function(e){var t=this;return{all$:this.ngRedux.select([s.proRoot,this.model,e]),key:function(n){var i="string"==typeof n?n:n.map((function(e){return l.toString(e)})).join("_");return t.ngRedux.select([s.proRoot,t.model,e,i])}}},e}();var ee=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r}return d(t,e),t}(Z);var te=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_fk_project__fk_entity$=r.selector("by_fk_project__fk_entity"),r}return d(t,e),t}(Z);var ne=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_fk_project__enabled_in_entities$=r.selector("by_fk_project__enabled_in_entities"),r.by_fk_project__fk_class$=r.selector("by_fk_project__fk_class"),r.by_fk_project$=r.selector("by_fk_project"),r}return d(t,e),t}(Z);var ie=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_fk_project__enabled$=r.selector("by_fk_project__enabled"),r.by_fk_project__fk_profile$=r.selector("by_fk_project__fk_profile"),r.by_fk_project$=r.selector("by_fk_project"),r}return d(t,e),t}(Z);var re=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_fk_project__fk_class$=r.selector("by_fk_project__fk_class"),r.by_pk_entity$=r.selector("by_pk_entity"),r}return d(t,e),t}(Z);var oe=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_fks$=r.selector("by_fks"),r.by_fks_without_lang$=r.selector("by_fks_without_lang"),r}return d(t,e),t}(Z);var pe=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r}return d(t,e),t}(Z);var se=function(e){function t(t){var n=e.call(this,t)||this;return n.ngRedux=t,n.project$=new ee(n.ngRedux,s.proDefinitions,"project"),n.info_proj_rel$=new te(n.ngRedux,s.proDefinitions,"info_proj_rel"),n.dfh_class_proj_rel$=new ne(n.ngRedux,s.proDefinitions,"dfh_class_proj_rel"),n.dfh_profile_proj_rel$=new ie(n.ngRedux,s.proDefinitions,"dfh_profile_proj_rel"),n.class_field_config$=new re(n.ngRedux,s.proDefinitions,"class_field_config"),n.text_property$=new oe(n.ngRedux,s.proDefinitions,"text_property"),n.analysis$=new pe(n.ngRedux,s.proDefinitions,"analysis"),n}return d(t,e),t.decorators=[{type:p.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:a.NgRedux}]},t.ngInjectableDef=p.ɵɵdefineInjectable({factory:function(){return new t(p.ɵɵinject(a.NgRedux))},token:t,providedIn:"root"}),t}(s.ProActions);var ae=function(){function e(e,t,n){this.ngRedux=e,this.configs=t,this.model=n,this.slice$=this.ngRedux.select([s.sysRoot,this.model])}return e.prototype.selector=function(e){var t=this;return{all$:this.ngRedux.select([s.sysRoot,this.model,e]),key:function(n){return t.ngRedux.select([s.sysRoot,t.model,e,n])}}},e}();var ue=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_class$=r.selector("by_fk_class"),r.by_required_by_sources$=r.selector("by_required_by_sources"),r.by_required$=r.selector("by_required"),r}return d(t,e),t}(ae);var ce=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.main$=r.ngRedux.select([s.sysRoot,r.model,"by_main","main"]),r}return d(t,e),t}(ae);var le=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.system_relevant_class$=new ue(t.ngRedux,s.sysDefinitions,"system_relevant_class"),t.config$=new ce(t.ngRedux,s.sysDefinitions,"config"),t}return d(t,e),t.decorators=[{type:p.Injectable,args:[{providedIn:"root"}]}],t.ngInjectableDef=p.ɵɵdefineInjectable({factory:function(){return new t(p.ɵɵinject(a.NgRedux))},token:t,providedIn:"root"}),t}(s.SysActions);var fe=function(){function e(e,t,n){this.ngRedux=e,this.configs=t,this.model=n}return e.prototype.selector=function(e){var t=this;return{all$:this.ngRedux.select([s.tabRoot,this.model,e]),key:function(n){return t.ngRedux.select([s.tabRoot,t.model,e,n])}}},e}();var ye=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_cell$=r.selector("by_pk_cell"),r.by_fk_column_fk_row$=r.selector("by_fk_column_fk_row"),r}return d(t,e),t}(fe);var _e=function(e){function t(t){var n=e.call(this,t)||this;return n.ngRedux=t,n.cell$=new ye(n.ngRedux,s.tabDefinitions,"cell"),n}return d(t,e),t.decorators=[{type:p.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:a.NgRedux}]},t.ngInjectableDef=p.ɵɵdefineInjectable({factory:function(){return new t(p.ɵɵinject(a.NgRedux))},token:t,providedIn:"root"}),t}(s.TabActions);var de=function(){function e(e,t,n){this.ngRedux=e,this.configs=t,this.model=n}return e.prototype.selector=function(e){var t=this;return{all$:this.ngRedux.select([s.warRoot,this.model,e]),key:function(n){var i="string"==typeof n?n:n.map((function(e){return l.toString(e)})).join("_");return t.ngRedux.select([s.warRoot,t.model,e,i])}}},e}();var ge=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r}return d(t,e),t}(de);var me=function(e){function t(t){var n=e.call(this,t)||this;return n.ngRedux=t,n.entity_preview$=new ge(n.ngRedux,s.warDefinitions,"entity_preview"),n}return d(t,e),t.decorators=[{type:p.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:a.NgRedux}]},t.ngInjectableDef=p.ɵɵdefineInjectable({factory:function(){return new t(p.ɵɵinject(a.NgRedux))},token:t,providedIn:"root"}),t}(s.WarActions);var be=function(){function e(e,n,i,r,o,p){this.dat$=n,this.tab$=i,this.pro$=r,this.dfh$=o,this.sys$=p;var s=e.select(["activeProject","pk_project"]).pipe(t.filter((function(e){return void 0!==e})),t.distinctUntilChanged((function(e,t){return e===t})));this.inf$=new z(e,s)}return e.decorators=[{type:p.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:a.NgRedux},{type:w},{type:_e},{type:se},{type:N},{type:le}]},e.ngInjectableDef=p.ɵɵdefineInjectable({factory:function(){return new e(p.ɵɵinject(a.NgRedux),p.ɵɵinject(w),p.ɵɵinject(_e),p.ɵɵinject(se),p.ɵɵinject(N),p.ɵɵinject(le))},token:e,providedIn:"root"}),e}();var he=function(){function e(e,n,i,r){var o=this;this.ngRedux=e,this.s=n,this.entityPreviewSocket=i,this.schemaService=r,this.requestedEntityPreviews={},this.pkProject$=e.select(["activeProject","pk_project"]).pipe(t.filter((function(e){return void 0!==e})),t.distinctUntilChanged((function(e,t){return e===t}))),this.entityPreviewSocket.fromEvent("reconnect").subscribe((function(e){o.pkProject$.pipe(t.first()).subscribe((function(e){var t=Object.keys(g({},o.ngRedux.getState().war.entity_preview,o.requestedEntityPreviews));t.length&&o.entityPreviewSocket.emit("addToStream",{pkProject:e,pks:t})}))})),u.combineLatest(this.schemaService.schemaObjectStored$,this.pkProject$).subscribe((function(e){var t=k(e,2),n=t[0],i=t[1];o.extendEntityPreviewStream(n,i)}))}return e.prototype.pipeActiveProject=function(){var e=this;return this.pkProject$.pipe(t.switchMap((function(t){return e.s.pro$.project$.by_pk_entity$.key(t.toString())}))).pipe(t.filter((function(e){return!!e})))},e.prototype.pipeActiveDefaultLanguage=function(){var e=this;return this.pipeActiveProject().pipe(t.filter((function(e){return!!e})),t.switchMap((function(t){return e.s.inf$.language$.by_pk_entity$.key(t.fk_language.toString())}))).pipe(t.filter((function(e){return!!e})))},e.prototype.streamEntityPreview=function(e,n){var i=this;return(!(((this.ngRedux.getState().war||{}).entity_preview||{}).by_pk_entity||{})[e]&&!this.requestedEntityPreviews[e]||n)&&this.pkProject$.pipe(t.first((function(e){return!!e}))).subscribe((function(t){i.entityPreviewSocket.emit("addToStream",{pkProject:t,pks:[e]}),i.requestedEntityPreviews[e]=!0})),this.ngRedux.select(["war","entity_preview","by_pk_entity",e]).pipe(t.distinctUntilChanged(l.equals),t.filter((function(e){return!!e})))},e.prototype.extendEntityPreviewStream=function(e,t){e&&e.war&&e.war.entity_preview&&e.war.entity_preview.length&&this.entityPreviewSocket.emit("extendStream",{pkProject:t,pks:e.war.entity_preview.map((function(e){return e.pk_entity}))})},e.decorators=[{type:p.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:a.NgRedux},{type:be},{type:f.EntityPreviewSocket},{type:s.SchemaService}]},e.ngInjectableDef=p.ɵɵdefineInjectable({factory:function(){return new e(p.ɵɵinject(a.NgRedux),p.ɵɵinject(be),p.ɵɵinject(f.EntityPreviewSocket),p.ɵɵinject(s.SchemaService))},token:e,providedIn:"root"}),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",u.Observable)],e.prototype,"pipeActiveProject",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",u.Observable)],e.prototype,"pipeActiveDefaultLanguage",null),e}();var ke=function(){function e(e,t){this.a=e,this.s=t}return e.prototype.pipeProfilesEnabledByProject=function(){var e=this;return this.a.pkProject$.pipe(t.switchMap((function(n){return e.s.pro$.dfh_profile_proj_rel$.by_fk_project__enabled$.key(n+"_true").pipe(t.map((function(e){return l.values(e).filter((function(e){return e.enabled})).map((function(e){return e.fk_profile}))})),t.map((function(e){return v(e,[i.DfhConfig.PK_PROFILE_GEOVISTORY_BASIC])})))})),t.shareReplay())},e.prototype.pipeFields=function(e,n){var r=this;return void 0===n&&(n=!1),u.combineLatest(this.s.dfh$.class$.by_pk_class$.key(e),this.s.dfh$.property$.by_has_domain$.key(e).pipe(t.map((function(e){return l.values(e)}))),this.s.dfh$.property$.by_has_range$.key(e).pipe(t.map((function(e){return l.values(e)}))),this.s.sys$.config$.main$.pipe(t.filter((function(e){return!!e}))),this.pipeProfilesEnabledByProject()).pipe(t.switchMap((function(o){var p,s,a=k(o,5),c=a[0],f=a[1],y=a[2],_=a[3],d=a[4],g=function(e){return d.some((function(t){return e.profiles.map((function(e){return e.fk_profile})).includes(t)}))},m=f.filter((function(e){return g(e)})),b=y.filter((function(e){return g(e)}));return e===i.DfhConfig.ClASS_PK_TIME_SPAN?b=[]:(9===c.basic_type&&m.push(ve(e)),m.push((p=e,s=[{removed_from_api:!1,fk_profile:i.DfhConfig.PK_PROFILE_GEOVISTORY_BASIC}],{has_domain:p,pk_property:i.DfhConfig.PROPERTY_PK_P18_HAS_DEFINITION,has_range:785,domain_instances_max_quantifier:-1,domain_instances_min_quantifier:1,range_instances_max_quantifier:1,range_instances_min_quantifier:1,identifier_in_namespace:"P18",identity_defining:!1,is_inherited:!0,is_has_type_subproperty:!1,profiles:s}))),u.combineLatest(r.pipePropertiesToSubfields(m,!0,d,_,n),r.pipePropertiesToSubfields(b,!1,d,_,n),r.pipeFieldConfigs(e)).pipe(t.map((function(e){var t,n,r,o=k(e,3),p=o[0],s=o[1],a=o[2],u=v(p,s),c=l.indexBy((function(e){return[e.fk_domain_class||e.fk_range_class,e.fk_property,!!e.fk_domain_class].join("_")}),a),f={},y={};try{for(var d=h(u),g=d.next();!g.done;g=d.next()){var m=g.value,b=[m.sourceClass,m.property.pkProperty,m.isOutgoing].join("_"),P=[m.sourceClass,m.property.pkProperty,m.isOutgoing,m.targetClass].join("_"),$=c[b];if(f[b])y[P]||(!1===f[b].allSubfieldsRemovedFromAllProfiles?f[b].allSubfieldsRemovedFromAllProfiles=!1:f[b].allSubfieldsRemovedFromAllProfiles=m.removedFromAllProfiles,f[b].targetClasses.push(m.targetClass),f[b].targets[m.targetClass]={listType:m.listType,removedFromAllProfiles:m.removedFromAllProfiles,targetClass:m.targetClass,targetClassLabel:m.targetClassLabel});else{var j=!1;m.isHasTypeField?j="has-type":m.property.pkProperty===i.DfhConfig.PROPERTY_PK_HAS_TIME_SPAN&&(j="time-span"),f[b]={sourceClass:m.sourceClass,sourceClassLabel:m.sourceClassLabel,sourceMaxQuantity:m.sourceMaxQuantity,sourceMinQuantity:m.sourceMinQuantity,targetMinQuantity:m.targetMinQuantity,targetMaxQuantity:m.targetMaxQuantity,label:m.label,isHasTypeField:m.isHasTypeField,property:m.property,isOutgoing:m.isOutgoing,identityDefiningForSource:m.identityDefiningForSource,identityDefiningForTarget:m.identityDefiningForTarget,ontoInfoLabel:m.ontoInfoLabel,ontoInfoUrl:m.ontoInfoUrl,allSubfieldsRemovedFromAllProfiles:m.removedFromAllProfiles,targetClasses:[m.targetClass],fieldConfig:$,placeOfDisplay:$e(_.specialFields,m,$),isSpecialField:j,targets:(r={},r[m.targetClass]={listType:m.listType,removedFromAllProfiles:m.removedFromAllProfiles,targetClass:m.targetClass,targetClassLabel:m.targetClassLabel},r)},y[P]=!0}}}catch(e){t={error:e}}finally{try{g&&!g.done&&(n=d.return)&&n.call(d)}finally{if(t)throw t.error}}return l.values(f)})))})))},e.prototype.pipeSpecificFieldOfClass=function(e,n){return void 0===n&&(n=!1),this.pipeFields(e,n).pipe(t.map((function(e){return e.filter((function(e){return e.placeOfDisplay.specificFields})).sort((function(e,t){return e.placeOfDisplay.specificFields.position-t.placeOfDisplay.specificFields.position}))})))},e.prototype.pipeBasicFieldsOfClass=function(e,n){return void 0===n&&(n=!1),this.pipeFields(e,n).pipe(t.map((function(e){return e.filter((function(e){return e.placeOfDisplay.basicFields})).sort((function(e,t){return e.placeOfDisplay.basicFields.position-t.placeOfDisplay.basicFields.position}))})))},e.prototype.pipeFieldsForTeEnForm=function(e,n){return void 0===n&&(n=!1),this.pipeFields(e,n).pipe(t.map((function(e){var t=e.filter((function(e){return e.placeOfDisplay.specificFields&&!1===e.allSubfieldsRemovedFromAllProfiles})).sort((function(e,t){return e.placeOfDisplay.specificFields.position-e.placeOfDisplay.specificFields.position})),n=e.find((function(e){return e.property.pkProperty===i.DfhConfig.PROPERTY_PK_HAS_TIME_SPAN}));n&&t.push(n);var r=e.find((function(e){return e.isHasTypeField}));return r&&t.push(r),t})))},e.prototype.pipeBasicAndSpecificFields=function(e,n){return void 0===n&&(n=!1),u.combineLatest(this.pipeBasicFieldsOfClass(e,n),this.pipeSpecificFieldOfClass(e,n)).pipe(t.map((function(e){var t=k(e,2);return v(t[0],t[1])})))},e.prototype.pipeSpecificAndBasicFields=function(e,n){return void 0===n&&(n=!1),u.combineLatest(this.pipeSpecificFieldOfClass(e,n),this.pipeBasicFieldsOfClass(e,n)).pipe(t.map((function(e){var t=k(e,2);return v(t[0],t[1])})))},e.prototype.pipePropertiesToSubfields=function(e,t,n,i,o){var p=this;return void 0===o&&(o=!1),r.combineLatestOrEmpty(e.map((function(e){return p.pipeSubfield(t,e,i,n,o)})))},e.prototype.pipeSubfieldIdToSubfield=function(e,n,i,r,o){var p=this;void 0===o&&(o=!1);var s=r?e:i,a=r?i:e;return u.combineLatest(this.s.dfh$.property$.pk_property__has_domain__has_range$.key([n,s,a].join("_")).pipe(t.filter((function(e){return!!e}))),this.s.sys$.config$.main$.pipe(t.filter((function(e){return!!e}))),this.pipeProfilesEnabledByProject().pipe(t.filter((function(e){return!!e})))).pipe(t.switchMap((function(e){var t=k(e,3),n=t[0],i=t[1],s=t[2];return p.pipeSubfield(r,n,i,s,o)})))},e.prototype.pipeSubfield=function(e,n,i,r,o){void 0===o&&(o=!1);var p=e,s=p?n.has_range:n.has_domain,a=p?n.has_domain:n.has_range,c=p?n.range_instances_max_quantifier:n.domain_instances_max_quantifier,l=p?n.domain_instances_max_quantifier:n.range_instances_max_quantifier,f=p?n.range_instances_min_quantifier:n.domain_instances_min_quantifier,y=p?n.domain_instances_min_quantifier:n.range_instances_min_quantifier;return u.combineLatest(this.pipeClassLabel(a).pipe(t.tap((function(e){return e}))),this.pipeClassLabel(s).pipe(t.tap((function(e){return e}))),this.pipeSubfieldTypeOfClass(i,s,c,n.pk_property,o).pipe(t.tap((function(e){return e}))),this.pipeFieldLabel(n.pk_property,e?n.has_domain:null,e?null:n.has_range).pipe(t.tap((function(e){return e})))).pipe(t.map((function(e){var t=k(e,4),i=t[0],o=t[1],u=t[2],_=t[3];return{listType:u,sourceClass:a,sourceClassLabel:i,sourceMaxQuantity:l,sourceMinQuantity:y,targetClass:s,targetClassLabel:o,targetMinQuantity:f,targetMaxQuantity:c,label:_,isHasTypeField:p&&n.is_has_type_subproperty,property:{pkProperty:n.pk_property},isOutgoing:p,identityDefiningForSource:!!p&&n.identity_defining,identityDefiningForTarget:!p&&n.identity_defining,ontoInfoLabel:n.identifier_in_namespace,ontoInfoUrl:"https://ontome.dataforhistory.org/property/"+n.pk_property,removedFromAllProfiles:Pe(r,n.profiles||[])}})))},e.prototype.pipeSubfieldTypeOfClass=function(e,n,i,r,o){var p=this;return void 0===o&&(o=!1),this.s.dfh$.class$.by_pk_class$.key(n).pipe(t.filter((function(e){return!!e})),t.switchMap((function(t){return p.pipeSubfieldType(e,t,i,r,o)})))},e.prototype.pipeSubfieldType=function(e,n,r,o,p){void 0===p&&(p=!1);var s,a=function(e){return new u.BehaviorSubject(e)};if(e&&(s=e.classes[n.pk_class]),s&&s.valueObjectType)return a(s.valueObjectType);if(30===n.basic_type&&1==r)return a({typeItem:"true"});if(n.pk_class===i.DfhConfig.ClASS_PK_TIME_SPAN)return a({timeSpan:"true"});if(8===n.basic_type||30===n.basic_type||p)return a({entityPreview:"true"});return this.pipeSpecificAndBasicFields(n.pk_class,!0).pipe(t.map((function(e){var t,n,i=[];try{for(var r=h(e),p=r.next();!p.done;p=r.next()){var s=p.value,a={};for(var u in s.targets)if(Object.prototype.hasOwnProperty.call(s.targets,u)){var c=s.targets[u].listType,l=c.temporalEntity?{entityPreview:"true"}:c;a[u]=l}var f=!1;o&&s.property.pkProperty==o&&1===s.targetMaxQuantity&&(f=!0);var y={targets:a,page:{fkProperty:s.property.pkProperty,isOutgoing:s.isOutgoing,limit:1,offset:0,isCircular:f}};i.push(y)}}catch(e){t={error:e}}finally{try{p&&!p.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return{temporalEntity:i}})))},e.prototype.pipeFieldConfigs=function(e){var n=this;return this.a.pkProject$.pipe(t.switchMap((function(r){var o=s.proClassFieldConfgByProjectAndClassKey({fk_class_for_class_field:e,fk_project:r}),p=s.proClassFieldConfgByProjectAndClassKey({fk_class_for_class_field:e,fk_project:i.ProConfig.PK_PROJECT_OF_DEFAULT_CONFIG_PROJECT});return u.combineLatest(n.s.pro$.class_field_config$.by_fk_project__fk_class$.key(o),n.s.pro$.class_field_config$.by_fk_project__fk_class$.key(p)).pipe(t.map((function(e){var t=k(e,2),n=t[0],i=t[1];return n&&l.values(n).length?n:i})),t.map((function(e){return l.values(e).sort((function(e,t){return e.ord_num>t.ord_num?1:-1}))})))})))},e.prototype.pipeClassLabel=function(e){var n=this;return u.combineLatest(this.a.pkProject$,this.a.pipeActiveDefaultLanguage()).pipe(t.switchMap((function(i){var r=k(i,2),o=r[0],p=r[1];return n.pipeLabels({pkClass:e,fkProject:o,language:p,type:"label"}).pipe(t.map((function(t){var n=t.find((function(e){return!!e}));return n?n.text:"* no label (id: "+e+") *"})))})))},e.prototype.pipeLabels=function(e){var n;if(e.pkClass)switch(e.type){case"label":n=i.SysConfig.PK_SYSTEM_TYPE__TEXT_PROPERTY__LABEL;break;default:console.warn("fk_system_type not found")}else if(e.fkProperty)switch(e.type){case"label":n=i.SysConfig.PK_SYSTEM_TYPE__TEXT_PROPERTY__LABEL;break;default:console.warn("fk_system_type not found")}return u.combineLatest(this.pipeProTextProperty({fk_project:e.fkProject,fk_language:e.language.pk_entity,fk_system_type:n,fk_dfh_class:e.pkClass,fk_dfh_property:e.fkProperty,fk_dfh_property_domain:e.fkPropertyDomain,fk_dfh_property_range:e.fkPropertyRange}).pipe(t.map((function(e){if(e){return{origin:"of project in project lang",text:e.string}}}))),this.pipeProTextProperty({fk_project:i.ProConfig.PK_PROJECT_OF_DEFAULT_CONFIG_PROJECT,fk_language:e.language.pk_entity,fk_system_type:n,fk_dfh_class:e.pkClass,fk_dfh_property:e.fkProperty,fk_dfh_property_domain:e.fkPropertyDomain,fk_dfh_property_range:e.fkPropertyRange}).pipe(t.map((function(e){if(e){return{origin:"of default project in project lang",text:e.string}}}))),this.pipeProTextProperty({fk_project:i.ProConfig.PK_PROJECT_OF_DEFAULT_CONFIG_PROJECT,fk_language:18889,fk_system_type:n,fk_dfh_class:e.pkClass,fk_dfh_property:e.fkProperty,fk_dfh_property_domain:e.fkPropertyDomain,fk_dfh_property_range:e.fkPropertyRange}).pipe(t.map((function(e){if(e){return{origin:"of default project in english",text:e.string}}}))),this.pipeDfhLabel({language:e.language.iso6391.trim(),type:"label",fk_class:e.pkClass,fk_property:e.fkProperty}).pipe(t.map((function(e){if(e){return{origin:"of ontome in project lang",text:e.label}}}))),this.pipeDfhLabel({language:"en",type:"label",fk_class:e.pkClass,fk_property:e.fkProperty}).pipe(t.map((function(e){if(e){return{origin:"of ontome in english",text:e.label}}}))))},e.prototype.pipeProTextProperty=function(e){var t=s.textPropertyByFksKey(e);return this.s.pro$.text_property$.by_fks$.key(t)},e.prototype.pipeDfhLabel=function(e){var t=s.dfhLabelByFksKey(e);return this.s.dfh$.label$.by_fks$.key(t)},e.prototype.pipeFieldLabel=function(e,n,i){var r=this,o=!!n;return u.combineLatest(this.a.pkProject$,this.a.pipeActiveDefaultLanguage()).pipe(t.switchMap((function(p){var s=k(p,2),a=s[0],u=s[1];return r.pipeLabels({fkProject:a,type:"label",language:u,fkProperty:e,fkPropertyDomain:n,fkPropertyRange:i}).pipe(t.map((function(t){var n="* no label (id: "+e+") *";return t.some((function(e){return!e||"of project in project lang"!==e.origin&&"of default project in project lang"!==e.origin&&"of default project in english"!==e.origin?!e||"of ontome in project lang"!==e.origin&&"of ontome in english"!==e.origin?void 0:(n=o?e.text:"* reverse of: "+e.text+"*",!0):(n=e.text,!0)})),n})))})))},e.prototype.pipeTableNameOfClass=function(e){return u.combineLatest(this.s.sys$.config$.main$,this.s.dfh$.class$.by_pk_class$.key(e)).pipe(t.filter((function(e){return!e.includes(void 0)})),t.map((function(t){var n=k(t,2),i=n[0],r=n[1],o=i.classes[e];if(!o||!o.valueObjectType)return 8===r.basic_type||30===r.basic_type?"persistent_item":"temporal_entity";var p=Object.keys(o.valueObjectType);if(!o.valueObjectType.appellation){p[0];return o.valueObjectType.appellation?"appellation":o.valueObjectType.language?"language":o.valueObjectType.place?"place":o.valueObjectType.timePrimitive?"time_primitive":o.valueObjectType.langString?"lang_string":o.valueObjectType.dimension?"dimension":void console.warn("unsupported list type")}})))},e.prototype.pipeClassesInEntitiesOrSources=function(){return u.combineLatest(this.pipeClassesEnabledInEntities(),this.pipeClassesRequiredBySources()).pipe(t.map((function(e){var t=k(e,2),n=t[0],i=t[1];return l.indexBy((function(e){return e.toString()}),l.uniq(v(n,i)))})),t.startWith({}))},e.prototype.pipeClassesRequiredBySources=function(){return this.s.sys$.system_relevant_class$.by_required_by_sources$.key("true").pipe(t.map((function(e){return l.values(e).map((function(e){return e.fk_class}))})))},e.prototype.pipeClassesEnabledByProjectProfiles=function(){var e=this;return this.a.pkProject$.pipe(t.switchMap((function(n){return u.combineLatest([e.s.dfh$.class$.by_pk_class$.all$,e.pipeProfilesEnabledByProject()]).pipe(t.map((function(e){var t=k(e,2),n=t[0],i=t[1],r=l.indexBy((function(e){return e.toString()}),l.values(i));return l.values(n).filter((function(e){return e.profiles.some((function(e){return r[e.fk_profile]}))}))})))})))},e.prototype.pipeTypeClassesEnabledByProjectProfiles=function(){return u.combineLatest([this.s.dfh$.class$.by_basic_type$.key(30),this.pipeProfilesEnabledByProject()]).pipe(t.map((function(e){var t=k(e,2),n=t[0],r=t[1],o=l.indexBy((function(e){return e.toString()}),l.values(r));return l.values(n).filter((function(e){return e.profiles.some((function(e){return o[e.fk_profile]}))&&![i.DfhConfig.CLASS_PK_LANGUAGE,i.DfhConfig.CLASS_PK_MANIFESTATION_PRODUCT_TYPE].includes(e.pk_class)}))})))},e.prototype.pipeClassesEnabledInEntities=function(){var e=this;return this.a.pkProject$.pipe(t.switchMap((function(n){return e.s.pro$.dfh_class_proj_rel$.by_fk_project__enabled_in_entities$.key(n+"_true").pipe(t.map((function(e){return l.values(e).map((function(e){return e.fk_class}))})))})))},e.prototype.pipeSelectedTeEnClassesInProject=function(){return u.combineLatest(this.pipeTeEnClassesEnabledInEntities(),this.pipeTeEnClassesRequiredBySources()).pipe(t.map((function(e){var t=k(e,2),n=t[0],i=t[1];return l.indexBy((function(e){return e.toString()}),l.uniq(v(n,i)))})),t.startWith({}))},e.prototype.pipeTeEnClassesEnabledInEntities=function(){var e=this;return this.a.pkProject$.pipe(t.switchMap((function(n){return e.s.pro$.dfh_class_proj_rel$.by_fk_project__enabled_in_entities$.key(n+"_true").pipe(t.switchMap((function(n){return u.combineLatest(l.values(n).map((function(n){return e.s.dfh$.class$.by_pk_class$.key(n.fk_class).pipe(t.filter((function(e){return!!e})))}))).pipe(t.map((function(t){return e.filterTeEnCasses(t)})))})))})))},e.prototype.filterTeEnCasses=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];9===i.basic_type&&t.push(i.pk_class)}return t},e.prototype.pipeTeEnClassesRequiredBySources=function(){var e=this;return this.s.sys$.system_relevant_class$.by_required_by_sources$.key("true").pipe(t.switchMap((function(n){return u.combineLatest(l.values(n).map((function(n){return e.s.dfh$.class$.by_pk_class$.key(n.fk_class).pipe(t.filter((function(e){return!!e})))}))).pipe(t.map((function(t){return e.filterTeEnCasses(t)})))})))},e.prototype.pipeTypeAndTypedClasses=function(e){var n,i=this,r=this.s.sys$.system_relevant_class$.by_required_by_sources$.key("true").pipe(t.map((function(e){return l.values(e).map((function(e){return e.fk_class}))}))),o=this.pipeClassesEnabledInEntities();return n="sources"===e?[r]:"entities"===e?[o]:[r,o],u.combineLatest(n).pipe(t.map((function(e){return l.uniq(l.flatten(e))})),t.switchMap((function(e){return i.pipeTypeAndTypedClassesOfTypedClasses(e)})))},e.prototype.pipeTypeAndTypedClassesOfTypedClasses=function(e){return this.s.dfh$.property$.by_is_has_type_subproperty$.key("true").pipe(t.map((function(t){var n=l.indexBy((function(e){return e.has_domain.toString()}),l.values(t));return e.map((function(e){return{typedClass:e,typeClass:n[e]?n[e].has_range:void 0}}))})))},e.prototype.pipeTypeClassOfTypedClass=function(e){return this.s.dfh$.property$.by_is_has_type_subproperty$.key("true").pipe(t.map((function(t){var n=l.indexBy((function(e){return e.has_domain.toString()}),l.values(t));return n[e]?n[e].has_range:void 0})))},e.prototype.pipeTypedClassesOfTypeClasses=function(e){return this.s.dfh$.property$.by_is_has_type_subproperty$.key("true").pipe(t.map((function(t){var n=l.indexBy((function(e){return e.has_range.toString()}),l.values(t));return e.map((function(e){return n[e]?n[e].has_domain:void 0}))})))},e.prototype.pipeTypePropertyOfTypedClass=function(e){return this.s.dfh$.property$.by_is_has_type_subproperty$.key("true").pipe(t.map((function(t){var n=l.values(t).find((function(t){return t.has_domain===e}));return n?n.pk_property:void 0})))},e.prototype.pipeTargetClassesOfProperties=function(e,n){return this.s.dfh$.property$.by_pk_property$.all$.pipe(t.map((function(t){if(!e||!e.length)return[];var i=[],r={};return e.forEach((function(e){l.values(t[e]).forEach((function(e){var t=n?e.has_range:e.has_domain;r[t]||(r[t]=!0,i.push(t))}))})),i})))},e.decorators=[{type:p.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:he},{type:be}]},e.ngInjectableDef=p.ɵɵdefineInjectable({factory:function(){return new e(p.ɵɵinject(he),p.ɵɵinject(be))},token:e,providedIn:"root"}),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number,Object]),b("design:returntype",u.Observable)],e.prototype,"pipeFields",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number,Object]),b("design:returntype",u.Observable)],e.prototype,"pipeSpecificFieldOfClass",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number,Object]),b("design:returntype",u.Observable)],e.prototype,"pipeBasicFieldsOfClass",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number,Object]),b("design:returntype",u.Observable)],e.prototype,"pipeFieldsForTeEnForm",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number,Object]),b("design:returntype",u.Observable)],e.prototype,"pipeBasicAndSpecificFields",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number,Object]),b("design:returntype",u.Observable)],e.prototype,"pipeSpecificAndBasicFields",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Array,Boolean,Array,Object,Object]),b("design:returntype",u.Observable)],e.prototype,"pipePropertiesToSubfields",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number,Number,Number,Boolean,Object]),b("design:returntype",u.Observable)],e.prototype,"pipeSubfieldIdToSubfield",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Object,Number,Number,Number,Object]),b("design:returntype",u.Observable)],e.prototype,"pipeSubfieldTypeOfClass",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",u.Observable)],e.prototype,"pipeFieldConfigs",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",u.Observable)],e.prototype,"pipeClassLabel",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",u.Observable)],e.prototype,"pipeLabels",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",u.Observable)],e.prototype,"pipeProTextProperty",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",u.Observable)],e.prototype,"pipeDfhLabel",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number,Number,Number]),b("design:returntype",u.Observable)],e.prototype,"pipeFieldLabel",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",u.Observable)],e.prototype,"pipeTableNameOfClass",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",u.Observable)],e.prototype,"pipeClassesInEntitiesOrSources",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",void 0)],e.prototype,"pipeClassesRequiredBySources",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",u.Observable)],e.prototype,"pipeClassesEnabledByProjectProfiles",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",u.Observable)],e.prototype,"pipeTypeClassesEnabledByProjectProfiles",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",void 0)],e.prototype,"pipeClassesEnabledInEntities",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",u.Observable)],e.prototype,"pipeSelectedTeEnClassesInProject",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",void 0)],e.prototype,"pipeTeEnClassesEnabledInEntities",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",void 0)],e.prototype,"pipeTeEnClassesRequiredBySources",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[String]),b("design:returntype",u.Observable)],e.prototype,"pipeTypeAndTypedClasses",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Array]),b("design:returntype",u.Observable)],e.prototype,"pipeTypeAndTypedClassesOfTypedClasses",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",u.Observable)],e.prototype,"pipeTypeClassOfTypedClass",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Array]),b("design:returntype",u.Observable)],e.prototype,"pipeTypedClassesOfTypeClasses",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",u.Observable)],e.prototype,"pipeTypePropertyOfTypedClass",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Array,Boolean]),b("design:returntype",u.Observable)],e.prototype,"pipeTargetClassesOfProperties",null),e}();function ve(e){var t=[{removed_from_api:!1,fk_profile:i.DfhConfig.PK_PROFILE_GEOVISTORY_BASIC}];return{has_domain:e,pk_property:i.DfhConfig.PROPERTY_PK_HAS_TIME_SPAN,has_range:i.DfhConfig.ClASS_PK_TIME_SPAN,domain_instances_max_quantifier:-1,domain_instances_min_quantifier:1,range_instances_max_quantifier:1,range_instances_min_quantifier:1,identifier_in_namespace:"P4",identity_defining:!1,is_inherited:!0,is_has_type_subproperty:!1,profiles:t}}function Pe(e,t){return!t.some((function(t){return!1===t.removed_from_api&&e.includes(t.fk_profile)}))}function $e(e,t,n){var i;if(i=function(e,t,n){e.isOutgoing?e.isHasTypeField&&t.hasTypeSubproperties?n=t.hasTypeSubproperties:t.bySourceClass&&t.bySourceClass[e.sourceClass]&&t.bySourceClass[e.sourceClass].outgoingProperties&&t.bySourceClass[e.sourceClass].outgoingProperties[e.property.pkProperty]?n=t.bySourceClass[e.sourceClass].outgoingProperties[e.property.pkProperty]:t.outgoingProperties&&t.outgoingProperties[e.property.pkProperty]&&(n=t.outgoingProperties[e.property.pkProperty]):t.bySourceClass&&t.bySourceClass[e.sourceClass]&&t.bySourceClass[e.sourceClass].incomingProperties&&t.bySourceClass[e.sourceClass].incomingProperties[e.property.pkProperty]?n=t.bySourceClass[e.sourceClass].incomingProperties[e.property.pkProperty]:t.incomingProperties&&t.incomingProperties[e.property.pkProperty]&&(n=t.incomingProperties[e.property.pkProperty]);return n}(t,e,i)){if(i.displayInBasicFields)return{basicFields:{position:i.displayInBasicFields.position}};if(i.hidden)return{hidden:!0}}var r=Number.POSITIVE_INFINITY;return n&&(r=n.ord_num),{specificFields:{position:r}}}var je=function(){function e(e,n){var i=this;this.p=e,this.s=n,this.timePrimitiveOfStatements=function(){return u.pipe(t.map((function(e){return e[0]})),t.switchMap((function(e){return e?i.pipeInfTimePrimitive(e.fk_object_info).pipe(t.switchMap((function(n){return i.p.pkProject$.pipe(t.switchMap((function(r){return i.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(r+"_"+e[0].pk_entity).pipe(t.filter((function(e){return!!e})),t.map((function(e){return{calendar:e.calendar?e.calendar:"gregorian",julianDay:n.julian_day,duration:n.duration}})))})))}))):new u.BehaviorSubject(void 0)})))}}return e.prototype.pipeStatements=function(e,t){return t?this.pipeOutgoingStatements(e):this.pipeIngoingStatements(e)},e.prototype.pipeOutgoingStatements=function(e){return this.s.inf$.statement$.by_subject$({fk_subject_info:e})},e.prototype.pipeIngoingStatements=function(e){return this.s.inf$.statement$.by_object$({fk_object_info:e})},e.prototype.pipeOutgoingStatementsByProperty=function(e,t){return this.s.inf$.statement$.by_subject_and_property$({fk_property:e,fk_subject_info:t})},e.prototype.pipeIngoingStatementsByProperty=function(e,t){return this.s.inf$.statement$.by_object_and_property$({fk_property:e,fk_object_info:t})},e.prototype.pipeOutgoingBasicStatementItemsByProperty=function(e,n,i){var o=this;return this.s.inf$.statement$.by_subject_and_property$({fk_property:e,fk_subject_info:n}).pipe(t.switchMap((function(e){return r.combineLatestOrEmpty(e.map((function(e){return o.pipeBasicStatementItem(i,e,!0)})))})))},e.prototype.pipeIngoingBasicStatementItemsByProperty=function(e,n,i){var o=this;return this.s.inf$.statement$.by_object_and_property$({fk_property:e,fk_object_info:n}).pipe(t.switchMap((function(e){return r.combineLatestOrEmpty(e.map((function(e){return o.pipeBasicStatementItem(i,e,!1)})))})))},e.prototype.pipeBasicStatementItem=function(e,n,i){return this.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(e+"_"+n.pk_entity).pipe(t.filter((function(e){return!!e})),t.map((function(e){return{projRel:e,statement:n,label:"",ordNum:i?e.ord_num_of_range:e.ord_num_of_domain,isOutgoing:i}})))},e.prototype.pipeBasicStatementItemByPkStatement=function(e,n,i){var r=this;return this.s.inf$.statement$.by_pk_entity_key$(n).pipe(t.switchMap((function(t){return t?r.pipeBasicStatementItem(e,t,i):u.of(void 0)})))},e.prototype.pipeInfTimePrimitive=function(e){return this.s.inf$.time_primitive$.by_pk_entity$.key(e)},e.prototype.pipeTimeSpan=function(e){return u.combineLatest(this.pipeOutgoingStatementsByProperty(72,e).pipe(this.timePrimitiveOfStatements()),this.pipeOutgoingStatementsByProperty(71,e).pipe(this.timePrimitiveOfStatements()),this.pipeOutgoingStatementsByProperty(150,e).pipe(this.timePrimitiveOfStatements()),this.pipeOutgoingStatementsByProperty(151,e).pipe(this.timePrimitiveOfStatements()),this.pipeOutgoingStatementsByProperty(152,e).pipe(this.timePrimitiveOfStatements()),this.pipeOutgoingStatementsByProperty(153,e).pipe(this.timePrimitiveOfStatements())).pipe(t.map((function(e){var t=k(e,6),n=t[0],i=t[1],o=t[2],p=t[3],s=t[4],a=t[5];return new r.TimeSpanUtil({p82:n,p81:i,p82a:s,p81a:o,p81b:p,p82b:a})})))},e.prototype.pipeClassOfEntity=function(e){return u.merge(this.s.inf$.persistent_item$.by_pk_entity_key$(e).pipe(t.filter((function(e){return!!e})),t.map((function(e){return e.fk_class}))),this.s.inf$.temporal_entity$.by_pk_entity_key$(e).pipe(t.filter((function(e){return!!e})),t.map((function(e){return e.fk_class}))))},e.prototype.pipeClassesOfPersistentItems=function(e){return this.s.inf$.persistent_item$.by_pk_entity_all$().pipe(t.map((function(t){if(!e||0===e.length)return[];var n={},i=[];return e.forEach((function(e){n[t[e].fk_class]||(n[t[e].fk_class]=!0,i.push(t[e].fk_class))})),i})))},e.prototype.pipeRepoOutgoingStatements=function(e){return this.s.inf$.statement$.by_subject$({fk_subject_info:e},!1)},e.prototype.pipeRepoIngoingStatements=function(e){return this.s.inf$.statement$.by_object$({fk_object_info:e},!1)},e.prototype.pipeRepoOutgoingStatementsByProperty=function(e,n){var i=this;return u.combineLatest(this.s.dfh$.property$.by_pk_property$.key(e).pipe(t.filter((function(e){return!!e&&Object.keys(e).length>0})),t.map((function(e){return l.values(e)[0].range_instances_max_quantifier}))),this.s.inf$.statement$.by_subject_and_property$({fk_property:e,fk_subject_info:n},!1)).pipe(t.map((function(e){var t=k(e,2),n=t[0],r=t[1];if(0===r.length)return r;var o=i.sortStatementsByRepoPopularity(r);return-1===n||null===n?o:o.slice(0,n)})))},e.prototype.pipeRepoIngoingStatementsByProperty=function(e,n){var i=this;return u.combineLatest(this.s.dfh$.property$.by_pk_property$.key(e).pipe(t.filter((function(e){return!!e&&Object.keys(e).length>0})),t.map((function(e){return l.values(e)[0].domain_instances_max_quantifier}))),this.s.inf$.statement$.by_object_and_property$({fk_property:e,fk_object_info:n},!1)).pipe(t.map((function(e){var t=k(e,2),n=t[0],r=t[1];if(0===r.length)return r;var o=i.sortStatementsByRepoPopularity(r);return-1===n||null===n?o:o.slice(0,n)})))},e.prototype.pipeAlternativeBasicStatementItemByPkStatement=function(e,n){return u.combineLatest(this.s.inf$.statement$.by_pk_entity_key$(e,!1),this.s.inf$.statement$.by_pk_entity_key$(e)).pipe(t.filter((function(e){return!!k(e,1)[0]})),t.map((function(e){var t=k(e,2),i=t[0];if(!t[1])return{projRel:void 0,statement:i,ordNum:void 0,isOutgoing:n,label:""}})))},e.prototype.pipeAlternativeIngoingStatements=function(e,n){return u.combineLatest(this.s.inf$.statement$.by_object_and_property_indexed$({fk_property:e,fk_object_info:n},!1),this.s.inf$.statement$.by_object_and_property_indexed$({fk_property:e,fk_object_info:n}).pipe(t.map((function(e){return e?Object.keys(e):[]})))).pipe(t.map((function(e){var t=k(e,2),n=t[0],i=t[1];return l.omit(i,n)})),t.map((function(e){return l.values(e)})))},e.prototype.pipeAlternativeOutgoingStatements=function(e,n){return u.combineLatest(this.s.inf$.statement$.by_subject_and_property_indexed$({fk_property:e,fk_subject_info:n},!1),this.s.inf$.statement$.by_subject_and_property_indexed$({fk_property:e,fk_subject_info:n}).pipe(t.map((function(e){return e?Object.keys(e):[]})))).pipe(t.map((function(e){var t=k(e,2),n=t[0],i=t[1];return l.omit(i,n)})),t.map((function(e){return l.values(e)})))},e.prototype.pipePersistentItemPksByClass=function(e){return this.s.inf$.persistent_item$.by_fk_class_key$(e).pipe(t.map((function(e){return e?Object.keys(e).map((function(e){return parseInt(e,10)})):[]})))},e.prototype.pipeIconType=function(e){return this.p.streamEntityPreview(e).pipe(t.map((function(e){return"teEn"==e.entity_type?"temporal-entity":e.fk_class===i.DfhConfig.CLASS_PK_EXPRESSION_PORTION?"expression-portion":i.DfhConfig.CLASS_PKS_SOURCE_PE_IT.includes(e.fk_class)?"source":"persistent-entity"})))},e.prototype.sortStatementsByRepoPopularity=function(e){return e.sort((function(e,t){return e.is_in_project_count>t.is_in_project_count?1:-1}))},e.decorators=[{type:p.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:he},{type:be}]},e.ngInjectableDef=p.ɵɵdefineInjectable({factory:function(){return new e(p.ɵɵinject(he),p.ɵɵinject(be))},token:e,providedIn:"root"}),m([$,b("design:type",Function),b("design:paramtypes",[Number,Object]),b("design:returntype",u.Observable)],e.prototype,"pipeStatements",null),m([$,b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",u.Observable)],e.prototype,"pipeOutgoingStatements",null),m([$,b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",u.Observable)],e.prototype,"pipeIngoingStatements",null),m([$,b("design:type",Function),b("design:paramtypes",[Object,Object]),b("design:returntype",u.Observable)],e.prototype,"pipeOutgoingStatementsByProperty",null),m([$,b("design:type",Function),b("design:paramtypes",[Object,Object]),b("design:returntype",u.Observable)],e.prototype,"pipeIngoingStatementsByProperty",null),m([$,b("design:type",Function),b("design:paramtypes",[Object,Object,Number]),b("design:returntype",u.Observable)],e.prototype,"pipeOutgoingBasicStatementItemsByProperty",null),m([$,b("design:type",Function),b("design:paramtypes",[Object,Object,Number]),b("design:returntype",u.Observable)],e.prototype,"pipeIngoingBasicStatementItemsByProperty",null),m([$,b("design:type",Function),b("design:paramtypes",[Number,y.InfStatement,Boolean]),b("design:returntype",u.Observable)],e.prototype,"pipeBasicStatementItem",null),m([$,b("design:type",Function),b("design:paramtypes",[Number,Number,Boolean]),b("design:returntype",u.Observable)],e.prototype,"pipeBasicStatementItemByPkStatement",null),m([$,b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",u.Observable)],e.prototype,"pipeInfTimePrimitive",null),m([$,b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",u.Observable)],e.prototype,"pipeTimeSpan",null),m([$,b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",u.Observable)],e.prototype,"pipeClassOfEntity",null),m([$,b("design:type",Function),b("design:paramtypes",[Array]),b("design:returntype",u.Observable)],e.prototype,"pipeClassesOfPersistentItems",null),m([$,b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",u.Observable)],e.prototype,"pipeRepoOutgoingStatements",null),m([$,b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",u.Observable)],e.prototype,"pipeRepoIngoingStatements",null),m([$,b("design:type",Function),b("design:paramtypes",[Object,Object]),b("design:returntype",u.Observable)],e.prototype,"pipeRepoOutgoingStatementsByProperty",null),m([$,b("design:type",Function),b("design:paramtypes",[Object,Object]),b("design:returntype",u.Observable)],e.prototype,"pipeRepoIngoingStatementsByProperty",null),m([$,b("design:type",Function),b("design:paramtypes",[Number,Boolean]),b("design:returntype",u.Observable)],e.prototype,"pipeAlternativeBasicStatementItemByPkStatement",null),m([$,b("design:type",Function),b("design:paramtypes",[Object,Object]),b("design:returntype",u.Observable)],e.prototype,"pipeAlternativeIngoingStatements",null),m([$,b("design:type",Function),b("design:paramtypes",[Object,Object]),b("design:returntype",u.Observable)],e.prototype,"pipeAlternativeOutgoingStatements",null),m([$,b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",u.Observable)],e.prototype,"pipePersistentItemPksByClass",null),e}();var Oe=function(){function e(e,t,n,i,r,o,p){this.b=e,this.p=t,this.s=n,this.c=i,this.timePrimitivePipe=r,this.timeSpanPipe=o,this.infRepo=new z(p,u.of("repo"))}return e.prototype.pipeProjRelOfStatement=function(e,n){return n.scope.inProject?this.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(n.scope.inProject+"_"+e.pk_entity).pipe(t.map((function(e){return{projRel:e,ordNum:n.isOutgoing?e.ord_num_of_range:e.ord_num_of_domain}}))):new u.BehaviorSubject({projRel:void 0,ordNum:0})},e.prototype.pipeTargetOfStatement=function(e,n,i){var r=this,o=n.isOutgoing,p=o?e.fk_object_info:e.fk_subject_info;return this.s.inf$.getModelOfEntity$(p).pipe(t.filter((function(e){return!!e})),t.switchMap((function(s){var a=i[s.fkClass];if(a.appellation)return r.s.inf$.appellation$.by_pk_entity$.key(p).pipe(t.filter((function(e){return!!e})),t.map((function(t){return{statement:e,isOutgoing:o,targetLabel:t.string,targetClass:t.fk_class,target:{appellation:t}}})));if(a.place)return r.s.inf$.place$.by_pk_entity$.key(p).pipe(t.filter((function(e){return!!e})),t.map((function(t){return{statement:e,isOutgoing:o,targetLabel:"WGS84: "+t.lat+"°, "+t.long+"°",targetClass:t.fk_class,target:{place:t}}})));if(a.dimension)return r.s.inf$.dimension$.by_pk_entity$.key(p).pipe(t.filter((function(e){return!!e})),t.switchMap((function(n){return r.p.streamEntityPreview(n.fk_measurement_unit).pipe(t.map((function(t){return{statement:e,isOutgoing:o,targetLabel:n.numeric_value+" "+t.entity_label,targetClass:n.fk_class,target:{dimension:n}}})))})));if(a.langString)return r.s.inf$.lang_string$.by_pk_entity$.key(p).pipe(t.filter((function(e){return!!e})),t.switchMap((function(n){return r.s.inf$.language$.by_pk_entity$.key(n.fk_language).pipe(t.map((function(t){return{statement:e,isOutgoing:o,targetLabel:n.string+" ("+t.iso6391+")",targetClass:n.fk_class,target:{langString:n}}})))})));if(a.language)return r.s.inf$.language$.by_pk_entity$.key(p).pipe(t.filter((function(e){return!!e})),t.map((function(t){return{statement:e,isOutgoing:o,targetLabel:""+(t.notes||t.iso6391),targetClass:t.fk_class,target:{language:t}}})));if(a.entityPreview||a.typeItem)return r.p.streamEntityPreview(p).pipe(t.filter((function(e){return!!e})),t.map((function(t){return{statement:e,isOutgoing:o,targetLabel:""+t.entity_label,targetClass:t.fk_class,target:{entityPreview:t}}})));if(a.temporalEntity)return r.s.inf$.temporal_entity$._by_pk_entity$.key(p).pipe(t.filter((function(e){return!!e})),t.map((function(t){return{statement:e,isOutgoing:o,targetLabel:"",targetClass:t.fk_class,target:{entity:{pkEntity:t.pk_entity,fkClass:t.fk_class}}}})));if(a.timePrimitive)return r.s.inf$.time_primitive$.by_pk_entity$.key(p).pipe(t.filter((function(e){return!!e})),t.switchMap((function(i){return(n.scope.inProject?r.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(n.scope.inProject+"_"+e.pk_entity).pipe(t.map((function(e){return e.calendar}))):new u.BehaviorSubject(e.community_favorite_calendar)).pipe(t.map((function(t){var n=j(i,t);return{statement:e,isOutgoing:o,targetLabel:r.timePrimitivePipe.transform(n),targetClass:i.fk_class,target:{timePrimitive:n}}})))})));throw new Error("No implementation found for subfieldType "+JSON.stringify(a))})))},e.prototype.pipeStatementWithTarget=function(e,n,i){return u.combineLatest(this.pipeTargetOfStatement(e,n,i),this.pipeProjRelOfStatement(e,n)).pipe(t.map((function(e){var t=k(e,2),n=t[0],i=t[1];return g({},n,i)})))},e.prototype.pipeSubfieldPage=function(e,n){var o=this;return e.fkProperty===i.DfhConfig.PROPERTY_PK_HAS_TIME_SPAN&&e.isOutgoing?this.pipeTimeSpan(e):u.combineLatest(this.s.inf$.statement$.pagination$.pipeCount(e),this.s.inf$.statement$.pagination$.pipePage(e).pipe(t.switchMap((function(i){return r.combineLatestOrEmpty(i.map((function(i){return o.s.inf$.statement$.by_pk_entity$.key(i).pipe(t.filter((function(e){return!!e})),t.switchMap((function(t){return o.pipeStatementWithTarget(t,e,n)})))})))})))).pipe(t.map((function(e){var t=k(e,2);return{count:t[0],statements:t[1]}})))},e.prototype.pipeTimeSpan=function(e){var n,o=this,p={fk_object_info:e.fkSourceEntity},s=((n={})[i.DfhConfig.ClASS_PK_TIME_SPAN]={timeSpan:"true"},i.DfhConfig.PROPERTY_PKS_WHERE_TIME_PRIMITIVE_IS_RANGE.map((function(n){var r,p=e.scope.notInProject?{inRepo:!0}:e.scope,s={fkProperty:n,isOutgoing:!0,limit:1,offset:0,fkSourceEntity:e.fkSourceEntity,scope:p},a=((r={})[i.DfhConfig.CLASS_PK_TIME_PRIMITIVE]={timePrimitive:"true"},r);return o.pipeSubfieldPage(s,a).pipe(t.map((function(e){var t=e.count,n=e.statements;return{subfield:function(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}(s,["limit","offset"]),count:t,statements:n}})))})));return r.combineLatestOrEmpty(s).pipe(t.map((function(t){var n={};return t.forEach((function(e){if(e.statements[0]){var t=e.statements[0],r=i.DfhConfig.PROPERTY_PK_TO_EXISTENCE_TIME_KEY[t.statement.fk_property];n[r]=t.target.timePrimitive}})),{statement:p,isOutgoing:e.isOutgoing,targetLabel:o.timeSpanPipe.transform(new r.TimeSpanUtil(n)),targetClass:i.DfhConfig.ClASS_PK_TIME_SPAN,target:{timeSpan:{preview:n,subfields:t}}}}))).pipe(t.map((function(e){return{count:1,statements:[g({},e,{projRel:void 0,ordNum:void 0})]}})))},e.prototype.pipeLabelOfEntity=function(e){return this.p.streamEntityPreview(e).pipe(t.map((function(e){return e.entity_label})))},e.prototype.pipeClassLabelOfEntity=function(e){var n=this;return this.b.pipeClassOfEntity(e).pipe(t.switchMap((function(e){return n.c.pipeClassLabel(e)})))},e.prototype.pipeTypeOfEntity=function(e,n,i){return i?this.s.inf$.statement$.by_subject_and_property_indexed$({fk_property:n,fk_subject_info:e}).pipe(t.map((function(e){return!e||Object.keys(e).length<1?void 0:l.values(e)[0]}))):this.s.inf$.statement$.by_object_and_property_indexed$({fk_property:n,fk_object_info:e}).pipe(t.map((function(e){return!e||Object.keys(e).length<1?void 0:l.values(e)[0]})))},e.prototype.pipeClassesAndTypes=function(e){var n=this;return this.c.pipeTypeAndTypedClasses(e).pipe(t.switchMap((function(e){return n.pipeClassAndTypeNodes(e)})))},e.prototype.pipeClassesAndTypesOfClasses=function(e){var n=this;return this.c.pipeTypeAndTypedClassesOfTypedClasses(e).pipe(t.switchMap((function(e){return n.pipeClassAndTypeNodes(e)})))},e.prototype.pipeClassAndTypeNodes=function(e){var n=this;return r.combineLatestOrEmpty(e.map((function(e){return n.c.pipeClassLabel(e.typedClass).pipe(t.map((function(t){return{label:t,data:{pkClass:e.typedClass,pkType:null}}})),t.switchMap((function(i){return u.iif((function(){return!!e.typeClass}),n.b.pipePersistentItemPksByClass(e.typeClass).pipe(t.switchMap((function(i){return r.combineLatestOrEmpty(i.map((function(i){return n.p.streamEntityPreview(i).pipe(t.map((function(t){return{label:t.entity_label,data:{pkClass:e.typedClass,pkType:i}}})))}))).pipe(r.sortAbc((function(e){return e.label})))})),t.map((function(e){return i.children=e,i}))),u.of(g({},i,{children:[]})))})))}))).pipe(r.sortAbc((function(e){return e.label})))},e.prototype.pipeClassesFromClassesAndTypes=function(e){var n=this;return(e&&e.types&&e.types.length?this.b.pipeClassesOfPersistentItems(e.types).pipe(t.filter((function(e){return!!e})),t.switchMap((function(e){return n.c.pipeTypedClassesOfTypeClasses(e)}))):u.of([])).pipe(t.map((function(t){return l.uniq(v(t,(e||{classes:[]}).classes||[]))})))},e.prototype.pipePropertyOptionsFromClassesAndTypes=function(e){var n=this;return this.pipeClassesFromClassesAndTypes(e).pipe(t.switchMap((function(e){return n.pipePropertyOptionsFormClasses(e)})))},e.prototype.pipePropertyOptionsFormClasses=function(e){var n=this;return r.combineLatestOrEmpty(e.map((function(e){return n.s.dfh$.class$.by_pk_class$.key(e).pipe(t.map((function(e){return 9===e.basic_type})),t.switchMap((function(o){return n.c.pipeSpecificAndBasicFields(e).pipe(t.map((function(e){return e.filter((function(e){return!!e.property.pkProperty})).map((function(e){return{isOutgoing:e.isOutgoing,fkPropertyDomain:e.isOutgoing?e.sourceClass:null,fkPropertyRange:e.isOutgoing?null:e.sourceClass,pkProperty:e.property.pkProperty}}))})),t.switchMap((function(p){return o&&i.DfhConfig.PROPERTY_PKS_WHERE_TIME_PRIMITIVE_IS_RANGE.map((function(t){p.push({pkProperty:t,fkPropertyDomain:e,fkPropertyRange:i.DfhConfig.CLASS_PK_TIME_PRIMITIVE,isOutgoing:!0})})),r.combineLatestOrEmpty(p.map((function(e){return n.c.pipeFieldLabel(e.pkProperty,e.fkPropertyDomain,e.fkPropertyRange).pipe(t.map((function(t){var n=e.isOutgoing;return{isOutgoing:n,label:t,pk:e.pkProperty,propertyFieldKey:Ce(e.pkProperty,n)}})))})))})))})))}))).pipe(t.map((function(e){return l.flatten(e)})))},e.prototype.pipePkClassesFromPropertySelectModel=function(e){return r.combineLatestOrEmpty([this.c.pipeTargetClassesOfProperties(e.outgoingProperties,!0),this.c.pipeTargetClassesOfProperties(e.ingoingProperties,!1)]).pipe(t.map((function(e){var t=k(e,2),n=t[0],i=t[1];return l.uniq(v(n,i))})))},e.prototype.getPkClassesFromPropertySelectModel$=function(e){var n=this;return e.pipe(t.switchMap((function(e){return r.combineLatestOrEmpty([n.c.pipeTargetClassesOfProperties(e.outgoingProperties,!0),n.c.pipeTargetClassesOfProperties(e.ingoingProperties,!1)]).pipe(t.map((function(e){var t=k(e,2),n=t[0],i=t[1];return l.uniq(v(n,i))})))})))},e.prototype.getPropertyOptions$=function(e){var n=this;return e.pipe(t.distinctUntilChanged((function(e,t){return l.equals(e,t)})),t.switchMap((function(e){return e?n.b.pipeClassesOfPersistentItems(e.types).pipe(t.filter((function(e){return!!e})),t.switchMap((function(i){return n.c.pipeTypedClassesOfTypeClasses(i).pipe(t.switchMap((function(t){var i=l.uniq(v(t,e.classes||[]));return n.pipePropertyOptionsFormClasses(i)})))}))):u.empty()})))},e.decorators=[{type:p.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:je},{type:he},{type:be},{type:ke},{type:r.TimePrimitivePipe},{type:r.TimeSpanPipe},{type:a.NgRedux}]},e.ngInjectableDef=p.ɵɵdefineInjectable({factory:function(){return new e(p.ɵɵinject(je),p.ɵɵinject(he),p.ɵɵinject(be),p.ɵɵinject(ke),p.ɵɵinject(r.TimePrimitivePipe),p.ɵɵinject(r.TimeSpanPipe),p.ɵɵinject(a.NgRedux))},token:e,providedIn:"root"}),m([$,P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[String]),b("design:returntype",void 0)],e.prototype,"pipeClassesAndTypes",null),m([$,P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Array]),b("design:returntype",void 0)],e.prototype,"pipeClassesAndTypesOfClasses",null),m([$,P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Array]),b("design:returntype",u.Observable)],e.prototype,"pipeClassAndTypeNodes",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Array]),b("design:returntype",u.Observable)],e.prototype,"pipePropertyOptionsFormClasses",null),m([P({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",u.Observable)],e.prototype,"pipePkClassesFromPropertySelectModel",null),e}();function Ce(e,t){return"_"+e+"_"+(t?"outgoing":"ingoing")}e.ActiveProjectPipesService=he,e.ConfigurationPipesService=ke,e.DatSelector=w,e.DfhSelector=N,e.InfSelector=z,e.InformationBasicPipesService=je,e.InformationPipesService=Oe,e.ProSelector=se,e.ReduxQueriesModule=O,e.SchemaSelectorsService=be,e.ShouldPauseService=F,e.SysSelector=le,e.TabSelector=_e,e.WarSelector=me,e.cache=P,e.createHasTimeSpanProperty=ve,e.infTimePrimToTimePrimWithCal=j,e.propertyOptionFieldKey=Ce,e.spyTag=$,e.timeSpanItemToTimeSpan=function(e){var t=new r.TimeSpanUtil;return e.properties.forEach((function(e){var n=i.DfhConfig.PROPERTY_PK_TO_EXISTENCE_TIME_KEY[e.listDefinition.property.pkProperty];e.items&&e.items.length&&(t[n]=e.items[0].timePrimitive)})),t},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=kleiolab-lib-queries.umd.min.js.map