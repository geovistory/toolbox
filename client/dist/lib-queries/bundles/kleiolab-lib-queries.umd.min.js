!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs/operators"),require("rxjs-spy/operators"),require("@kleiolab/lib-config"),require("@kleiolab/lib-utils"),require("@angular/common"),require("@angular/core"),require("@kleiolab/lib-redux"),require("@angular-redux/store"),require("rxjs"),require("d3"),require("ramda"),require("@kleiolab/lib-sockets"),require("@kleiolab/lib-sdk-lb3")):"function"==typeof define&&define.amd?define("@kleiolab/lib-queries",["exports","rxjs/operators","rxjs-spy/operators","@kleiolab/lib-config","@kleiolab/lib-utils","@angular/common","@angular/core","@kleiolab/lib-redux","@angular-redux/store","rxjs","d3","ramda","@kleiolab/lib-sockets","@kleiolab/lib-sdk-lb3"],t):t(((e=e||self).kleiolab=e.kleiolab||{},e.kleiolab["lib-queries"]={}),e.rxjs.operators,e.operators$1,e.libConfig,e.libUtils,e.ng.common,e.ng.core,e.libRedux,e.store,e.rxjs,e.d3,e.ramda,e.libSockets,e.libSdkLb3)}(this,(function(e,t,n,i,r,p,o,s,a,u,c,f,l,y){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var _=function(e,t){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function m(e,t){function n(){this.constructor=e}_(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var d=function(){return(d=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function g(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(i=Object.getOwnPropertySymbols(e);r<i.length;r++)t.indexOf(i[r])<0&&Object.prototype.propertyIsEnumerable.call(e,i[r])&&(n[i[r]]=e[i[r]])}return n}function b(e,t,n,i){var r,p=arguments.length,o=p<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(o=(p<3?r(o):p>3?r(t,n,o):r(t,n))||o);return p>3&&o&&Object.defineProperty(t,n,o),o}function h(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function k(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function v(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,p=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=p.next()).done;)o.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}return o}function P(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(v(arguments[t]));return e}var $=function(e){return function(i,r,p){var o=d({refCount:!0},e),s=new Map,a=p.value;return p.value=function(){for(var e=[],p=0;p<arguments.length;p++)e[p]=arguments[p];var u=JSON.stringify(e);if(!s.has(u)){var c=a.bind(this);s.set(u,c.apply(void 0,P(e)).pipe(t.shareReplay({refCount:o.refCount,bufferSize:1}),n.tag("FROM-CACHE-"+i.constructor.name+"::"+r+"::"+e.join(":"))))}return s.get(u)},p}};function j(e,t,i){var r=i.value;return i.value=function(){for(var i=[],p=0;p<arguments.length;p++)i[p]=arguments[p];var o=r.bind(this);return o.apply(void 0,P(i)).pipe(n.tag(e.constructor.name+"::"+t+"::"+i.join(":")))},i}function O(e){var t=new r.TimeSpanUtil;return e.properties.forEach((function(e){var n=i.DfhConfig.PROPERTY_PK_TO_EXISTENCE_TIME_KEY[e.listDefinition.property.pkProperty];e.items&&e.items.length&&(t[n]=e.items[0].timePrimitive)})),t}function S(e,t){return{julianDay:e.julian_day,duration:e.duration,calendar:t}}var C=function(){function e(e,t){var n=[];if(e&&n.push("ReduxQueriesModule is already loaded. Import in your base AppModule only."),t||n.push("You need to import the ReduxModule in your AppModule!"),n.length)throw new Error(n.join("\n"))}return e.decorators=[{type:o.NgModule,args:[{declarations:[],imports:[p.CommonModule],providers:[]}]}],e.ctorParameters=function(){return[{type:e,decorators:[{type:o.Optional},{type:o.SkipSelf}]},{type:s.ReduxModule,decorators:[{type:o.Optional}]}]},e}(),I=function(){function e(e,t,n){this.ngRedux=e,this.configs=t,this.model=n}return e.prototype.selector=function(e){var t=this;return{all$:this.ngRedux.select([s.datRoot,this.model,e]),key:function(n){return t.ngRedux.select([s.datRoot,t.model,e,n])}}},e}();var R=function(e){function n(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity__entity_version$=r.selector("by_pk_entity__entity_version"),r.by_pk_entity$=r.selector("by_pk_entity"),r.by_pk_text$=r.selector("by_pk_text"),r}return m(n,e),n.prototype.latestVersion=function(e){return this.by_pk_entity$.key(e).pipe(t.map((function(e){return r.latestVersion(e)})))},n}(I);var T=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_project$=r.selector("by_fk_project"),r}return m(t,e),t}(I);var w=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_text$=r.selector("by_fk_text"),r}return m(t,e),t}(I);var x=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_column$=r.selector("by_fk_column"),r}return m(t,e),t}(I);var E=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_digital$=r.selector("by_fk_digital"),r}return m(t,e),t}(I);var L=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_entity__fk_system_type$=r.selector("by_fk_entity__fk_system_type"),r}return m(t,e),t}(I);var F=function(e){function t(t){var n=e.call(this,t)||this;return n.ngRedux=t,n.digital$=new R(n.ngRedux,s.datDefinitions,"digital"),n.namespace$=new T(n.ngRedux,s.datDefinitions,"namespace"),n.chunk$=new w(n.ngRedux,s.datDefinitions,"chunk"),n.column$=new E(n.ngRedux,s.datDefinitions,"column"),n.class_column_mapping$=new x(n.ngRedux,s.datDefinitions,"class_column_mapping"),n.text_property$=new L(n.ngRedux,s.datDefinitions,"text_property"),n}return m(t,e),t.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:a.NgRedux}]},t.ngInjectableDef=o.ɵɵdefineInjectable({factory:function(){return new t(o.ɵɵinject(a.NgRedux))},token:t,providedIn:"root"}),t}(s.DatActions);var A=function(){function e(){this.shouldPause$=new u.BehaviorSubject(!1)}return e.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=o.ɵɵdefineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}();var D=function(){function e(e,t,n,i){this.ngRedux=e,this.configs=t,this.model=n,this.shouldPause$=i,this.slice$=this.ngRedux.select([s.dfhRoot,this.model])}return e.prototype.selector=function(e){var n=this,i=this.ngRedux.select([s.dfhRoot,this.model,e]);return{all$:this.shouldPause$.pipe(t.switchMap((function(e){return e?u.empty():i}))),key:function(i){return n.shouldPause$.pipe(t.switchMap((function(t){return t?u.empty():n.ngRedux.select([s.dfhRoot,n.model,e,i])})))},noPause:{all$:i,key:function(t){return n.ngRedux.select([s.dfhRoot,n.model,e,t])}}}},e}();var M=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.by_pk_profile$=t.selector("by_pk_profile"),t}return m(t,e),t}(D);var B=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.by_pk_class$=t.selector("by_pk_class"),t.by_basic_type$=t.selector("by_basic_type"),t}return m(t,e),t}(D);var N=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pk_property__has_domain__has_range$=t.selector("by_pk_property__has_domain__has_range"),t.by_pk_property$=t.selector("by_pk_property"),t.by_has_domain$=t.selector("by_has_domain"),t.by_has_range$=t.selector("by_has_range"),t.by_is_has_type_subproperty$=t.selector("by_is_has_type_subproperty"),t}return m(t,e),t}(D);var q=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.by_fks$=t.selector("by_fks"),t.by_fk_class__type$=t.selector("by_fk_class__type"),t.by_fk_property__type$=t.selector("by_fk_property__type"),t.by_fk_profile__type$=t.selector("by_fk_profile__type"),t}return m(t,e),t}(D);var K=function(e){function t(t,n){var i=e.call(this,t)||this;return i.ngRedux=t,i.pause=n,i.profile$=new M(i.ngRedux,s.dfhDefinitions,"profile",i.pause.shouldPause$),i.class$=new B(i.ngRedux,s.dfhDefinitions,"klass",i.pause.shouldPause$),i.property$=new N(i.ngRedux,s.dfhDefinitions,"property",i.pause.shouldPause$),i.label$=new q(i.ngRedux,s.dfhDefinitions,"label",i.pause.shouldPause$),i}return m(t,e),t.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:a.NgRedux},{type:A}]},t.ngInjectableDef=o.ɵɵdefineInjectable({factory:function(){return new t(o.ɵɵinject(a.NgRedux),o.ɵɵinject(A))},token:t,providedIn:"root"}),t}(s.DfhActions);var W=function(){function e(e,t,n,i){this.ngRedux=e,this.pkProject$=t,this.configs=n,this.model=i}return e.prototype.selector=function(e){var t=this;return{all$:this.ngRedux.select([s.infRoot,this.model,e]),key:function(n){return t.ngRedux.select([s.infRoot,t.model,e,n],f.equals)}}},e.prototype.paginationSelector=function(){var e=this;return{pipePage:function(n){var i,p=s.paginateBy,o=s.subfieldIdToString(n);return i=[s.infRoot,e.model,p,o],e.ngRedux.select(P(i,["count"])).pipe(t.filter((function(e){return void 0!==e})),t.switchMap((function(p){for(var o=n.offset,s=p<=o+n.limit?p:o+n.limit,a=[],u=o;u<s;u++)a.push(e.ngRedux.select(P(i,["rows",u])).pipe(t.filter((function(e){return!!e}))));return r.combineLatestOrEmpty(a)})))},pipeCount:function(t){var n,i=s.paginateBy,r=s.subfieldIdToString(t);return n=[s.infRoot,e.model,i,r],e.ngRedux.select(P(n,["count"]))},pipePageLoadNeeded:function(n,i){var r,p=s.paginateBy,o=s.subfieldIdToString(n);r=[s.infRoot,e.model,p,o];var a=s.getFromTo(n.limit,n.offset);return i.pipe(t.switchMap((function(){return e.ngRedux.select(P(r,["loading",a])).pipe(t.first(),t.map((function(e){return!e})))})))}}},e.prototype.pipeItemsInProject=function(e,n){var i=this;return u.pipe(t.switchMap((function(p){return e.pipe(t.switchMap((function(e){var o=[],s=function(r){if(p.hasOwnProperty(r)){var s=p[r];o.push(i.ngRedux.select(["pro","info_proj_rel","by_fk_project__fk_entity",e+"_"+n(s)]).pipe(t.map((function(e){return{key:r,rel:e}}))))}};for(var a in p)s(a);return r.combineLatestOrEmpty(o).pipe(t.map((function(e){for(var t={},n=0;n<e.length;n++){var i=e[n];i.rel&&i.rel.is_in_project&&(t[i.key]=p[i.key])}return t})))})))})))},e.prototype.pipeItemInProject=function(e,n){var i=this;return u.pipe(t.switchMap((function(r){return r?e.pipe(t.switchMap((function(e){return i.ngRedux.select(["pro","info_proj_rel","by_fk_project__fk_entity",e+"_"+n(r)]).pipe(t.map((function(e){return e&&1==e.is_in_project?r:void 0})))}))):u.of(void 0)})))},e}();var Y=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p._by_pk_entity$=p.selector("by_pk_entity"),p._by_fk_class$=p.selector("by_fk_class"),p}return m(t,e),t.prototype.by_pk_entity_key$=function(e,t){void 0===t&&(t=!0);var n=this._by_pk_entity$.key(e);return t?n.pipe(this.pipeItemInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t.prototype.by_pk_entity_all$=function(e){void 0===e&&(e=!0);var t=this._by_pk_entity$.all$;return e?t.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):t},t.prototype.by_fk_class_key$=function(e,t){void 0===t&&(t=!0);var n=this._by_fk_class$.key(e);return t?n.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t}(W);var U=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p._by_pk_entity$=p.selector("by_pk_entity"),p}return m(t,e),t.prototype.by_pk_entity_key$=function(e,t){void 0===t&&(t=!0);var n=this._by_pk_entity$.key(e);return t?n.pipe(this.pipeItemInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t}(W);var Q=function(e){function n(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p.by_pk_entity$=p.selector("by_pk_entity"),p.by_fk_subject_data$=p.selector("by_fk_subject_data"),p.pagination$=p.paginationSelector(),p}return m(n,e),n.prototype.by_pk_entity_key$=function(e,t){void 0===t&&(t=!0);var n=this.by_pk_entity$.key(e);return t?n.pipe(this.pipeItemInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},n.prototype.by_subject$=function(e,n){void 0===n&&(n=!0);var i=s.indexStatementBySubject(e),r=this.selector("by_subject").key(i);return n?r.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity})),t.map((function(e){return c.values(e)}))):r.pipe(t.map((function(e){return c.values(e)})))},n.prototype.by_subject_and_property$=function(e,n){return void 0===n&&(n=!0),this.by_subject_and_property_indexed$(e,n).pipe(t.map((function(e){return c.values(e)})))},n.prototype.by_subject_and_property_indexed$=function(e,t){void 0===t&&(t=!0);var n=s.indexStatementBySubjectProperty(e),i=this.selector("by_subject+property").key(n);return t?i.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):i},n.prototype.by_object$=function(e,n){void 0===n&&(n=!0);var i=s.indexStatementByObject(e),r=this.selector("by_object").key(i);return n?r.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity})),t.map((function(e){return c.values(e)}))):r.pipe(t.map((function(e){return c.values(e)})))},n.prototype.by_object_and_property$=function(e,n){return void 0===n&&(n=!0),this.by_object_and_property_indexed$(e,n).pipe(t.map((function(e){return c.values(e)})))},n.prototype.by_object_and_property_indexed$=function(e,t){void 0===t&&(t=!0);var n=s.indexStatementByObjectProperty(e),i=this.selector("by_object+property").key(n);return t?i.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):i},n}(W);var H=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p._by_pk_entity$=p.selector("by_pk_entity"),p._by_fk_concerned_entity__fk_class_field$=p.selector("by_fk_concerned_entity__fk_class_field"),p._by_fk_concerned_entity$=p.selector("by_fk_concerned_entity"),p}return m(t,e),t.prototype.by_pk_entity_key$=function(e,t){void 0===t&&(t=!0);var n=this._by_pk_entity$.key(e);return t?n.pipe(this.pipeItemInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t.prototype.by_fk_concerned_entity__fk_class_field_indexed$=function(e,t){void 0===t&&(t=!0);var n=this._by_fk_concerned_entity__fk_class_field$.key(e);return t?n.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t.prototype.by_fk_concerned_entity_indexed$=function(e,t){void 0===t&&(t=!0);var n=this._by_fk_concerned_entity$.key(e);return t?n.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t}(W);var G=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p.by_pk_entity$=p.selector("by_pk_entity"),p}return m(t,e),t}(W);var V=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p.by_pk_entity$=p.selector("by_pk_entity"),p}return m(t,e),t}(W);var J=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p.by_pk_entity$=p.selector("by_pk_entity"),p}return m(t,e),t}(W);var X=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p.by_pk_entity$=p.selector("by_pk_entity"),p}return m(t,e),t}(W);var z=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p.by_pk_entity$=p.selector("by_pk_entity"),p}return m(t,e),t}(W);var Z=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p.by_pk_entity$=p.selector("by_pk_entity"),p}return m(t,e),t}(W);var ee=function(){function e(e,t){this.ngRedux=e,this.pkProject$=t,this.persistent_item$=new Y(this.ngRedux,this.pkProject$,s.infDefinitions,"persistent_item"),this.temporal_entity$=new U(this.ngRedux,this.pkProject$,s.infDefinitions,"temporal_entity"),this.statement$=new Q(this.ngRedux,this.pkProject$,s.infDefinitions,"statement"),this.appellation$=new G(this.ngRedux,this.pkProject$,s.infDefinitions,"appellation"),this.place$=new J(this.ngRedux,this.pkProject$,s.infDefinitions,"place"),this.text_property$=new H(this.ngRedux,this.pkProject$,s.infDefinitions,"text_property"),this.lang_string$=new V(this.ngRedux,this.pkProject$,s.infDefinitions,"lang_string"),this.time_primitive$=new X(this.ngRedux,this.pkProject$,s.infDefinitions,"time_primitive"),this.language$=new z(this.ngRedux,this.pkProject$,s.infDefinitions,"language"),this.dimension$=new Z(this.ngRedux,this.pkProject$,s.infDefinitions,"dimension"),this.pkEntityModelMap$=this.ngRedux.select([s.infRoot,s.PR_ENTITY_MODEL_MAP])}return e.prototype.getModelOfEntity$=function(e){return this.ngRedux.select([s.infRoot,s.PR_ENTITY_MODEL_MAP,e])},e}();var te=function(){function e(e,t,n){this.ngRedux=e,this.configs=t,this.model=n}return e.prototype.selector=function(e){var t=this;return{all$:this.ngRedux.select([s.proRoot,this.model,e]),key:function(n){var i="string"==typeof n?n:n.map((function(e){return f.toString(e)})).join("_");return t.ngRedux.select([s.proRoot,t.model,e,i])}}},e}();var ne=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r}return m(t,e),t}(te);var ie=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_fk_project__fk_entity$=r.selector("by_fk_project__fk_entity"),r}return m(t,e),t}(te);var re=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_fk_project__enabled_in_entities$=r.selector("by_fk_project__enabled_in_entities"),r.by_fk_project__fk_class$=r.selector("by_fk_project__fk_class"),r.by_fk_project$=r.selector("by_fk_project"),r}return m(t,e),t}(te);var pe=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_fk_project__enabled$=r.selector("by_fk_project__enabled"),r.by_fk_project__fk_profile$=r.selector("by_fk_project__fk_profile"),r.by_fk_project$=r.selector("by_fk_project"),r}return m(t,e),t}(te);var oe=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_fk_project__fk_class$=r.selector("by_fk_project__fk_class"),r.by_pk_entity$=r.selector("by_pk_entity"),r}return m(t,e),t}(te);var se=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_fks$=r.selector("by_fks"),r.by_fks_without_lang$=r.selector("by_fks_without_lang"),r}return m(t,e),t}(te);var ae=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r}return m(t,e),t}(te);var ue=function(e){function t(t){var n=e.call(this,t)||this;return n.ngRedux=t,n.project$=new ne(n.ngRedux,s.proDefinitions,"project"),n.info_proj_rel$=new ie(n.ngRedux,s.proDefinitions,"info_proj_rel"),n.dfh_class_proj_rel$=new re(n.ngRedux,s.proDefinitions,"dfh_class_proj_rel"),n.dfh_profile_proj_rel$=new pe(n.ngRedux,s.proDefinitions,"dfh_profile_proj_rel"),n.class_field_config$=new oe(n.ngRedux,s.proDefinitions,"class_field_config"),n.text_property$=new se(n.ngRedux,s.proDefinitions,"text_property"),n.analysis$=new ae(n.ngRedux,s.proDefinitions,"analysis"),n}return m(t,e),t.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:a.NgRedux}]},t.ngInjectableDef=o.ɵɵdefineInjectable({factory:function(){return new t(o.ɵɵinject(a.NgRedux))},token:t,providedIn:"root"}),t}(s.ProActions);var ce=function(){function e(e,t,n){this.ngRedux=e,this.configs=t,this.model=n,this.slice$=this.ngRedux.select([s.sysRoot,this.model])}return e.prototype.selector=function(e){var t=this;return{all$:this.ngRedux.select([s.sysRoot,this.model,e]),key:function(n){return t.ngRedux.select([s.sysRoot,t.model,e,n])}}},e}();var fe=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_class$=r.selector("by_fk_class"),r.by_required_by_sources$=r.selector("by_required_by_sources"),r.by_required$=r.selector("by_required"),r}return m(t,e),t}(ce);var le=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.main$=r.ngRedux.select([s.sysRoot,r.model,"by_main","main"]),r}return m(t,e),t}(ce);var ye=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.system_relevant_class$=new fe(t.ngRedux,s.sysDefinitions,"system_relevant_class"),t.config$=new le(t.ngRedux,s.sysDefinitions,"config"),t}return m(t,e),t.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],t.ngInjectableDef=o.ɵɵdefineInjectable({factory:function(){return new t(o.ɵɵinject(a.NgRedux))},token:t,providedIn:"root"}),t}(s.SysActions);var _e=function(){function e(e,t,n){this.ngRedux=e,this.configs=t,this.model=n}return e.prototype.selector=function(e){var t=this;return{all$:this.ngRedux.select([s.tabRoot,this.model,e]),key:function(n){return t.ngRedux.select([s.tabRoot,t.model,e,n])}}},e}();var me=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_cell$=r.selector("by_pk_cell"),r.by_fk_column_fk_row$=r.selector("by_fk_column_fk_row"),r}return m(t,e),t}(_e);var de=function(e){function t(t){var n=e.call(this,t)||this;return n.ngRedux=t,n.cell$=new me(n.ngRedux,s.tabDefinitions,"cell"),n}return m(t,e),t.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:a.NgRedux}]},t.ngInjectableDef=o.ɵɵdefineInjectable({factory:function(){return new t(o.ɵɵinject(a.NgRedux))},token:t,providedIn:"root"}),t}(s.TabActions);var ge=function(){function e(e,t,n){this.ngRedux=e,this.configs=t,this.model=n}return e.prototype.selector=function(e){var t=this;return{all$:this.ngRedux.select([s.warRoot,this.model,e]),key:function(n){var i="string"==typeof n?n:n.map((function(e){return f.toString(e)})).join("_");return t.ngRedux.select([s.warRoot,t.model,e,i])}}},e}();var be=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r}return m(t,e),t}(ge);var he=function(e){function t(t){var n=e.call(this,t)||this;return n.ngRedux=t,n.entity_preview$=new be(n.ngRedux,s.warDefinitions,"entity_preview"),n}return m(t,e),t.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:a.NgRedux}]},t.ngInjectableDef=o.ɵɵdefineInjectable({factory:function(){return new t(o.ɵɵinject(a.NgRedux))},token:t,providedIn:"root"}),t}(s.WarActions);var ke=function(){function e(e,n,i,r,p,o){this.dat$=n,this.tab$=i,this.pro$=r,this.dfh$=p,this.sys$=o;var s=e.select(["activeProject","pk_project"]).pipe(t.filter((function(e){return void 0!==e})),t.distinctUntilChanged((function(e,t){return e===t})));this.inf$=new ee(e,s)}return e.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:a.NgRedux},{type:F},{type:de},{type:ue},{type:K},{type:ye}]},e.ngInjectableDef=o.ɵɵdefineInjectable({factory:function(){return new e(o.ɵɵinject(a.NgRedux),o.ɵɵinject(F),o.ɵɵinject(de),o.ɵɵinject(ue),o.ɵɵinject(K),o.ɵɵinject(ye))},token:e,providedIn:"root"}),e}();var ve=function(){function e(e,n,i){var r=this;this.ngRedux=e,this.s=n,this.entityPreviewSocket=i,this.requestedEntityPreviews={},this.pkProject$=e.select(["activeProject","pk_project"]).pipe(t.filter((function(e){return void 0!==e})),t.distinctUntilChanged((function(e,t){return e===t}))),this.entityPreviewSocket.fromEvent("reconnect").subscribe((function(e){r.pkProject$.pipe(t.first()).subscribe((function(e){var t=Object.keys(d({},r.ngRedux.getState().war.entity_preview,r.requestedEntityPreviews));t.length&&r.entityPreviewSocket.emit("addToStream",{pkProject:e,pks:t})}))}))}return e.prototype.pipeActiveProject=function(){var e=this;return this.pkProject$.pipe(t.switchMap((function(t){return e.s.pro$.project$.by_pk_entity$.key(t.toString())}))).pipe(t.filter((function(e){return!!e})))},e.prototype.pipeActiveDefaultLanguage=function(){var e=this;return this.pipeActiveProject().pipe(t.filter((function(e){return!!e})),t.switchMap((function(t){return e.s.inf$.language$.by_pk_entity$.key(t.fk_language.toString())}))).pipe(t.filter((function(e){return!!e})))},e.prototype.streamEntityPreview=function(e,n){var i=this;return(!(((this.ngRedux.getState().war||{}).entity_preview||{}).by_pk_entity||{})[e]&&!this.requestedEntityPreviews[e]||n)&&this.pkProject$.pipe(t.first((function(e){return!!e}))).subscribe((function(t){i.entityPreviewSocket.emit("addToStream",{pkProject:t,pks:[e]}),i.requestedEntityPreviews[e]=!0})),this.ngRedux.select(["war","entity_preview","by_pk_entity",e]).pipe(t.distinctUntilChanged(f.equals),t.filter((function(e){return!!e})))},e.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:a.NgRedux},{type:ke},{type:l.EntityPreviewSocket}]},e.ngInjectableDef=o.ɵɵdefineInjectable({factory:function(){return new e(o.ɵɵinject(a.NgRedux),o.ɵɵinject(ke),o.ɵɵinject(l.EntityPreviewSocket))},token:e,providedIn:"root"}),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",u.Observable)],e.prototype,"pipeActiveProject",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",u.Observable)],e.prototype,"pipeActiveDefaultLanguage",null),e}();var Pe=function(){function e(e,t){this.a=e,this.s=t}return e.prototype.pipeProfilesEnabledByProject=function(){var e=this;return this.a.pkProject$.pipe(t.switchMap((function(n){return e.s.pro$.dfh_profile_proj_rel$.by_fk_project__enabled$.key(n+"_true").pipe(t.map((function(e){return f.values(e).filter((function(e){return e.enabled})).map((function(e){return e.fk_profile}))})),t.map((function(e){return P(e,[i.DfhConfig.PK_PROFILE_GEOVISTORY_BASIC])})))})),t.shareReplay())},e.prototype.pipeFields=function(e,n){var r=this;return void 0===n&&(n=!1),u.combineLatest(this.s.dfh$.class$.by_pk_class$.key(e),this.s.dfh$.property$.by_has_domain$.key(e).pipe(t.map((function(e){return f.values(e)}))),this.s.dfh$.property$.by_has_range$.key(e).pipe(t.map((function(e){return f.values(e)}))),this.s.sys$.config$.main$.pipe(t.filter((function(e){return!!e}))),this.pipeProfilesEnabledByProject()).pipe(t.switchMap((function(p){var o,s,a=v(p,5),c=a[0],l=a[1],y=a[2],_=a[3],m=a[4];return e===i.DfhConfig.ClASS_PK_TIME_SPAN?y=[]:(9===c.basic_type&&l.push($e(e)),l.push((o=e,s=[{removed_from_api:!1,fk_profile:i.DfhConfig.PK_PROFILE_GEOVISTORY_BASIC}],{has_domain:o,pk_property:i.DfhConfig.PROPERTY_PK_P18_HAS_DEFINITION,has_range:785,domain_instances_max_quantifier:-1,domain_instances_min_quantifier:1,range_instances_max_quantifier:1,range_instances_min_quantifier:1,identifier_in_namespace:"P18",identity_defining:!1,is_inherited:!0,is_has_type_subproperty:!1,profiles:s}))),u.combineLatest(r.pipePropertiesToSubfields(l,!0,m,_,n),r.pipePropertiesToSubfields(y,!1,m,_,n),r.pipeFieldConfigs(e)).pipe(t.map((function(e){var t,n,r=v(e,3),p=r[0],o=r[1],s=r[2],a=P(p,o),u=f.indexBy((function(e){return[e.fk_domain_class||e.fk_range_class,e.fk_property,!!e.fk_domain_class].join("_")}),s),c={},l={};try{for(var y=k(a),m=y.next();!m.done;m=y.next()){var d=m.value,g=[d.sourceClass,d.property.pkProperty,d.isOutgoing].join("_"),b=[d.sourceClass,d.property.pkProperty,d.isOutgoing,d.targetClass].join("_"),h=u[g];if(c[g])l[b]||(!1===c[g].allSubfieldsRemovedFromAllProfiles?c[g].allSubfieldsRemovedFromAllProfiles=!1:c[g].allSubfieldsRemovedFromAllProfiles=d.removedFromAllProfiles,c[g].targetClasses.push(d.targetClass),c[g].listDefinitions.push(d));else{var $=!1;d.isHasTypeField?$="has-type":d.property.pkProperty===i.DfhConfig.PROPERTY_PK_HAS_TIME_SPAN&&($="time-span"),c[g]={sourceClass:d.sourceClass,sourceClassLabel:d.sourceClassLabel,sourceMaxQuantity:d.sourceMaxQuantity,sourceMinQuantity:d.sourceMinQuantity,targetMinQuantity:d.targetMinQuantity,targetMaxQuantity:d.targetMaxQuantity,label:d.label,isHasTypeField:d.isHasTypeField,property:d.property,isOutgoing:d.isOutgoing,identityDefiningForSource:d.identityDefiningForSource,identityDefiningForTarget:d.identityDefiningForTarget,ontoInfoLabel:d.ontoInfoLabel,ontoInfoUrl:d.ontoInfoUrl,allSubfieldsRemovedFromAllProfiles:d.removedFromAllProfiles,targetClasses:[d.targetClass],listDefinitions:[d],fieldConfig:h,placeOfDisplay:Oe(_.specialFields,d,h),isSpecialField:$},l[b]=!0}}}catch(e){t={error:e}}finally{try{m&&!m.done&&(n=y.return)&&n.call(y)}finally{if(t)throw t.error}}return f.values(c)})))})))},e.prototype.pipeSpecificFieldOfClass=function(e,n){return void 0===n&&(n=!1),this.pipeFields(e,n).pipe(t.map((function(e){return e.filter((function(e){return e.placeOfDisplay.specificFields})).sort((function(e,t){return e.placeOfDisplay.specificFields.position-t.placeOfDisplay.specificFields.position}))})))},e.prototype.pipeBasicFieldsOfClass=function(e,n){return void 0===n&&(n=!1),this.pipeFields(e,n).pipe(t.map((function(e){return e.filter((function(e){return e.placeOfDisplay.basicFields})).sort((function(e,t){return e.placeOfDisplay.basicFields.position-t.placeOfDisplay.basicFields.position}))})))},e.prototype.pipeFieldsForTeEnForm=function(e,n){return void 0===n&&(n=!1),this.pipeFields(e,n).pipe(t.map((function(e){var t=e.filter((function(e){return e.placeOfDisplay.specificFields})).sort((function(e,t){return e.placeOfDisplay.specificFields.position-e.placeOfDisplay.specificFields.position})),n=e.find((function(e){return e.property.pkProperty===i.DfhConfig.PROPERTY_PK_HAS_TIME_SPAN}));n&&t.push(n);var r=e.find((function(e){return e.isHasTypeField}));return r&&t.push(r),t})))},e.prototype.pipeBasicAndSpecificFields=function(e,n){return void 0===n&&(n=!1),u.combineLatest(this.pipeBasicFieldsOfClass(e,n),this.pipeSpecificFieldOfClass(e,n)).pipe(t.map((function(e){var t=v(e,2);return P(t[0],t[1])})))},e.prototype.pipeSpecificAndBasicFields=function(e,n){return void 0===n&&(n=!1),u.combineLatest(this.pipeSpecificFieldOfClass(e,n),this.pipeBasicFieldsOfClass(e,n)).pipe(t.map((function(e){var t=v(e,2);return P(t[0],t[1])})))},e.prototype.pipePropertiesToSubfields=function(e,t,n,i,p){var o=this;return void 0===p&&(p=!1),r.combineLatestOrEmpty(e.map((function(e){return o.pipeSubfield(t,e,i,n,p)})))},e.prototype.pipeSubfieldIdToSubfield=function(e,n,i,r,p){var o=this;void 0===p&&(p=!1);var s=r?e:i,a=r?i:e;return u.combineLatest(this.s.dfh$.property$.pk_property__has_domain__has_range$.key([n,s,a].join("_")).pipe(t.filter((function(e){return!!e}))),this.s.sys$.config$.main$.pipe(t.filter((function(e){return!!e}))),this.pipeProfilesEnabledByProject().pipe(t.filter((function(e){return!!e})))).pipe(t.switchMap((function(e){var t=v(e,3),n=t[0],i=t[1],s=t[2];return o.pipeSubfield(r,n,i,s,p)})))},e.prototype.pipeSubfield=function(e,n,i,r,p){void 0===p&&(p=!1);var o=e,s=o?n.has_range:n.has_domain,a=o?n.has_domain:n.has_range,c=o?n.range_instances_max_quantifier:n.domain_instances_max_quantifier,f=o?n.domain_instances_max_quantifier:n.range_instances_max_quantifier,l=o?n.range_instances_min_quantifier:n.domain_instances_min_quantifier,y=o?n.domain_instances_min_quantifier:n.range_instances_min_quantifier;return u.combineLatest(this.pipeClassLabel(a).pipe(t.tap((function(e){return e}))),this.pipeClassLabel(s).pipe(t.tap((function(e){return e}))),this.pipeSubfieldTypeOfClass(i,s,c,n.pk_property,p).pipe(t.tap((function(e){return e}))),this.pipeFieldLabel(n.pk_property,e?n.has_domain:null,e?null:n.has_range).pipe(t.tap((function(e){return e})))).pipe(t.map((function(e){var t=v(e,4),i=t[0],p=t[1],u=t[2],_=t[3];return{listType:u,sourceClass:a,sourceClassLabel:i,sourceMaxQuantity:f,sourceMinQuantity:y,targetClass:s,targetClassLabel:p,targetMinQuantity:l,targetMaxQuantity:c,label:_,isHasTypeField:o&&n.is_has_type_subproperty,property:{pkProperty:n.pk_property},isOutgoing:o,identityDefiningForSource:!!o&&n.identity_defining,identityDefiningForTarget:!o&&n.identity_defining,ontoInfoLabel:n.identifier_in_namespace,ontoInfoUrl:"https://ontome.dataforhistory.org/property/"+n.pk_property,removedFromAllProfiles:je(r,n.profiles||[])}})))},e.prototype.pipeSubfieldTypeOfClass=function(e,n,i,r,p){var o=this;return void 0===p&&(p=!1),this.s.dfh$.class$.by_pk_class$.key(n).pipe(t.filter((function(e){return!!e})),t.switchMap((function(t){return o.pipeSubfieldType(e,t,i,r,p)})))},e.prototype.pipeSubfieldType=function(e,n,r,p,o){void 0===o&&(o=!1);var s,a=function(e){return new u.BehaviorSubject(e)};if(e&&(s=e.classes[n.pk_class]),s&&s.valueObjectType)return a(s.valueObjectType);if(30===n.basic_type&&1==r)return a({typeItem:"true"});if(n.pk_class===i.DfhConfig.ClASS_PK_TIME_SPAN)return a({timeSpan:"true"});if(8===n.basic_type||30===n.basic_type||o)return a({entityPreview:"true"});return this.pipeBasicAndSpecificFields(n.pk_class,!0).pipe(t.map((function(e){var t,n,i,r,o=[];try{for(var s=k(e),a=s.next();!a.done;a=s.next()){var u=a.value;try{for(var c=(i=void 0,k(u.listDefinitions)),f=c.next();!f.done;f=c.next()){var l=f.value,y={entityPreview:"true"};l.listType.temporalEntity||(y=l.listType);var _=!1;p&&l.property.pkProperty==p&&1===l.targetMaxQuantity&&(_=!0);var m={subfieldType:y,page:{fkProperty:l.property.pkProperty,isOutgoing:l.isOutgoing,limit:1,offset:0,targetClass:l.targetClass,isCircular:_}};o.push(m)}}catch(e){i={error:e}}finally{try{f&&!f.done&&(r=c.return)&&r.call(c)}finally{if(i)throw i.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return{temporalEntity:o}})))},e.prototype.pipeFieldConfigs=function(e){var n=this;return this.a.pkProject$.pipe(t.switchMap((function(r){var p=s.proClassFieldConfgByProjectAndClassKey({fk_class_for_class_field:e,fk_project:r}),o=s.proClassFieldConfgByProjectAndClassKey({fk_class_for_class_field:e,fk_project:i.ProConfig.PK_PROJECT_OF_DEFAULT_CONFIG_PROJECT});return u.combineLatest(n.s.pro$.class_field_config$.by_fk_project__fk_class$.key(p),n.s.pro$.class_field_config$.by_fk_project__fk_class$.key(o)).pipe(t.map((function(e){var t=v(e,2),n=t[0],i=t[1];return n&&f.values(n).length?n:i})),t.map((function(e){return f.values(e).sort((function(e,t){return e.ord_num>t.ord_num?1:-1}))})))})))},e.prototype.pipeClassLabel=function(e){var n=this;return u.combineLatest(this.a.pkProject$,this.a.pipeActiveDefaultLanguage()).pipe(t.switchMap((function(i){var r=v(i,2),p=r[0],o=r[1];return n.pipeLabels({pkClass:e,fkProject:p,language:o,type:"label"}).pipe(t.map((function(t){var n=t.find((function(e){return!!e}));return n?n.text:"* no label (id: "+e+") *"})))})))},e.prototype.pipeLabels=function(e){var n;if(e.pkClass)switch(e.type){case"label":n=i.SysConfig.PK_SYSTEM_TYPE__TEXT_PROPERTY__LABEL;break;default:console.warn("fk_system_type not found")}else if(e.fkProperty)switch(e.type){case"label":n=i.SysConfig.PK_SYSTEM_TYPE__TEXT_PROPERTY__LABEL;break;default:console.warn("fk_system_type not found")}return u.combineLatest(this.pipeProTextProperty({fk_project:e.fkProject,fk_language:e.language.pk_entity,fk_system_type:n,fk_dfh_class:e.pkClass,fk_dfh_property:e.fkProperty,fk_dfh_property_domain:e.fkPropertyDomain,fk_dfh_property_range:e.fkPropertyRange}).pipe(t.map((function(e){if(e){return{origin:"of project in project lang",text:e.string}}}))),this.pipeProTextProperty({fk_project:i.ProConfig.PK_PROJECT_OF_DEFAULT_CONFIG_PROJECT,fk_language:e.language.pk_entity,fk_system_type:n,fk_dfh_class:e.pkClass,fk_dfh_property:e.fkProperty,fk_dfh_property_domain:e.fkPropertyDomain,fk_dfh_property_range:e.fkPropertyRange}).pipe(t.map((function(e){if(e){return{origin:"of default project in project lang",text:e.string}}}))),this.pipeProTextProperty({fk_project:i.ProConfig.PK_PROJECT_OF_DEFAULT_CONFIG_PROJECT,fk_language:18889,fk_system_type:n,fk_dfh_class:e.pkClass,fk_dfh_property:e.fkProperty,fk_dfh_property_domain:e.fkPropertyDomain,fk_dfh_property_range:e.fkPropertyRange}).pipe(t.map((function(e){if(e){return{origin:"of default project in english",text:e.string}}}))),this.pipeDfhLabel({language:e.language.iso6391.trim(),type:"label",fk_class:e.pkClass,fk_property:e.fkProperty}).pipe(t.map((function(e){if(e){return{origin:"of ontome in project lang",text:e.label}}}))),this.pipeDfhLabel({language:"en",type:"label",fk_class:e.pkClass,fk_property:e.fkProperty}).pipe(t.map((function(e){if(e){return{origin:"of ontome in english",text:e.label}}}))))},e.prototype.pipeProTextProperty=function(e){var t=s.textPropertyByFksKey(e);return this.s.pro$.text_property$.by_fks$.key(t)},e.prototype.pipeDfhLabel=function(e){var t=s.dfhLabelByFksKey(e);return this.s.dfh$.label$.by_fks$.key(t)},e.prototype.pipeFieldLabel=function(e,n,i){var r=this,p=!!n;return u.combineLatest(this.a.pkProject$,this.a.pipeActiveDefaultLanguage()).pipe(t.switchMap((function(o){var s=v(o,2),a=s[0],u=s[1];return r.pipeLabels({fkProject:a,type:"label",language:u,fkProperty:e,fkPropertyDomain:n,fkPropertyRange:i}).pipe(t.map((function(t){var n="* no label (id: "+e+") *";return t.some((function(e){return!e||"of project in project lang"!==e.origin&&"of default project in project lang"!==e.origin&&"of default project in english"!==e.origin?!e||"of ontome in project lang"!==e.origin&&"of ontome in english"!==e.origin?void 0:(n=p?e.text:"* reverse of: "+e.text+"*",!0):(n=e.text,!0)})),n})))})))},e.prototype.pipeTableNameOfClass=function(e){return u.combineLatest(this.s.sys$.config$.main$,this.s.dfh$.class$.by_pk_class$.key(e)).pipe(t.filter((function(e){return!e.includes(void 0)})),t.map((function(t){var n=v(t,2),i=n[0],r=n[1],p=i.classes[e];if(!p||!p.valueObjectType)return 8===r.basic_type||30===r.basic_type?"persistent_item":"temporal_entity";var o=Object.keys(p.valueObjectType);if(!p.valueObjectType.appellation){o[0];return p.valueObjectType.appellation?"appellation":p.valueObjectType.language?"language":p.valueObjectType.place?"place":p.valueObjectType.timePrimitive?"time_primitive":p.valueObjectType.langString?"lang_string":p.valueObjectType.dimension?"dimension":void console.warn("unsupported list type")}})))},e.prototype.pipeClassesInEntitiesOrSources=function(){return u.combineLatest(this.pipeClassesEnabledInEntities(),this.pipeClassesRequiredBySources()).pipe(t.map((function(e){var t=v(e,2),n=t[0],i=t[1];return f.indexBy((function(e){return e.toString()}),f.uniq(P(n,i)))})),t.startWith({}))},e.prototype.pipeClassesRequiredBySources=function(){return this.s.sys$.system_relevant_class$.by_required_by_sources$.key("true").pipe(t.map((function(e){return f.values(e).map((function(e){return e.fk_class}))})))},e.prototype.pipeClassesEnabledByProjectProfiles=function(){var e=this;return this.a.pkProject$.pipe(t.switchMap((function(n){return u.combineLatest([e.s.dfh$.class$.by_pk_class$.all$,e.pipeProfilesEnabledByProject()]).pipe(t.map((function(e){var t=v(e,2),n=t[0],i=t[1],r=f.indexBy((function(e){return e.toString()}),f.values(i));return f.values(n).filter((function(e){return e.profiles.some((function(e){return r[e.fk_profile]}))}))})))})))},e.prototype.pipeTypeClassesEnabledByProjectProfiles=function(){return u.combineLatest([this.s.dfh$.class$.by_basic_type$.key(30),this.pipeProfilesEnabledByProject()]).pipe(t.map((function(e){var t=v(e,2),n=t[0],r=t[1],p=f.indexBy((function(e){return e.toString()}),f.values(r));return f.values(n).filter((function(e){return e.profiles.some((function(e){return p[e.fk_profile]}))&&![i.DfhConfig.CLASS_PK_LANGUAGE,i.DfhConfig.CLASS_PK_MANIFESTATION_PRODUCT_TYPE].includes(e.pk_class)}))})))},e.prototype.pipeClassesEnabledInEntities=function(){var e=this;return this.a.pkProject$.pipe(t.switchMap((function(n){return e.s.pro$.dfh_class_proj_rel$.by_fk_project__enabled_in_entities$.key(n+"_true").pipe(t.map((function(e){return f.values(e).map((function(e){return e.fk_class}))})))})))},e.prototype.pipeSelectedTeEnClassesInProject=function(){return u.combineLatest(this.pipeTeEnClassesEnabledInEntities(),this.pipeTeEnClassesRequiredBySources()).pipe(t.map((function(e){var t=v(e,2),n=t[0],i=t[1];return f.indexBy((function(e){return e.toString()}),f.uniq(P(n,i)))})),t.startWith({}))},e.prototype.pipeTeEnClassesEnabledInEntities=function(){var e=this;return this.a.pkProject$.pipe(t.switchMap((function(n){return e.s.pro$.dfh_class_proj_rel$.by_fk_project__enabled_in_entities$.key(n+"_true").pipe(t.switchMap((function(n){return u.combineLatest(f.values(n).map((function(n){return e.s.dfh$.class$.by_pk_class$.key(n.fk_class).pipe(t.filter((function(e){return!!e})))}))).pipe(t.map((function(t){return e.filterTeEnCasses(t)})))})))})))},e.prototype.filterTeEnCasses=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];9===i.basic_type&&t.push(i.pk_class)}return t},e.prototype.pipeTeEnClassesRequiredBySources=function(){var e=this;return this.s.sys$.system_relevant_class$.by_required_by_sources$.key("true").pipe(t.switchMap((function(n){return u.combineLatest(f.values(n).map((function(n){return e.s.dfh$.class$.by_pk_class$.key(n.fk_class).pipe(t.filter((function(e){return!!e})))}))).pipe(t.map((function(t){return e.filterTeEnCasses(t)})))})))},e.prototype.pipeTypeAndTypedClasses=function(e){var n,i=this,r=this.s.sys$.system_relevant_class$.by_required_by_sources$.key("true").pipe(t.map((function(e){return f.values(e).map((function(e){return e.fk_class}))}))),p=this.pipeClassesEnabledInEntities();return n="sources"===e?[r]:"entities"===e?[p]:[r,p],u.combineLatest(n).pipe(t.map((function(e){return f.uniq(f.flatten(e))})),t.switchMap((function(e){return i.pipeTypeAndTypedClassesOfTypedClasses(e)})))},e.prototype.pipeTypeAndTypedClassesOfTypedClasses=function(e){return this.s.dfh$.property$.by_is_has_type_subproperty$.key("true").pipe(t.map((function(t){var n=f.indexBy((function(e){return e.has_domain.toString()}),f.values(t));return e.map((function(e){return{typedClass:e,typeClass:n[e]?n[e].has_range:void 0}}))})))},e.prototype.pipeTypeClassOfTypedClass=function(e){return this.s.dfh$.property$.by_is_has_type_subproperty$.key("true").pipe(t.map((function(t){var n=f.indexBy((function(e){return e.has_domain.toString()}),f.values(t));return n[e]?n[e].has_range:void 0})))},e.prototype.pipeTypedClassesOfTypeClasses=function(e){return this.s.dfh$.property$.by_is_has_type_subproperty$.key("true").pipe(t.map((function(t){var n=f.indexBy((function(e){return e.has_range.toString()}),f.values(t));return e.map((function(e){return n[e]?n[e].has_domain:void 0}))})))},e.prototype.pipeTypePropertyOfTypedClass=function(e){return this.s.dfh$.property$.by_is_has_type_subproperty$.key("true").pipe(t.map((function(t){var n=f.values(t).find((function(t){return t.has_domain===e}));return n?n.pk_property:void 0})))},e.prototype.pipeTargetClassesOfProperties=function(e,n){return this.s.dfh$.property$.by_pk_property$.all$.pipe(t.map((function(t){if(!e||!e.length)return[];var i=[],r={};return e.forEach((function(e){f.values(t[e]).forEach((function(e){var t=n?e.has_range:e.has_domain;r[t]||(r[t]=!0,i.push(t))}))})),i})))},e.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:ve},{type:ke}]},e.ngInjectableDef=o.ɵɵdefineInjectable({factory:function(){return new e(o.ɵɵinject(ve),o.ɵɵinject(ke))},token:e,providedIn:"root"}),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Number,Object]),h("design:returntype",u.Observable)],e.prototype,"pipeFields",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Number,Object]),h("design:returntype",u.Observable)],e.prototype,"pipeSpecificFieldOfClass",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Number,Object]),h("design:returntype",u.Observable)],e.prototype,"pipeBasicFieldsOfClass",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Number,Object]),h("design:returntype",u.Observable)],e.prototype,"pipeFieldsForTeEnForm",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Number,Object]),h("design:returntype",u.Observable)],e.prototype,"pipeBasicAndSpecificFields",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Number,Object]),h("design:returntype",u.Observable)],e.prototype,"pipeSpecificAndBasicFields",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Array,Boolean,Array,Object,Object]),h("design:returntype",u.Observable)],e.prototype,"pipePropertiesToSubfields",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Number,Number,Number,Boolean,Object]),h("design:returntype",u.Observable)],e.prototype,"pipeSubfieldIdToSubfield",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Object,Number,Number,Number,Object]),h("design:returntype",u.Observable)],e.prototype,"pipeSubfieldTypeOfClass",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Number]),h("design:returntype",u.Observable)],e.prototype,"pipeFieldConfigs",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Number]),h("design:returntype",u.Observable)],e.prototype,"pipeClassLabel",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",u.Observable)],e.prototype,"pipeLabels",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",u.Observable)],e.prototype,"pipeProTextProperty",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",u.Observable)],e.prototype,"pipeDfhLabel",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Number,Number,Number]),h("design:returntype",u.Observable)],e.prototype,"pipeFieldLabel",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Number]),h("design:returntype",u.Observable)],e.prototype,"pipeTableNameOfClass",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",u.Observable)],e.prototype,"pipeClassesInEntitiesOrSources",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",void 0)],e.prototype,"pipeClassesRequiredBySources",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",u.Observable)],e.prototype,"pipeClassesEnabledByProjectProfiles",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",u.Observable)],e.prototype,"pipeTypeClassesEnabledByProjectProfiles",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",void 0)],e.prototype,"pipeClassesEnabledInEntities",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",u.Observable)],e.prototype,"pipeSelectedTeEnClassesInProject",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",void 0)],e.prototype,"pipeTeEnClassesEnabledInEntities",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[]),h("design:returntype",void 0)],e.prototype,"pipeTeEnClassesRequiredBySources",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[String]),h("design:returntype",u.Observable)],e.prototype,"pipeTypeAndTypedClasses",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Array]),h("design:returntype",u.Observable)],e.prototype,"pipeTypeAndTypedClassesOfTypedClasses",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",u.Observable)],e.prototype,"pipeTypeClassOfTypedClass",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Array]),h("design:returntype",u.Observable)],e.prototype,"pipeTypedClassesOfTypeClasses",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",u.Observable)],e.prototype,"pipeTypePropertyOfTypedClass",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Array,Boolean]),h("design:returntype",u.Observable)],e.prototype,"pipeTargetClassesOfProperties",null),e}();function $e(e){var t=[{removed_from_api:!1,fk_profile:i.DfhConfig.PK_PROFILE_GEOVISTORY_BASIC}];return{has_domain:e,pk_property:i.DfhConfig.PROPERTY_PK_HAS_TIME_SPAN,has_range:i.DfhConfig.ClASS_PK_TIME_SPAN,domain_instances_max_quantifier:-1,domain_instances_min_quantifier:1,range_instances_max_quantifier:1,range_instances_min_quantifier:1,identifier_in_namespace:"P4",identity_defining:!1,is_inherited:!0,is_has_type_subproperty:!1,profiles:t}}function je(e,t){return!t.some((function(t){return!1===t.removed_from_api&&e.includes(t.fk_profile)}))}function Oe(e,t,n){var i;if(i=function(e,t,n){e.isOutgoing?e.isHasTypeField&&t.hasTypeSubproperties?n=t.hasTypeSubproperties:t.bySourceClass&&t.bySourceClass[e.sourceClass]&&t.bySourceClass[e.sourceClass].outgoingProperties&&t.bySourceClass[e.sourceClass].outgoingProperties[e.property.pkProperty]?n=t.bySourceClass[e.sourceClass].outgoingProperties[e.property.pkProperty]:t.outgoingProperties&&t.outgoingProperties[e.property.pkProperty]&&(n=t.outgoingProperties[e.property.pkProperty]):t.bySourceClass&&t.bySourceClass[e.sourceClass]&&t.bySourceClass[e.sourceClass].incomingProperties&&t.bySourceClass[e.sourceClass].incomingProperties[e.property.pkProperty]?n=t.bySourceClass[e.sourceClass].incomingProperties[e.property.pkProperty]:t.incomingProperties&&t.incomingProperties[e.property.pkProperty]&&(n=t.incomingProperties[e.property.pkProperty]);return n}(t,e,i)){if(i.displayInBasicFields)return{basicFields:{position:i.displayInBasicFields.position}};if(i.hidden)return{hidden:!0}}var r=Number.POSITIVE_INFINITY;return n&&(r=n.ord_num),{specificFields:{position:r}}}var Se=function(){function e(e,n){var i=this;this.p=e,this.s=n,this.timePrimitiveOfStatements=function(){return u.pipe(t.map((function(e){return e[0]})),t.switchMap((function(e){return e?i.pipeInfTimePrimitive(e.fk_object_info).pipe(t.switchMap((function(n){return i.p.pkProject$.pipe(t.switchMap((function(r){return i.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(r+"_"+e[0].pk_entity).pipe(t.filter((function(e){return!!e})),t.map((function(e){return{calendar:e.calendar?e.calendar:"gregorian",julianDay:n.julian_day,duration:n.duration}})))})))}))):new u.BehaviorSubject(void 0)})))}}return e.prototype.pipeStatements=function(e,t){return t?this.pipeOutgoingStatements(e):this.pipeIngoingStatements(e)},e.prototype.pipeOutgoingStatements=function(e){return this.s.inf$.statement$.by_subject$({fk_subject_info:e})},e.prototype.pipeIngoingStatements=function(e){return this.s.inf$.statement$.by_object$({fk_object_info:e})},e.prototype.pipeStatementsOfList=function(e,t){return e.isOutgoing?this.s.inf$.statement$.by_subject_and_property$({fk_property:e.property.pkProperty,fk_property_of_property:e.property.pkPropertyOfProperty,fk_subject_info:t}):this.s.inf$.statement$.by_object_and_property$({fk_property:e.property.pkProperty,fk_property_of_property:e.property.pkPropertyOfProperty,fk_object_info:t})},e.prototype.pipeOutgoingStatementsByProperty=function(e,t){return this.s.inf$.statement$.by_subject_and_property$({fk_property:e,fk_subject_info:t})},e.prototype.pipeIngoingStatementsByProperty=function(e,t){return this.s.inf$.statement$.by_object_and_property$({fk_property:e,fk_object_info:t})},e.prototype.pipeOutgoingBasicStatementItemsByProperty=function(e,n,i){var p=this;return this.s.inf$.statement$.by_subject_and_property$({fk_property:e,fk_subject_info:n}).pipe(t.switchMap((function(e){return r.combineLatestOrEmpty(e.map((function(e){return p.pipeBasicStatementItem(i,e,!0)})))})))},e.prototype.pipeIngoingBasicStatementItemsByProperty=function(e,n,i){var p=this;return this.s.inf$.statement$.by_object_and_property$({fk_property:e,fk_object_info:n}).pipe(t.switchMap((function(e){return r.combineLatestOrEmpty(e.map((function(e){return p.pipeBasicStatementItem(i,e,!1)})))})))},e.prototype.pipeBasicStatementItem=function(e,n,i){return this.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(e+"_"+n.pk_entity).pipe(t.filter((function(e){return!!e})),t.map((function(e){return{projRel:e,statement:n,label:"",ordNum:i?e.ord_num_of_range:e.ord_num_of_domain,isOutgoing:i}})))},e.prototype.pipeBasicStatementItemByPkStatement=function(e,n,i){var r=this;return this.s.inf$.statement$.by_pk_entity_key$(n).pipe(t.switchMap((function(t){return t?r.pipeBasicStatementItem(e,t,i):u.of(void 0)})))},e.prototype.pipeInfTimePrimitive=function(e){return this.s.inf$.time_primitive$.by_pk_entity$.key(e)},e.prototype.pipeTimeSpan=function(e){return u.combineLatest(this.pipeOutgoingStatementsByProperty(72,e).pipe(this.timePrimitiveOfStatements()),this.pipeOutgoingStatementsByProperty(71,e).pipe(this.timePrimitiveOfStatements()),this.pipeOutgoingStatementsByProperty(150,e).pipe(this.timePrimitiveOfStatements()),this.pipeOutgoingStatementsByProperty(151,e).pipe(this.timePrimitiveOfStatements()),this.pipeOutgoingStatementsByProperty(152,e).pipe(this.timePrimitiveOfStatements()),this.pipeOutgoingStatementsByProperty(153,e).pipe(this.timePrimitiveOfStatements())).pipe(t.map((function(e){var t=v(e,6),n=t[0],i=t[1],p=t[2],o=t[3],s=t[4],a=t[5];return new r.TimeSpanUtil({p82:n,p81:i,p82a:s,p81a:p,p81b:o,p82b:a})})))},e.prototype.pipeClassOfEntity=function(e){return u.merge(this.s.inf$.persistent_item$.by_pk_entity_key$(e).pipe(t.filter((function(e){return!!e})),t.map((function(e){return e.fk_class}))),this.s.inf$.temporal_entity$.by_pk_entity_key$(e).pipe(t.filter((function(e){return!!e})),t.map((function(e){return e.fk_class}))))},e.prototype.pipeClassesOfPersistentItems=function(e){return this.s.inf$.persistent_item$.by_pk_entity_all$().pipe(t.map((function(t){if(!e||0===e.length)return[];var n={},i=[];return e.forEach((function(e){n[t[e].fk_class]||(n[t[e].fk_class]=!0,i.push(t[e].fk_class))})),i})))},e.prototype.pipeRepoOutgoingStatements=function(e){return this.s.inf$.statement$.by_subject$({fk_subject_info:e},!1)},e.prototype.pipeRepoIngoingStatements=function(e){return this.s.inf$.statement$.by_object$({fk_object_info:e},!1)},e.prototype.pipeRepoOutgoingStatementsByProperty=function(e,n){var i=this;return u.combineLatest(this.s.dfh$.property$.by_pk_property$.key(e).pipe(t.filter((function(e){return!!e&&Object.keys(e).length>0})),t.map((function(e){return f.values(e)[0].range_instances_max_quantifier}))),this.s.inf$.statement$.by_subject_and_property$({fk_property:e,fk_subject_info:n},!1)).pipe(t.map((function(e){var t=v(e,2),n=t[0],r=t[1];if(0===r.length)return r;var p=i.sortStatementsByRepoPopularity(r);return-1===n||null===n?p:p.slice(0,n)})))},e.prototype.pipeRepoIngoingStatementsByProperty=function(e,n){var i=this;return u.combineLatest(this.s.dfh$.property$.by_pk_property$.key(e).pipe(t.filter((function(e){return!!e&&Object.keys(e).length>0})),t.map((function(e){return f.values(e)[0].domain_instances_max_quantifier}))),this.s.inf$.statement$.by_object_and_property$({fk_property:e,fk_object_info:n},!1)).pipe(t.map((function(e){var t=v(e,2),n=t[0],r=t[1];if(0===r.length)return r;var p=i.sortStatementsByRepoPopularity(r);return-1===n||null===n?p:p.slice(0,n)})))},e.prototype.pipeAlternativeBasicStatementItemByPkStatement=function(e,n){return u.combineLatest(this.s.inf$.statement$.by_pk_entity_key$(e,!1),this.s.inf$.statement$.by_pk_entity_key$(e)).pipe(t.filter((function(e){return!!v(e,1)[0]})),t.map((function(e){var t=v(e,2),i=t[0];if(!t[1])return{projRel:void 0,statement:i,ordNum:void 0,isOutgoing:n,label:""}})))},e.prototype.pipeAlternativeIngoingStatements=function(e,n){return u.combineLatest(this.s.inf$.statement$.by_object_and_property_indexed$({fk_property:e,fk_object_info:n},!1),this.s.inf$.statement$.by_object_and_property_indexed$({fk_property:e,fk_object_info:n}).pipe(t.map((function(e){return e?Object.keys(e):[]})))).pipe(t.map((function(e){var t=v(e,2),n=t[0],i=t[1];return f.omit(i,n)})),t.map((function(e){return f.values(e)})))},e.prototype.pipeAlternativeOutgoingStatements=function(e,n){return u.combineLatest(this.s.inf$.statement$.by_subject_and_property_indexed$({fk_property:e,fk_subject_info:n},!1),this.s.inf$.statement$.by_subject_and_property_indexed$({fk_property:e,fk_subject_info:n}).pipe(t.map((function(e){return e?Object.keys(e):[]})))).pipe(t.map((function(e){var t=v(e,2),n=t[0],i=t[1];return f.omit(i,n)})),t.map((function(e){return f.values(e)})))},e.prototype.pipePersistentItemPksByClass=function(e){return this.s.inf$.persistent_item$.by_fk_class_key$(e).pipe(t.map((function(e){return e?Object.keys(e).map((function(e){return parseInt(e,10)})):[]})))},e.prototype.pipeIconType=function(e){return this.p.streamEntityPreview(e).pipe(t.map((function(e){return"teEn"==e.entity_type?"temporal-entity":e.fk_class===i.DfhConfig.CLASS_PK_EXPRESSION_PORTION?"expression-portion":i.DfhConfig.CLASS_PKS_SOURCE_PE_IT.includes(e.fk_class)?"source":"persistent-entity"})))},e.prototype.sortStatementsByRepoPopularity=function(e){return e.sort((function(e,t){return e.is_in_project_count>t.is_in_project_count?1:-1}))},e.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:ve},{type:ke}]},e.ngInjectableDef=o.ɵɵdefineInjectable({factory:function(){return new e(o.ɵɵinject(ve),o.ɵɵinject(ke))},token:e,providedIn:"root"}),b([j,h("design:type",Function),h("design:paramtypes",[Number,Object]),h("design:returntype",u.Observable)],e.prototype,"pipeStatements",null),b([j,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",u.Observable)],e.prototype,"pipeOutgoingStatements",null),b([j,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",u.Observable)],e.prototype,"pipeIngoingStatements",null),b([j,h("design:type",Function),h("design:paramtypes",[Object,Object]),h("design:returntype",u.Observable)],e.prototype,"pipeOutgoingStatementsByProperty",null),b([j,h("design:type",Function),h("design:paramtypes",[Object,Object]),h("design:returntype",u.Observable)],e.prototype,"pipeIngoingStatementsByProperty",null),b([j,h("design:type",Function),h("design:paramtypes",[Object,Object,Number]),h("design:returntype",u.Observable)],e.prototype,"pipeOutgoingBasicStatementItemsByProperty",null),b([j,h("design:type",Function),h("design:paramtypes",[Object,Object,Number]),h("design:returntype",u.Observable)],e.prototype,"pipeIngoingBasicStatementItemsByProperty",null),b([j,h("design:type",Function),h("design:paramtypes",[Number,y.InfStatement,Boolean]),h("design:returntype",u.Observable)],e.prototype,"pipeBasicStatementItem",null),b([j,h("design:type",Function),h("design:paramtypes",[Number,Number,Boolean]),h("design:returntype",u.Observable)],e.prototype,"pipeBasicStatementItemByPkStatement",null),b([j,h("design:type",Function),h("design:paramtypes",[Number]),h("design:returntype",u.Observable)],e.prototype,"pipeInfTimePrimitive",null),b([j,h("design:type",Function),h("design:paramtypes",[Number]),h("design:returntype",u.Observable)],e.prototype,"pipeTimeSpan",null),b([j,h("design:type",Function),h("design:paramtypes",[Number]),h("design:returntype",u.Observable)],e.prototype,"pipeClassOfEntity",null),b([j,h("design:type",Function),h("design:paramtypes",[Array]),h("design:returntype",u.Observable)],e.prototype,"pipeClassesOfPersistentItems",null),b([j,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",u.Observable)],e.prototype,"pipeRepoOutgoingStatements",null),b([j,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",u.Observable)],e.prototype,"pipeRepoIngoingStatements",null),b([j,h("design:type",Function),h("design:paramtypes",[Object,Object]),h("design:returntype",u.Observable)],e.prototype,"pipeRepoOutgoingStatementsByProperty",null),b([j,h("design:type",Function),h("design:paramtypes",[Object,Object]),h("design:returntype",u.Observable)],e.prototype,"pipeRepoIngoingStatementsByProperty",null),b([j,h("design:type",Function),h("design:paramtypes",[Number,Boolean]),h("design:returntype",u.Observable)],e.prototype,"pipeAlternativeBasicStatementItemByPkStatement",null),b([j,h("design:type",Function),h("design:paramtypes",[Object,Object]),h("design:returntype",u.Observable)],e.prototype,"pipeAlternativeIngoingStatements",null),b([j,h("design:type",Function),h("design:paramtypes",[Object,Object]),h("design:returntype",u.Observable)],e.prototype,"pipeAlternativeOutgoingStatements",null),b([j,h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",u.Observable)],e.prototype,"pipePersistentItemPksByClass",null),e}();var Ce=function(){function e(e,t,n,i,r,p,o){this.b=e,this.p=t,this.s=n,this.c=i,this.timePrimitivePipe=r,this.timeSpanPipe=p,this.infRepo=new ee(o,u.of("repo"))}return e.prototype.pipeListLength=function(e,n){switch(e.listType){case"appellation":case"entity-preview":case"language":case"place":case"dimension":case"langString":case"temporal-entity":return this.pipeList(e,n).pipe(t.map((function(e){return e.length})));case"time-span":return u.combineLatest(this.b.pipeOutgoingStatementsByProperty(72,n),this.b.pipeOutgoingStatementsByProperty(71,n),this.b.pipeOutgoingStatementsByProperty(150,n),this.b.pipeOutgoingStatementsByProperty(151,n),this.b.pipeOutgoingStatementsByProperty(152,n),this.b.pipeOutgoingStatementsByProperty(153,n)).pipe(t.tap((function(e){})),t.map((function(e){return e.filter((function(e){return e.length>0})).length})));default:return console.warn("unsupported listType"),new u.BehaviorSubject(0)}},e.prototype.pipeList=function(e,n,i){return e.listType.appellation?this.pipeListAppellation(e,n,i):e.listType.entityPreview?this.pipeListEntityPreview(e,n,i):e.listType.language?this.pipeListLanguage(e,n,i):e.listType.place?this.pipeListPlace(e,n,i):e.listType.dimension?this.pipeListDimension(e,n,i):e.listType.langString?this.pipeListLangString(e,n,i):e.listType.temporalEntity?this.pipeListEntityPreview(e,n,i):e.listType.timeSpan?this.pipeItemTimeSpan(n).pipe(t.map((function(e){return[e].filter((function(e){return e.properties.length>0}))}))):void console.warn("unsupported listType")},e.prototype.pipeListBasicStatementItems=function(e,t,n){return e.isOutgoing?this.b.pipeOutgoingBasicStatementItemsByProperty(e.property.pkProperty,t,n):this.b.pipeIngoingBasicStatementItemsByProperty(e.property.pkProperty,t,n)},e.prototype.pipeListAppellation=function(e,n,i){var p=this;return this.b.pipeStatementsOfList(e,n).pipe(t.switchMap((function(n){return u.combineLatest(n.map((function(e,t){return p.pipeItemAppellation(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),r.limitTo(i),t.startWith([]))})))},e.prototype.pipeListEntityPreview=function(e,i,p){var o=this;return this.b.pipeStatementsOfList(e,i).pipe(n.tag("before-"+i+"-"+e.property.pkProperty+"-"+e.targetClass),t.switchMap((function(n){return u.combineLatest(n.map((function(t,n){return o.pipeItemEntityPreview(t,e.isOutgoing)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass})).sort((function(e,t){return e.ordNum>t.ordNum?1:-1}))}),r.limitTo(p)),t.startWith([]))})),n.tag("after-"+i+"-"+e.property.pkProperty+"-"+e.targetClass))},e.prototype.pipeListLanguage=function(e,n,i){var p=this;return this.b.pipeStatementsOfList(e,n).pipe(t.switchMap((function(n){return u.combineLatest(n.map((function(e,t){return p.pipeItemLanguage(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),r.limitTo(i),t.startWith([]))})))},e.prototype.pipeListPlace=function(e,n,i){var p=this;return this.b.pipeStatementsOfList(e,n).pipe(t.switchMap((function(n){return u.combineLatest(n.map((function(e,t){return p.pipeItemPlace(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),r.limitTo(i),t.startWith([]))})))},e.prototype.pipeListDimension=function(e,n,i){var p=this;return this.b.pipeStatementsOfList(e,n).pipe(t.switchMap((function(n){return u.combineLatest(n.map((function(e,t){return p.pipeItemDimension(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),r.limitTo(i),t.startWith([]))})))},e.prototype.pipeListLangString=function(e,n,i){var p=this;return this.b.pipeStatementsOfList(e,n).pipe(t.switchMap((function(n){return u.combineLatest(n.map((function(e,t){return p.pipeItemLangString(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),r.limitTo(i),t.startWith([]))})))},e.prototype.pipeProjRelOfStatement=function(e,n){return n.scope.inProject?this.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(n.scope.inProject+"_"+e.pk_entity).pipe(t.map((function(e){return{projRel:e,ordNum:n.isOutgoing?e.ord_num_of_range:e.ord_num_of_domain}}))):new u.BehaviorSubject({projRel:void 0,ordNum:0})},e.prototype.pipeTargetOfStatement=function(e,n,p){var o=this,s=n.isOutgoing,a=s?e.fk_object_info:e.fk_subject_info;if(p.appellation)return this.s.inf$.appellation$.by_pk_entity$.key(a).pipe(t.filter((function(e){return!!e})),t.map((function(t){return{statement:e,isOutgoing:s,targetLabel:t.string,targetClass:n.targetClass,target:{appellation:t}}})));if(p.place)return this.s.inf$.place$.by_pk_entity$.key(a).pipe(t.filter((function(e){return!!e})),t.map((function(t){return{statement:e,isOutgoing:s,targetLabel:"WGS84: "+t.lat+"°, "+t.long+"°",targetClass:n.targetClass,target:{place:t}}})));if(p.dimension)return this.s.inf$.dimension$.by_pk_entity$.key(a).pipe(t.filter((function(e){return!!e})),t.switchMap((function(i){return o.p.streamEntityPreview(i.fk_measurement_unit).pipe(t.map((function(t){return{statement:e,isOutgoing:s,targetLabel:i.numeric_value+" "+t.entity_label,targetClass:n.targetClass,target:{dimension:i}}})))})));if(p.langString)return this.s.inf$.lang_string$.by_pk_entity$.key(a).pipe(t.filter((function(e){return!!e})),t.switchMap((function(i){return o.s.inf$.language$.by_pk_entity$.key(i.fk_language).pipe(t.map((function(t){return{statement:e,isOutgoing:s,targetLabel:i.string+" ("+t.iso6391+")",targetClass:n.targetClass,target:{langString:i}}})))})));if(p.language)return this.s.inf$.language$.by_pk_entity$.key(a).pipe(t.filter((function(e){return!!e})),t.map((function(t){return{statement:e,isOutgoing:s,targetLabel:""+(t.notes||t.iso6391),targetClass:n.targetClass,target:{language:t}}})));if(p.entityPreview||p.typeItem)return this.p.streamEntityPreview(a).pipe(t.filter((function(e){return!!e})),t.map((function(t){return{statement:e,isOutgoing:s,targetLabel:""+t.entity_label,targetClass:n.targetClass,target:{entityPreview:t}}})));if(p.temporalEntity){var c=p.temporalEntity.map((function(e){var i=e.page,r=(i.isCircular,g(i,["isCircular"])),p=d({},r,{fkSourceEntity:a,scope:n.scope});return o.pipeSubfieldPage(p,e.subfieldType).pipe(t.map((function(e){var t=e.count,n=e.statements;p.limit,p.offset;return{subfield:g(p,["limit","offset"]),count:t,statements:n}})))}));return r.combineLatestOrEmpty(c).pipe(t.map((function(t){return{statement:e,isOutgoing:s,targetLabel:"",targetClass:n.targetClass,target:{entity:{pkEntity:a,subfields:t}}}})))}if(p.timeSpan){c=i.DfhConfig.PROPERTY_PKS_WHERE_TIME_PRIMITIVE_IS_RANGE.map((function(e){var r={fkProperty:e,isOutgoing:!0,limit:1,offset:0,targetClass:i.DfhConfig.CLASS_PK_TIME_PRIMITIVE,fkSourceEntity:a,scope:n.scope};return o.pipeSubfieldPage(r,{timePrimitive:"true"}).pipe(t.map((function(e){var t=e.count,n=e.statements;return{subfield:g(r,["limit","offset"]),count:t,statements:n}})))}));return r.combineLatestOrEmpty(c).pipe(t.map((function(t){var p={};return t.forEach((function(e){if(e.statements[0]){var t=e.statements[0],n=i.DfhConfig.PROPERTY_PK_TO_EXISTENCE_TIME_KEY[t.statement.fk_property];p[n]=t.target.timePrimitive}})),{statement:e,isOutgoing:s,targetLabel:o.timeSpanPipe.transform(new r.TimeSpanUtil(p)),targetClass:n.targetClass,target:{timeSpan:{preview:p,subfields:t}}}})))}if(p.timePrimitive)return this.s.inf$.time_primitive$.by_pk_entity$.key(a).pipe(t.filter((function(e){return!!e})),t.switchMap((function(i){return(n.scope.inProject?o.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(n.scope.inProject+"_"+e.pk_entity).pipe(t.map((function(e){return e.calendar}))):new u.BehaviorSubject(e.community_favorite_calendar)).pipe(t.map((function(t){var r=S(i,t);return{statement:e,isOutgoing:s,targetLabel:o.timePrimitivePipe.transform(r),targetClass:n.targetClass,target:{timePrimitive:r}}})))})));throw new Error("No implementation found for subfieldType "+JSON.stringify(p))},e.prototype.pipeStatementWithTarget=function(e,n,i){return u.combineLatest(this.pipeTargetOfStatement(e,n,i),this.pipeProjRelOfStatement(e,n)).pipe(t.map((function(e){var t=v(e,2),n=t[0],i=t[1];return d({},n,i)})))},e.prototype.pipeSubfieldPage=function(e,n){var i=this;return n.timeSpan?this.pipeTimeSpan(e,n):u.combineLatest(this.s.inf$.statement$.pagination$.pipeCount(e),this.s.inf$.statement$.pagination$.pipePage(e).pipe(t.switchMap((function(p){return r.combineLatestOrEmpty(p.map((function(r){return i.s.inf$.statement$.by_pk_entity$.key(r).pipe(t.filter((function(e){return!!e})),t.switchMap((function(t){return i.pipeStatementWithTarget(t,e,n)})))})))})))).pipe(t.map((function(e){var t=v(e,2);return{count:t[0],statements:t[1]}})))},e.prototype.pipeTimeSpan=function(e,n){var i={fk_object_info:e.fkSourceEntity};return this.pipeTargetOfStatement(i,e,n).pipe(t.map((function(e){return{count:1,statements:[d({},e,{projRel:void 0,ordNum:void 0})]}})))},e.prototype.pipeItemTeEnRow=function(e,n,i,p){var o=this,s=p?this.b.pipeRepoOutgoingStatements(e):this.b.pipeOutgoingStatements(e),a=p?this.b.pipeRepoIngoingStatements(e):this.b.pipeIngoingStatements(e),c=s.pipe(t.switchMap((function(e){return r.combineLatestOrEmpty(e.filter((function(e){return!!e.fk_object_info})).map((function(e){return o.pipeItem(e,i,!0)})))}))),l=a.pipe(t.switchMap((function(e){return r.combineLatestOrEmpty(e.filter((function(e){return!!e.fk_subject_info})).map((function(e){return o.pipeItem(e,i,!1)})))}))),y=p?function(e){return e.sort((function(e,t){return e.statement.is_in_project_count>t.statement.is_in_project_count?1:-1}))}:function(e){return e};return u.combineLatest(c,l).pipe(t.map((function(e){var t=v(e,2),n=t[0],i=t[1];return{groupedOut:f.groupBy((function(e){return e&&e.statement?e.statement.fk_property.toString():void 0}),n),groupedIn:f.groupBy((function(e){return e&&e.statement?e.statement.fk_property.toString():void 0}),i)}})),t.map((function(e){var t={};return n.forEach((function(n){var i;n.listDefinitions.forEach((function(t){if(t.listType.timeSpan){var n=f.pick(["71","72","150","151","152","153"],e.groupedOut),p=Object.keys(n),s=p.length,a=void 0;if(s>0){var u={};p.forEach((function(e){u[e]=n[e][0].timePrimitive}));var c=r.TimeSpanUtil.fromTimeSpanDialogData(u);a=o.timeSpanPipe.transform(c)}i={isOutgoing:t.isOutgoing,itemsCount:s,label:a,entityPreview:void 0,pkProperty:void 0,isTimeSpan:!0}}else if(t.isOutgoing){if(e.groupedOut[t.property.pkProperty]){var l=(_=y(e.groupedOut[t.property.pkProperty]))[0];i={isOutgoing:t.isOutgoing,itemsCount:_.length,entityPreview:(l||{}).preview,label:l.label,pkProperty:t.property.pkProperty,firstItem:l,items:_}}}else if(e.groupedIn[t.property.pkProperty]){var _;l=(_=y(e.groupedIn[t.property.pkProperty]))[0];i={isOutgoing:t.isOutgoing,itemsCount:_.length,entityPreview:(l||{}).preview,label:l.label,pkProperty:t.property.pkProperty,firstItem:l,items:_}}})),t[n.label]=i})),t})))},e.prototype.pipeItem=function(e,n,i){var r=this,p=i?e.fk_object_info:e.fk_subject_info;return this.s.inf$.getModelOfEntity$(p).pipe(t.switchMap((function(t){switch(t?t.modelName:void 0){case"appellation":return r.pipeItemAppellation(e);case"language":return r.pipeItemLanguage(e);case"place":return r.pipeItemPlace(e);case"dimension":return r.pipeItemDimension(e);case"lang_string":return r.pipeItemLangString(e);case"time_primitive":return r.pipeItemTimePrimitive(e,n);default:return r.pipeItemEntityPreview(e,i)}})))},e.prototype.pipeEntityProperties=function(e,n,i){var r=this;return e.listType.appellation?this.pipeListAppellation(e,n,i).pipe(t.map((function(t){return r.getEntityProperties(e,t)}))):e.listType.language?this.pipeListLanguage(e,n,i).pipe(t.map((function(t){return r.getEntityProperties(e,t)}))):e.listType.place?this.pipeListPlace(e,n,i).pipe(t.map((function(t){return r.getEntityProperties(e,t)}))):e.listType.dimension?this.pipeListDimension(e,n,i).pipe(t.map((function(t){return r.getEntityProperties(e,t)}))):e.listType.langString?this.pipeListLangString(e,n,i).pipe(t.map((function(t){return r.getEntityProperties(e,t)}))):e.listType.entityPreview||e.listType.temporalEntity?this.pipeListEntityPreview(e,n,i).pipe(t.map((function(t){return r.getEntityProperties(e,t)}))):e.listType.timeSpan?this.pipeItemTimeSpan(n).pipe(t.map((function(t){var n=t.properties.find((function(e){return e.items.length>0}))?[{label:r.timeSpanPipe.transform(O(t)),properties:[]}]:[];return{listDefinition:e,items:n}}))):u.of(null)},e.prototype.pipeTemporalEntityRemoveProperties=function(e){return u.combineLatest(this.s.inf$.temporal_entity$.by_pk_entity_key$(e),this.s.inf$.statement$.by_subject$({fk_subject_info:e}),this.s.inf$.text_property$.by_fk_concerned_entity_indexed$(e)).pipe(t.map((function(e){var t=v(e,3),n=t[0],i=t[1],r=t[2];return{temporalEntity:n,statements:i,textProperties:f.values(r)}})))},e.prototype.getEntityProperties=function(e,t){return{listDefinition:e,items:t}},e.prototype.pipeItemTimeSpan=function(e){var n=this;return this.p.pkProject$.pipe(t.switchMap((function(p){return n.c.pipeSpecificFieldOfClass(i.DfhConfig.ClASS_PK_TIME_SPAN).pipe(t.switchMap((function(i){return u.combineLatest(i.map((function(i){return n.s.inf$.statement$.by_subject_and_property$({fk_property:i.property.pkProperty,fk_subject_info:e}).pipe(r.switchMapOr([],(function(e){return u.combineLatest(e.map((function(e){return u.combineLatest(n.s.inf$.time_primitive$.by_pk_entity$.key(e.fk_object_info).pipe(t.filter((function(e){return!!e}))),n.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(p+"_"+e.pk_entity)).pipe(t.map((function(t){var i=v(t,2),p=i[0],o=i[1],s=new r.TimePrimitive({julianDay:p.julian_day,calendar:o.calendar||"gregorian",duration:p.duration});return{statement:e,ordNum:void 0,projRel:o,timePrimitive:s,label:n.timePrimitivePipe.transform(s),fkClass:p.fk_class}})))})))})),t.map((function(e){return{listDefinition:i.listDefinitions[0],items:e}})))}))).pipe(t.map((function(e){return{label:"",properties:e.filter((function(e){return e.items.length>0}))}})))})))})))},e.prototype.pipeItemAppellation=function(e){return this.s.inf$.appellation$.by_pk_entity$.key(e.fk_object_info).pipe(t.filter((function(e){return!!e})),t.map((function(t){return t?{ordNum:void 0,projRel:void 0,statement:e,label:t.string,fkClass:t.fk_class}:null})))},e.prototype.pipeItemLanguage=function(e){return this.s.inf$.language$.by_pk_entity$.key(e.fk_object_info).pipe(t.filter((function(e){return!!e})),t.map((function(t){return t?{ordNum:void 0,projRel:void 0,statement:e,label:t.notes,fkClass:t.fk_class}:null})))},e.prototype.pipeItemPlace=function(e){return this.s.inf$.place$.by_pk_entity$.key(e.fk_object_info).pipe(t.filter((function(e){return!!e})),t.map((function(t){return t?{ordNum:void 0,projRel:void 0,statement:e,label:"WGS84: "+t.lat+"°, "+t.long+"°",fkClass:t.fk_class}:null})))},e.prototype.pipeItemDimension=function(e){var n=this;return this.s.inf$.dimension$.by_pk_entity$.key(e.fk_object_info).pipe(t.filter((function(e){return!!e})),t.switchMap((function(i){return n.p.streamEntityPreview(i.fk_measurement_unit).pipe(t.map((function(t){return{ordNum:void 0,projRel:void 0,statement:e,label:i.numeric_value+" "+t.entity_label,fkClass:i.fk_class}})))})))},e.prototype.pipeItemLangString=function(e){var n=this;return this.s.inf$.lang_string$.by_pk_entity$.key(e.fk_object_info).pipe(t.switchMap((function(i){return i?n.s.inf$.language$.by_pk_entity$.key(i.fk_language).pipe(t.map((function(t){if(!t)return null;var n="";return i.string?n=i.string:i.quill_doc&&i.quill_doc.ops&&i.quill_doc.ops.length&&(n=i.quill_doc.ops.map((function(e){return e.insert})).join("")),{ordNum:void 0,projRel:void 0,statement:e,label:n,fkClass:i.fk_class,language:t,fkLanguage:i.fk_language}}))):new u.BehaviorSubject(null)})))},e.prototype.pipeItemEntityPreview=function(e,n){return this.p.streamEntityPreview(n?e.fk_object_info:e.fk_subject_info).pipe(t.map((function(t){return t?{ordNum:void 0,projRel:void 0,statement:e,preview:t,label:t.entity_label||"",fkClass:t.fk_class}:null})))},e.prototype.pipeItemTimePrimitive=function(e,n){var i=this;return n?u.combineLatest(this.s.inf$.time_primitive$.by_pk_entity$.key(e.fk_object_info).pipe(t.filter((function(e){return!!e}))),this.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(n+"_"+e.pk_entity).pipe(t.filter((function(e){return!!e})))).pipe(t.map((function(t){var n=v(t,2),p=n[0],o=n[1];if(!p)return null;var s=new r.TimePrimitive({julianDay:p.julian_day,calendar:o.calendar||"gregorian",duration:p.duration});return{ordNum:void 0,projRel:void 0,statement:e,timePrimitive:s,label:i.timePrimitivePipe.transform(s),fkClass:p.fk_class}}))):this.infRepo.time_primitive$.by_pk_entity$.key(e.fk_object_info).pipe(t.filter((function(e){return!!e}))).pipe(t.map((function(t){var n=new r.TimePrimitive({julianDay:t.julian_day,calendar:e.community_favorite_calendar||"gregorian",duration:t.duration});return{ordNum:void 0,projRel:void 0,statement:e,timePrimitive:n,label:i.timePrimitivePipe.transform(n),fkClass:t.fk_class}})))},e.prototype.pipeAltListLength=function(e,n){switch(e.listType){case"appellation":case"entity-preview":case"language":case"place":case"langString":case"temporal-entity":case"time-span":return this.pipeAltListStatements(e,n).pipe(t.map((function(e){return e.length})));default:console.warn("unsupported listType")}},e.prototype.pipeAltList=function(e,t){return e.listType.appellation?this.pipeAltListAppellation(e,t):e.listType.entityPreview?this.pipeAltListEntityPreview(e,t):e.listType.language?this.pipeAltListLanguage(e,t):e.listType.place?this.pipeAltListPlace(e,t):e.listType.dimension?this.pipeAltListDimension(e,t):e.listType.langString?this.pipeAltListLangString(e,t):e.listType.temporalEntity?this.pipeAltListEntityPreview(e,t):void console.warn("unsupported listType")},e.prototype.pipeAltListStatements=function(e,t){return e.isOutgoing,this.b.pipeAlternativeIngoingStatements(e.property.pkProperty,t)},e.prototype.pipeAltListEntityPreview=function(e,n){var i=this;return(e.isOutgoing?this.b.pipeAlternativeOutgoingStatements(e.property.pkProperty,n):this.b.pipeAlternativeIngoingStatements(e.property.pkProperty,n)).pipe(t.switchMap((function(n){return u.combineLatest(n.map((function(t,n){return i.pipeItemEntityPreview(t,e.isOutgoing)}))).pipe(t.map((function(e){return e.filter((function(e){return!!e})).sort((function(e,t){return e.ordNum>t.ordNum?1:-1}))})),t.startWith([]))})))},e.prototype.pipeAltListPlace=function(e,n){var i=this;if(e.isOutgoing)return this.b.pipeAlternativeOutgoingStatements(e.property.pkProperty,n).pipe(t.switchMap((function(n){return u.combineLatest(n.map((function(e,t){return i.pipeItemPlace(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),t.startWith([]))})))},e.prototype.pipeAltListDimension=function(e,n){var i=this;if(e.isOutgoing)return this.b.pipeAlternativeOutgoingStatements(e.property.pkProperty,n).pipe(t.switchMap((function(n){return u.combineLatest(n.map((function(e,t){return i.pipeItemDimension(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),t.startWith([]))})))},e.prototype.pipeAltListLangString=function(e,n){var i=this;if(e.isOutgoing)return this.b.pipeAlternativeOutgoingStatements(e.property.pkProperty,n).pipe(t.switchMap((function(n){return u.combineLatest(n.map((function(e,t){return i.pipeItemLangString(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),t.startWith([]))})))},e.prototype.pipeAltListAppellation=function(e,n){var i=this;if(e.isOutgoing)return this.b.pipeAlternativeOutgoingStatements(e.property.pkProperty,n).pipe(t.switchMap((function(n){return u.combineLatest(n.map((function(e,t){return i.pipeItemAppellation(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),t.startWith([]))})))},e.prototype.pipeAltListLanguage=function(e,n){var i=this;if(e.isOutgoing)return this.b.pipeAlternativeOutgoingStatements(e.property.pkProperty,n).pipe(t.switchMap((function(n){return u.combineLatest(n.map((function(e,t){return i.pipeItemLanguage(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),t.startWith([]))})))},e.prototype.pipeRepoListAppellation=function(e,n){var i=this;if(e.isOutgoing)return this.b.pipeRepoOutgoingStatementsByProperty(e.property.pkProperty,n).pipe(t.switchMap((function(n){return u.combineLatest(n.map((function(e,t){return i.pipeItemAppellation(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),t.startWith([]))})))},e.prototype.pipeRepoListLanguage=function(e,n){var i=this;if(e.isOutgoing)return this.b.pipeRepoOutgoingStatementsByProperty(e.property.pkProperty,n).pipe(t.switchMap((function(n){return u.combineLatest(n.map((function(e,t){return i.pipeItemLanguage(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),t.startWith([]))})))},e.prototype.pipeRepoListPlace=function(e,n){var i=this;if(e.isOutgoing)return this.b.pipeRepoOutgoingStatementsByProperty(e.property.pkProperty,n).pipe(t.switchMap((function(n){return u.combineLatest(n.map((function(e,t){return i.pipeItemPlace(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),t.startWith([]))})))},e.prototype.pipeRepoListDimension=function(e,n){var i=this;if(e.isOutgoing)return this.b.pipeRepoOutgoingStatementsByProperty(e.property.pkProperty,n).pipe(t.switchMap((function(n){return u.combineLatest(n.map((function(e,t){return i.pipeItemDimension(e)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),t.startWith([]))})))},e.prototype.pipeRepoListEntityPreview=function(e,n){var i=this;return(e.isOutgoing?this.b.pipeRepoOutgoingStatementsByProperty(e.property.pkProperty,n):this.b.pipeRepoIngoingStatementsByProperty(e.property.pkProperty,n)).pipe(t.switchMap((function(n){return u.combineLatest(n.map((function(t,n){return i.pipeItemEntityPreview(t,e.isOutgoing)}))).pipe(t.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})))})),t.startWith([]))},e.prototype.pipeRepoItemTimeSpan=function(e){var n=this;return this.p.pkProject$.pipe(t.switchMap((function(p){return n.c.pipeBasicAndSpecificFields(i.DfhConfig.ClASS_PK_TIME_SPAN).pipe(t.switchMap((function(i){return u.combineLatest(i.map((function(i){return n.b.pipeRepoOutgoingStatementsByProperty(i.property.pkProperty,e).pipe(r.switchMapOr([],(function(e){return u.combineLatest(e.map((function(e){return n.infRepo.time_primitive$.by_pk_entity$.key(e.fk_object_info).pipe(t.map((function(t){var i=new r.TimePrimitive({julianDay:t.julian_day,calendar:e.community_favorite_calendar||"gregorian",duration:t.duration});return{statement:e,ordNum:void 0,projRel:void 0,timePrimitive:i,label:n.timePrimitivePipe.transform(i),fkClass:t.fk_class}})))})))})),t.map((function(e){return{listDefinition:i.listDefinitions[0],items:e}})),t.startWith({listDefinition:i.listDefinitions[0],items:[]}))}))).pipe(t.map((function(e){return{label:"",properties:e.filter((function(e){return e.items.length>0}))}})))})))})))},e.prototype.pipeLabelOfEntity=function(e){var n=this;return this.b.pipeClassOfEntity(e).pipe(t.switchMap((function(i){return n.c.pipeBasicAndSpecificFields(i).pipe(t.switchMap((function(i){return r.combineLatestOrEmpty(i&&i.length?i[0].listDefinitions.map((function(t){return n.pipeEntityProperties(t,e,1)})):[]).pipe(t.map((function(e){return(e=e.filter((function(e){return e.items.length>0}))).length&&e[0].items.length?e[0].items[0].label:""})))})))})))},e.prototype.pipeClassLabelOfEntity=function(e){var n=this;return this.b.pipeClassOfEntity(e).pipe(t.switchMap((function(e){return n.c.pipeClassLabel(e)})))},e.prototype.pipeTypeOfEntity=function(e,n,i){return i?this.s.inf$.statement$.by_subject_and_property_indexed$({fk_property:n,fk_subject_info:e}).pipe(t.map((function(e){return!e||Object.keys(e).length<1?void 0:f.values(e)[0]}))):this.s.inf$.statement$.by_object_and_property_indexed$({fk_property:n,fk_object_info:e}).pipe(t.map((function(e){return!e||Object.keys(e).length<1?void 0:f.values(e)[0]})))},e.prototype.pipeClassesAndTypes=function(e){var n=this;return this.c.pipeTypeAndTypedClasses(e).pipe(t.switchMap((function(e){return n.pipeClassAndTypeNodes(e)})))},e.prototype.pipeClassesAndTypesOfClasses=function(e){var n=this;return this.c.pipeTypeAndTypedClassesOfTypedClasses(e).pipe(t.switchMap((function(e){return n.pipeClassAndTypeNodes(e)})))},e.prototype.pipeClassAndTypeNodes=function(e){var n=this;return r.combineLatestOrEmpty(e.map((function(e){return n.c.pipeClassLabel(e.typedClass).pipe(t.map((function(t){return{label:t,data:{pkClass:e.typedClass,pkType:null}}})),t.switchMap((function(i){return u.iif((function(){return!!e.typeClass}),n.b.pipePersistentItemPksByClass(e.typeClass).pipe(t.switchMap((function(i){return r.combineLatestOrEmpty(i.map((function(i){return n.p.streamEntityPreview(i).pipe(t.map((function(t){return{label:t.entity_label,data:{pkClass:e.typedClass,pkType:i}}})))}))).pipe(r.sortAbc((function(e){return e.label})))})),t.map((function(e){return i.children=e,i}))),u.of(d({},i,{children:[]})))})))}))).pipe(r.sortAbc((function(e){return e.label})))},e.prototype.pipeClassesFromClassesAndTypes=function(e){var n=this;return(e&&e.types&&e.types.length?this.b.pipeClassesOfPersistentItems(e.types).pipe(t.filter((function(e){return!!e})),t.switchMap((function(e){return n.c.pipeTypedClassesOfTypeClasses(e)}))):u.of([])).pipe(t.map((function(t){return f.uniq(P(t,(e||{classes:[]}).classes||[]))})))},e.prototype.pipePropertyOptionsFromClassesAndTypes=function(e){var n=this;return this.pipeClassesFromClassesAndTypes(e).pipe(t.switchMap((function(e){return n.pipePropertyOptionsFormClasses(e)})))},e.prototype.pipePropertyOptionsFormClasses=function(e){var n=this;return r.combineLatestOrEmpty(e.map((function(e){return n.s.dfh$.class$.by_pk_class$.key(e).pipe(t.map((function(e){return 9===e.basic_type})),t.switchMap((function(p){return n.c.pipeSpecificAndBasicFields(e).pipe(t.map((function(e){return e.filter((function(e){return!!e.property.pkProperty})).map((function(e){return{isOutgoing:e.isOutgoing,fkPropertyDomain:e.isOutgoing?e.sourceClass:null,fkPropertyRange:e.isOutgoing?null:e.sourceClass,pkProperty:e.property.pkProperty}}))})),t.switchMap((function(o){return p&&i.DfhConfig.PROPERTY_PKS_WHERE_TIME_PRIMITIVE_IS_RANGE.map((function(t){o.push({pkProperty:t,fkPropertyDomain:e,fkPropertyRange:i.DfhConfig.CLASS_PK_TIME_PRIMITIVE,isOutgoing:!0})})),r.combineLatestOrEmpty(o.map((function(e){return n.c.pipeFieldLabel(e.pkProperty,e.fkPropertyDomain,e.fkPropertyRange).pipe(t.map((function(t){var n=e.isOutgoing;return{isOutgoing:n,label:t,pk:e.pkProperty,propertyFieldKey:Ie(e.pkProperty,n)}})))})))})))})))}))).pipe(t.map((function(e){return f.flatten(e)})))},e.prototype.pipePkClassesFromPropertySelectModel=function(e){return r.combineLatestOrEmpty([this.c.pipeTargetClassesOfProperties(e.outgoingProperties,!0),this.c.pipeTargetClassesOfProperties(e.ingoingProperties,!1)]).pipe(t.map((function(e){var t=v(e,2),n=t[0],i=t[1];return f.uniq(P(n,i))})))},e.prototype.getPkClassesFromPropertySelectModel$=function(e){var n=this;return e.pipe(t.switchMap((function(e){return r.combineLatestOrEmpty([n.c.pipeTargetClassesOfProperties(e.outgoingProperties,!0),n.c.pipeTargetClassesOfProperties(e.ingoingProperties,!1)]).pipe(t.map((function(e){var t=v(e,2),n=t[0],i=t[1];return f.uniq(P(n,i))})))})))},e.prototype.getPropertyOptions$=function(e){var n=this;return e.pipe(t.distinctUntilChanged((function(e,t){return f.equals(e,t)})),t.switchMap((function(e){return e?n.b.pipeClassesOfPersistentItems(e.types).pipe(t.filter((function(e){return!!e})),t.switchMap((function(i){return n.c.pipeTypedClassesOfTypeClasses(i).pipe(t.switchMap((function(t){var i=f.uniq(P(t,e.classes||[]));return n.pipePropertyOptionsFormClasses(i)})))}))):u.empty()})))},e.decorators=[{type:o.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:Se},{type:ve},{type:ke},{type:Pe},{type:r.TimePrimitivePipe},{type:r.TimeSpanPipe},{type:a.NgRedux}]},e.ngInjectableDef=o.ɵɵdefineInjectable({factory:function(){return new e(o.ɵɵinject(Se),o.ɵɵinject(ve),o.ɵɵinject(ke),o.ɵɵinject(Pe),o.ɵɵinject(r.TimePrimitivePipe),o.ɵɵinject(r.TimeSpanPipe),o.ɵɵinject(a.NgRedux))},token:e,providedIn:"root"}),b([j,$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[String]),h("design:returntype",void 0)],e.prototype,"pipeClassesAndTypes",null),b([j,$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Array]),h("design:returntype",void 0)],e.prototype,"pipeClassesAndTypesOfClasses",null),b([j,$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Array]),h("design:returntype",u.Observable)],e.prototype,"pipeClassAndTypeNodes",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Array]),h("design:returntype",u.Observable)],e.prototype,"pipePropertyOptionsFormClasses",null),b([$({refCount:!1}),h("design:type",Function),h("design:paramtypes",[Object]),h("design:returntype",u.Observable)],e.prototype,"pipePkClassesFromPropertySelectModel",null),e}();function Ie(e,t){return"_"+e+"_"+(t?"outgoing":"ingoing")}e.ActiveProjectPipesService=ve,e.ConfigurationPipesService=Pe,e.DatSelector=F,e.DfhSelector=K,e.InfSelector=ee,e.InformationBasicPipesService=Se,e.InformationPipesService=Ce,e.ProSelector=ue,e.ReduxQueriesModule=C,e.SchemaSelectorsService=ke,e.ShouldPauseService=A,e.SysSelector=ye,e.TabSelector=de,e.WarSelector=he,e.cache=$,e.createHasTimeSpanProperty=$e,e.infTimePrimToTimePrimWithCal=S,e.propertyOptionFieldKey=Ie,e.spyTag=j,e.timeSpanItemToTimeSpan=O,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=kleiolab-lib-queries.umd.min.js.map