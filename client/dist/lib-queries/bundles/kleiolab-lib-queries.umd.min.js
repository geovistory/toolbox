!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("@angular/core"),require("@kleiolab/lib-redux"),require("rxjs/operators"),require("rxjs-spy/operators"),require("@angular-redux/store"),require("@kleiolab/lib-utils"),require("rxjs"),require("d3"),require("ramda"),require("@kleiolab/lib-sockets"),require("@kleiolab/lib-config"),require("@kleiolab/lib-sdk-lb3")):"function"==typeof define&&define.amd?define("@kleiolab/lib-queries",["exports","@angular/common","@angular/core","@kleiolab/lib-redux","rxjs/operators","rxjs-spy/operators","@angular-redux/store","@kleiolab/lib-utils","rxjs","d3","ramda","@kleiolab/lib-sockets","@kleiolab/lib-config","@kleiolab/lib-sdk-lb3"],t):t(((e=e||self).kleiolab=e.kleiolab||{},e.kleiolab["lib-queries"]={}),e.ng.common,e.ng.core,e.libRedux,e.rxjs.operators,e.operators$1,e.store,e.libUtils,e.rxjs,e.d3,e.ramda,e.libSockets,e.libConfig,e.libSdkLb3)}(this,(function(e,t,n,i,r,p,o,s,a,u,c,f,l,y){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var _=function(e,t){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function d(e,t){function n(){this.constructor=e}_(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var m=function(){return(m=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var r in t=arguments[n])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function g(e,t,n,i){var r,p=arguments.length,o=p<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,i);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(o=(p<3?r(o):p>3?r(t,n,o):r(t,n))||o);return p>3&&o&&Object.defineProperty(t,n,o),o}function b(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function h(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function k(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var i,r,p=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(i=p.next()).done;)o.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(n=p.return)&&n.call(p)}finally{if(r)throw r.error}}return o}function v(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(k(arguments[t]));return e}var P=function(){function e(e,t){var n=[];if(e&&n.push("ReduxQueriesModule is already loaded. Import in your base AppModule only."),t||n.push("You need to import the ReduxModule in your AppModule!"),n.length)throw new Error(n.join("\n"))}return e.decorators=[{type:n.NgModule,args:[{declarations:[],imports:[t.CommonModule],providers:[]}]}],e.ctorParameters=function(){return[{type:e,decorators:[{type:n.Optional},{type:n.SkipSelf}]},{type:i.ReduxModule,decorators:[{type:n.Optional}]}]},e}();var $=function(e){return function(t,n,i){var o=m({refCount:!0},e),s=new Map,a=i.value;return i.value=function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];var u=JSON.stringify(e);if(!s.has(u)){var c=a.bind(this);s.set(u,c.apply(void 0,v(e)).pipe(r.shareReplay({refCount:o.refCount,bufferSize:1}),p.tag("FROM-CACHE-"+t.constructor.name+"::"+n+"::"+e.join(":"))))}return s.get(u)},i}};function j(e,t,n){var i=n.value;return n.value=function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];var o=i.bind(this);return o.apply(void 0,v(n)).pipe(p.tag(e.constructor.name+"::"+t+"::"+n.join(":")))},n}var O=function(){function e(e,t,n){this.ngRedux=e,this.configs=t,this.model=n}return e.prototype.selector=function(e){var t=this;return{all$:this.ngRedux.select([i.datRoot,this.model,e]),key:function(n){return t.ngRedux.select([i.datRoot,t.model,e,n])}}},e}();var C=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity__entity_version$=r.selector("by_pk_entity__entity_version"),r.by_pk_entity$=r.selector("by_pk_entity"),r.by_pk_text$=r.selector("by_pk_text"),r}return d(t,e),t.prototype.latestVersion=function(e){return this.by_pk_entity$.key(e).pipe(r.map((function(e){return s.latestVersion(e)})))},t}(O);var S=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_project$=r.selector("by_fk_project"),r}return d(t,e),t}(O);var R=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_text$=r.selector("by_fk_text"),r}return d(t,e),t}(O);var I=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_column$=r.selector("by_fk_column"),r}return d(t,e),t}(O);var T=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_digital$=r.selector("by_fk_digital"),r}return d(t,e),t}(O);var w=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_entity__fk_system_type$=r.selector("by_fk_entity__fk_system_type"),r}return d(t,e),t}(O);var x=function(e){function t(t){var n=e.call(this,t)||this;return n.ngRedux=t,n.digital$=new C(n.ngRedux,i.datDefinitions,"digital"),n.namespace$=new S(n.ngRedux,i.datDefinitions,"namespace"),n.chunk$=new R(n.ngRedux,i.datDefinitions,"chunk"),n.column$=new T(n.ngRedux,i.datDefinitions,"column"),n.class_column_mapping$=new I(n.ngRedux,i.datDefinitions,"class_column_mapping"),n.text_property$=new w(n.ngRedux,i.datDefinitions,"text_property"),n}return d(t,e),t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:o.NgRedux}]},t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(o.NgRedux))},token:t,providedIn:"root"}),t}(i.DatActions);var L=function(){function e(){this.shouldPause$=new a.BehaviorSubject(!1)}return e.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[]},e.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}();var E=function(){function e(e,t,n,r){this.ngRedux=e,this.configs=t,this.model=n,this.shouldPause$=r,this.slice$=this.ngRedux.select([i.dfhRoot,this.model])}return e.prototype.selector=function(e){var t=this,n=this.ngRedux.select([i.dfhRoot,this.model,e]);return{all$:this.shouldPause$.pipe(r.switchMap((function(e){return e?a.empty():n}))),key:function(n){return t.shouldPause$.pipe(r.switchMap((function(r){return r?a.empty():t.ngRedux.select([i.dfhRoot,t.model,e,n])})))},noPause:{all$:n,key:function(n){return t.ngRedux.select([i.dfhRoot,t.model,e,n])}}}},e}();var F=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.by_pk_profile$=t.selector("by_pk_profile"),t}return d(t,e),t}(E);var A=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.by_pk_class$=t.selector("by_pk_class"),t.by_basic_type$=t.selector("by_basic_type"),t}return d(t,e),t}(E);var B=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pk_property__has_domain__has_range$=t.selector("pk_property__has_domain__has_range"),t.by_pk_property$=t.selector("by_pk_property"),t.by_has_domain__pk_property$=t.selector("by_has_domain__pk_property"),t.by_has_range__pk_property$=t.selector("by_has_range__pk_property"),t.by_has_domain$=t.selector("by_has_domain"),t.by_has_range$=t.selector("by_has_range"),t.by_is_has_type_subproperty$=t.selector("by_is_has_type_subproperty"),t}return d(t,e),t}(E);var D=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.by_fks$=t.selector("by_fks"),t.by_fk_class__type$=t.selector("by_fk_class__type"),t.by_fk_property__type$=t.selector("by_fk_property__type"),t.by_fk_profile__type$=t.selector("by_fk_profile__type"),t}return d(t,e),t}(E);var M=function(e){function t(t,n){var r=e.call(this,t)||this;return r.ngRedux=t,r.pause=n,r.profile$=new F(r.ngRedux,i.dfhDefinitions,"profile",r.pause.shouldPause$),r.class$=new A(r.ngRedux,i.dfhDefinitions,"klass",r.pause.shouldPause$),r.property$=new B(r.ngRedux,i.dfhDefinitions,"property",r.pause.shouldPause$),r.label$=new D(r.ngRedux,i.dfhDefinitions,"label",r.pause.shouldPause$),r}return d(t,e),t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:o.NgRedux},{type:L}]},t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(o.NgRedux),n.ɵɵinject(L))},token:t,providedIn:"root"}),t}(i.DfhActions);var N=function(){function e(e,t,n,i){this.ngRedux=e,this.pkProject$=t,this.configs=n,this.model=i}return e.prototype.selector=function(e){var t=this;return{all$:this.pkProject$.pipe(r.switchMap((function(n){var r;return r=t.configs[t.model].facetteByPk?[i.infRoot,t.model,t.configs[t.model].facetteByPk,n,e]:[i.infRoot,t.model,e],t.ngRedux.select(r)}))),key:function(n){return t.pkProject$.pipe(r.switchMap((function(r){var p;return p=t.configs[t.model].facetteByPk?[i.infRoot,t.model,t.configs[t.model].facetteByPk,r,e,n]:[i.infRoot,t.model,e,n],t.ngRedux.select(p)})))}}},e.prototype.paginationSelector=function(){var e=this;return{pipePage:function(t,n,p){return e.pkProject$.pipe(r.switchMap((function(o){var a,u=i.paginatedBy(i.paginateName(t)),c=i.paginateKey(t);return a=e.configs[e.model].facetteByPk?[i.infRoot,e.model,e.configs[e.model].facetteByPk,o,u,c]:[i.infRoot,e.model,u,c],e.ngRedux.select(v(a,["count"])).pipe(r.filter((function(e){return void 0!==e})),r.switchMap((function(t){for(var i=t<=p+n?t:p+n,o=[],u=p;u<i;u++)o.push(e.ngRedux.select(v(a,["rows",u])).pipe(r.filter((function(e){return!!e}))));return s.combineLatestOrEmpty(o)})))})))},pipePageLoadNeeded:function(t,n,p,o){return e.pkProject$.pipe(r.switchMap((function(s){var a,u=i.paginatedBy(i.paginateName(t)),c=i.paginateKey(t);return a=e.configs[e.model].facetteByPk?[i.infRoot,e.model,e.configs[e.model].facetteByPk,s,u,c]:[i.infRoot,e.model,u,c],o.pipe(r.switchMap((function(){return e.ngRedux.select(v(a,["loading",i.getFromTo(n,p)])).pipe(r.first(),r.map((function(e){return!e})))})))})))},pipeCount:function(t){return e.pkProject$.pipe(r.switchMap((function(n){var r,p=i.paginatedBy(i.paginateName(t)),o=i.paginateKey(t);return r=e.configs[e.model].facetteByPk?[i.infRoot,e.model,e.configs[e.model].facetteByPk,n,p,o]:[i.infRoot,e.model,p,o],e.ngRedux.select(v(r,["count"]))})))}}},e.prototype.pipeItemsInProject=function(e,t){var n=this;return a.pipe(r.switchMap((function(i){return e.pipe(r.switchMap((function(e){var p=[],o=function(o){if(i.hasOwnProperty(o)){var s=i[o];p.push(n.ngRedux.select(["pro","info_proj_rel","by_fk_project__fk_entity",e+"_"+t(s)]).pipe(r.map((function(e){return{key:o,rel:e}}))))}};for(var a in i)o(a);return s.combineLatestOrEmpty(p).pipe(r.map((function(e){for(var t={},n=0;n<e.length;n++){var r=e[n];r.rel&&r.rel.is_in_project&&(t[r.key]=i[r.key])}return t})))})))})))},e.prototype.pipeItemInProject=function(e,t){var n=this;return a.pipe(r.switchMap((function(i){return i?e.pipe(r.switchMap((function(e){return n.ngRedux.select(["pro","info_proj_rel","by_fk_project__fk_entity",e+"_"+t(i)]).pipe(r.map((function(e){return e&&1==e.is_in_project?i:void 0})))}))):a.of(void 0)})))},e}();var q=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p._by_pk_entity$=p.selector("by_pk_entity"),p._by_fk_class$=p.selector("by_fk_class"),p}return d(t,e),t.prototype.by_pk_entity_key$=function(e,t){void 0===t&&(t=!0);var n=this._by_pk_entity$.key(e);return t?n.pipe(this.pipeItemInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t.prototype.by_pk_entity_all$=function(e){void 0===e&&(e=!0);var t=this._by_pk_entity$.all$;return e?t.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):t},t.prototype.by_fk_class_key$=function(e,t){void 0===t&&(t=!0);var n=this._by_fk_class$.key(e);return t?n.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t}(N);var K=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p._by_pk_entity$=p.selector("by_pk_entity"),p}return d(t,e),t.prototype.by_pk_entity_key$=function(e,t){void 0===t&&(t=!0);var n=this._by_pk_entity$.key(e);return t?n.pipe(this.pipeItemInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t}(N);var W=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p._by_pk_entity$=p.selector("by_pk_entity"),p.by_fk_subject_data$=p.selector("by_fk_subject_data"),p.pagination$=p.paginationSelector(),p}return d(t,e),t.prototype.by_pk_entity_key$=function(e,t){void 0===t&&(t=!0);var n=this._by_pk_entity$.key(e);return t?n.pipe(this.pipeItemInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t.prototype.by_subject$=function(e,t){void 0===t&&(t=!0);var n=i.indexStatementBySubject(e),p=this.selector("by_subject").key(n);return t?p.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity})),r.map((function(e){return u.values(e)}))):p.pipe(r.map((function(e){return u.values(e)})))},t.prototype.by_subject_and_property$=function(e,t){return void 0===t&&(t=!0),this.by_subject_and_property_indexed$(e,t).pipe(r.map((function(e){return u.values(e)})))},t.prototype.by_subject_and_property_indexed$=function(e,t){void 0===t&&(t=!0);var n=i.indexStatementBySubjectProperty(e),r=this.selector("by_subject+property").key(n);return t?r.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):r},t.prototype.by_object$=function(e,t){void 0===t&&(t=!0);var n=i.indexStatementByObject(e),p=this.selector("by_object").key(n);return t?p.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity})),r.map((function(e){return u.values(e)}))):p.pipe(r.map((function(e){return u.values(e)})))},t.prototype.by_object_and_property$=function(e,t){return void 0===t&&(t=!0),this.by_object_and_property_indexed$(e,t).pipe(r.map((function(e){return u.values(e)})))},t.prototype.by_object_and_property_indexed$=function(e,t){void 0===t&&(t=!0);var n=i.indexStatementByObjectProperty(e),r=this.selector("by_object+property").key(n);return t?r.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):r},t}(N);var Y=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p._by_pk_entity$=p.selector("by_pk_entity"),p._by_fk_concerned_entity__fk_class_field$=p.selector("by_fk_concerned_entity__fk_class_field"),p._by_fk_concerned_entity$=p.selector("by_fk_concerned_entity"),p}return d(t,e),t.prototype.by_pk_entity_key$=function(e,t){void 0===t&&(t=!0);var n=this._by_pk_entity$.key(e);return t?n.pipe(this.pipeItemInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t.prototype.by_fk_concerned_entity__fk_class_field_indexed$=function(e,t){void 0===t&&(t=!0);var n=this._by_fk_concerned_entity__fk_class_field$.key(e);return t?n.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t.prototype.by_fk_concerned_entity_indexed$=function(e,t){void 0===t&&(t=!0);var n=this._by_fk_concerned_entity$.key(e);return t?n.pipe(this.pipeItemsInProject(this.pkProject$,(function(e){return e.pk_entity}))):n},t}(N);var U=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p.by_pk_entity$=p.selector("by_pk_entity"),p}return d(t,e),t}(N);var G=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p.by_pk_entity$=p.selector("by_pk_entity"),p}return d(t,e),t}(N);var Q=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p.by_pk_entity$=p.selector("by_pk_entity"),p}return d(t,e),t}(N);var H=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p.by_pk_entity$=p.selector("by_pk_entity"),p}return d(t,e),t}(N);var V=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p.by_pk_entity$=p.selector("by_pk_entity"),p}return d(t,e),t}(N);var J=function(e){function t(t,n,i,r){var p=e.call(this,t,n,i,r)||this;return p.ngRedux=t,p.pkProject$=n,p.configs=i,p.model=r,p.by_pk_entity$=p.selector("by_pk_entity"),p}return d(t,e),t}(N);var X=function(){function e(e,t){this.ngRedux=e,this.pkProject$=t,this.persistent_item$=new q(this.ngRedux,this.pkProject$,i.infDefinitions,"persistent_item"),this.temporal_entity$=new K(this.ngRedux,this.pkProject$,i.infDefinitions,"temporal_entity"),this.statement$=new W(this.ngRedux,this.pkProject$,i.infDefinitions,"statement"),this.appellation$=new U(this.ngRedux,this.pkProject$,i.infDefinitions,"appellation"),this.place$=new Q(this.ngRedux,this.pkProject$,i.infDefinitions,"place"),this.text_property$=new Y(this.ngRedux,this.pkProject$,i.infDefinitions,"text_property"),this.lang_string$=new G(this.ngRedux,this.pkProject$,i.infDefinitions,"lang_string"),this.time_primitive$=new H(this.ngRedux,this.pkProject$,i.infDefinitions,"time_primitive"),this.language$=new V(this.ngRedux,this.pkProject$,i.infDefinitions,"language"),this.dimension$=new J(this.ngRedux,this.pkProject$,i.infDefinitions,"dimension"),this.pkEntityModelMap$=this.ngRedux.select([i.infRoot,i.PR_ENTITY_MODEL_MAP])}return e.prototype.getModelOfEntity$=function(e){return this.ngRedux.select([i.infRoot,i.PR_ENTITY_MODEL_MAP,e])},e}();var z=function(){function e(e,t,n){this.ngRedux=e,this.configs=t,this.model=n}return e.prototype.selector=function(e){var t=this;return{all$:this.ngRedux.select([i.proRoot,this.model,e]),key:function(n){var r="string"==typeof n?n:n.map((function(e){return c.toString(e)})).join("_");return t.ngRedux.select([i.proRoot,t.model,e,r])}}},e}();var Z=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r}return d(t,e),t}(z);var ee=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_fk_project__fk_entity$=r.selector("by_fk_project__fk_entity"),r}return d(t,e),t}(z);var te=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_fk_project__enabled_in_entities$=r.selector("by_fk_project__enabled_in_entities"),r.by_fk_project__fk_class$=r.selector("by_fk_project__fk_class"),r.by_fk_project$=r.selector("by_fk_project"),r}return d(t,e),t}(z);var ne=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_fk_project__enabled$=r.selector("by_fk_project__enabled"),r.by_fk_project__fk_profile$=r.selector("by_fk_project__fk_profile"),r.by_fk_project$=r.selector("by_fk_project"),r}return d(t,e),t}(z);var ie=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_fk_project__fk_class$=r.selector("by_fk_project__fk_class"),r.by_pk_entity$=r.selector("by_pk_entity"),r}return d(t,e),t}(z);var re=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_fks$=r.selector("by_fks"),r.by_fks_without_lang$=r.selector("by_fks_without_lang"),r}return d(t,e),t}(z);var pe=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r}return d(t,e),t}(z);var oe=function(e){function t(t){var n=e.call(this,t)||this;return n.ngRedux=t,n.project$=new Z(n.ngRedux,i.proDefinitions,"project"),n.info_proj_rel$=new ee(n.ngRedux,i.proDefinitions,"info_proj_rel"),n.dfh_class_proj_rel$=new te(n.ngRedux,i.proDefinitions,"dfh_class_proj_rel"),n.dfh_profile_proj_rel$=new ne(n.ngRedux,i.proDefinitions,"dfh_profile_proj_rel"),n.class_field_config$=new ie(n.ngRedux,i.proDefinitions,"class_field_config"),n.text_property$=new re(n.ngRedux,i.proDefinitions,"text_property"),n.analysis$=new pe(n.ngRedux,i.proDefinitions,"analysis"),n}return d(t,e),t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:o.NgRedux}]},t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(o.NgRedux))},token:t,providedIn:"root"}),t}(i.ProActions);var se=function(){function e(e,t,n){this.ngRedux=e,this.configs=t,this.model=n,this.slice$=this.ngRedux.select([i.sysRoot,this.model])}return e.prototype.selector=function(e){var t=this;return{all$:this.ngRedux.select([i.sysRoot,this.model,e]),key:function(n){return t.ngRedux.select([i.sysRoot,t.model,e,n])}}},e}();var ae=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r.by_fk_class$=r.selector("by_fk_class"),r.by_required_by_sources$=r.selector("by_required_by_sources"),r.by_required$=r.selector("by_required"),r}return d(t,e),t}(se);var ue=function(e){function t(t,n,r){var p=e.call(this,t,n,r)||this;return p.ngRedux=t,p.configs=n,p.model=r,p.main$=p.ngRedux.select([i.sysRoot,p.model,"by_main","main"]),p}return d(t,e),t}(se);var ce=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.system_relevant_class$=new ae(t.ngRedux,i.sysDefinitions,"system_relevant_class"),t.config$=new ue(t.ngRedux,i.sysDefinitions,"config"),t}return d(t,e),t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(o.NgRedux))},token:t,providedIn:"root"}),t}(i.SysActions);var fe=function(){function e(e,t,n){this.ngRedux=e,this.configs=t,this.model=n}return e.prototype.selector=function(e){var t=this;return{all$:this.ngRedux.select([i.tabRoot,this.model,e]),key:function(n){return t.ngRedux.select([i.tabRoot,t.model,e,n])}}},e}();var le=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_cell$=r.selector("by_pk_cell"),r.by_fk_column_fk_row$=r.selector("by_fk_column_fk_row"),r}return d(t,e),t}(fe);var ye=function(e){function t(t){var n=e.call(this,t)||this;return n.ngRedux=t,n.cell$=new le(n.ngRedux,i.tabDefinitions,"cell"),n}return d(t,e),t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:o.NgRedux}]},t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(o.NgRedux))},token:t,providedIn:"root"}),t}(i.TabActions);var _e=function(){function e(e,t,n){this.ngRedux=e,this.configs=t,this.model=n}return e.prototype.selector=function(e){var t=this;return{all$:this.ngRedux.select([i.warRoot,this.model,e]),key:function(n){var r="string"==typeof n?n:n.map((function(e){return c.toString(e)})).join("_");return t.ngRedux.select([i.warRoot,t.model,e,r])}}},e}();var de=function(e){function t(t,n,i){var r=e.call(this,t,n,i)||this;return r.ngRedux=t,r.configs=n,r.model=i,r.by_pk_entity$=r.selector("by_pk_entity"),r}return d(t,e),t}(_e);var me=function(e){function t(t){var n=e.call(this,t)||this;return n.ngRedux=t,n.entity_preview$=new de(n.ngRedux,i.warDefinitions,"entity_preview"),n}return d(t,e),t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[{type:o.NgRedux}]},t.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new t(n.ɵɵinject(o.NgRedux))},token:t,providedIn:"root"}),t}(i.WarActions);var ge=function(){function e(e,t,n,i,p,o){this.dat$=t,this.tab$=n,this.pro$=i,this.dfh$=p,this.sys$=o;var s=e.select(["activeProject","pk_project"]).pipe(r.filter((function(e){return void 0!==e})),r.distinctUntilChanged((function(e,t){return e===t})));this.inf$=new X(e,s)}return e.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:o.NgRedux},{type:x},{type:ye},{type:oe},{type:M},{type:ce}]},e.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new e(n.ɵɵinject(o.NgRedux),n.ɵɵinject(x),n.ɵɵinject(ye),n.ɵɵinject(oe),n.ɵɵinject(M),n.ɵɵinject(ce))},token:e,providedIn:"root"}),e}();var be=function(){function e(e,t,n){var i=this;this.ngRedux=e,this.s=t,this.entityPreviewSocket=n,this.requestedEntityPreviews={},this.pkProject$=e.select(["activeProject","pk_project"]).pipe(r.filter((function(e){return void 0!==e})),r.distinctUntilChanged((function(e,t){return e===t}))),this.entityPreviewSocket.fromEvent("reconnect").subscribe((function(e){i.pkProject$.pipe(r.first()).subscribe((function(e){var t=Object.keys(m({},i.ngRedux.getState().war.entity_preview,i.requestedEntityPreviews));t.length&&i.entityPreviewSocket.emit("addToStream",{pkProject:e,pks:t})}))}))}return e.prototype.pipeActiveProject=function(){var e=this;return this.pkProject$.pipe(r.switchMap((function(t){return e.s.pro$.project$.by_pk_entity$.key(t.toString())}))).pipe(r.filter((function(e){return!!e})))},e.prototype.pipeActiveDefaultLanguage=function(){var e=this;return this.pipeActiveProject().pipe(r.filter((function(e){return!!e})),r.switchMap((function(t){return e.s.inf$.language$.by_pk_entity$.key(t.fk_language.toString())}))).pipe(r.filter((function(e){return!!e})))},e.prototype.streamEntityPreview=function(e,t){var n=this;return(!(((this.ngRedux.getState().war||{}).entity_preview||{}).by_pk_entity||{})[e]&&!this.requestedEntityPreviews[e]||t)&&this.pkProject$.pipe(r.first((function(e){return!!e}))).subscribe((function(t){n.entityPreviewSocket.emit("addToStream",{pkProject:t,pks:[e]}),n.requestedEntityPreviews[e]=!0})),this.ngRedux.select(["war","entity_preview","by_pk_entity",e]).pipe(r.distinctUntilChanged(c.equals),r.filter((function(e){return!!e})))},e.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:o.NgRedux},{type:ge},{type:f.EntityPreviewSocket}]},e.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new e(n.ɵɵinject(o.NgRedux),n.ɵɵinject(ge),n.ɵɵinject(f.EntityPreviewSocket))},token:e,providedIn:"root"}),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",a.Observable)],e.prototype,"pipeActiveProject",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",a.Observable)],e.prototype,"pipeActiveDefaultLanguage",null),e}();var he=function(){function e(e,t){this.a=e,this.s=t}return e.prototype.pipeProfilesEnabledByProject=function(){var e=this;return this.a.pkProject$.pipe(r.switchMap((function(t){return e.s.pro$.dfh_profile_proj_rel$.by_fk_project__enabled$.key(t+"_true").pipe(r.map((function(e){return c.values(e).filter((function(e){return e.enabled})).map((function(e){return e.fk_profile}))})),r.map((function(e){return v(e,[l.DfhConfig.PK_PROFILE_GEOVISTORY_BASIC])})))})))},e.prototype.pipeFields=function(e){var t=this;return a.combineLatest(this.s.dfh$.class$.by_pk_class$.key(e),this.s.dfh$.property$.by_has_domain$.key(e).pipe(r.map((function(e){return c.values(e)}))),this.s.dfh$.property$.by_has_range$.key(e).pipe(r.map((function(e){return c.values(e)}))),this.s.sys$.config$.main$.pipe(r.filter((function(e){return!!e}))),this.pipeProfilesEnabledByProject()).pipe(r.switchMap((function(n){var i,p,o=k(n,5),s=o[0],u=o[1],f=o[2],y=o[3],_=o[4];return e!==l.DfhConfig.CLASS_PK_APPELLATION_FOR_LANGUAGE&&f.push((i=e,p=[{removed_from_api:!1,fk_profile:l.DfhConfig.PK_PROFILE_GEOVISTORY_BASIC}],{has_domain:l.DfhConfig.CLASS_PK_APPELLATION_FOR_LANGUAGE,pk_property:l.DfhConfig.PROPERTY_PK_IS_APPELLATION_OF,has_range:i,domain_instances_max_quantifier:-1,domain_instances_min_quantifier:0,range_instances_max_quantifier:1,range_instances_min_quantifier:1,identifier_in_namespace:"histP9",identity_defining:!0,is_inherited:!0,is_has_type_subproperty:!1,profiles:p})),9===s.basic_type&&u.push(function(e){var t=[{removed_from_api:!1,fk_profile:l.DfhConfig.PK_PROFILE_GEOVISTORY_BASIC}];return{has_domain:e,pk_property:l.DfhConfig.PROPERTY_PK_HAS_TIME_SPAN,has_range:l.DfhConfig.ClASS_PK_TIME_SPAN,domain_instances_max_quantifier:1,domain_instances_min_quantifier:1,range_instances_max_quantifier:1,range_instances_min_quantifier:0,identifier_in_namespace:"P4",identity_defining:!1,is_inherited:!0,is_has_type_subproperty:!1,profiles:t}}(e)),u.push(function(e){var t=[{removed_from_api:!1,fk_profile:l.DfhConfig.PK_PROFILE_GEOVISTORY_BASIC}];return{has_domain:e,pk_property:l.DfhConfig.PROPERTY_PK_P18_HAS_DEFINITION,has_range:785,domain_instances_max_quantifier:-1,domain_instances_min_quantifier:1,range_instances_max_quantifier:1,range_instances_min_quantifier:1,identifier_in_namespace:"P18",identity_defining:!1,is_inherited:!0,is_has_type_subproperty:!1,profiles:t}}(e)),a.combineLatest(t.pipePropertiesToSubfields(u,!0,_,y),t.pipePropertiesToSubfields(f,!1,_,y),t.pipeFieldConfigs(e)).pipe(r.map((function(e){var t,n,i=k(e,3),r=i[0],p=i[1],o=i[2],s=v(r,p),a=c.indexBy((function(e){return[e.fk_domain_class||e.fk_range_class,e.fk_property,!!e.fk_domain_class].join("_")}),o),u={},f={};try{for(var _=h(s),d=_.next();!d.done;d=_.next()){var m=d.value,g=[m.sourceClass,m.property.pkProperty,m.isOutgoing].join("_"),b=[m.sourceClass,m.property.pkProperty,m.isOutgoing,m.targetClass].join("_"),P=a[g];if(u[g])f[b]||(!1===u[g].allSubfieldsRemovedFromAllProfiles?u[g].allSubfieldsRemovedFromAllProfiles=!1:u[g].allSubfieldsRemovedFromAllProfiles=m.removedFromAllProfiles,u[g].targetClasses.push(m.targetClass),u[g].listDefinitions.push(m));else{var $=!1;m.isHasTypeField?$="has-type":m.property.pkProperty===l.DfhConfig.PROPERTY_PK_HAS_TIME_SPAN&&($="time-span"),u[g]={sourceClass:m.sourceClass,sourceClassLabel:m.sourceClassLabel,sourceMaxQuantity:m.sourceMaxQuantity,sourceMinQuantity:m.sourceMinQuantity,targetMinQuantity:m.targetMinQuantity,targetMaxQuantity:m.targetMaxQuantity,label:m.label,isHasTypeField:m.isHasTypeField,property:m.property,isOutgoing:m.isOutgoing,identityDefiningForSource:m.identityDefiningForSource,identityDefiningForTarget:m.identityDefiningForTarget,ontoInfoLabel:m.ontoInfoLabel,ontoInfoUrl:m.ontoInfoUrl,allSubfieldsRemovedFromAllProfiles:m.removedFromAllProfiles,targetClasses:[m.targetClass],listDefinitions:[m],fieldConfig:P,placeOfDisplay:ve(y.specialFields,m,P),isSpecialField:$},f[b]=!0}}}catch(e){t={error:e}}finally{try{d&&!d.done&&(n=_.return)&&n.call(_)}finally{if(t)throw t.error}}return c.values(u)})))})))},e.prototype.pipeSpecificFieldOfClass=function(e){return this.pipeFields(e).pipe(r.map((function(e){return e.filter((function(e){return e.placeOfDisplay.specificFields})).sort((function(e,t){return e.placeOfDisplay.specificFields.position-t.placeOfDisplay.specificFields.position}))})))},e.prototype.pipeBasicFieldsOfClass=function(e){return this.pipeFields(e).pipe(r.map((function(e){return e.filter((function(e){return e.placeOfDisplay.basicFields})).sort((function(e,t){return e.placeOfDisplay.basicFields.position-t.placeOfDisplay.basicFields.position}))})))},e.prototype.pipeFieldsForTeEnForm=function(e){return this.pipeFields(e).pipe(r.map((function(e){var t=e.filter((function(e){return e.placeOfDisplay.specificFields})).sort((function(e,t){return e.placeOfDisplay.specificFields.position-e.placeOfDisplay.specificFields.position})),n=e.find((function(e){return e.property.pkProperty===l.DfhConfig.PROPERTY_PK_HAS_TIME_SPAN}));n&&t.push(n);var i=e.find((function(e){return e.isHasTypeField}));return i&&t.push(i),t})))},e.prototype.pipeBasicAndSpecificFields=function(e){return a.combineLatest(this.pipeBasicFieldsOfClass(e),this.pipeSpecificFieldOfClass(e)).pipe(r.map((function(e){var t=k(e,2);return v(t[0],t[1])})))},e.prototype.pipeSpecificAndBasicFields=function(e){return a.combineLatest(this.pipeSpecificFieldOfClass(e),this.pipeBasicFieldsOfClass(e)).pipe(r.map((function(e){var t=k(e,2);return v(t[0],t[1])})))},e.prototype.pipePropertiesToSubfields=function(e,t,n,i){var p=this;return s.combineLatestOrEmpty(e.map((function(e){var o=t,s=o?e.has_range:e.has_domain,u=o?e.has_domain:e.has_range,c=o?e.range_instances_max_quantifier:e.domain_instances_max_quantifier,f=o?e.domain_instances_max_quantifier:e.range_instances_max_quantifier,l=o?e.range_instances_min_quantifier:e.domain_instances_min_quantifier,y=o?e.domain_instances_min_quantifier:e.range_instances_min_quantifier;return a.combineLatest(p.pipeClassLabel(u),p.pipeClassLabel(s),p.pipeSubfieldTypeOfClass(i,s,c),p.pipeFieldLabel(e.pk_property,t?e.has_domain:null,t?null:e.has_range)).pipe(r.map((function(t){var i=k(t,4),r=i[0],p=i[1],a=i[2],_=i[3];return{listType:a,sourceClass:u,sourceClassLabel:r,sourceMaxQuantity:f,sourceMinQuantity:y,targetClass:s,targetClassLabel:p,targetMinQuantity:l,targetMaxQuantity:c,label:_,isHasTypeField:o&&e.is_has_type_subproperty,property:{pkProperty:e.pk_property},isOutgoing:o,identityDefiningForSource:!!o&&e.identity_defining,identityDefiningForTarget:!o&&e.identity_defining,ontoInfoLabel:e.identifier_in_namespace,ontoInfoUrl:"https://ontome.dataforhistory.org/property/"+e.pk_property,removedFromAllProfiles:ke(n,e.profiles||[])}})))})))},e.prototype.pipeSubfieldTypeOfClass=function(e,t,n){return this.s.dfh$.class$.by_pk_class$.key(t).pipe(r.filter((function(e){return!!e})),r.map((function(t){return function(e,t,n){var i;e&&(i=e.classes[t.pk_class]);return i&&i.valueObjectType?i.valueObjectType:30===t.basic_type&&1==n?{typeItem:"true"}:8===t.basic_type||30===t.basic_type?{entityPreview:"true"}:{temporalEntity:"true"}}(e,t,n)})))},e.prototype.pipeFieldConfigs=function(e){var t=this;return this.a.pkProject$.pipe(r.switchMap((function(n){var p=i.proClassFieldConfgByProjectAndClassKey({fk_class_for_class_field:e,fk_project:n}),o=i.proClassFieldConfgByProjectAndClassKey({fk_class_for_class_field:e,fk_project:l.ProConfig.PK_PROJECT_OF_DEFAULT_CONFIG_PROJECT});return a.combineLatest(t.s.pro$.class_field_config$.by_fk_project__fk_class$.key(p),t.s.pro$.class_field_config$.by_fk_project__fk_class$.key(o)).pipe(r.map((function(e){var t=k(e,2),n=t[0],i=t[1];return n&&c.values(n).length?n:i})),r.map((function(e){return c.values(e).sort((function(e,t){return e.ord_num>t.ord_num?1:-1}))})))})))},e.prototype.pipeClassLabel=function(e){var t=this;return a.combineLatest(this.a.pkProject$,this.a.pipeActiveDefaultLanguage()).pipe(r.switchMap((function(n){var i=k(n,2),p=i[0],o=i[1];return t.pipeLabels({pkClass:e,fkProject:p,language:o,type:"label"}).pipe(r.map((function(t){var n=t.find((function(e){return!!e}));return n?n.text:"* no label (id: "+e+") *"})))})))},e.prototype.pipeLabels=function(e){var t;if(e.pkClass)switch(e.type){case"label":t=l.SysConfig.PK_SYSTEM_TYPE__TEXT_PROPERTY__LABEL;break;default:console.warn("fk_system_type not found")}else if(e.fkProperty)switch(e.type){case"label":t=l.SysConfig.PK_SYSTEM_TYPE__TEXT_PROPERTY__LABEL;break;default:console.warn("fk_system_type not found")}return a.combineLatest(this.pipeProTextProperty({fk_project:e.fkProject,fk_language:e.language.pk_entity,fk_system_type:t,fk_dfh_class:e.pkClass,fk_dfh_property:e.fkProperty,fk_dfh_property_domain:e.fkPropertyDomain,fk_dfh_property_range:e.fkPropertyRange}).pipe(r.map((function(e){if(e){return{origin:"of project in project lang",text:e.string}}}))),this.pipeProTextProperty({fk_project:l.ProConfig.PK_PROJECT_OF_DEFAULT_CONFIG_PROJECT,fk_language:e.language.pk_entity,fk_system_type:t,fk_dfh_class:e.pkClass,fk_dfh_property:e.fkProperty,fk_dfh_property_domain:e.fkPropertyDomain,fk_dfh_property_range:e.fkPropertyRange}).pipe(r.map((function(e){if(e){return{origin:"of default project in project lang",text:e.string}}}))),this.pipeProTextProperty({fk_project:l.ProConfig.PK_PROJECT_OF_DEFAULT_CONFIG_PROJECT,fk_language:18889,fk_system_type:t,fk_dfh_class:e.pkClass,fk_dfh_property:e.fkProperty,fk_dfh_property_domain:e.fkPropertyDomain,fk_dfh_property_range:e.fkPropertyRange}).pipe(r.map((function(e){if(e){return{origin:"of default project in english",text:e.string}}}))),this.pipeDfhLabel({language:e.language.iso6391.trim(),type:"label",fk_class:e.pkClass,fk_property:e.fkProperty}).pipe(r.map((function(e){if(e){return{origin:"of ontome in project lang",text:e.label}}}))),this.pipeDfhLabel({language:"en",type:"label",fk_class:e.pkClass,fk_property:e.fkProperty}).pipe(r.map((function(e){if(e){return{origin:"of ontome in english",text:e.label}}}))))},e.prototype.pipeProTextProperty=function(e){var t=i.textPropertyByFksKey(e);return this.s.pro$.text_property$.by_fks$.key(t)},e.prototype.pipeDfhLabel=function(e){var t=i.dfhLabelByFksKey(e);return this.s.dfh$.label$.by_fks$.key(t)},e.prototype.pipeFieldLabel=function(e,t,n){var i=this,p=!!t;return a.combineLatest(this.a.pkProject$,this.a.pipeActiveDefaultLanguage()).pipe(r.switchMap((function(o){var s=k(o,2),a=s[0],u=s[1];return i.pipeLabels({fkProject:a,type:"label",language:u,fkProperty:e,fkPropertyDomain:t,fkPropertyRange:n}).pipe(r.map((function(t){var n="* no label (id: "+e+") *";return t.some((function(e){return!e||"of project in project lang"!==e.origin&&"of default project in project lang"!==e.origin&&"of default project in english"!==e.origin?!e||"of ontome in project lang"!==e.origin&&"of ontome in english"!==e.origin?void 0:(n=p?e.text:"* reverse of: "+e.text+"*",!0):(n=e.text,!0)})),n})))})))},e.prototype.pipeTableNameOfClass=function(e){return a.combineLatest(this.s.sys$.config$.main$,this.s.dfh$.class$.by_pk_class$.key(e)).pipe(r.filter((function(e){return!e.includes(void 0)})),r.map((function(t){var n=k(t,2),i=n[0],r=n[1],p=i.classes[e];if(!p||!p.valueObjectType)return 8===r.basic_type||30===r.basic_type?"persistent_item":"temporal_entity";var o=Object.keys(p.valueObjectType);if(!p.valueObjectType.appellation){o[0];return p.valueObjectType.appellation?"appellation":p.valueObjectType.language?"language":p.valueObjectType.place?"place":p.valueObjectType.timePrimitive?"time_primitive":p.valueObjectType.langString?"lang_string":p.valueObjectType.dimension?"dimension":void console.warn("unsupported list type")}})))},e.prototype.pipeClassesInEntitiesOrSources=function(){return a.combineLatest(this.pipeClassesEnabledInEntities(),this.pipeClassesRequiredBySources()).pipe(r.map((function(e){var t=k(e,2),n=t[0],i=t[1];return c.indexBy((function(e){return e.toString()}),c.uniq(v(n,i)))})),r.startWith({}))},e.prototype.pipeClassesRequiredBySources=function(){return this.s.sys$.system_relevant_class$.by_required_by_sources$.key("true").pipe(r.map((function(e){return c.values(e).map((function(e){return e.fk_class}))})))},e.prototype.pipeClassesEnabledByProjectProfiles=function(){var e=this;return this.a.pkProject$.pipe(r.switchMap((function(t){return a.combineLatest([e.s.dfh$.class$.by_pk_class$.all$,e.pipeProfilesEnabledByProject()]).pipe(r.map((function(e){var t=k(e,2),n=t[0],i=t[1],r=c.indexBy((function(e){return e.toString()}),c.values(i));return c.values(n).filter((function(e){return e.profiles.some((function(e){return r[e.fk_profile]}))}))})))})))},e.prototype.pipeTypeClassesEnabledByProjectProfiles=function(){return a.combineLatest([this.s.dfh$.class$.by_basic_type$.key(30),this.pipeProfilesEnabledByProject()]).pipe(r.map((function(e){var t=k(e,2),n=t[0],i=t[1],r=c.indexBy((function(e){return e.toString()}),c.values(i));return c.values(n).filter((function(e){return e.profiles.some((function(e){return r[e.fk_profile]}))&&![l.DfhConfig.CLASS_PK_LANGUAGE,l.DfhConfig.CLASS_PK_MANIFESTATION_PRODUCT_TYPE].includes(e.pk_class)}))})))},e.prototype.pipeClassesEnabledInEntities=function(){var e=this;return this.a.pkProject$.pipe(r.switchMap((function(t){return e.s.pro$.dfh_class_proj_rel$.by_fk_project__enabled_in_entities$.key(t+"_true").pipe(r.map((function(e){return c.values(e).map((function(e){return e.fk_class}))})))})))},e.prototype.pipeSelectedTeEnClassesInProject=function(){return a.combineLatest(this.pipeTeEnClassesEnabledInEntities(),this.pipeTeEnClassesRequiredBySources()).pipe(r.map((function(e){var t=k(e,2),n=t[0],i=t[1];return c.indexBy((function(e){return e.toString()}),c.uniq(v(n,i)))})),r.startWith({}))},e.prototype.pipeTeEnClassesEnabledInEntities=function(){var e=this;return this.a.pkProject$.pipe(r.switchMap((function(t){return e.s.pro$.dfh_class_proj_rel$.by_fk_project__enabled_in_entities$.key(t+"_true").pipe(r.switchMap((function(t){return a.combineLatest(c.values(t).map((function(t){return e.s.dfh$.class$.by_pk_class$.key(t.fk_class).pipe(r.filter((function(e){return!!e})))}))).pipe(r.map((function(t){return e.filterTeEnCasses(t)})))})))})))},e.prototype.filterTeEnCasses=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];9===i.basic_type&&t.push(i.pk_class)}return t},e.prototype.pipeTeEnClassesRequiredBySources=function(){var e=this;return this.s.sys$.system_relevant_class$.by_required_by_sources$.key("true").pipe(r.switchMap((function(t){return a.combineLatest(c.values(t).map((function(t){return e.s.dfh$.class$.by_pk_class$.key(t.fk_class).pipe(r.filter((function(e){return!!e})))}))).pipe(r.map((function(t){return e.filterTeEnCasses(t)})))})))},e.prototype.pipeTypeAndTypedClasses=function(e){var t,n=this,i=this.s.sys$.system_relevant_class$.by_required_by_sources$.key("true").pipe(r.map((function(e){return c.values(e).map((function(e){return e.fk_class}))}))),p=this.pipeClassesEnabledInEntities();return t="sources"===e?[i]:"entities"===e?[p]:[i,p],a.combineLatest(t).pipe(r.map((function(e){return c.uniq(c.flatten(e))})),r.switchMap((function(e){return n.pipeTypeAndTypedClassesOfTypedClasses(e)})))},e.prototype.pipeTypeAndTypedClassesOfTypedClasses=function(e){return this.s.dfh$.property$.by_is_has_type_subproperty$.key("true").pipe(r.map((function(t){var n=c.indexBy((function(e){return e.has_domain.toString()}),c.values(t));return e.map((function(e){return{typedClass:e,typeClass:n[e]?n[e].has_range:void 0}}))})))},e.prototype.pipeTypeClassOfTypedClass=function(e){return this.s.dfh$.property$.by_is_has_type_subproperty$.key("true").pipe(r.map((function(t){var n=c.indexBy((function(e){return e.has_domain.toString()}),c.values(t));return n[e]?n[e].has_range:void 0})))},e.prototype.pipeTypedClassesOfTypeClasses=function(e){return this.s.dfh$.property$.by_is_has_type_subproperty$.key("true").pipe(r.map((function(t){var n=c.indexBy((function(e){return e.has_range.toString()}),c.values(t));return e.map((function(e){return n[e]?n[e].has_domain:void 0}))})))},e.prototype.pipeTypePropertyOfTypedClass=function(e){return this.s.dfh$.property$.by_is_has_type_subproperty$.key("true").pipe(r.map((function(t){var n=c.values(t).find((function(t){return t.has_domain===e}));return n?n.pk_property:void 0})))},e.prototype.pipeTargetClassesOfProperties=function(e,t){return this.s.dfh$.property$.by_pk_property$.all$.pipe(r.map((function(n){if(!e||!e.length)return[];var i=[],r={};return e.forEach((function(e){c.values(n[e]).forEach((function(e){var n=t?e.has_range:e.has_domain;r[n]||(r[n]=!0,i.push(n))}))})),i})))},e.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:be},{type:ge}]},e.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new e(n.ɵɵinject(be),n.ɵɵinject(ge))},token:e,providedIn:"root"}),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",a.Observable)],e.prototype,"pipeProfilesEnabledByProject",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeFields",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeSpecificFieldOfClass",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeBasicFieldsOfClass",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeFieldsForTeEnForm",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeBasicAndSpecificFields",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeSpecificAndBasicFields",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Array,Boolean,Array,Object]),b("design:returntype",a.Observable)],e.prototype,"pipePropertiesToSubfields",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Object,Number,Number]),b("design:returntype",a.Observable)],e.prototype,"pipeSubfieldTypeOfClass",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeFieldConfigs",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeClassLabel",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",a.Observable)],e.prototype,"pipeLabels",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",a.Observable)],e.prototype,"pipeProTextProperty",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",a.Observable)],e.prototype,"pipeDfhLabel",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number,Number,Number]),b("design:returntype",a.Observable)],e.prototype,"pipeFieldLabel",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeTableNameOfClass",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",a.Observable)],e.prototype,"pipeClassesInEntitiesOrSources",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",void 0)],e.prototype,"pipeClassesRequiredBySources",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",a.Observable)],e.prototype,"pipeClassesEnabledByProjectProfiles",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",a.Observable)],e.prototype,"pipeTypeClassesEnabledByProjectProfiles",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",void 0)],e.prototype,"pipeClassesEnabledInEntities",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",a.Observable)],e.prototype,"pipeSelectedTeEnClassesInProject",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",void 0)],e.prototype,"pipeTeEnClassesEnabledInEntities",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[]),b("design:returntype",void 0)],e.prototype,"pipeTeEnClassesRequiredBySources",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[String]),b("design:returntype",a.Observable)],e.prototype,"pipeTypeAndTypedClasses",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Array]),b("design:returntype",a.Observable)],e.prototype,"pipeTypeAndTypedClassesOfTypedClasses",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",a.Observable)],e.prototype,"pipeTypeClassOfTypedClass",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Array]),b("design:returntype",a.Observable)],e.prototype,"pipeTypedClassesOfTypeClasses",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",a.Observable)],e.prototype,"pipeTypePropertyOfTypedClass",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Array,Boolean]),b("design:returntype",a.Observable)],e.prototype,"pipeTargetClassesOfProperties",null),e}();function ke(e,t){return!t.some((function(t){return!1===t.removed_from_api&&e.includes(t.fk_profile)}))}function ve(e,t,n){var i;if(i=function(e,t,n){e.isOutgoing?e.isHasTypeField&&t.hasTypeSubproperties?n=t.hasTypeSubproperties:t.bySourceClass&&t.bySourceClass[e.sourceClass]&&t.bySourceClass[e.sourceClass].outgoingProperties&&t.bySourceClass[e.sourceClass].outgoingProperties[e.property.pkProperty]?n=t.bySourceClass[e.sourceClass].outgoingProperties[e.property.pkProperty]:t.outgoingProperties&&t.outgoingProperties[e.property.pkProperty]&&(n=t.outgoingProperties[e.property.pkProperty]):t.bySourceClass&&t.bySourceClass[e.sourceClass]&&t.bySourceClass[e.sourceClass].incomingProperties&&t.bySourceClass[e.sourceClass].incomingProperties[e.property.pkProperty]?n=t.bySourceClass[e.sourceClass].incomingProperties[e.property.pkProperty]:t.incomingProperties&&t.incomingProperties[e.property.pkProperty]&&(n=t.incomingProperties[e.property.pkProperty]);return n}(t,e,i)){if(i.displayInBasicFields)return{basicFields:{position:i.displayInBasicFields.position}};if(i.hidden)return{hidden:!0}}var r=Number.POSITIVE_INFINITY;return n&&(r=n.ord_num),{specificFields:{position:r}}}var Pe=function(){function e(e,t){var n=this;this.p=e,this.s=t,this.timePrimitiveOfStatements=function(){return a.pipe(r.map((function(e){return e[0]})),r.switchMap((function(e){return e?n.pipeInfTimePrimitive(e.fk_object_info).pipe(r.switchMap((function(t){return n.p.pkProject$.pipe(r.switchMap((function(i){return n.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(i+"_"+e[0].pk_entity).pipe(r.filter((function(e){return!!e})),r.map((function(e){return{calendar:e.calendar?e.calendar:"gregorian",julianDay:t.julian_day,duration:t.duration}})))})))}))):new a.BehaviorSubject(void 0)})))}}return e.prototype.pipeStatements=function(e,t){return t?this.pipeOutgoingStatements(e):this.pipeIngoingStatements(e)},e.prototype.pipeOutgoingStatements=function(e){return this.s.inf$.statement$.by_subject$({fk_subject_info:e})},e.prototype.pipeIngoingStatements=function(e){return this.s.inf$.statement$.by_object$({fk_object_info:e})},e.prototype.pipeStatementsOfList=function(e,t){return e.isOutgoing?this.s.inf$.statement$.by_subject_and_property$({fk_property:e.property.pkProperty,fk_property_of_property:e.property.pkPropertyOfProperty,fk_subject_info:t}):this.s.inf$.statement$.by_object_and_property$({fk_property:e.property.pkProperty,fk_property_of_property:e.property.pkPropertyOfProperty,fk_object_info:t})},e.prototype.pipeOutgoingStatementsByProperty=function(e,t){return this.s.inf$.statement$.by_subject_and_property$({fk_property:e,fk_subject_info:t})},e.prototype.pipeIngoingStatementsByProperty=function(e,t){return this.s.inf$.statement$.by_object_and_property$({fk_property:e,fk_object_info:t})},e.prototype.pipeOutgoingBasicStatementItemsByProperty=function(e,t,n){var i=this;return this.s.inf$.statement$.by_subject_and_property$({fk_property:e,fk_subject_info:t}).pipe(r.switchMap((function(e){return s.combineLatestOrEmpty(e.map((function(e){return i.pipeBasicStatementItem(n,e,!0)})))})))},e.prototype.pipeIngoingBasicStatementItemsByProperty=function(e,t,n){var i=this;return this.s.inf$.statement$.by_object_and_property$({fk_property:e,fk_object_info:t}).pipe(r.switchMap((function(e){return s.combineLatestOrEmpty(e.map((function(e){return i.pipeBasicStatementItem(n,e,!1)})))})))},e.prototype.pipeBasicStatementItem=function(e,t,n){return this.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(e+"_"+t.pk_entity).pipe(r.filter((function(e){return!!e})),r.map((function(e){return{projRel:e,statement:t,label:"",ordNum:n?e.ord_num_of_range:e.ord_num_of_domain,isOutgoing:n}})))},e.prototype.pipeBasicStatementItemByPkStatement=function(e,t,n){var i=this;return this.s.inf$.statement$.by_pk_entity_key$(t).pipe(r.switchMap((function(t){return t?i.pipeBasicStatementItem(e,t,n):a.of(void 0)})))},e.prototype.pipeInfTimePrimitive=function(e){return this.s.inf$.time_primitive$.by_pk_entity$.key(e)},e.prototype.pipeTimeSpan=function(e){return a.combineLatest(this.pipeOutgoingStatementsByProperty(72,e).pipe(this.timePrimitiveOfStatements()),this.pipeOutgoingStatementsByProperty(71,e).pipe(this.timePrimitiveOfStatements()),this.pipeOutgoingStatementsByProperty(150,e).pipe(this.timePrimitiveOfStatements()),this.pipeOutgoingStatementsByProperty(151,e).pipe(this.timePrimitiveOfStatements()),this.pipeOutgoingStatementsByProperty(152,e).pipe(this.timePrimitiveOfStatements()),this.pipeOutgoingStatementsByProperty(153,e).pipe(this.timePrimitiveOfStatements())).pipe(r.map((function(e){var t=k(e,6),n=t[0],i=t[1],r=t[2],p=t[3],o=t[4],a=t[5];return new s.TimeSpanUtil({p82:n,p81:i,p82a:o,p81a:r,p81b:p,p82b:a})})))},e.prototype.pipeClassOfEntity=function(e){return a.merge(this.s.inf$.persistent_item$.by_pk_entity_key$(e).pipe(r.filter((function(e){return!!e})),r.map((function(e){return e.fk_class}))),this.s.inf$.temporal_entity$.by_pk_entity_key$(e).pipe(r.filter((function(e){return!!e})),r.map((function(e){return e.fk_class}))))},e.prototype.pipeClassesOfPersistentItems=function(e){return this.s.inf$.persistent_item$.by_pk_entity_all$().pipe(r.map((function(t){if(!e||0===e.length)return[];var n={},i=[];return e.forEach((function(e){n[t[e].fk_class]||(n[t[e].fk_class]=!0,i.push(t[e].fk_class))})),i})))},e.prototype.pipeRepoOutgoingStatements=function(e){return this.s.inf$.statement$.by_subject$({fk_subject_info:e},!1)},e.prototype.pipeRepoIngoingStatements=function(e){return this.s.inf$.statement$.by_object$({fk_object_info:e},!1)},e.prototype.pipeRepoOutgoingStatementsByProperty=function(e,t){var n=this;return a.combineLatest(this.s.dfh$.property$.by_pk_property$.key(e).pipe(r.filter((function(e){return!!e&&Object.keys(e).length>0})),r.map((function(e){return c.values(e)[0].range_instances_max_quantifier}))),this.s.inf$.statement$.by_subject_and_property$({fk_property:e,fk_subject_info:t},!1)).pipe(r.map((function(e){var t=k(e,2),i=t[0],r=t[1];if(0===r.length)return r;var p=n.sortStatementsByRepoPopularity(r);return-1===i||null===i?p:p.slice(0,i)})))},e.prototype.pipeRepoIngoingStatementsByProperty=function(e,t){var n=this;return a.combineLatest(this.s.dfh$.property$.by_pk_property$.key(e).pipe(r.filter((function(e){return!!e&&Object.keys(e).length>0})),r.map((function(e){return c.values(e)[0].domain_instances_max_quantifier}))),this.s.inf$.statement$.by_object_and_property$({fk_property:e,fk_object_info:t},!1)).pipe(r.map((function(e){var t=k(e,2),i=t[0],r=t[1];if(0===r.length)return r;var p=n.sortStatementsByRepoPopularity(r);return-1===i||null===i?p:p.slice(0,i)})))},e.prototype.pipeAlternativeBasicStatementItemByPkStatement=function(e,t){return a.combineLatest(this.s.inf$.statement$.by_pk_entity_key$(e,!1),this.s.inf$.statement$.by_pk_entity_key$(e)).pipe(r.filter((function(e){return!!k(e,1)[0]})),r.map((function(e){var n=k(e,2),i=n[0];if(!n[1])return{projRel:void 0,statement:i,ordNum:void 0,isOutgoing:t,label:""}})))},e.prototype.pipeAlternativeIngoingStatements=function(e,t){return a.combineLatest(this.s.inf$.statement$.by_object_and_property_indexed$({fk_property:e,fk_object_info:t},!1),this.s.inf$.statement$.by_object_and_property_indexed$({fk_property:e,fk_object_info:t}).pipe(r.map((function(e){return e?Object.keys(e):[]})))).pipe(r.map((function(e){var t=k(e,2),n=t[0],i=t[1];return c.omit(i,n)})),r.map((function(e){return c.values(e)})))},e.prototype.pipeAlternativeOutgoingStatements=function(e,t){return a.combineLatest(this.s.inf$.statement$.by_subject_and_property_indexed$({fk_property:e,fk_subject_info:t},!1),this.s.inf$.statement$.by_subject_and_property_indexed$({fk_property:e,fk_subject_info:t}).pipe(r.map((function(e){return e?Object.keys(e):[]})))).pipe(r.map((function(e){var t=k(e,2),n=t[0],i=t[1];return c.omit(i,n)})),r.map((function(e){return c.values(e)})))},e.prototype.pipePersistentItemPksByClass=function(e){return this.s.inf$.persistent_item$.by_fk_class_key$(e).pipe(r.map((function(e){return e?Object.keys(e).map((function(e){return parseInt(e,10)})):[]})))},e.prototype.pipeIconType=function(e){return this.p.streamEntityPreview(e).pipe(r.map((function(e){return"teEn"==e.entity_type?"temporal-entity":e.fk_class===l.DfhConfig.CLASS_PK_EXPRESSION_PORTION?"expression-portion":l.DfhConfig.CLASS_PKS_SOURCE_PE_IT.includes(e.fk_class)?"source":"persistent-entity"})))},e.prototype.sortStatementsByRepoPopularity=function(e){return e.sort((function(e,t){return e.is_in_project_count>t.is_in_project_count?1:-1}))},e.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:be},{type:ge}]},e.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new e(n.ɵɵinject(be),n.ɵɵinject(ge))},token:e,providedIn:"root"}),g([j,b("design:type",Function),b("design:paramtypes",[Number,Object]),b("design:returntype",a.Observable)],e.prototype,"pipeStatements",null),g([j,b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",a.Observable)],e.prototype,"pipeOutgoingStatements",null),g([j,b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",a.Observable)],e.prototype,"pipeIngoingStatements",null),g([j,b("design:type",Function),b("design:paramtypes",[Object,Object]),b("design:returntype",a.Observable)],e.prototype,"pipeOutgoingStatementsByProperty",null),g([j,b("design:type",Function),b("design:paramtypes",[Object,Object]),b("design:returntype",a.Observable)],e.prototype,"pipeIngoingStatementsByProperty",null),g([j,b("design:type",Function),b("design:paramtypes",[Object,Object,Number]),b("design:returntype",a.Observable)],e.prototype,"pipeOutgoingBasicStatementItemsByProperty",null),g([j,b("design:type",Function),b("design:paramtypes",[Object,Object,Number]),b("design:returntype",a.Observable)],e.prototype,"pipeIngoingBasicStatementItemsByProperty",null),g([j,b("design:type",Function),b("design:paramtypes",[Number,y.InfStatement,Boolean]),b("design:returntype",a.Observable)],e.prototype,"pipeBasicStatementItem",null),g([j,b("design:type",Function),b("design:paramtypes",[Number,Number,Boolean]),b("design:returntype",a.Observable)],e.prototype,"pipeBasicStatementItemByPkStatement",null),g([j,b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeInfTimePrimitive",null),g([j,b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeTimeSpan",null),g([j,b("design:type",Function),b("design:paramtypes",[Number]),b("design:returntype",a.Observable)],e.prototype,"pipeClassOfEntity",null),g([j,b("design:type",Function),b("design:paramtypes",[Array]),b("design:returntype",a.Observable)],e.prototype,"pipeClassesOfPersistentItems",null),g([j,b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",a.Observable)],e.prototype,"pipeRepoOutgoingStatements",null),g([j,b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",a.Observable)],e.prototype,"pipeRepoIngoingStatements",null),g([j,b("design:type",Function),b("design:paramtypes",[Object,Object]),b("design:returntype",a.Observable)],e.prototype,"pipeRepoOutgoingStatementsByProperty",null),g([j,b("design:type",Function),b("design:paramtypes",[Object,Object]),b("design:returntype",a.Observable)],e.prototype,"pipeRepoIngoingStatementsByProperty",null),g([j,b("design:type",Function),b("design:paramtypes",[Number,Boolean]),b("design:returntype",a.Observable)],e.prototype,"pipeAlternativeBasicStatementItemByPkStatement",null),g([j,b("design:type",Function),b("design:paramtypes",[Object,Object]),b("design:returntype",a.Observable)],e.prototype,"pipeAlternativeIngoingStatements",null),g([j,b("design:type",Function),b("design:paramtypes",[Object,Object]),b("design:returntype",a.Observable)],e.prototype,"pipeAlternativeOutgoingStatements",null),g([j,b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",a.Observable)],e.prototype,"pipePersistentItemPksByClass",null),e}();var $e=function(){function e(e,t,n,i,r,p,o){this.b=e,this.p=t,this.s=n,this.c=i,this.timePrimitivePipe=r,this.timeSpanPipe=p,this.infRepo=new X(o,a.of("repo"))}return e.prototype.pipeListLength=function(e,t){switch(e.listType){case"appellation":case"entity-preview":case"language":case"place":case"dimension":case"langString":case"temporal-entity":return this.pipeList(e,t).pipe(r.map((function(e){return e.length})));case"time-span":return a.combineLatest(this.b.pipeOutgoingStatementsByProperty(72,t),this.b.pipeOutgoingStatementsByProperty(71,t),this.b.pipeOutgoingStatementsByProperty(150,t),this.b.pipeOutgoingStatementsByProperty(151,t),this.b.pipeOutgoingStatementsByProperty(152,t),this.b.pipeOutgoingStatementsByProperty(153,t)).pipe(r.tap((function(e){})),r.map((function(e){return e.filter((function(e){return e.length>0})).length})));default:return console.warn("unsupported listType"),new a.BehaviorSubject(0)}},e.prototype.pipeList=function(e,t,n){return e.listType.appellation?this.pipeListAppellation(e,t,n):e.listType.entityPreview?this.pipeListEntityPreview(e,t,n):e.listType.language?this.pipeListLanguage(e,t,n):e.listType.place?this.pipeListPlace(e,t,n):e.listType.dimension?this.pipeListDimension(e,t,n):e.listType.langString?this.pipeListLangString(e,t,n):e.listType.temporalEntity?this.pipeListEntityPreview(e,t,n):e.listType.timeSpan?this.pipeItemTimeSpan(t).pipe(r.map((function(e){return[e].filter((function(e){return e.properties.length>0}))}))):void console.warn("unsupported listType")},e.prototype.pipeListBasicStatementItems=function(e,t,n){return e.isOutgoing?this.b.pipeOutgoingBasicStatementItemsByProperty(e.property.pkProperty,t,n):this.b.pipeIngoingBasicStatementItemsByProperty(e.property.pkProperty,t,n)},e.prototype.pipeListAppellation=function(e,t,n){var i=this;return this.b.pipeStatementsOfList(e,t).pipe(r.switchMap((function(t){return a.combineLatest(t.map((function(e,t){return i.pipeItemAppellation(e)}))).pipe(r.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),s.limitTo(n),r.startWith([]))})))},e.prototype.pipeListEntityPreview=function(e,t,n){var i=this;return this.b.pipeStatementsOfList(e,t).pipe(p.tag("before-"+t+"-"+e.property.pkProperty+"-"+e.targetClass),r.switchMap((function(t){return a.combineLatest(t.map((function(t,n){return i.pipeItemEntityPreview(t,e.isOutgoing)}))).pipe(r.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass})).sort((function(e,t){return e.ordNum>t.ordNum?1:-1}))}),s.limitTo(n)),r.startWith([]))})),p.tag("after-"+t+"-"+e.property.pkProperty+"-"+e.targetClass))},e.prototype.pipeListLanguage=function(e,t,n){var i=this;return this.b.pipeStatementsOfList(e,t).pipe(r.switchMap((function(t){return a.combineLatest(t.map((function(e,t){return i.pipeItemLanguage(e)}))).pipe(r.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),s.limitTo(n),r.startWith([]))})))},e.prototype.pipeListPlace=function(e,t,n){var i=this;return this.b.pipeStatementsOfList(e,t).pipe(r.switchMap((function(t){return a.combineLatest(t.map((function(e,t){return i.pipeItemPlace(e)}))).pipe(r.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),s.limitTo(n),r.startWith([]))})))},e.prototype.pipeListDimension=function(e,t,n){var i=this;return this.b.pipeStatementsOfList(e,t).pipe(r.switchMap((function(t){return a.combineLatest(t.map((function(e,t){return i.pipeItemDimension(e)}))).pipe(r.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),s.limitTo(n),r.startWith([]))})))},e.prototype.pipeListLangString=function(e,t,n){var i=this;return this.b.pipeStatementsOfList(e,t).pipe(r.switchMap((function(t){return a.combineLatest(t.map((function(e,t){return i.pipeItemLangString(e)}))).pipe(r.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),s.limitTo(n),r.startWith([]))})))},e.prototype.pipeStatementListPage=function(e,t,n,i,p,o){var a=this;void 0===o&&(o=!1);var u=o?this.infRepo.statement$.pagination$:this.s.inf$.statement$.pagination$;return u.pipePage(e,t,n).pipe(r.switchMap((function(e){return s.combineLatestOrEmpty(e.map((function(e){return function(e,t,n){return o?a.b.pipeAlternativeBasicStatementItemByPkStatement(e,t):a.b.pipeBasicStatementItemByPkStatement(n,e,t)}(e,p.isOutgoing,i).pipe(r.filter((function(e){return!!e})),r.switchMap((function(e){return a.p.streamEntityPreview(e.isOutgoing?e.statement.fk_object_info:e.statement.fk_subject_info).pipe(r.map((function(t){return m({},e,{preview:t,fkClass:t.fk_class})})))})))})))})))},e.prototype.pipeTemporalEntityTableRows=function(e,t,n,i,p,o,u){var c=this;void 0===u&&(u=!1);var f=u?this.infRepo.statement$.pagination$:this.s.inf$.statement$.pagination$;return f.pipePage(e,t,n).pipe(r.switchMap((function(e){return s.combineLatestOrEmpty(e.map((function(e){return function(e,t,n){return u?c.b.pipeAlternativeBasicStatementItemByPkStatement(e,t):c.b.pipeBasicStatementItemByPkStatement(n,e,t)}(e,p.isOutgoing,i).pipe(r.filter((function(e){return!!e})))}))).pipe(r.switchMap((function(e){return s.combineLatestOrEmpty(e.map((function(e){var t,n,p,s,f=(t=e).isOutgoing?t.statement.fk_object_info:t.statement.fk_subject_info;return a.combineLatest((n=f,p=o,s=i,u?c.pipeItemTeEnRow(n,p,null,!0):c.pipeItemTeEnRow(n,p,s,!1)),c.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(i+"_"+f)).pipe(r.map((function(t){var n=k(t,2),i=n[0],r=n[1];return m({},e,{row:i,pkEntity:f,teEnProjRel:r})})))})))})))})))},e.prototype.pipeItemTeEnRow=function(e,t,n,i){var p=this,o=i?this.b.pipeRepoOutgoingStatements(e):this.b.pipeOutgoingStatements(e),u=i?this.b.pipeRepoIngoingStatements(e):this.b.pipeIngoingStatements(e),f=o.pipe(r.switchMap((function(e){return s.combineLatestOrEmpty(e.filter((function(e){return!!e.fk_object_info})).map((function(e){return p.pipeItem(e,n,!0)})))}))),l=u.pipe(r.switchMap((function(e){return s.combineLatestOrEmpty(e.filter((function(e){return!!e.fk_subject_info})).map((function(e){return p.pipeItem(e,n,!1)})))}))),y=i?function(e){return e.sort((function(e,t){return e.statement.is_in_project_count>t.statement.is_in_project_count?1:-1}))}:function(e){return e};return a.combineLatest(f,l).pipe(r.map((function(e){var t=k(e,2),n=t[0],i=t[1];return{groupedOut:c.groupBy((function(e){return e&&e.statement?e.statement.fk_property.toString():void 0}),n),groupedIn:c.groupBy((function(e){return e&&e.statement?e.statement.fk_property.toString():void 0}),i)}})),r.map((function(e){var n={};return t.forEach((function(t){var i;t.listDefinitions.forEach((function(t){if(t.listType.timeSpan){var n=c.pick(["71","72","150","151","152","153"],e.groupedOut),r=Object.keys(n),o=r.length,a=void 0;if(o>0){var u={};r.forEach((function(e){u[e]=n[e][0].timePrimitive}));var f=s.TimeSpanUtil.fromTimeSpanDialogData(u);a=p.timeSpanPipe.transform(f)}i={isOutgoing:t.isOutgoing,itemsCount:o,label:a,entityPreview:void 0,pkProperty:void 0,isTimeSpan:!0}}else if(t.isOutgoing){if(e.groupedOut[t.property.pkProperty]){var l=(_=y(e.groupedOut[t.property.pkProperty]))[0];i={isOutgoing:t.isOutgoing,itemsCount:_.length,entityPreview:(l||{}).preview,label:l.label,pkProperty:t.property.pkProperty,firstItem:l,items:_}}}else if(e.groupedIn[t.property.pkProperty]){var _;l=(_=y(e.groupedIn[t.property.pkProperty]))[0];i={isOutgoing:t.isOutgoing,itemsCount:_.length,entityPreview:(l||{}).preview,label:l.label,pkProperty:t.property.pkProperty,firstItem:l,items:_}}})),n[t.label]=i})),n})))},e.prototype.pipeItem=function(e,t,n){var i=this,p=n?e.fk_object_info:e.fk_subject_info;return this.s.inf$.getModelOfEntity$(p).pipe(r.switchMap((function(r){switch(r?r.modelName:void 0){case"appellation":return i.pipeItemAppellation(e);case"language":return i.pipeItemLanguage(e);case"place":return i.pipeItemPlace(e);case"dimension":return i.pipeItemDimension(e);case"lang_string":return i.pipeItemLangString(e);case"time_primitive":return i.pipeItemTimePrimitive(e,t);default:return i.pipeItemEntityPreview(e,n)}})))},e.prototype.pipeEntityProperties=function(e,t,n){var i=this;return e.listType.appellation?this.pipeListAppellation(e,t,n).pipe(r.map((function(t){return i.getEntityProperties(e,t)}))):e.listType.language?this.pipeListLanguage(e,t,n).pipe(r.map((function(t){return i.getEntityProperties(e,t)}))):e.listType.place?this.pipeListPlace(e,t,n).pipe(r.map((function(t){return i.getEntityProperties(e,t)}))):e.listType.dimension?this.pipeListDimension(e,t,n).pipe(r.map((function(t){return i.getEntityProperties(e,t)}))):e.listType.langString?this.pipeListLangString(e,t,n).pipe(r.map((function(t){return i.getEntityProperties(e,t)}))):e.listType.entityPreview||e.listType.temporalEntity?this.pipeListEntityPreview(e,t,n).pipe(r.map((function(t){return i.getEntityProperties(e,t)}))):e.listType.timeSpan?this.pipeItemTimeSpan(t).pipe(r.map((function(t){var n,r,p=t.properties.find((function(e){return e.items.length>0}))?[{label:i.timeSpanPipe.transform((n=t,r=new s.TimeSpanUtil,n.properties.forEach((function(e){var t=l.DfhConfig.PROPERTY_PK_TO_EXISTENCE_TIME_KEY[e.listDefinition.property.pkProperty];e.items&&e.items.length&&(r[t]=e.items[0].timePrimitive)})),r)),properties:[]}]:[];return{listDefinition:e,items:p}}))):a.of(null)},e.prototype.pipeTemporalEntityRemoveProperties=function(e){return a.combineLatest(this.s.inf$.temporal_entity$.by_pk_entity_key$(e),this.s.inf$.statement$.by_subject$({fk_subject_info:e}),this.s.inf$.text_property$.by_fk_concerned_entity_indexed$(e)).pipe(r.map((function(e){var t=k(e,3),n=t[0],i=t[1],r=t[2];return{temporalEntity:n,statements:i,textProperties:c.values(r)}})))},e.prototype.getEntityProperties=function(e,t){return{listDefinition:e,items:t}},e.prototype.pipeItemTimeSpan=function(e){var t=this;return this.p.pkProject$.pipe(r.switchMap((function(n){return t.c.pipeSpecificFieldOfClass(l.DfhConfig.ClASS_PK_TIME_SPAN).pipe(r.switchMap((function(i){return a.combineLatest(i.map((function(i){return t.s.inf$.statement$.by_subject_and_property$({fk_property:i.property.pkProperty,fk_subject_info:e}).pipe(s.switchMapOr([],(function(e){return a.combineLatest(e.map((function(e){return a.combineLatest(t.s.inf$.time_primitive$.by_pk_entity$.key(e.fk_object_info).pipe(r.filter((function(e){return!!e}))),t.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(n+"_"+e.pk_entity)).pipe(r.map((function(n){var i=k(n,2),r=i[0],p=i[1],o=new s.TimePrimitive({julianDay:r.julian_day,calendar:p.calendar||"gregorian",duration:r.duration});return{statement:e,ordNum:void 0,projRel:p,timePrimitive:o,label:t.timePrimitivePipe.transform(o),fkClass:r.fk_class}})))})))})),r.map((function(e){return{listDefinition:i.listDefinitions[0],items:e}})))}))).pipe(r.map((function(e){return{label:"",properties:e.filter((function(e){return e.items.length>0}))}})))})))})))},e.prototype.pipeItemAppellation=function(e){return this.s.inf$.appellation$.by_pk_entity$.key(e.fk_object_info).pipe(r.filter((function(e){return!!e})),r.map((function(t){return t?{ordNum:void 0,projRel:void 0,statement:e,label:t.string,fkClass:t.fk_class}:null})))},e.prototype.pipeItemLanguage=function(e){return this.s.inf$.language$.by_pk_entity$.key(e.fk_object_info).pipe(r.filter((function(e){return!!e})),r.map((function(t){return t?{ordNum:void 0,projRel:void 0,statement:e,label:t.notes,fkClass:t.fk_class}:null})))},e.prototype.pipeItemPlace=function(e){return this.s.inf$.place$.by_pk_entity$.key(e.fk_object_info).pipe(r.filter((function(e){return!!e})),r.map((function(t){return t?{ordNum:void 0,projRel:void 0,statement:e,label:"WGS84: "+t.lat+"°, "+t.long+"°",fkClass:t.fk_class}:null})))},e.prototype.pipeItemDimension=function(e){var t=this;return this.s.inf$.dimension$.by_pk_entity$.key(e.fk_object_info).pipe(r.filter((function(e){return!!e})),r.switchMap((function(n){return t.p.streamEntityPreview(n.fk_measurement_unit).pipe(r.map((function(t){return{ordNum:void 0,projRel:void 0,statement:e,label:n.numeric_value+" "+t.entity_label,fkClass:n.fk_class}})))})))},e.prototype.pipeItemLangString=function(e){var t=this;return this.s.inf$.lang_string$.by_pk_entity$.key(e.fk_object_info).pipe(r.switchMap((function(n){return n?t.s.inf$.language$.by_pk_entity$.key(n.fk_language).pipe(r.map((function(t){if(!t)return null;var i="";return n.string?i=n.string:n.quill_doc&&n.quill_doc.ops&&n.quill_doc.ops.length&&(i=n.quill_doc.ops.map((function(e){return e.insert})).join("")),{ordNum:void 0,projRel:void 0,statement:e,label:i,fkClass:n.fk_class,language:t,fkLanguage:n.fk_language}}))):new a.BehaviorSubject(null)})))},e.prototype.pipeItemEntityPreview=function(e,t){return this.p.streamEntityPreview(t?e.fk_object_info:e.fk_subject_info).pipe(r.map((function(t){return t?{ordNum:void 0,projRel:void 0,statement:e,preview:t,label:t.entity_label||"",fkClass:t.fk_class}:null})))},e.prototype.pipeItemTimePrimitive=function(e,t){var n=this;return t?a.combineLatest(this.s.inf$.time_primitive$.by_pk_entity$.key(e.fk_object_info).pipe(r.filter((function(e){return!!e}))),this.s.pro$.info_proj_rel$.by_fk_project__fk_entity$.key(t+"_"+e.pk_entity).pipe(r.filter((function(e){return!!e})))).pipe(r.map((function(t){var i=k(t,2),r=i[0],p=i[1];if(!r)return null;var o=new s.TimePrimitive({julianDay:r.julian_day,calendar:p.calendar||"gregorian",duration:r.duration});return{ordNum:void 0,projRel:void 0,statement:e,timePrimitive:o,label:n.timePrimitivePipe.transform(o),fkClass:r.fk_class}}))):this.infRepo.time_primitive$.by_pk_entity$.key(e.fk_object_info).pipe(r.filter((function(e){return!!e}))).pipe(r.map((function(t){var i=new s.TimePrimitive({julianDay:t.julian_day,calendar:e.community_favorite_calendar||"gregorian",duration:t.duration});return{ordNum:void 0,projRel:void 0,statement:e,timePrimitive:i,label:n.timePrimitivePipe.transform(i),fkClass:t.fk_class}})))},e.prototype.pipeAltListLength=function(e,t){switch(e.listType){case"appellation":case"entity-preview":case"language":case"place":case"langString":case"temporal-entity":case"time-span":return this.pipeAltListStatements(e,t).pipe(r.map((function(e){return e.length})));default:console.warn("unsupported listType")}},e.prototype.pipeAltList=function(e,t){return e.listType.appellation?this.pipeAltListAppellation(e,t):e.listType.entityPreview?this.pipeAltListEntityPreview(e,t):e.listType.language?this.pipeAltListLanguage(e,t):e.listType.place?this.pipeAltListPlace(e,t):e.listType.dimension?this.pipeAltListDimension(e,t):e.listType.langString?this.pipeAltListLangString(e,t):e.listType.temporalEntity?this.pipeAltListEntityPreview(e,t):void console.warn("unsupported listType")},e.prototype.pipeAltListStatements=function(e,t){return e.isOutgoing,this.b.pipeAlternativeIngoingStatements(e.property.pkProperty,t)},e.prototype.pipeAltListEntityPreview=function(e,t){var n=this;return(e.isOutgoing?this.b.pipeAlternativeOutgoingStatements(e.property.pkProperty,t):this.b.pipeAlternativeIngoingStatements(e.property.pkProperty,t)).pipe(r.switchMap((function(t){return a.combineLatest(t.map((function(t,i){return n.pipeItemEntityPreview(t,e.isOutgoing)}))).pipe(r.map((function(e){return e.filter((function(e){return!!e})).sort((function(e,t){return e.ordNum>t.ordNum?1:-1}))})),r.startWith([]))})))},e.prototype.pipeAltListPlace=function(e,t){var n=this;if(e.isOutgoing)return this.b.pipeAlternativeOutgoingStatements(e.property.pkProperty,t).pipe(r.switchMap((function(t){return a.combineLatest(t.map((function(e,t){return n.pipeItemPlace(e)}))).pipe(r.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),r.startWith([]))})))},e.prototype.pipeAltListDimension=function(e,t){var n=this;if(e.isOutgoing)return this.b.pipeAlternativeOutgoingStatements(e.property.pkProperty,t).pipe(r.switchMap((function(t){return a.combineLatest(t.map((function(e,t){return n.pipeItemDimension(e)}))).pipe(r.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),r.startWith([]))})))},e.prototype.pipeAltListLangString=function(e,t){var n=this;if(e.isOutgoing)return this.b.pipeAlternativeOutgoingStatements(e.property.pkProperty,t).pipe(r.switchMap((function(t){return a.combineLatest(t.map((function(e,t){return n.pipeItemLangString(e)}))).pipe(r.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),r.startWith([]))})))},e.prototype.pipeAltListAppellation=function(e,t){var n=this;if(e.isOutgoing)return this.b.pipeAlternativeOutgoingStatements(e.property.pkProperty,t).pipe(r.switchMap((function(t){return a.combineLatest(t.map((function(e,t){return n.pipeItemAppellation(e)}))).pipe(r.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),r.startWith([]))})))},e.prototype.pipeAltListLanguage=function(e,t){var n=this;if(e.isOutgoing)return this.b.pipeAlternativeOutgoingStatements(e.property.pkProperty,t).pipe(r.switchMap((function(t){return a.combineLatest(t.map((function(e,t){return n.pipeItemLanguage(e)}))).pipe(r.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),r.startWith([]))})))},e.prototype.pipeRepoListAppellation=function(e,t){var n=this;if(e.isOutgoing)return this.b.pipeRepoOutgoingStatementsByProperty(e.property.pkProperty,t).pipe(r.switchMap((function(t){return a.combineLatest(t.map((function(e,t){return n.pipeItemAppellation(e)}))).pipe(r.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),r.startWith([]))})))},e.prototype.pipeRepoListLanguage=function(e,t){var n=this;if(e.isOutgoing)return this.b.pipeRepoOutgoingStatementsByProperty(e.property.pkProperty,t).pipe(r.switchMap((function(t){return a.combineLatest(t.map((function(e,t){return n.pipeItemLanguage(e)}))).pipe(r.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),r.startWith([]))})))},e.prototype.pipeRepoListPlace=function(e,t){var n=this;if(e.isOutgoing)return this.b.pipeRepoOutgoingStatementsByProperty(e.property.pkProperty,t).pipe(r.switchMap((function(t){return a.combineLatest(t.map((function(e,t){return n.pipeItemPlace(e)}))).pipe(r.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),r.startWith([]))})))},e.prototype.pipeRepoListDimension=function(e,t){var n=this;if(e.isOutgoing)return this.b.pipeRepoOutgoingStatementsByProperty(e.property.pkProperty,t).pipe(r.switchMap((function(t){return a.combineLatest(t.map((function(e,t){return n.pipeItemDimension(e)}))).pipe(r.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})),r.startWith([]))})))},e.prototype.pipeRepoListEntityPreview=function(e,t){var n=this;return(e.isOutgoing?this.b.pipeRepoOutgoingStatementsByProperty(e.property.pkProperty,t):this.b.pipeRepoIngoingStatementsByProperty(e.property.pkProperty,t)).pipe(r.switchMap((function(t){return a.combineLatest(t.map((function(t,i){return n.pipeItemEntityPreview(t,e.isOutgoing)}))).pipe(r.map((function(t){return t.filter((function(t){return!!t&&t.fkClass===e.targetClass}))})))})),r.startWith([]))},e.prototype.pipeRepoItemTimeSpan=function(e){var t=this;return this.p.pkProject$.pipe(r.switchMap((function(n){return t.c.pipeBasicAndSpecificFields(l.DfhConfig.ClASS_PK_TIME_SPAN).pipe(r.switchMap((function(n){return a.combineLatest(n.map((function(n){return t.b.pipeRepoOutgoingStatementsByProperty(n.property.pkProperty,e).pipe(s.switchMapOr([],(function(e){return a.combineLatest(e.map((function(e){return t.infRepo.time_primitive$.by_pk_entity$.key(e.fk_object_info).pipe(r.map((function(n){var i=new s.TimePrimitive({julianDay:n.julian_day,calendar:e.community_favorite_calendar||"gregorian",duration:n.duration});return{statement:e,ordNum:void 0,projRel:void 0,timePrimitive:i,label:t.timePrimitivePipe.transform(i),fkClass:n.fk_class}})))})))})),r.map((function(e){return{listDefinition:n.listDefinitions[0],items:e}})),r.startWith({listDefinition:n.listDefinitions[0],items:[]}))}))).pipe(r.map((function(e){return{label:"",properties:e.filter((function(e){return e.items.length>0}))}})))})))})))},e.prototype.pipeLabelOfEntity=function(e){var t=this;return this.b.pipeClassOfEntity(e).pipe(r.switchMap((function(n){return t.c.pipeBasicAndSpecificFields(n).pipe(r.switchMap((function(n){return s.combineLatestOrEmpty(n&&n.length?n[0].listDefinitions.map((function(n){return t.pipeEntityProperties(n,e,1)})):[]).pipe(r.map((function(e){return(e=e.filter((function(e){return e.items.length>0}))).length&&e[0].items.length?e[0].items[0].label:""})))})))})))},e.prototype.pipeClassLabelOfEntity=function(e){var t=this;return this.b.pipeClassOfEntity(e).pipe(r.switchMap((function(e){return t.c.pipeClassLabel(e)})))},e.prototype.pipeTypeOfEntity=function(e,t,n){return n?this.s.inf$.statement$.by_subject_and_property_indexed$({fk_property:t,fk_subject_info:e}).pipe(r.map((function(e){return!e||Object.keys(e).length<1?void 0:c.values(e)[0]}))):this.s.inf$.statement$.by_object_and_property_indexed$({fk_property:t,fk_object_info:e}).pipe(r.map((function(e){return!e||Object.keys(e).length<1?void 0:c.values(e)[0]})))},e.prototype.pipeClassesAndTypes=function(e){var t=this;return this.c.pipeTypeAndTypedClasses(e).pipe(r.switchMap((function(e){return t.pipeClassAndTypeNodes(e)})))},e.prototype.pipeClassesAndTypesOfClasses=function(e){var t=this;return this.c.pipeTypeAndTypedClassesOfTypedClasses(e).pipe(r.switchMap((function(e){return t.pipeClassAndTypeNodes(e)})))},e.prototype.pipeClassAndTypeNodes=function(e){var t=this;return s.combineLatestOrEmpty(e.map((function(e){return t.c.pipeClassLabel(e.typedClass).pipe(r.map((function(t){return{label:t,data:{pkClass:e.typedClass,pkType:null}}})),r.switchMap((function(n){return a.iif((function(){return!!e.typeClass}),t.b.pipePersistentItemPksByClass(e.typeClass).pipe(r.switchMap((function(n){return s.combineLatestOrEmpty(n.map((function(n){return t.p.streamEntityPreview(n).pipe(r.map((function(t){return{label:t.entity_label,data:{pkClass:e.typedClass,pkType:n}}})))}))).pipe(s.sortAbc((function(e){return e.label})))})),r.map((function(e){return n.children=e,n}))),a.of(m({},n,{children:[]})))})))}))).pipe(s.sortAbc((function(e){return e.label})))},e.prototype.pipeClassesFromClassesAndTypes=function(e){var t=this;return(e&&e.types&&e.types.length?this.b.pipeClassesOfPersistentItems(e.types).pipe(r.filter((function(e){return!!e})),r.switchMap((function(e){return t.c.pipeTypedClassesOfTypeClasses(e)}))):a.of([])).pipe(r.map((function(t){return c.uniq(v(t,(e||{classes:[]}).classes||[]))})))},e.prototype.pipePropertyOptionsFromClassesAndTypes=function(e){var t=this;return this.pipeClassesFromClassesAndTypes(e).pipe(r.switchMap((function(e){return t.pipePropertyOptionsFormClasses(e)})))},e.prototype.pipePropertyOptionsFormClasses=function(e){var t=this;return s.combineLatestOrEmpty(e.map((function(e){return t.s.dfh$.class$.by_pk_class$.key(e).pipe(r.map((function(e){return 9===e.basic_type})),r.switchMap((function(n){return t.c.pipeSpecificAndBasicFields(e).pipe(r.map((function(e){return e.filter((function(e){return!!e.property.pkProperty})).map((function(e){return{isOutgoing:e.isOutgoing,fkPropertyDomain:e.isOutgoing?e.sourceClass:null,fkPropertyRange:e.isOutgoing?null:e.sourceClass,pkProperty:e.property.pkProperty}}))})),r.switchMap((function(i){return n&&l.DfhConfig.PROPERTY_PKS_WHERE_TIME_PRIMITIVE_IS_RANGE.map((function(t){i.push({pkProperty:t,fkPropertyDomain:e,fkPropertyRange:l.DfhConfig.CLASS_PK_TIME_PRIMITIVE,isOutgoing:!0})})),s.combineLatestOrEmpty(i.map((function(e){return t.c.pipeFieldLabel(e.pkProperty,e.fkPropertyDomain,e.fkPropertyRange).pipe(r.map((function(t){var n=e.isOutgoing;return{isOutgoing:n,label:t,pk:e.pkProperty,propertyFieldKey:je(e.pkProperty,n)}})))})))})))})))}))).pipe(r.map((function(e){return c.flatten(e)})))},e.prototype.pipePkClassesFromPropertySelectModel=function(e){return s.combineLatestOrEmpty([this.c.pipeTargetClassesOfProperties(e.outgoingProperties,!0),this.c.pipeTargetClassesOfProperties(e.ingoingProperties,!1)]).pipe(r.map((function(e){var t=k(e,2),n=t[0],i=t[1];return c.uniq(v(n,i))})))},e.prototype.getPkClassesFromPropertySelectModel$=function(e){var t=this;return e.pipe(r.switchMap((function(e){return s.combineLatestOrEmpty([t.c.pipeTargetClassesOfProperties(e.outgoingProperties,!0),t.c.pipeTargetClassesOfProperties(e.ingoingProperties,!1)]).pipe(r.map((function(e){var t=k(e,2),n=t[0],i=t[1];return c.uniq(v(n,i))})))})))},e.prototype.getPropertyOptions$=function(e){var t=this;return e.pipe(r.distinctUntilChanged((function(e,t){return c.equals(e,t)})),r.switchMap((function(e){return e?t.b.pipeClassesOfPersistentItems(e.types).pipe(r.filter((function(e){return!!e})),r.switchMap((function(n){return t.c.pipeTypedClassesOfTypeClasses(n).pipe(r.switchMap((function(n){var i=c.uniq(v(n,e.classes||[]));return t.pipePropertyOptionsFormClasses(i)})))}))):a.empty()})))},e.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:Pe},{type:be},{type:ge},{type:he},{type:s.TimePrimitivePipe},{type:s.TimeSpanPipe},{type:o.NgRedux}]},e.ngInjectableDef=n.ɵɵdefineInjectable({factory:function(){return new e(n.ɵɵinject(Pe),n.ɵɵinject(be),n.ɵɵinject(ge),n.ɵɵinject(he),n.ɵɵinject(s.TimePrimitivePipe),n.ɵɵinject(s.TimeSpanPipe),n.ɵɵinject(o.NgRedux))},token:e,providedIn:"root"}),g([j,$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[String]),b("design:returntype",void 0)],e.prototype,"pipeClassesAndTypes",null),g([j,$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Array]),b("design:returntype",void 0)],e.prototype,"pipeClassesAndTypesOfClasses",null),g([j,$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Array]),b("design:returntype",a.Observable)],e.prototype,"pipeClassAndTypeNodes",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Array]),b("design:returntype",a.Observable)],e.prototype,"pipePropertyOptionsFormClasses",null),g([$({refCount:!1}),b("design:type",Function),b("design:paramtypes",[Object]),b("design:returntype",a.Observable)],e.prototype,"pipePkClassesFromPropertySelectModel",null),e}();function je(e,t){return"_"+e+"_"+(t?"outgoing":"ingoing")}e.ActiveProjectPipesService=be,e.ConfigurationPipesService=he,e.DatSelector=x,e.DfhSelector=M,e.InfSelector=X,e.InformationBasicPipesService=Pe,e.InformationPipesService=$e,e.ProSelector=oe,e.ReduxQueriesModule=P,e.SchemaSelectorsService=ge,e.ShouldPauseService=L,e.SysSelector=ce,e.TabSelector=ye,e.WarSelector=me,e.cache=$,e.propertyOptionFieldKey=je,e.spyTag=j,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=kleiolab-lib-queries.umd.min.js.map