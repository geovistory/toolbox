{"version":3,"file":"kleiolab-lib-utils-src-lib-time-span.umd.js","sources":["ng://@kleiolab/lib-utils/src/lib/time-span/time-span.ts"],"sourcesContent":["import { TimePrimitive } from '@kleiolab/lib-utils/src/lib/date-time';\nimport { WarEntityPreviewTimeSpan, TimePrimitiveWithCal } from '@kleiolab/lib-sdk-lb4';\nexport const x: TimePrimitive = undefined\n\nexport interface TimeSpanWithNumberProps {\n  // key is the dfh_pk_property, expressing what the time primitive means for the time span\n  72?: TimePrimitiveWithCal; // p82 | At some time within | outer bounds | not before â not after\n  152?: TimePrimitiveWithCal; // p82a | begin of the begin | left outer bound | not before\n  153?: TimePrimitiveWithCal; // p82b | end of the end |Â right outer bound |Â not after\n  71?: TimePrimitiveWithCal; // p81 | Ongoing throughout | inner bounds | surely from â surely to\n  150?: TimePrimitiveWithCal; // p81a | end of the begin | left inner bound | surely from\n  151?: TimePrimitiveWithCal; // p81b | begin of the end | right inner bound | surely to\n}\nexport class TimeSpan {\n\n  readonly tpKeys = ['p82', 'p81', 'p82a', 'p82b', 'p81a', 'p81b']\n\n  p82?: TimePrimitive; // At some time within | outer bounds | not before â not after\n  p81?: TimePrimitive; // Ongoing throughout | inner bounds | surely from â surely to\n  p82a?: TimePrimitive; // begin of the begin | left outer bound | not before\n  p81a?: TimePrimitive; // end of the begin | left inner bound | surely from\n  p81b?: TimePrimitive; // begin of the end | right inner bound | surely to\n  p82b?: TimePrimitive; // end of the end |Â right outer bound |Â not after\n\n\n  get earliestDay() {\n\n    if (this.isEmpty()) return null;\n\n    let min = Number.POSITIVE_INFINITY;\n\n    this.tpKeys.forEach(key => {\n      if (this[key]) {\n        const current = this[key].julianDay;\n        // if this timePrimitive is earlier than min, set this as new min\n        min = current < min ? current : min;\n      }\n    })\n\n    return min;\n  }\n\n  /**\n  * get the earliest and latest TimePrimitive of given array of TimePrimitives\n  *\n  * For earliest it compares the begin of TimePrimitive duration\n  * For latest it compares the last second of TimePrimitive duration\n  *\n  * @returns object with min Date and max Date or null, if no TimePrimitive available\n  */\n  static getMinMaxTimePrimitveOfArray(tps: TimePrimitive[]) {\n\n    if (!tps || tps.length < 1) return null;\n\n    let min = tps[0];\n    let max = tps[0];\n\n    tps.forEach(tp => {\n\n      // if this timePrimitive is earlier than min, set this as new min\n      min = tp.getJulianSecond() < min.getJulianSecond() ? tp : min;\n\n      // if this timePrimitive is later than max, set this as new max\n      max = tp.getJulianSecond() > max.getJulianSecond() ? tp : max;\n      //  check if we would need the latest second here?\n      // max = tp.getLastSecond() > max.getLastSecond() ? tp : max;\n\n\n    })\n\n    return { min: min, max: max };\n  }\n\n  static fromTimeSpanDialogData(d: TimeSpanWithNumberProps = {}): TimeSpan {\n    if (!d) d = {};\n    const x = {}\n    if (d['72']) x['p82'] = d['72'];\n    if (d['71']) x['p81'] = d['71'];\n    if (d['152']) x['p82a'] = d['152'];\n    if (d['150']) x['p81a'] = d['150'];\n    if (d['151']) x['p81b'] = d['151'];\n    if (d['153']) x['p82b'] = d['153'];\n    return new TimeSpan(x)\n  }\n\n  constructor(data?: WarEntityPreviewTimeSpan) {\n    if (data) {\n      Object.keys(data).forEach(key => data[key] === undefined ? delete data[key] : '');\n      Object.assign(this, data);\n      this.tpKeys.forEach(key => {\n        if (this[key]) this[key] = new TimePrimitive(this[key]);\n      })\n    }\n  }\n\n\n  /**\n   * returns true if no TimePrimitive is there\n   */\n  isEmpty(): boolean {\n    return !this.isNotEmpty()\n  }\n  /**\n   * returns true if at least one TimePrimitive is there\n   */\n  isNotEmpty(): boolean {\n    if (this.p82 || this.p81 || this.p82a || this.p82b || this.p81a || this.p81b) return true\n    else return false\n  }\n\n\n  /**\n  * get the earliest and latest TimePrimitive of this TimeSpan\n  *\n  * For earliest it compares the begin of TimePrimitive duration\n  * For latest it compares the last second of TimePrimitive duration\n  *\n  * @returns object with min Date and max Date or null, if no TimePrimitive available\n  */\n  getMinMaxTimePrimitive(): { min: TimePrimitive, max: TimePrimitive } | null {\n    return TimeSpan.getMinMaxTimePrimitveOfArray(this.getArrayOfTimePrimitives());\n  }\n\n  /**\n   * @returns array of TimePrimitives of this TimeSpan\n   */\n  getArrayOfTimePrimitives(): TimePrimitive[] {\n    const array = [];\n\n    this.tpKeys.forEach(key => {\n      if (this[key]) {\n        array.push(this[key]);\n      }\n    })\n\n    return array;\n  }\n\n  getPrimitivesForPreview(): { single?: TimePrimitive, begin?: TimePrimitive, end?: TimePrimitive } {\n    const single = this.p82 || this.p81;\n    const begin = this.p82a || this.p81a;\n    const end = this.p82b || this.p81b;\n    return { single, begin, end };\n  }\n\n}\n"],"names":["TimePrimitive"],"mappings":"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"}